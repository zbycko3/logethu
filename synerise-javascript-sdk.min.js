if(function(window,undefined){var _VERSION="3",_MODULE_NAME="default",_BUILD_TIME="2020-04-27",_={},dump,_config={},emptyFn=function(){};"undefined"==typeof console&&(console={log:emptyFn,debug:emptyFn,error:emptyFn,info:emptyFn}),_.addEvent=function(e,t,n){return e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},_.removeEvent=function(e,t,n){return e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},_.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},_.onReady=function(e,t){e.document&&"complete"===e.document.readyState?t():e.document&&e.document.addEventListener?e.document.addEventListener("DOMContentLoaded",t,!1):e.attachEvent?e.attachEvent("onload",t):window.onload=t},_.unescapeHtml=function(e){var t=document.createElement("div");if(t.innerHTML=e,0===t.childNodes.length)return"";var n=t.childNodes[0]?t.childNodes[0].nodeValue:"";return n+=t.childNodes[1]?t.childNodes[1].outerHTML:"",n+=t.childNodes[2]?t.childNodes[2].outerHTML:""},_.insertAfter=function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)},_.insertBefore=function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e)},_.moveChildren=function(e,t){if(e!==t)for(;e.hasChildNodes();)t.appendChild(e.firstChild)},_.documentFragmentInnerHtml=function(e,t){var n=document.createElement("div");n.innerHTML=t,_.moveChildren(n,e)},_.isDocumentFragment=function(e){return e.nodeType===Node.DOCUMENT_FRAGMENT_NODE},_.containerInnerHtml=function(e,t){_.isDocumentFragment(e)?_.documentFragmentInnerHtml(e,t):e.innerHTML=t},_.executeScriptsForScriptTags=function(e){if(e.length){var n=/^$|\/(?:java|ecma)script/i,r=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;_.each(e,function(e){dump.log("_:executeScript",e);var t=e.ownerDocument;n.test(e.type||"")&&(e.src?_.globalEvalScript(e.src,t):_.globalEvalCode(e.textContent.replace(r,""),t))})}},_.executeScripts=function(e){_.executeScriptsForScriptTags(e.querySelectorAll("script"))},_.executeScriptsForNodes=function(e){_.executeScriptsForScriptTags(_.getElementsByTagNameIncludesItself(e,"script"))},_.replaceChildren=function(e,t){_.isElement(t)||_.isDocumentFragment(t)?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t},_.getNodesArray=function(e){var t=[];return e.hasChildNodes()&&_.each(e.childNodes,function(e){t.push(e)}),t},_.getElementsByTagNameIncludesItself=function(e,n){n=n.toLowerCase(),Array.isArray(e)||(e=[e]);var r=[];return _.each(e,function(e){if(e&&e.tagName){e.tagName.toLowerCase()===n&&r.push(e);var t=e.getElementsByTagName(n);t.length&&_.each(t,function(e){r.push(e)})}}),r},_.globalEvalCode=function(e,t){var n=(t=t||document).createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)},_.globalEvalScript=function(e,t){var n=(t=t||document).createElement("script");n.src=e,t.head.appendChild(n)},_.inArray=function(e,t,n){var r="";if(!!n){for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return!0}else for(r in t)if(t.hasOwnProperty(r)&&t[r]==e)return!0;return!1},_.isDocumentVisible=function(){var t,n,e={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(t in e)if(e.hasOwnProperty(t)&&t in document){n=e[t];break}return function(e){return e&&document.addEventListener(n,e),!document[t]}}();var timer={objects:[],_timerObject:function(e){this.label=e,this.time=(new Date).getTime(),this.getLabel=function(){return this.label},this.getElapsedTime=function(){return(new Date).getTime()-this.time},this.getElapsedTimeString=function(){return this.getElapsedTime()+" ms"},this.getTime=function(){return this.time},this.log=function(){timer.log(this)}},create:function(e){var t=new this._timerObject(e);return this.objects[e]=t},get:function(e){return void 0!==e&&e||(e="__main__"),void 0===this.objects[e]&&(this.objects[e]=new this._timerObject(e)),this.objects[e]},log:function(e){dump.log('Timer "'+e.getLabel()+'" took '+e.getElapsedTimeString())}},Utils={_promiseHandlers:{},_persistentPromiseHandlers:{},encodeString:function(e,t){return"function"==typeof encodeURIComponent?t?encodeURI(e):encodeURIComponent(e):escape(e)},prepareTimeForDate:function(e,t){t=t?new Date(t.getTime()):new Date;var n=e.split(":");return t.setHours(n[0]),t.setMinutes(n[1]),t.setSeconds(n[2]),t},addStyles:function(n){return new Promise(function(e,t){if(dump.log("Utils:addStyles"),!n)return e(null);Array.isArray(n)||(n=[n]),_.each(n,function(e){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(t)}),e(n)})},uniquePromiseHandler:function(t,n){if(Utils._promiseHandlers[t])return Utils._promiseHandlers[t];var e=new Promise(n);return(Utils._promiseHandlers[t]=e).then(function(){dump.log("Utils:uniquePromiseHandler then",t,n),delete Utils._promiseHandlers[t]}).catch(function(e){dump.log("Utils:uniquePromiseHandler catch",t,n,e),delete Utils._promiseHandlers[t]}),e},persistentPromiseHandler:function(e,t){return Utils._persistentPromiseHandlers[e]||(Utils._persistentPromiseHandlers[e]=new Promise(t)),Utils._persistentPromiseHandlers[e]},addClass:function(e,t){Utils.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){Utils.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("\\b"+t+"\\b","g"),""))},hasClass:function(e,t){return!!e.className.match(new RegExp("\\b"+t+"\\b","g"))},attachHandlerForElements:function(e,n,r,i){dump.log("Utils:attachHandlerForElements",e.length,e),0<e.length&&_.each(e,function(t,e){Utils.addEvent(t,n,function(e){dump.log("Utils:attachHandlerForElements on event ",n,e,this,t),!1!==i&&_.preventDefault(e),r(e)})})},attachHandlerByClassName:function(e,t,n,r,i){var o=e.getElementsByClassName(t);Utils.attachHandlerForElements(o,n,r,i)},attachHandlerByQuerySelectorAll:function(e,t,n,r,i){var o=e.querySelectorAll(t);Utils.attachHandlerForElements(o,n,r,i)},timer:timer,hashString:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t},getBoundingClientRect:function(e){if(e.getBoundingClientRect)return e.getBoundingClientRect();if(document.createRange&&e.nodeType===Node.TEXT_NODE){var t=document.createRange();if(t.selectNodeContents(e),t.getBoundingClientRect)return t.getBoundingClientRect()}return null},isVisibleOnScreen:function(e){var t=Utils.getWindowHeight();return Utils.isVisibleOnScreenForViewHeight(e,t)},isVisibleOnScreenForViewHeight:function(e,t){var n=Utils.getBoundingClientRect(e);return!(!n||0===n.top&&0===n.left&&0===n.width&&0===n.height||n.left<0&&n.right<0)&&!(n.bottom<0||0<=n.top-t)},isVisibleAtLeastOneElementOnScreen:function(e){if(!e)return!1;Array.isArray(e)||(e=[e]);var t=Utils.getWindowHeight();for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];if(r&&Utils.isVisibleOnScreenForViewHeight(r,t))return dump.info("Utils:isVisibleAtLeastOneElementOnScreen element is visible on screen",r),!0}return!1},getWindowHeight:function(){return Math.max(window.innerHeight,document.documentElement.clientHeight,0)},getWindowYScroll:function(){return window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0},getDocumentHeight:function(){return Math.max(document.body.scrollHeight||0,document.documentElement.scrollHeight||0,document.body.offsetHeight||0,document.documentElement.offsetHeight||0,document.body.clientHeight||0,document.documentElement.clientHeight||0)},getScrollPercentage:function(){return(Utils.getWindowYScroll()+Utils.getWindowHeight())/Utils.getDocumentHeight()*100},escapeHTML:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},generateUUID:function(){var n=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},addEvent:function(t,e,n){return"click"===e?_.addEvent(t,e,function(e){return ErrorHandler.handleClick(t),n(e)}):_.addEvent(t,e,n)},removeEvent:function(e,t,n){return _.removeEvent(e,t,n)}},ErrorHandler={_events:[],_startTime:null,_groupUuid:null,_intervalId:null,_delayTimeoutId:null,_maxEventCount:25,_logingConditions:[],LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},SCOPE:{inner:"inner",outer:"outer"},init:function(e){e=e||{},ErrorHandler._startTime=e.startTime?e.startTime:(new Date).getTime(),ErrorHandler._groupUuid=Utils.generateUUID(),ErrorHandler._attachWindowErrorListener(),ErrorHandler._logingConditions=[{level:ErrorHandler.LEVEL.fatal,scope:ErrorHandler.SCOPE.inner},{level:ErrorHandler.LEVEL.error,type:ErrorHandler.TYPE.request,scope:ErrorHandler.SCOPE.inner}],ErrorSender.init()},callFunctionAndLogError:function(e,t,n){var r,i;for(var o in e.apply(this,t),t)if(t[o]instanceof Error){r=t[o];break}if("string"==typeof t[0]&&(i=t[0]),r){var a=ErrorHandler._prepareEventFromError(r,ErrorHandler.TYPE.general,n);i&&(a.msg=i+" "+a.msg),ErrorHandler.handleEvent(a)}else ErrorHandler.handleError(new Error(i||"Unknown error dump message"),ErrorHandler.TYPE.general,n)},handleError:function(e,t,n,r){ErrorHandler.handleEvent(ErrorHandler._prepareEventFromError(e,t,n,r))},handleClick:function(e){ErrorHandler.handleEvent(ErrorHandler._prepareEventFromElement(e,ErrorHandler.TYPE.click,ErrorHandler.LEVEL.info,ErrorHandler.SCOPE.inner))},handleEvent:function(e){ErrorHandler._checkAndRichEvent(e),ErrorHandler._pushEvent(e)},handleFetch:function(t,e){var n,r=(new Date).getTime();return e.then(function(e){return n=200===e.status||201===e.status||0===e.status?_.extend(ErrorHandler._prepareEventDataFromRequest(t),{level:ErrorHandler.LEVEL.info,type:ErrorHandler.TYPE.request,msg:"Fetch request succeeded",statusCode:e.status}):_.extend(ErrorHandler._prepareEventDataFromRequest(t),{level:ErrorHandler.LEVEL.error,type:ErrorHandler.TYPE.request,name:"Fetch request fail",msg:e.statusText,stack:(new Error).stack,statusCode:e.status}),e}).catch(function(e){return n=_.extend(ErrorHandler._prepareEventDataFromRequest(t),ErrorHandler._prepareEventFromError(e,ErrorHandler.TYPE.request)),Promise.reject(e)}).finally(function(){n.requestDuration=(new Date).getTime()-r,ErrorHandler.handleEvent(n)})},sendEvents:function(){ErrorHandler._sendEventsToSender(),ErrorHandler._attachDelayAndSendFewEventsAfterTriggered()},_sendEventsToSender:function(){var e=[].concat(ErrorHandler._events);ErrorSender.sendEvents(e),ErrorHandler._events=[]},_attachDelayAndSendFewEventsAfterTriggered:function(){ErrorHandler._delayTimeoutId&&(clearTimeout(ErrorHandler._delayTimeoutId),ErrorHandler._delayTimeoutId=null),ErrorHandler._delayTimeoutId=setTimeout(function(){ErrorHandler._sendEventsToSender()},15)},_prepareEventFromElement:function(e,t,n,r){var i=e.nodeName?e.nodeName:null,o=e.className?e.className:null;return{level:n||ErrorHandler.LEVEL.error,type:t||ErrorHandler.TYPE.general,scope:r||ErrorHandler.SCOPE.inner,name:"NodeEvent",msg:'Action on "'+(i||"unknown")+'" node with class name "'+(o||"")+'"',nodeName:"string"==typeof i?i.toLowerCase():null,className:o}},_prepareEventFromError:function(e,t,n,r){var i=e.stack,o=e.toString();return{level:n||ErrorHandler.LEVEL.error,type:t||ErrorHandler.TYPE.general,scope:r||ErrorHandler.SCOPE.inner,name:e.name,msg:o,stack:i}},_prepareEventDataFromRequest:function(e){return{method:e.method,url:e.url,bodyUsed:e.bodyUsed,cache:e.cache,keepalive:e.keepalive}},_pushEvent:function(e){ErrorHandler._applyEventsLimit(),ErrorHandler._events.push(e),ErrorHandler._checkConditionsAndSend(e)},_checkConditionsAndSend:function(e){ErrorHandler._checkConditions(e)&&ErrorHandler.sendEvents()},_checkConditions:function(e){if(e.level===ErrorHandler.LEVEL.error&&e.type===ErrorHandler.TYPE.request&&-1!==(e.url||"").indexOf("web-push/get-public-config"))return!1;for(var t in ErrorHandler._logingConditions)if(ErrorHandler._logingConditions.hasOwnProperty(t)){var n=ErrorHandler._logingConditions[t];if(ErrorHandler._checkCondition(e,n))return!0}return!1},_checkCondition:function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0},_applyEventsLimit:function(){if(ErrorHandler._events.length>=ErrorHandler._maxEventCount){var e=ErrorHandler._events.shift();if(e.type===ErrorHandler.TYPE.lost)ErrorHandler._events.shift(),e.lostCount++,ErrorHandler._events.unshift(e);else{var t=ErrorHandler._checkAndRichEvent({level:ErrorHandler.LEVEL.info,type:ErrorHandler.TYPE.lost,name:"LostEventsLimitAchieved",msg:"First lost event message: "+e.msg,lostCount:1});ErrorHandler._events.splice(0,1,t)}}},_attachWindowErrorListener:function(){Utils.addEvent(window,"error",function(e){e.error&&ErrorHandler.handleError(e.error,ErrorHandler.TYPE.general,ErrorHandler.LEVEL.error,ErrorHandler.SCOPE.outer)})},_checkAndRichEvent:function(e){if(!e||!e.level||!e.type)throw new Error("Invalid event to handle by error handler");if(!e.clientUuid){var t=ClientManager.getClientFromStore();e.clientUuid=t.uuid,e.clientPermUuid=t.permUuid}if(void 0===e.scrollPercentage&&(e.scrollPercentage=Utils.getScrollPercentage()),!e.time){var n=(new Date).getTime();e.startTime=ErrorHandler._startTime,e.time=n,e.elapsedTime=n-ErrorHandler._startTime}return e.groupUuid||(e.groupUuid=ErrorHandler._groupUuid),e.eventUuid||(e.eventUuid=Utils.generateUUID()),e.scope||(e.scope=ErrorHandler.SCOPE.inner),e.href||(e.href=window.location.href),e.source="sdk-js",e.sdkVersion=Core.getVersion(),e.sdkModule=Core.getModuleName(),e.sdkBuildTime=Core.getBuildTime(),e}},ErrorSender={_logsToSend:[],_eventLost:null,_intervalId:null,_intervalMs:100,_timeout:4e3,_trackerLogsUrl:"https://tck.snrbox.com/logs",_localStorageLogsKey:"_snrs_error_logs",_maxLogsCount:100,LEVEL:{fatal:"fatal",error:"error",info:"info",debug:"debug"},TYPE:{general:"general",request:"request",log:"log",click:"click",lost:"lost"},init:function(e){e=e||{},RequestLimiter.init(),ErrorSender._restoreLogs(),ErrorSender._attachHandlers(),ErrorSender._startLogging()},sendEvents:function(e){var t=ErrorSender._applyLogsLimit(e);ErrorSender._logsToSend=ErrorSender._logsToSend.concat(t)},_attachHandlers:function(){window.onbeforeunload=function(){ErrorSender._storeLogs()},ErrorSender._attachLoggingOnMouseExit()},_attachLoggingOnMouseExit:function(){Utils.addEvent(document,"mouseout",function(e){e.clientY<=0&&setTimeout(function(){ErrorSender.flush()},10)})},_applyLogsLimit:function(e){var t=e;if(e.length>ErrorSender._maxLogsCount){t=e.slice(e.length-ErrorSender._maxLogsCount+1);var n=e.slice(0,e.length-ErrorSender._maxLogsCount+1),r=ErrorSender._logsToSend[0]||n[0],i=ErrorHandler._checkAndRichEvent({level:ErrorHandler.LEVEL.info,type:ErrorHandler.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+r.msg,lostCount:n.length+ErrorSender._logsToSend.length});ErrorSender._logsToSend=[i]}else if(ErrorSender._logsToSend.length+e.length>ErrorSender._maxLogsCount){var o=ErrorSender._logsToSend[0];if(o.type===ErrorHandler.TYPE.lost&&"LostLogsToSendLimitAchieved"===o.name){t=e.slice(e.length-ErrorSender._maxLogsCount+1);var a=ErrorSender._logsToSend.length+t.length-ErrorSender._maxLogsCount;ErrorSender._logsToSend=ErrorSender._logsToSend.slice(a+1),ErrorSender._logsToSend.unshift(o),o.lostCount+=a}else{i=ErrorHandler._checkAndRichEvent({level:ErrorHandler.LEVEL.info,type:ErrorHandler.TYPE.lost,name:"LostLogsToSendLimitAchieved",msg:"First lost event message: "+o.msg,lostCount:a}),a=ErrorSender._logsToSend.length+e.length-ErrorSender._maxLogsCount;ErrorSender._logsToSend=ErrorSender._logsToSend.slice(a+1),ErrorSender._logsToSend.unshift(i)}}return t},flush:function(){ErrorSender._logsToSend.length&&Auth.checkAuth()&&ErrorSender._requestLogs(function(){})},_requestLogs:function(e){var t=[].concat(ErrorSender._logsToSend);ErrorSender._logsToSend=[],ErrorSender._requestWithLimits(t,e)},_request:function(e,t){var n=new XMLHttpRequest;n.open("POST",ErrorSender._trackerLogsUrl,!0),n.withCredentials=!0,n.timeout=ErrorSender._timeout,n.setRequestHeader(Auth.getHeaderAuth("key"),Auth.getHeaderAuth("value")),n.setRequestHeader("Content-type","application/json"),n.ontimeout=function(e){},n.onabort=function(e){},n.onerror=function(e){},n.onreadystatechange=function(){4===n.readyState&&t(n)},n.send(JSON.stringify(e))},_requestWithLimits:function(e,t){RequestLimiter.request(function(){ErrorSender._request(e,function(e){t(e)})})},_startLogging:function(){ErrorSender._intervalId=setInterval(function(){ErrorSender.flush()},ErrorSender._intervalMs)},_setToLocalStore:function(e){LocalStore.setString(ErrorSender._localStorageLogsKey,JSON.stringify(e))},_getFromLocalStore:function(){var e=LocalStore.getString(ErrorSender._localStorageLogsKey);return e?JSON.parse(e):null},_getAndRemoveFromLocalStore:function(){var e=LocalStore.getString(ErrorSender._localStorageLogsKey);return e?(LocalStore.remove(ErrorSender._localStorageLogsKey),JSON.parse(e)):null},_storeLogs:function(){var e=[].concat(ErrorSender._logsToSend);if(ErrorSender._logsToSend=[],e.length){var t=ErrorSender._getFromLocalStore();t&&t.length,ErrorSender._setToLocalStore(e)}},_restoreLogs:function(){var e=ErrorSender._getAndRemoveFromLocalStore();e&&e.length&&ErrorSender.sendEvents(e)}},RequestLimiter={_locked:!1,_lockedTimeEnd:null,_count:0,_countAll:0,_maxCount:10,_maxCountAll:100,_timeMs:1e4,_localStorageLimitAchievedKey:"_snrs_logs_limit_achieved",_lockForTimeMs:18e4,init:function(e){e=e||{},RequestLimiter._startThrottling()},request:function(e){RequestLimiter._checkAndLock()||(RequestLimiter._count++,RequestLimiter._countAll++,e())},_startThrottling:function(){var e=RequestLimiter._checkAndRemoveLockTimeFromStoreIfExpired();e&&RequestLimiter._lock(e),setInterval(function(){RequestLimiter._count=0},RequestLimiter._timeMs)},_checkAndLock:function(){return!!RequestLimiter._locked||(RequestLimiter._count>RequestLimiter._maxCount||RequestLimiter._countAll>RequestLimiter._maxCountAll)&&(RequestLimiter._lockAndStore(),!0)},_lock:function(e){e=e||(new Date).getTime()+RequestLimiter._lockForTimeMs,RequestLimiter._locked=!0,RequestLimiter._lockedTimeEnd=e,RequestLimiter._setUnlockTimer(RequestLimiter._lockedTimeEnd)},_lockAndStore:function(){RequestLimiter._lock(),RequestLimiter._setTimeToLocalStore(RequestLimiter._lockedTimeEnd)},_unlockAndStore:function(){RequestLimiter._locked=!1,RequestLimiter._lockedTimeEnd=null,RequestLimiter._count=0,RequestLimiter._countAll=0,RequestLimiter._checkAndRemoveLockTimeFromStoreIfExpired()},_checkAndRemoveLockTimeFromStoreIfExpired:function(){var e=RequestLimiter._getTimeFromLocalStore();return e&&e-(new Date).getTime()<=0?(LocalStore.remove(LocalStore._localStorageLimitAchievedKey),null):e},_setUnlockTimer:function(e){var t=e-(new Date).getTime();0<t?setTimeout(function(){RequestLimiter._unlockAndStore()},t):setTimeout(function(){RequestLimiter._unlockAndStore()},10)},_setTimeToLocalStore:function(e){LocalStore.setString(LocalStore._localStorageLimitAchievedKey,e+"")},_getTimeFromLocalStore:function(){var e=LocalStore.getString(LocalStore._localStorageLimitAchievedKey);if(e){var t=parseInt(e,10);return isNaN(t)?null:t}return null}},startDate=Utils.timer.get(),SyneriseLibraryScope={},libWrapper=function(){var e,t,n,r,D=undefined,zn=undefined,i=undefined;e=this,t=function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){var t=S.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function t(e){return null==e.passiveListener?void(!e.event.cancelable||(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault())):void("undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener))}function u(e,t){S.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var n,r=Object.keys(t),i=0;i<r.length;++i)(n=r[i])in this||Object.defineProperty(this,n,d(n))}function d(t){return{get:function(){return l(this).event[t]},set:function(e){l(this).event[t]=e},configurable:!0,enumerable:!0}}function h(t){return{value:function(){var e=l(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function p(e){if(null==e||e===Object.prototype)return u;var t=C.get(e);return null==t&&(t=function(n,e){function t(e,t){n.call(this,e,t)}var r=Object.keys(e);if(0===r.length)return n;t.prototype=Object.create(n.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var i,o=0;o<r.length;++o)if(!((i=r[o])in n.prototype)){var a="function"==typeof Object.getOwnPropertyDescriptor(e,i).value;Object.defineProperty(t.prototype,i,a?h(i):d(i))}return t}(p(Object.getPrototypeOf(e)),e),C.set(e,t)),t}function f(e,t){l(e).passiveListener=t}function g(e){return null!==e&&"object"===n(e)}function m(e){var t=P.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function y(e,t){var o;Object.defineProperty(e,"on".concat(t),(o=t,{get:function(){for(var e=m(this).get(o);null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set:function(e){"function"==typeof e||g(e)||(e=null);for(var t=m(this),n=null,r=t.get(o);null!=r;)3===r.listenerType?null===n?null===r.next?t.delete(o):t.set(o,r.next):n.next=r.next:n=r,r=r.next;if(null!==e){var i={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===n?t.set(o,i):n.next=i}},configurable:!0,enumerable:!0}))}function b(e){function t(){v.call(this)}t.prototype=Object.create(v.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(var n=0;n<e.length;++n)y(t.prototype,e[n]);return t}function v(){if(!(this instanceof v)){if(1===arguments.length&&Array.isArray(arguments[0]))return b(arguments[0]);if(0<arguments.length){for(var e=Array(arguments.length),t=0;t<arguments.length;++t)e[t]=arguments[t];return b(e)}throw new TypeError("Cannot call a class as a function")}P.set(this,new Map)}function _(e){var t=T.get(e);if(null==t)throw new TypeError("Expected 'this' to be an 'AbortController' object, but got ".concat(null===e?"null":n(e)));return t}var S=new WeakMap,C=new WeakMap;u.prototype={get type(){return l(this).event.type},get target(){return l(this).eventTarget},get currentTarget(){return l(this).currentTarget},composedPath:function(){var e=l(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return l(this).eventPhase},stopPropagation:function(){var e=l(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation:function(){var e=l(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return!!l(this).event.bubbles},get cancelable(){return!!l(this).event.cancelable},preventDefault:function(){t(l(this))},get defaultPrevented(){return l(this).canceled},get composed(){return!!l(this).event.composed},get timeStamp(){return l(this).timeStamp},get srcElement(){return l(this).eventTarget},get cancelBubble(){return l(this).stopped},set cancelBubble(e){if(e){var t=l(this);t.stopped=!0,"boolean"==typeof t.event.cancelBubble&&(t.event.cancelBubble=!0)}},get returnValue(){return!l(this).canceled},set returnValue(e){e||t(l(this))},initEvent:function(){}},Object.defineProperty(u.prototype,"constructor",{value:u,configurable:!0,writable:!0}),void 0!==window&&void 0!==window.Event&&(Object.setPrototypeOf(u.prototype,window.Event.prototype),C.set(window.Event.prototype,u));var P=new WeakMap;v.prototype={addEventListener:function(e,t,n){if(null!=t){if("function"!=typeof t&&!g(t))throw new TypeError("'listener' should be a function or an object.");var r=m(this),i=g(n),o=(i?!!n.capture:!!n)?1:2,a={listener:t,listenerType:o,passive:i&&!!n.passive,once:i&&!!n.once,next:null},s=r.get(e);if(void 0===s)return void r.set(e,a);for(var c=null;null!=s;){if(s.listener===t&&s.listenerType===o)return;s=(c=s).next}c.next=a}},removeEventListener:function(e,t,n){if(null!=t)for(var r=m(this),i=(g(n)?!!n.capture:!!n)?1:2,o=null,a=r.get(e);null!=a;){if(a.listener===t&&a.listenerType===i)return void(null===o?null===a.next?r.delete(e):r.set(e,a.next):o.next=a.next);a=(o=a).next}},dispatchEvent:function(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');var t,n,r,i,o=m(this),a=e.type,s=o.get(a);if(null==s)return!0;for(var c=(t=this,n=e,new(p(Object.getPrototypeOf(n)))(t,n)),u=null;null!=s;){if(s.once?null===u?null===s.next?o.delete(a):o.set(a,s.next):u.next=s.next:u=s,f(c,s.passive?s.listener:null),"function"==typeof s.listener)try{s.listener.call(this,c)}catch(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==s.listenerType&&"function"==typeof s.listener.handleEvent&&s.listener.handleEvent(c);if(l(c).immediateStopped)break;s=s.next}return f(c,null),i=0,l(c).eventPhase=i,r=null,l(c).currentTarget=r,!c.defaultPrevented}},Object.defineProperty(v.prototype,"constructor",{value:v,configurable:!0,writable:!0}),void 0!==window&&void 0!==window.EventTarget&&Object.setPrototypeOf(v.prototype,window.EventTarget.prototype);var w=function(e){function t(){throw r(this,t),c(this,a(t).call(this)),new TypeError("AbortSignal cannot be constructed directly")}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,v),o(t,[{key:"aborted",get:function(){var e=M.get(this);if("boolean"!=typeof e)throw new TypeError("Expected 'this' to be an 'AbortSignal' object, but got ".concat(null===this?"null":n(this)));return e}}]),t}();y(w.prototype,"abort");var M=new WeakMap;Object.defineProperties(w.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===n(Symbol.toStringTag)&&Object.defineProperty(w.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var E=function(){function t(){var e;r(this,t),T.set(this,(e=Object.create(w.prototype),v.call(e),M.set(e,!1),e))}return o(t,[{key:"abort",value:function(){var e;e=_(this),!1!==M.get(e)||(M.set(e,!0),e.dispatchEvent({type:"abort"}))}},{key:"signal",get:function(){return _(this)}}]),t}(),T=new WeakMap;if(Object.defineProperties(E.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"===n(Symbol.toStringTag)&&Object.defineProperty(E.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),e.AbortController=E,e.AbortSignal=w,e.default=E,Object.defineProperty(e,"__esModule",{value:!0}),void 0===zn&&void 0===D){var k=Function("return this")();void 0===k.AbortController&&(k.AbortController=E,k.AbortSignal=w)}},"object"==typeof i&&void 0!==zn?t(i):"function"==typeof D&&D.amd?D(["exports"],t):t((e=e||self).AbortControllerShim={}),function(s){s.emojioneList={":smiley:":{unicode:["1f603"],fname:"1f603",uc:"1f603",isCanonical:!0},":laughing:":{unicode:["1f606"],fname:"1f606",uc:"1f606",isCanonical:!0},":wink:":{unicode:["1f609"],fname:"1f609",uc:"1f609",isCanonical:!0},":disappointed:":{unicode:["1f61e"],fname:"1f61e",uc:"1f61e",isCanonical:!0},":joy:":{unicode:["1f602"],fname:"1f602",uc:"1f602",isCanonical:!0},":cry:":{unicode:["1f622"],fname:"1f622",uc:"1f622",isCanonical:!0},":heart:":{unicode:["2764-fe0f","2764"],fname:"2764",uc:"2764",isCanonical:!0},":broken_heart:":{unicode:["1f494"],fname:"1f494",uc:"1f494",isCanonical:!0},":kissing_heart:":{unicode:["1f618"],fname:"1f618",uc:"1f618",isCanonical:!0},":dizzy_face:":{unicode:["1f635"],fname:"1f635",uc:"1f635",isCanonical:!0},":sunglasses:":{unicode:["1f60e"],fname:"1f60e",uc:"1f60e",isCanonical:!0},":confused:":{unicode:["1f615"],fname:"1f615",uc:"1f615",isCanonical:!0},":stuck_out_tongue:":{unicode:["1f61b"],fname:"1f61b",uc:"1f61b",isCanonical:!0},":open_mouth:":{unicode:["1f62e"],fname:"1f62e",uc:"1f62e",isCanonical:!0},":thumbsup:":{unicode:["1f44d"],fname:"1f44d",uc:"1f44d",isCanonical:!0},":thumbsdown:":{unicode:["1f44e"],fname:"1f44e",uc:"1f44e",isCanonical:!0},":ok_hand:":{unicode:["1f44c"],fname:"1f44c",uc:"1f44c",isCanonical:!0},":muscle:":{unicode:["1f4aa"],fname:"1f4aa",uc:"1f4aa",isCanonical:!0},":angry:":{unicode:["1f620"],fname:"1f620",uc:"1f620",isCanonical:!0},":sob:":{unicode:["1f62d"],fname:"1f62d",uc:"1f62d",isCanonical:!0}};var e,t=[];for(e in s.emojioneList)s.emojioneList.hasOwnProperty(e)&&t.push(e.replace(/[+]/g,"\\$&"));s.shortnames=t.join("|"),s.asciiList={"<3":"2764","</3":"1f494",":')":"1f602",":'-)":"1f602",":D":"1f603",":-D":"1f603","=D":"1f603",":)":"1f642",":-)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642","':)":"1f605","':-)":"1f605","'=)":"1f605","':D":"1f605","':-D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">:-)":"1f606",">=)":"1f606",";)":"1f609",";-)":"1f609","*-)":"1f609","*)":"1f609",";-]":"1f609",";]":"1f609",";D":"1f609",";^)":"1f609","':(":"1f613","':-(":"1f613","'=(":"1f613",":*":"1f618",":-*":"1f618","=*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c","x-p":"1f61c",">:[":"1f61e",":-(":"1f61e",":(":"1f61e",":-[":"1f61e",":[":"1f61e","=(":"1f61e",">:(":"1f620",">:-(":"1f620",":@":"1f620",":'(":"1f622",":'-(":"1f622",";(":"1f622",";-(":"1f622",">.<":"1f623","D:":"1f628",":$":"1f633","=$":"1f633","#-)":"1f635","#)":"1f635","%-)":"1f635","%)":"1f635","X)":"1f635","X-)":"1f635","*\\0/*":"1f646","\\0/":"1f646","*\\O/*":"1f646","\\O/":"1f646","O:-)":"1f607","0:-3":"1f607","0:3":"1f607","0:-)":"1f607","0:)":"1f607","0;^)":"1f607","O:)":"1f607","O;-)":"1f607","O=)":"1f607","0;-)":"1f607","O:-3":"1f607","O:3":"1f607","B-)":"1f60e","B)":"1f60e","8)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611","-__-":"1f611","-___-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b",":-P":"1f61b","=P":"1f61b",":-p":"1f61b",":p":"1f61b","=p":"1f61b",":-Þ":"1f61b",":Þ":"1f61b",":þ":"1f61b",":-þ":"1f61b",":-b":"1f61b",":b":"1f61b","d:":"1f61b",":-O":"1f62e",":O":"1f62e",":-o":"1f62e",":o":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":X":"1f636",":-#":"1f636",":#":"1f636","=X":"1f636","=x":"1f636",":x":"1f636",":-x":"1f636","=#":"1f636"},s.asciiRegexp="(\\<3|&lt;3|\\<\\/3|&lt;\\/3|\\:'\\)|\\:'\\-\\)|\\:D|\\:\\-D|\\=D|\\:\\)|\\:\\-\\)|\\=\\]|\\=\\)|\\:\\]|'\\:\\)|'\\:\\-\\)|'\\=\\)|'\\:D|'\\:\\-D|'\\=D|\\>\\:\\)|&gt;\\:\\)|\\>;\\)|&gt;;\\)|\\>\\:\\-\\)|&gt;\\:\\-\\)|\\>\\=\\)|&gt;\\=\\)|;\\)|;\\-\\)|\\*\\-\\)|\\*\\)|;\\-\\]|;\\]|;D|;\\^\\)|'\\:\\(|'\\:\\-\\(|'\\=\\(|\\:\\*|\\:\\-\\*|\\=\\*|\\:\\^\\*|\\>\\:P|&gt;\\:P|X\\-P|x\\-p|\\>\\:\\[|&gt;\\:\\[|\\:\\-\\(|\\:\\(|\\:\\-\\[|\\:\\[|\\=\\(|\\>\\:\\(|&gt;\\:\\(|\\>\\:\\-\\(|&gt;\\:\\-\\(|\\:@|\\:'\\(|\\:'\\-\\(|;\\(|;\\-\\(|\\>\\.\\<|&gt;\\.&lt;|D\\:|\\:\\$|\\=\\$|#\\-\\)|#\\)|%\\-\\)|%\\)|X\\)|X\\-\\)|\\*\\\\0\\/\\*|\\\\0\\/|\\*\\\\O\\/\\*|\\\\O\\/|O\\:\\-\\)|0\\:\\-3|0\\:3|0\\:\\-\\)|0\\:\\)|0;\\^\\)|O\\:\\-\\)|O\\:\\)|O;\\-\\)|O\\=\\)|0;\\-\\)|O\\:\\-3|O\\:3|B\\-\\)|B\\)|8\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\-__\\-|\\-___\\-|\\>\\:\\\\|&gt;\\:\\\\|\\>\\:\\/|&gt;\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\:\\-P|\\=P|\\:\\-p|\\:p|\\=p|\\:\\-Þ|\\:\\-&THORN;|\\:Þ|\\:&THORN;|\\:þ|\\:&thorn;|\\:\\-þ|\\:\\-&thorn;|\\:\\-b|\\:b|d\\:|\\:\\-O|\\:O|\\:\\-o|\\:o|O_O|\\>\\:O|&gt;\\:O|\\:\\-X|\\:X|\\:\\-#|\\:#|\\=X|\\=x|\\:x|\\:\\-x|\\=#)",s.unicodeRegexp="",s.jsEscapeMap={},s.imagePathPNG="https://cdn.jsdelivr.net/emojione/assets/png/",s.imagePathSVG="https://cdn.jsdelivr.net/emojione/assets/svg/",s.imagePathSVGSprites="./../assets/sprites/emojione.sprites.svg",s.imageType="png",s.imageTitleTag=!0,s.sprites=!1,s.unicodeAlt=!0,s.ascii=!1,s.cacheBustParam="?v=2.2.7",s.regShortNames=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|("+s.shortnames+")","gi"),s.regAscii=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)"+s.asciiRegexp+"(?=\\s|$|[!,.?]))","g"),s.regUnicode=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|("+s.unicodeRegexp+")","gi"),s.toImage=function(e){return e=s.unicodeToImage(e),e=s.shortnameToImage(e)},s.unifyUnicode=function(e){return e=s.toShort(e),e=s.shortnameToUnicode(e)},s.shortnameToAscii=function(e){var t,n=s.objectFlip(s.asciiList);return e=e.replace(s.regShortNames,function(e){return void 0!==e&&""!==e&&e in s.emojioneList?(t=s.emojioneList[e].unicode[s.emojioneList[e].unicode.length-1],void 0!==n[t]?n[t]:e):e})},s.shortnameToUnicode=function(e){var i,t;return e=e.replace(s.regShortNames,function(e){return void 0!==e&&""!==e&&e in s.emojioneList?(i=s.emojioneList[e].unicode[0].toUpperCase(),s.emojioneList[e].fname,t=s.emojioneList[e].uc,s.convert(t)):e}),s.ascii&&(e=e.replace(s.regAscii,function(e,t,n,r){return void 0!==r&&""!==r&&s.unescapeHTML(r)in s.asciiList?(r=s.unescapeHTML(r),i=s.asciiList[r].toUpperCase(),n+s.convert(i)):e})),e},s.shortnameToImage=function(e){var i,o,a;return e=e.replace(s.regShortNames,function(e){return void 0!==e&&""!==e&&e in s.emojioneList?(i=s.emojioneList[e].unicode[s.emojioneList[e].unicode.length-1],a=s.imageTitleTag?'title="'+e+'"':"",o=s.unicodeAlt?s.convert(i.toUpperCase()):e,"png"===s.imageType?s.sprites?'<span class="emojione emojione-'+i+'" '+a+">"+o+"</span>":'<img class="emojione" alt="'+o+'" '+a+' src="'+s.imagePathPNG+i+".png"+s.cacheBustParam+'"/>':s.sprites?'<svg class="emojione"><description>'+o+'</description><use xlink:href="'+s.imagePathSVGSprites+"#emoji-"+i+'"></use></svg>':'<object class="emojione" data="'+s.imagePathSVG+i+".svg"+s.cacheBustParam+'" type="image/svg+xml" standby="'+o+'">'+o+"</object>"):e}),s.ascii&&(e=e.replace(s.regAscii,function(e,t,n,r){return void 0!==r&&""!==r&&s.unescapeHTML(r)in s.asciiList?(r=s.unescapeHTML(r),i=s.asciiList[r],a=s.imageTitleTag?'title="'+s.escapeHTML(r)+'"':"",o=s.unicodeAlt?s.convert(i.toUpperCase()):s.escapeHTML(r),"png"===s.imageType?s.sprites?n+'<span class="emojione emojione-'+i+'"  '+a+">"+o+"</span>":n+'<img class="emojione" alt="'+o+'" '+a+' src="'+s.imagePathPNG+i+".png"+s.cacheBustParam+'"/>':s.sprites?'<svg class="emojione"><description>'+o+'</description><use xlink:href="'+s.imagePathSVGSprites+"#emoji-"+i+'"></use></svg>':n+'<object class="emojione" data="'+s.imagePathSVG+i+".svg"+s.cacheBustParam+'" type="image/svg+xml" standby="'+o+'">'+o+"</object>"):e})),e},s.unicodeToImage=function(e){var t,n,r,i,o,a=s.mapUnicodeToShort();return e=e.replace(s.regUnicode,function(e){return void 0!==e&&""!==e&&e in s.jsEscapeMap?(t=s.jsEscapeMap[e],n=a[t],r=s.emojioneList[n].fname,i=s.unicodeAlt?s.convert(t.toUpperCase()):n,o=s.imageTitleTag?'title="'+n+'"':"","png"===s.imageType?s.sprites?'<span class="emojione emojione-'+t+'" '+o+">"+i+"</span>":'<img class="emojione" alt="'+i+'" '+o+' src="'+s.imagePathPNG+r+".png"+s.cacheBustParam+'"/>':s.sprites?'<svg class="emojione"><description>'+i+'</description><use xlink:href="'+s.imagePathSVGSprites+"#emoji-"+t+'"></use></svg>':'<img class="emojione" alt="'+i+'" '+o+' src="'+s.imagePathSVG+r+".svg"+s.cacheBustParam+'"/>'):e})},s.toShort=function(e){var t=s.getUnicodeReplacementRegEx(),n=s.mapUnicodeCharactersToShort();return s.replaceAll(e,t,n)},s.convert=function(e){if(-1<e.indexOf("-")){for(var t=[],n=e.split("-"),r=0;r<n.length;r++){var i=parseInt(n[r],16);if(65536<=i&&i<=1114111){var o=Math.floor((i-65536)/1024)+55296,a=(i-65536)%1024+56320;i=String.fromCharCode(o)+String.fromCharCode(a)}else i=String.fromCharCode(i);t.push(i)}return t.join("")}if(65536<=(n=parseInt(e,16))&&n<=1114111){o=Math.floor((n-65536)/1024)+55296,a=(n-65536)%1024+56320;return String.fromCharCode(o)+String.fromCharCode(a)}return String.fromCharCode(n)},s.escapeHTML=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},s.unescapeHTML=function(e){var t={"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3C;":"<","&gt;":">","&#62;":">","&#x3E;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'"};return e.replace(/&(?:amp|#38|#x26|lt|#60|#x3C|gt|#62|#x3E|apos|#39|#x27|quot|#34|#x22);/gi,function(e){return t[e]})},s.mapEmojioneList=function(e){for(var t in s.emojioneList)if(s.emojioneList.hasOwnProperty(t))for(var n=0,r=s.emojioneList[t].unicode.length;n<r;n++){e(s.emojioneList[t].unicode[n],t)}},s.mapUnicodeToShort=function(){return s.memMapShortToUnicode||(s.memMapShortToUnicode={},s.mapEmojioneList(function(e,t){s.memMapShortToUnicode[e]=t})),s.memMapShortToUnicode},s.memoizeReplacement=function(){if(!s.unicodeReplacementRegEx||!s.memMapShortToUnicodeCharacters){var r=[];s.memMapShortToUnicodeCharacters={},s.mapEmojioneList(function(e,t){var n=s.convert(e);s.emojioneList[t].isCanonical&&(s.memMapShortToUnicodeCharacters[n]=t),r.push(n)}),s.unicodeReplacementRegEx=r.join("|")}},s.mapUnicodeCharactersToShort=function(){return s.memoizeReplacement(),s.memMapShortToUnicodeCharacters},s.getUnicodeReplacementRegEx=function(){return s.memoizeReplacement(),s.unicodeReplacementRegEx},s.objectFlip=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n},s.escapeRegExp=function(e){return e.replace(/[-[\]{}()*+?.,;:&\\^$#\s]/g,"\\$&")},s.replaceAll=function(e,t,n){var r=s.escapeRegExp(t),i=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|("+r+")","gi");return e.replace(i,function(e,t){return void 0===t||""===t?e:n[t]})}}(this.emojione=this.emojione||{}),"object"==typeof zn&&(zn.exports=this.emojione),n=this,r=function(){"use strict";function r(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function i(e){return"string"!=typeof e&&(e=String(e)),e}function c(t){this.map={},t instanceof c?t.forEach(function(e,t){this.append(t,e)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function a(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function e(e){var t=new FileReader;return t.readAsArrayBuffer(e),a(t)}c.prototype.append=function(e,t){e=r(e),t=i(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},c.prototype.delete=function(e){delete this.map[r(e)]},c.prototype.get=function(e){var t=this.map[r(e)];return t?t[0]:null},c.prototype.getAll=function(e){return this.map[r(e)]||[]},c.prototype.has=function(e){return this.map.hasOwnProperty(r(e))},c.prototype.set=function(e,t){this.map[r(e)]=[i(t)]},c.prototype.forEach=function(n,r){Object.getOwnPropertyNames(this.map).forEach(function(t){this.map[t].forEach(function(e){n.call(r,e,t,this)},this)},this)};var u="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),t="FormData"in self,n="ArrayBuffer"in self;function s(){return this.bodyUsed=!1,this._initBody=function(e){if("string"==typeof(this._bodyInit=e))this._bodyText=e;else if(u&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!n||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},u?(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(e)},this.text=function(){var e,t,n=o(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,(t=new FileReader).readAsText(e),a(t);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=o(this);return e||Promise.resolve(this._bodyText)},t&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}var l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function d(e,t){var n,r,i=(t=t||{}).body;if(d.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,i||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),-1<l.indexOf(r)?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function h(e){var i=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),n=t.shift().replace(/\+/g," "),r=t.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function p(e,t){t||(t={}),this._initBody(e),this.type="default",this.status=t.status,this.ok=200<=this.status&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof c?t.headers:new c(t.headers),this.url=t.url||""}d.prototype.clone=function(){return new d(this)},s.call(d.prototype),s.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var f=[301,302,303,307,308];return p.redirect=function(e,t){if(-1===f.indexOf(t))throw new RangeError("Invalid status code");return new p(null,{status:t,headers:{location:e}})},p=p,{fetch:fetch=function(t,n){return new Promise(function(o,a){var e;e=d.prototype.isPrototypeOf(t)&&!n?t:new d(t,n);var s=new XMLHttpRequest;s.onload=function(){var e=1223===s.status?204:s.status;if(e<100||599<e)a(new TypeError("Network request failed"));else{var t,i,n={status:e,statusText:s.statusText,headers:(t=s,i=new c,t.getAllResponseHeaders().trim().split("\n").forEach(function(e){var t=e.trim().split(":"),n=t.shift().trim(),r=t.join(":").trim();i.append(n,r)}),i),url:"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0},r="response"in s?s.response:s.responseText;o(new p(r,n))}},s.onerror=function(){a(new TypeError("Network request failed"))},s.open(e.method,e.url,!0),"include"===e.credentials&&(s.withCredentials=!0),"responseType"in s&&u&&(s.responseType="blob"),e.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===e._bodyInit?null:e._bodyInit)})},Request:d=d,Headers:c=c}},"object"==typeof i&&void 0!==zn?zn.exports=r():"function"==typeof D&&D.amd?D(r):n.ES6Fetch=r();var o,a,s,c,u,l,d,h,Se=null;!function(){for(var t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){if(n.get||n.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},n=void 0!==window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,r=function(){r=function(){},n.Symbol||(n.Symbol=e)},i=0,e=function(e){return"jscomp_symbol_"+(e||"")+i++},o=function(){r();var e=n.Symbol.iterator;e||(e=n.Symbol.iterator=n.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&t(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return a(this)}}),o=function(){}},a=function(e){var t=0;return s(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})},s=function(e){return o(),(e={next:e})[n.Symbol.iterator]=function(){return this},e},c=function(e){o();var t=e[Symbol.iterator];return t?t.call(e):a(e)},u=n,l=["Promise"],d=0;d<l.length-1;d++){var h=l[d];h in u||(u[h]={}),u=u[h]}var p=l[l.length-1],f=u[p],g=function(){function e(){this.c=null}if(f)return f;e.prototype.L=function(e){null==this.c&&(this.c=[],this.W()),this.c.push(e)},e.prototype.W=function(){var e=this;this.M(function(){e.$()})};var t=n.setTimeout;e.prototype.M=function(e){t(e,0)},e.prototype.$=function(){for(;this.c&&this.c.length;){var e=this.c;this.c=[];for(var t=0;t<e.length;++t){var n=e[t];delete e[t];try{n()}catch(e){this.X(e)}}}this.c=null},e.prototype.X=function(e){this.M(function(){throw e})};var s=function(e){this.a=0,this.j=void 0,this.m=[];var t=this.F();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};s.prototype.F=function(){function e(t){return function(e){r||(r=!0,t.call(n,e))}}var n=this,r=!1;return{resolve:e(this.ia),reject:e(this.K)}},s.prototype.ia=function(e){if(e===this)this.K(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof s)this.la(e);else{var t;e:switch(typeof e){case"object":t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.ha(e):this.R(e)}},s.prototype.ha=function(e){var t=void 0;try{t=e.then}catch(e){return void this.K(e)}"function"==typeof t?this.ma(t,e):this.R(e)},s.prototype.K=function(e){this.U(2,e)},s.prototype.R=function(e){this.U(1,e)},s.prototype.U=function(e,t){if(0!=this.a)throw Error("Cannot settle("+e+", "+t|"): Promise already settled in state"+this.a);this.a=e,this.j=t,this.ba()},s.prototype.ba=function(){if(null!=this.m){for(var e=this.m,t=0;t<e.length;++t)e[t].call(),e[t]=null;this.m=null}};var i=new e;return s.prototype.la=function(e){var t=this.F();e.o(t.resolve,t.reject)},s.prototype.ma=function(e,t){var n=this.F();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},s.prototype.then=function(e,t){function n(t,e){return"function"==typeof t?function(e){try{r(t(e))}catch(e){i(e)}}:e}var r,i,o=new s(function(e,t){r=e,i=t});return this.o(n(e,r),n(t,i)),o},s.prototype.catch=function(e){return this.then(void 0,e)},s.prototype.o=function(e,t){function n(){switch(r.a){case 1:e(r.j);break;case 2:t(r.j);break;default:throw Error("Unexpected state: "+r.a)}}var r=this;null==this.m?i.L(n):this.m.push(function(){i.L(n)})},s.resolve=function(t){return t instanceof s?t:new s(function(e){e(t)})},s.reject=function(n){return new s(function(e,t){t(n)})},s.race=function(i){return new s(function(e,t){for(var n=c(i),r=n.next();!r.done;r=n.next())s.resolve(r.value).o(e,t)})},s.all=function(e){var o=c(e),a=o.next();return a.done?s.resolve([]):new s(function(n,e){function t(t){return function(e){r[t]=e,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,s.resolve(a.value).o(t(r.length-1),e),!(a=o.next()).done;);})},s.$jscomp$new$AsyncExecutor=function(){return new e},s}();g!=f&&null!=g&&t(u,p,{configurable:!0,writable:!0,value:g});var m,y=this,b=function(){},v=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t},_=function(e){return"function"==v(e)},S=function(e,t,n){return e.call.apply(e.bind,arguments)},C=function(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}},P=function(e,t,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?S:C).apply(null,arguments)},w=function(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}},M=function(e,o){function t(){}t.prototype=o.prototype,e.sa=o.prototype,e.prototype=new t,(e.prototype.constructor=e).ra=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}};void 0!==(m=void 0!==window?window:"undefined"!=typeof self?self:global).V&&m.V||(m.__extends=function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},m.__decorate=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof(i=m.Reflect)&&"function"==typeof i.decorate)a=i.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},m.__metadata=function(e,t){var n=m.Reflect;if("object"==typeof n&&"function"==typeof n.metadata)return n.metadata(e,t)},m.__param=function(n,r){return function(e,t){r(e,t,n)}},m.__awaiter=function(o,a,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((c=c.apply(o,a)).next())})});var E=function(e){if(Error.captureStackTrace)Error.captureStackTrace(this,E);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))};M(E,Error),E.prototype.name="CustomError";var T=function(e,t){t.unshift(e),E.call(this,function(e,t){for(var n=e.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}.apply(null,t)),t.shift()};M(T,E),T.prototype.name="AssertionError";var k,D=function(e,t,n,r){var i="Assertion failed";if(n){i=i+": "+n;var o=r}else e&&(i+=": "+e,o=t);throw new T(""+i,o||[])},A=function(e,t,n){e||D("",null,t,Array.prototype.slice.call(arguments,2))},W=function(e,t,n){_(e)||D("Expected function but got %s: %s.",[v(e),e],t,Array.prototype.slice.call(arguments,2))},O=function(e,t,n){this.ea=n,this.Y=e,this.ga=t,this.A=0,this.w=null};O.prototype.get=function(){var e;return 0<this.A?(this.A--,e=this.w,this.w=e.next,e.next=null):e=this.Y(),e},O.prototype.put=function(e){this.ga(e),this.A<this.ea&&(this.A++,e.next=this.w,this.w=e)};e:{var R=y.navigator;if(R){var N=R.userAgent;if(N){k=N;break e}}k=""}var I,x=function(e){y.setTimeout(function(){throw e},0)},L=function(){this.C=this.g=null},F=new O(function(){return new U},function(e){e.reset()},100);L.prototype.add=function(e,t){var n=F.get();n.set(e,t),this.C?this.C.next=n:(A(!this.g),this.g=n),this.C=n},L.prototype.remove=function(){var e=null;return this.g&&(e=this.g,this.g=this.g.next,this.g||(this.C=null),e.next=null),e};var U=function(){this.next=this.scope=this.H=null};U.prototype.set=function(e,t){this.H=e,this.scope=t,this.next=null},U.prototype.reset=function(){this.next=this.scope=this.H=null};var B,H=function(e,t){B||j(),q||(B(),q=!0),Y.add(e,t)},j=function(){var e=y.Promise;if(-1!=String(e).indexOf("[native code]")){var t=e.resolve(void 0);B=function(){t.then(V)}}else B=function(){var e,t=V;!(e=!_(y.setImmediate))&&(e=y.Window&&y.Window.prototype)&&(e=-1==k.indexOf("Edge")&&y.Window.prototype.setImmediate==y.setImmediate),e?(I||(I=function(){var e=y.MessageChannel;if(void 0===e&&void 0!==window&&window.postMessage&&window.addEventListener&&-1==k.indexOf("Presto")&&(e=function(){(r=document.createElement("IFRAME")).style.display="none",r.src="",document.documentElement.appendChild(r);var e=r.contentWindow;(r=e.document).open(),r.write(""),r.close();var t="callImmediate"+Math.random(),n="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host,r=P(function(e){"*"!=n&&e.origin!=n||e.data!=t||this.port1.onmessage()},this);e.addEventListener("message",r,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(t,n)}}}),void 0!==e&&-1==k.indexOf("Trident")&&-1==k.indexOf("MSIE")){var t=new e,n={},r=n;return t.port1.onmessage=function(){if(void 0!==n.next){var e=(n=n.next).N;n.N=null,e()}},function(e){r.next={N:e},r=r.next,t.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(e){var t=document.createElement("SCRIPT");t.onreadystatechange=function(){t.onreadystatechange=null,t.parentNode.removeChild(t),t=null,e(),e=null},document.documentElement.appendChild(t)}:function(e){y.setTimeout(e,0)}}()),I(t)):y.setImmediate(t)}},q=!1,Y=new L,V=function(){for(var e;e=Y.remove();){try{e.H.call(e.scope)}catch(e){x(e)}F.put(e)}q=!1},G=function(e,t){if(this.a=0,this.j=void 0,this.s=this.h=this.B=null,this.v=this.G=!1,e!=b)try{var n=this;e.call(t,function(e){Z(n,2,e)},function(e){try{if(e instanceof Error)throw e;throw Error("Promise rejected.")}catch(e){}Z(n,3,e)})}catch(e){Z(this,3,e)}},z=function(){this.next=this.context=this.i=this.f=this.child=null,this.D=!1};z.prototype.reset=function(){this.context=this.i=this.f=this.child=null,this.D=!1};var K=new O(function(){return new z},function(e){e.reset()},100),X=function(e,t,n){var r=K.get();return r.f=e,r.i=t,r.context=n,r};G.prototype.then=function(e,t,n){return null!=e&&W(e,"opt_onFulfilled should be a function."),null!=t&&W(t,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?"),$(this,_(e)?e:null,_(t)?t:null,n)},G.prototype.then=G.prototype.then,G.prototype.$goog_Thenable=!0,G.prototype.na=function(e,t){return $(this,null,e,t)};var J=function(e,t){e.h||2!=e.a&&3!=e.a||te(e),A(null!=t.f),e.s?e.s.next=t:e.h=t,e.s=t},$=function(e,i,o,a){var t=X(null,null,null);return t.child=new G(function(n,r){t.f=i?function(e){try{var t=i.call(a,e);n(t)}catch(e){r(e)}}:n,t.i=o?function(e){try{var t=o.call(a,e);n(t)}catch(e){r(e)}}:r}),t.child.B=e,J(e,t),t.child};G.prototype.oa=function(e){A(1==this.a),this.a=0,Z(this,2,e)},G.prototype.pa=function(e){A(1==this.a),this.a=0,Z(this,3,e)};var Z=function(e,t,n){0==e.a&&(e===n&&(t=3,n=new TypeError("Promise cannot resolve to itself")),e.a=1,Q(n,e.oa,e.pa,e)||(e.j=n,e.a=t,e.B=null,te(e),3!=t||re(e,n)))},Q=function(e,t,n,r){if(e instanceof G)return null!=t&&W(t,"opt_onFulfilled should be a function."),null!=n&&W(n,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?"),J(e,X(t||b,n||null,r)),!0;var i;if(e)try{i=!!e.$goog_Thenable}catch(e){i=!1}else i=!1;if(i)return e.then(t,n,r),!0;if("object"==(i=typeof e)&&null!=e||"function"==i)try{var o=e.then;if(_(o))return ee(e,o,t,n,r),!0}catch(e){return n.call(r,e),!0}return!1},ee=function(e,t,n,r,i){var o=!1,a=function(e){o||(o=!0,r.call(i,e))};try{t.call(e,function(e){o||(o=!0,n.call(i,e))},a)}catch(e){a(e)}},te=function(e){e.G||(e.G=!0,H(e.aa,e))};G.prototype.aa=function(){for(var e;o=void 0,o=null,(i=this).h&&(o=i.h,i.h=o.next,o.next=null),i.h||(i.s=null),null!=o&&A(null!=o.f),e=o;){var t,n=this.a,r=this.j;if(3==n&&e.i&&!e.D)for(t=this;t&&t.v;t=t.B)t.v=!1;if(e.child)e.child.B=null,ne(e,n,r);else try{e.D?e.f.call(e.context):ne(e,n,r)}catch(e){ie.call(null,e)}K.put(e)}var i,o;this.G=!1};var ne=function(e,t,n){2==t?e.f.call(e.context,n):e.i&&e.i.call(e.context,n)},re=function(e,t){e.v=!0,H(function(){e.v&&ie.call(null,t)})},ie=x;function oe(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=oe(e[n],t[n]));return e}G.all=function(l){return new G(function(n,t){var e,r,i=l.length,o=[];if(i)for(var a,s=function(e,t){i--,o[e]=t,0==i&&n(o)},c=function(e){t(e)},u=0;u<l.length;u++)a=l[u],e=a,r=w(s,u),Q(e,r,c,null)||H(w(r,e));else n(o)})},G.resolve=function(e){if(e instanceof G)return e;var t=new G(b);return Z(t,2,e),t},G.reject=function(n){return new G(function(e,t){t(n)})},G.prototype.catch=G.prototype.na;var ae=G;void 0!==Promise&&(ae=Promise);var se=ae;function ce(e,t){return(e=new ue(e,t)).subscribe.bind(e)}var ue=function(e,t){var n=this;this.b=[],this.T=0,this.task=se.resolve(),this.u=!1,this.J=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})};ue.prototype.next=function(t){le(this,function(e){e.next(t)})},ue.prototype.error=function(t){le(this,function(e){e.error(t)}),this.close(t)},ue.prototype.complete=function(){le(this,function(e){e.complete()}),this.close()},ue.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");return void 0===(r=function(e){if("object"!=typeof e||null===e)return!1;for(var t=c(["next","error","complete"]),n=t.next();!n.done;n=t.next())if((n=n.value)in e&&"function"==typeof e[n])return!0;return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=he),void 0===r.error&&(r.error=he),void 0===r.complete&&(r.complete=he),e=this.qa.bind(this,this.b.length),this.u&&this.task.then(function(){try{i.O?r.error(i.O):r.complete()}catch(e){}}),this.b.push(r),e},ue.prototype.qa=function(e){void 0!==this.b&&void 0!==this.b[e]&&(delete this.b[e],--this.T,0===this.T&&void 0!==this.J&&this.J(this))};var le=function(e,t){if(!e.u)for(var n=0;n<e.b.length;n++)de(e,n,t)},de=function(e,t,n){e.task.then(function(){if(void 0!==e.b&&void 0!==e.b[t])try{n(e.b[t])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})};function he(){}ue.prototype.close=function(e){var t=this;this.u||(this.u=!0,void 0!==e&&(this.O=e),this.task.then(function(){t.b=void 0,t.J=void 0}))};var pe=Error.captureStackTrace,fe=function(e,t){if(this.code=e,this.message=t,pe)pe(this,ge.prototype.create);else{var n=Error.apply(this,arguments);this.name="FirebaseError",Object.defineProperty(this,"stack",{get:function(){return n.stack}})}};((fe.prototype=Object.create(Error.prototype)).constructor=fe).prototype.name="FirebaseError";var ge=function(e,t,n){this.ja=e,this.ka=t,this.Z=n,this.pattern=/\{\$([^}]+)}/g};ge.prototype.create=function(e,n){void 0===n&&(n={});var t=this.Z[e];e=this.ja+"/"+e;var r;t=void 0===t?"Error":t.replace(this.pattern,function(e,t){return void 0!==(e=n[t])?e.toString():"<"+t+"?>"}),t=this.ka+": "+t+" ("+e+").",t=new fe(e,t);for(r in n)n.hasOwnProperty(r)&&"_"!==r.slice(-1)&&(t[r]=n[r]);return t};var me=ae,ye=function(e,t,n){var r=this;this.P=n,this.S=!1,this.l={},this.I=t,this.fa=oe(void 0,e),Object.keys(n.INTERNAL.factories).forEach(function(e){var t=n.INTERNAL.useAsService(r,e);null!==t&&(t=r.da.bind(r,t),r[e]=t)})};ye.prototype.delete=function(){var t=this;return new me(function(e){be(t),e()}).then(function(){return t.P.INTERNAL.removeApp(t.I),me.all(Object.keys(t.l).map(function(e){return t.l[e].INTERNAL.delete()}))}).then(function(){t.S=!0,t.l={}})},ye.prototype.da=function(e){return be(this),void 0===this.l[e]&&(this.l[e]=this.P.INTERNAL.factories[e](this,this.ca.bind(this))),this.l[e]},ye.prototype.ca=function(e){oe(this,e)};var be=function(e){e.S&&ve(_e("deleted",{name:e.I}))};function ve(e,t){throw Error(_e(e,t))}function _e(e,t){return void 0===(t={noApp:"No Firebase App '"+(t=t||{}).name+"' has been created - call Firebase App.initializeApp().","bad-app-name":"Illegal App name: '"+t.name+"'.",dupApp:"Firebase App named '"+t.name+"' already exists.",deleted:"Firebase App named '"+t.name+"' already deleted.",dupService:"Firebase Service named '"+t.name+"' already registered.",serverAuthMissing:"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain."}[e])?"Application Error: ("+e+")":t}n.Object.defineProperties(ye.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return be(this),this.I}},options:{configurable:!0,enumerable:!0,get:function(){return be(this),this.fa}}}),ye.prototype.name&&ye.prototype.options||ye.prototype.delete||console.log("dc"),void 0!==Se&&(Se=function e(){function i(e){var t=o[e=e||"[DEFAULT]"];return void 0===t&&ve("noApp",{name:e}),t}function n(t,n){Object.keys(a).forEach(function(e){null!==(e=r(t,e))&&s[e]&&s[e](n,t)})}function r(e,t){if("serverAuth"===t)return null;var n=t;return e=e.options,"auth"===t&&(e.serviceAccount||e.credential)&&((n="serverAuth")in a||ve("serverAuthMissing")),n}var o={},a={},s={},c={__esModule:!0,initializeApp:function(e,t){return void 0===t?t="[DEFAULT]":"string"==typeof t&&""!==t||ve("bad-app-name",{name:t+""}),void 0!==o[t]&&ve("dupApp",{name:t}),e=new ye(e,t,c),n(o[t]=e,"create"),null!=e.INTERNAL&&null!=e.INTERNAL.getToken||oe(e,{INTERNAL:{getToken:function(){return me.resolve(null)},addAuthTokenListener:function(){},removeAuthTokenListener:function(){}}}),e},app:i,apps:null,Promise:me,SDK_VERSION:"0.0.0",INTERNAL:{registerService:function(t,e,n,r){return a[t]&&ve("dupService",{name:t}),a[t]=e,r&&(s[t]=r),e=function(e){return void 0===e&&(e=i()),e[t]()},void 0!==n&&oe(e,n),c[t]=e},createFirebaseNamespace:e,extendNamespace:function(e){oe(c,e)},createSubscribe:ce,ErrorFactory:ge,removeApp:function(e){n(o[e],"delete"),delete o[e]},factories:a,useAsService:r,Promise:G,deepExtend:oe}};return c.default=c,Object.defineProperty(c,"apps",{get:function(){return Object.keys(o).map(function(e){return o[e]})}}),i.App=ye,c}())}(),Se.SDK_VERSION="3.5.2",function(){var e=function(e,t){function n(){}for(var r in n.prototype=t.prototype,e.prototype=new n,t)if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(t,r);i&&Object.defineProperty(e,r,i)}else e[r]=t[r]},o="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){if(n.get||n.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},a=void 0!==window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,t=function(e,t){if(t){var n=a;e=e.split(".");for(var r=0;r<e.length-1;r++){var i=e[r];i in n||(n[i]={}),n=n[i]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&o(n,e,{configurable:!0,writable:!0,value:t})}},n=function(){n=function(){},a.Symbol||(a.Symbol=i)},r=0,i=function(e){return"jscomp_symbol_"+(e||"")+r++},s=function(){n();var e=a.Symbol.iterator;e||(e=a.Symbol.iterator=a.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&o(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return c(this)}}),s=function(){}},c=function(e){var t=0;return u(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})},u=function(e){return s(),(e={next:e})[a.Symbol.iterator]=function(){return this},e},l=function(e){s();var t=e[Symbol.iterator];return t?t.call(e):c(e)};t("Promise",function(e){function t(){this.a=null}if(e)return e;t.prototype.b=function(e){null==this.a&&(this.a=[],this.f()),this.a.push(e)},t.prototype.f=function(){var e=this;this.c(function(){e.h()})};var n=a.setTimeout;t.prototype.c=function(e){n(e,0)},t.prototype.h=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];delete e[t];try{n()}catch(e){this.g(e)}}}this.a=null},t.prototype.g=function(e){this.c(function(){throw e})};var s=function(e){this.b=0,this.h=void 0,this.a=[];var t=this.f();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};s.prototype.f=function(){function e(t){return function(e){r||(r=!0,t.call(n,e))}}var n=this,r=!1;return{resolve:e(this.ca),reject:e(this.g)}},s.prototype.ca=function(e){if(e===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof s)this.da(e);else{var t;e:switch(typeof e){case"object":t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.w(e):this.j(e)}},s.prototype.w=function(e){var t=void 0;try{t=e.then}catch(e){return void this.g(e)}"function"==typeof t?this.ea(t,e):this.j(e)},s.prototype.g=function(e){this.o(2,e)},s.prototype.j=function(e){this.o(1,e)},s.prototype.o=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t|"): Promise already settled in state"+this.b);this.b=e,this.h=t,this.v()},s.prototype.v=function(){if(null!=this.a){for(var e=this.a,t=0;t<e.length;++t)e[t].call(),e[t]=null;this.a=null}};var i=new t;return s.prototype.da=function(e){var t=this.f();e.c(t.resolve,t.reject)},s.prototype.ea=function(e,t){var n=this.f();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},s.prototype.then=function(e,t){function n(t,e){return"function"==typeof t?function(e){try{r(t(e))}catch(e){i(e)}}:e}var r,i,o=new s(function(e,t){r=e,i=t});return this.c(n(e,r),n(t,i)),o},s.prototype.catch=function(e){return this.then(void 0,e)},s.prototype.c=function(e,t){function n(){switch(r.b){case 1:e(r.h);break;case 2:t(r.h);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(function(){i.b(n)})},s.resolve=function(t){return t instanceof s?t:new s(function(e){e(t)})},s.reject=function(n){return new s(function(e,t){t(n)})},s.b=function(i){return new s(function(e,t){for(var n=l(i),r=n.next();!r.done;r=n.next())s.resolve(r.value).c(e,t)})},s.a=function(e){var o=l(e),a=o.next();return a.done?s.resolve([]):new s(function(n,e){function t(t){return function(e){r[t]=e,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,s.resolve(a.value).c(t(r.length-1),e),!(a=o.next()).done;);})},s.$jscomp$new$AsyncExecutor=function(){return new t},s}),t("Array.prototype.findIndex",function(e){return e||function(e,t){e:{var n=this;n instanceof String&&(n=String(n));for(var r=n.length,i=0;i<r;i++)if(e.call(t,n[i],i,n)){e=i;break e}e=-1}return e}}),t("Object.assign",function(e){return e||function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}});var d=this,h=function(e,o){function t(){}t.prototype=o.prototype,e.ja=o.prototype,e.prototype=new t,e.fa=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[t].apply(e,r)}},p="only-available-in-window",f="only-available-in-sw",g="should-be-overriden",m="bad-sender-id",y="incorrect-gcm-sender-id",b="permission-default",v="permission-blocked",_="unsupported-browser",S="notifications-blocked",C="failed-serviceworker-registration",P="sw-registration-expected",w="get-subscription-failed",M="invalid-saved-token",E="sw-reg-redundant",T="token-subscribe-failed",k="token-subscribe-no-token",D="token-subscribe-no-push-set",A="use-sw-before-get-token",W="invalid-delete-token",O="delete-token-not-found",R="bg-handler-function-expected",N="no-window-client-to-msg",I="unable-to-resubscribe",x="no-fcm-token-for-resubscribe",L="failed-to-delete-token",F="no-sw-in-reg",U={},B=(U[p]="This method is available in a Window context.",U[f]="This method is available in a service worker context.",U[g]="This method should be overriden by extended classes.",U[m]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",U[b]="The required permissions were not granted and dismissed instead.",U[v]="The required permissions were not granted and blocked instead.",U[_]="This browser doesn't support the API's required to use the firebase SDK.",U[S]="Notifications have been blocked.",U[C]="We are unable to register the default service worker. {$browserErrorMessage}",U[P]="A service worker registration was the expected input.",U[w]="There was an error when trying to get any existing Push Subscriptions.",U[M]="Unable to access details of the saved token.",U[E]="The service worker being used for push was made redundant.",U[T]="A problem occured while subscribing the user to FCM: {$message}",U[k]="FCM returned no token when subscribing the user to push.",U[D]="FCM returned an invalid response when getting an FCM token.",U[A]="You must call useServiceWorker() before calling getToken() to ensure your service worker is used.",U[W]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",U[O]="The deletion attempt for token could not be performed as the token was not found.",U[R]="The input to setBackgroundMessageHandler() must be a function.",U[N]="An attempt was made to message a non-existant window client.",U[I]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",U[x]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",U[L]="Unable to delete the currently saved token.",U[F]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",U[y]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",U),H={userVisibleOnly:!0,applicationServerKey:new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110])},j="firebase-messaging-msg-type",q="firebase-messaging-msg-data",Y="push-msg-received",V="notification-clicked",G=function(e,t){var n={};return n[j]=e,n[q]=t,n},z=function(e){if(Error.captureStackTrace)Error.captureStackTrace(this,z);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))};h(z,Error);var K=function(e,t){t.unshift(e),z.call(this,function(e,t){for(var n=e.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}.apply(null,t)),t.shift()};h(K,z);var X=null,J=function(e){if(function(e,t,n){if(!e){var r="Assertion failed";if(t){r=r+": "+t;var i=Array.prototype.slice.call(arguments,2)}throw new K(""+r,i||[])}}("array"==(t=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t}(e=new Uint8Array(e)))||"object"==t&&"number"==typeof e.length,"encodeByteArray takes an array as a parameter"),!X)for(X={},t=0;t<65;t++)X[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t);for(var t=X,n=[],r=0;r<e.length;r+=3){var i=e[r],o=r+1<e.length,a=o?e[r+1]:0,s=r+2<e.length,c=i>>2,u=(i=(3&i)<<4|a>>4,a=(15&a)<<2|(u=s?e[r+2]:0)>>6,63&u);s||(u=64,o||(a=64)),n.push(t[c],t[i],t[a],t[u])}return n.join("").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},$=new Se.INTERNAL.ErrorFactory("messaging","Messaging",B),Z=function(){this.a=null},Q=function(e){return e.a||(e.a=new Promise(function(t,n){var e=d.indexedDB.open("fcm_token_details_db",1);e.onerror=function(e){n(e.target.error)},e.onsuccess=function(e){t(e.target.result)},e.onupgradeneeded=function(e){(e=e.target.result.createObjectStore("fcm_token_object_Store",{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),e.createIndex("fcmToken","fcmToken",{unique:!0})}})),e.a},ee=function(e,i){return Q(e).then(function(r){return new Promise(function(t,n){var e=r.transaction(["fcm_token_object_Store"]).objectStore("fcm_token_object_Store").index("fcmToken").get(i);e.onerror=function(e){n(e.target.error)},e.onsuccess=function(e){t(e.target.result)}})})},te=function(e,t,n){var r=J(t.getKey("p256dh")),i=J(t.getKey("auth"));return e="authorized_entity="+e+"&endpoint="+t.endpoint+"&encryption_key="+r+"&encryption_auth="+i,n&&(e+="&pushSet="+n),(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),fetch("https://fcm.googleapis.com/fcm/connect/subscribe",{method:"POST",headers:n,body:e}).then(function(e){return e.json()}).then(function(e){if(e.error)throw $.create(T,{message:e.error.message});if(!e.token)throw $.create(k);if(!e.pushSet)throw $.create(D);return{token:e.token,pushSet:e.pushSet}})};Z.prototype.getSavedToken=Z.prototype.ba=function(n,r){return r instanceof ServiceWorkerRegistration?"string"!=typeof n||0===n.length?Promise.reject($.create(m)):(e=this,o=n,Q(e).then(function(i){return new Promise(function(t,n){var r=[],e=i.transaction(["fcm_token_object_Store"]).objectStore("fcm_token_object_Store").openCursor();e.onerror=function(e){n(e.target.error)},e.onsuccess=function(e){(e=e.target.result)?(e.value.fcmSenderId===o&&r.push(e.value),e.continue()):t(r)}})})).then(function(e){if(0!==e.length){var t=e.findIndex(function(e){return r.scope===e.swScope&&n===e.fcmSenderId});if(-1!==t)return e[t]}}).then(function(n){if(n)return r.pushManager.getSubscription().catch(function(){throw $.create(w)}).then(function(e){var t;if((t=e)&&(t=e.endpoint===n.endpoint&&J(e.getKey("auth"))===n.auth&&J(e.getKey("p256dh"))===n.p256dh),t)return n.fcmToken})}):Promise.reject($.create(P));var e,o},Z.prototype.createToken=Z.prototype.aa=function(u,l){var d=this;return"string"!=typeof u||0===u.length?Promise.reject($.create(m)):l instanceof ServiceWorkerRegistration?l.pushManager.getSubscription().then(function(e){return e||l.pushManager.subscribe(H)}).then(function(c){return te(u,c).then(function(e){return(t=d,n=u,r=l,i=c,o=e.token,a=e.pushSet,s={swScope:r.scope,endpoint:i.endpoint,auth:J(i.getKey("auth")),p256dh:J(i.getKey("p256dh")),fcmToken:o,fcmPushSet:a,fcmSenderId:n},Q(t).then(function(r){return new Promise(function(e,t){var n=r.transaction(["fcm_token_object_Store"],"readwrite").objectStore("fcm_token_object_Store").put(s);n.onerror=function(e){t(e.target.error)},n.onsuccess=function(){e()}})})).then(function(){return e.token});var t,n,r,i,o,a,s})}):Promise.reject($.create(P))},Z.prototype.deleteToken=function(e){var t=this;return"string"!=typeof e||0===e.length?Promise.reject($.create(W)):ee(this,e).then(function(i){if(!i)throw $.create(O);return Q(t).then(function(r){return new Promise(function(t,n){var e=r.transaction(["fcm_token_object_Store"],"readwrite").objectStore("fcm_token_object_Store").delete(i.swScope);e.onerror=function(e){n(e.target.error)},e.onsuccess=function(e){0===e.target.result?n($.create(L)):t(i)}})})})};var ne=function(e){var t=this;if(this.a=new Se.INTERNAL.ErrorFactory("messaging","Messaging",B),!e.options.messagingSenderId||"string"!=typeof e.options.messagingSenderId)throw this.a.create(m);this.j=e.options.messagingSenderId,this.c=new Z,this.app=e,this.INTERNAL={},this.INTERNAL.delete=function(){return t.delete}};ne.prototype.getToken=ne.prototype.getToken=function(){var n=this,e=Notification.permission;return"granted"!==e?"denied"===e?Promise.reject(this.a.create(S)):Promise.resolve(null):this.f().then(function(t){return n.c.ba(n.j,t).then(function(e){return e||n.c.aa(n.j,t)})})},ne.prototype.deleteToken=ne.prototype.deleteToken=function(e){var t=this;return this.c.deleteToken(e).then(function(){return t.f()}).then(function(e){return e?e.pushManager.getSubscription():null}).then(function(e){if(e)return e.unsubscribe()})},ne.prototype.f=function(){throw this.a.create(g)},ne.prototype.requestPermission=function(){throw this.a.create(p)},ne.prototype.useServiceWorker=ne.prototype.useServiceWorker=function(){throw this.a.create(p)},ne.prototype.onMessage=ne.prototype.onMessage=function(){throw this.a.create(p)},ne.prototype.onTokenRefresh=ne.prototype.onTokenRefresh=function(){throw this.a.create(p)},ne.prototype.setBackgroundMessageHandler=ne.prototype.setBackgroundMessageHandler=function(){throw this.a.create(f)},ne.prototype.delete=function(){var t;(t=this.c).a?t.a.then(function(e){e.close(),t.a=null}):Promise.resolve()};var re=self,ie=function(e){var t=this;ne.call(this,e),this.a=new Se.INTERNAL.ErrorFactory("messaging","Messaging",B),re.addEventListener("push",function(e){return oe(t,e)},!1),re.addEventListener("pushsubscriptionchange",function(e){return ae(t,e)},!1),re.addEventListener("notificationclick",function(e){return se(t,e)},!1),this.b=null};e(ie,ne);var oe=function(r,e){var i;try{i=e.data.json()}catch(e){return}var t=le().then(function(e){if(e){if(i.notification||r.b)return de(r,i)}else{if((e=i)&&"object"==typeof e.notification){var t=Object.assign({},e.notification),n={};t.data=(n.FCM_MSG=e,n),e=t}else e=void 0;if(e)return re.registration.showNotification(e.title||"",e);if(r.b)return r.b(i)}});e.waitUntil(t)},ae=function(r,e){var t=r.getToken().then(function(e){if(!e)throw r.a.create(x);var n=r.c;return ee(n,e).then(function(t){if(!t)throw r.a.create(M);return re.registration.pushManager.subscribe(H).then(function(e){return te(t.ha,e,t.ga)}).catch(function(e){return n.deleteToken(t.ia).then(function(){throw r.a.create(I,{message:e})})})})});e.waitUntil(t)},se=function(t,e){if(e.notification&&e.notification.data&&e.notification.data.FCM_MSG){e.stopImmediatePropagation(),e.notification.close();var n=e.notification.data.FCM_MSG,r=n.notification.click_action;if(r){var i=ce(r).then(function(e){return e||re.clients.openWindow(r)}).then(function(e){if(e)return delete n.notification,ue(t,e,G(V,n))});e.waitUntil(i)}}};ie.prototype.setBackgroundMessageHandler=ie.prototype.setBackgroundMessageHandler=function(e){if(e&&"function"!=typeof e)throw this.a.create(R);this.b=e};var ce=function(e){var r=new URL(e).href;return re.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){for(var t=null,n=0;n<e.length;n++)if(new URL(e[n].url).href===r){t=e[n];break}if(t)return t.focus(),t})},ue=function(n,r,i){return new Promise(function(e,t){if(!r)return t(n.a.create(N));r.postMessage(i),e()})},le=function(){return re.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){return e.some(function(e){return"visible"===e.visibilityState})})},de=function(n,r){return re.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(e){var t=G(Y,r);return Promise.all(e.map(function(e){return ue(n,e,t)}))})};ie.prototype.f=function(){return Promise.resolve(re.registration)};var he=function(e){var t=this;ne.call(this,e),this.h=null,this.o=Se.INTERNAL.createSubscribe(function(e){t.h=e}),this.w=null,this.v=Se.INTERNAL.createSubscribe(function(e){t.w=e}),ge(this)};e(he,ne),he.prototype.getToken=he.prototype.getToken=function(){var e=this;return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")?pe(this).then(function(){return ne.prototype.getToken.call(e)}):Promise.reject(this.a.create(_))};var pe=function(t){if(t.g)return t.g;var e=document.querySelector('link[rel="manifest"]');return t.g=e?fetch(e.href).then(function(e){return e.json()}).catch(function(){return Promise.resolve()}).then(function(e){if(e&&(e.snrs_gcm_sender_id?e.snrs_gcm_sender_id:e.gcm_sender_id)&&"103953800507"!==(e.snrs_gcm_sender_id?e.snrs_gcm_sender_id:e.gcm_sender_id))throw t.a.create(y)}):Promise.resolve(),t.g};he.prototype.requestPermission=he.prototype.requestPermission=function(){var o=this;return"granted"===Notification.permission?Promise.resolve():new Promise(function(t,n){var r=function(e){return"granted"===e?t():n("denied"===e?o.a.create(v):o.a.create(b))},i=Notification.requestPermission(function(e){i||r(e)});i&&i.then(r)})},he.prototype.useServiceWorker=he.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw this.a.create(P);if(void 0!==this.b)throw this.a.create(A);this.b=e},he.prototype.onMessage=he.prototype.onMessage=function(e,t,n){return this.o(e,t,n)},he.prototype.onTokenRefresh=he.prototype.onTokenRefresh=function(e,t,n){return this.v(e,t,n)};var fe=function(r,i){var o=i.installing||i.waiting||i.active;return new Promise(function(e,t){if(o)if("activated"===o.state)e(i);else if("redundant"===o.state)t(r.a.create(E));else{var n=function(){if("activated"===o.state)e(i);else{if("redundant"!==o.state)return;t(r.a.create(E))}o.removeEventListener("statechange",n)};o.addEventListener("statechange",n)}else t(r.a.create(F))})};he.prototype.f=function(){var t=this;return this.b?fe(this,this.b):(this.b=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(e){throw t.a.create(C,{browserErrorMessage:e.message})}).then(function(e){return fe(t,e).then(function(){return(t.b=e).update(),e})}))};var ge=function(t){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[j])switch(e=e.data,e[j]){case Y:case V:t.h.next(e[q])}},!1)};if(!(Se&&Se.INTERNAL&&Se.INTERNAL.registerService))throw Error("Cannot install Firebase Messaging - be sure to load firebase-app.js first.");Se.INTERNAL.registerService("messaging",function(e){return self&&"ServiceWorkerGlobalScope"in self?new ie(e):new he(e)},{Messaging:he})}(),_.cookie=function(){function p(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}return function e(d){function h(e,t,n){var r;if(1<arguments.length){if("number"==typeof(n=p({path:"/"},h.defaults,n)).expires){var i=new Date;i.setMilliseconds(i.getMilliseconds()+864e5*n.expires),n.expires=i}try{r=JSON.stringify(t),/^[\{\[]/.test(r)&&(t=r)}catch(e){}return t=d.write?d.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),void(document.cookie=[e,"=",t,n.expires&&"; expires="+n.expires.toUTCString(),n.path&&"; path="+n.path,n.domain&&"; domain="+n.domain,n.secure?"; secure":""].join(""))}e||(r={});for(var o=document.cookie?document.cookie.split("; "):[],a=/(%[0-9A-Z]{2})+/g,s=0;s<o.length;s++){var c=o[s].split("="),u=c[0].replace(a,decodeURIComponent),l=c.slice(1).join("=");'"'===l.charAt(0)&&(l=l.slice(1,-1));try{if(l=d.read?d.read(l,u):d(l,u)||l.replace(a,decodeURIComponent),this.json)try{l=JSON.parse(l)}catch(e){}if(e===u){r=l;break}e||(r[u]=l)}catch(e){}}return r}return h.get=h.set=h,h.getJSON=function(){return h.apply({json:!0},[].slice.call(arguments))},h.defaults={},h.remove=function(e,t){h(e,"",p(t,{expires:-1}))},h.withConverter=e,h}(function(){})}(),o=this,a=function(){"use strict";var e,i;function b(){return e.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function c(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function u(e){return void 0===e}function l(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function d(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function h(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function v(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function p(e,t){for(var n in t)v(t,n)&&(e[n]=t[n]);return v(t,"toString")&&(e.toString=t.toString),v(t,"valueOf")&&(e.valueOf=t.valueOf),e}function f(e,t,n,r){return Mt(e,t,n,r,!0).utc()}function _(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function g(e){if(null==e._isValid){var t=_(e),n=i.call(t.parsedDateParts,function(e){return null!=e}),r=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(r=r&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return r;e._isValid=r}return e._isValid}function m(e){var t=f(NaN);return null!=e?p(_(t),e):_(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,r=0;r<n;r++)if(r in t&&e.call(this,t[r],r,t))return!0;return!1};var o=b.momentProperties=[];function y(e,t){var n,r,i;if(u(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),u(t._i)||(e._i=t._i),u(t._f)||(e._f=t._f),u(t._l)||(e._l=t._l),u(t._strict)||(e._strict=t._strict),u(t._tzm)||(e._tzm=t._tzm),u(t._isUTC)||(e._isUTC=t._isUTC),u(t._offset)||(e._offset=t._offset),u(t._pf)||(e._pf=_(t)),u(t._locale)||(e._locale=t._locale),0<o.length)for(n=0;n<o.length;n++)u(i=t[r=o[n]])||(e[r]=i);return e}var t=!1;function S(e){y(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,b.updateOffset(this),t=!1)}function C(e){return e instanceof S||null!=e&&null!=e._isAMomentObject}function P(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function w(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=P(t)),n}function a(e,t,n){var r,i=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),a=0;for(r=0;r<i;r++)(n&&e[r]!==t[r]||!n&&w(e[r])!==w(t[r]))&&a++;return a+o}function M(e){!1===b.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(i,o){var a=!0;return p(function(){if(null!=b.deprecationHandler&&b.deprecationHandler(null,i),a){for(var e,t=[],n=0;n<arguments.length;n++){if(e="","object"==typeof arguments[n]){for(var r in e+="\n["+n+"] ",arguments[0])e+=r+": "+arguments[0][r]+", ";e=e.slice(0,-2)}else e=arguments[n];t.push(e)}M(i+"\nArguments: "+Array.prototype.slice.call(t).join("")+"\n"+(new Error).stack),a=!1}return o.apply(this,arguments)},o)}var r,E={};function T(e,t){null!=b.deprecationHandler&&b.deprecationHandler(e,t),E[e]||(M(t),E[e]=!0)}function k(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function D(e,t){var n,r=p({},e);for(n in t)v(t,n)&&(c(e[n])&&c(t[n])?(r[n]={},p(r[n],e[n]),p(r[n],t[n])):null!=t[n]?r[n]=t[n]:delete r[n]);for(n in e)v(e,n)&&!v(t,n)&&c(e[n])&&(r[n]=p({},r[n]));return r}function A(e){null!=e&&this.set(e)}b.suppressDeprecationWarnings=!1,b.deprecationHandler=null,r=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)v(e,t)&&n.push(t);return n};var W={};function O(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function N(e){var t,n,r={};for(n in e)v(e,n)&&(t=R(n))&&(r[t]=e[n]);return r}var I={};function x(e,t){I[e]=t}function L(e,t,n){var r=""+Math.abs(e),i=t-r.length;return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}var F=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,B={},H={};function j(e,t,n,r){var i=r;"string"==typeof r&&(i=function(){return this[r]()}),e&&(H[e]=i),t&&(H[t[0]]=function(){return L(i.apply(this,arguments),t[1],t[2])}),n&&(H[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function q(e,t){return e.isValid()?(t=Y(t,e.localeData()),B[t]=B[t]||function(r){var e,i,t,o=r.match(F);for(e=0,i=o.length;e<i;e++)H[o[e]]?o[e]=H[o[e]]:o[e]=(t=o[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");return function(e){var t,n="";for(t=0;t<i;t++)n+=k(o[t])?o[t].call(e,r):o[t];return n}}(t),B[t](e)):e.localeData().invalidDate()}function Y(e,t){var n=5;function r(e){return t.longDateFormat(e)||e}for(U.lastIndex=0;0<=n&&U.test(e);)e=e.replace(U,r),U.lastIndex=0,n-=1;return e}var V=/\d/,G=/\d\d/,z=/\d{3}/,K=/\d{4}/,X=/[+-]?\d{6}/,J=/\d\d?/,$=/\d\d\d\d?/,Z=/\d\d\d\d\d\d?/,Q=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,re=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,oe=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,se={};function ce(e,n,r){se[e]=k(n)?n:function(e,t){return e&&r?r:n}}function ue(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var le={};function de(e,n){var t,r=n;for("string"==typeof e&&(e=[e]),l(n)&&(r=function(e,t){t[n]=w(e)}),t=0;t<e.length;t++)le[e[t]]=r}function he(e,i){de(e,function(e,t,n,r){n._w=n._w||{},i(e,n._w,n,r)})}var pe=0,fe=1,ge=2,me=3,ye=4,be=5,ve=6,_e=7,Se=8;function Ce(e){return Pe(e)?366:365}function Pe(e){return e%4==0&&e%100!=0||e%400==0}j("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),j(0,["YY",2],0,function(){return this.year()%100}),j(0,["YYYY",4],0,"year"),j(0,["YYYYY",5],0,"year"),j(0,["YYYYYY",6,!0],0,"year"),O("year","y"),x("year",1),ce("Y",re),ce("YY",J,G),ce("YYYY",ee,K),ce("YYYYY",te,X),ce("YYYYYY",te,X),de(["YYYYY","YYYYYY"],pe),de("YYYY",function(e,t){t[pe]=2===e.length?b.parseTwoDigitYear(e):w(e)}),de("YY",function(e,t){t[pe]=b.parseTwoDigitYear(e)}),de("Y",function(e,t){t[pe]=parseInt(e,10)}),b.parseTwoDigitYear=function(e){return w(e)+(68<w(e)?1900:2e3)};var we,Me=Ee("FullYear",!0);function Ee(t,n){return function(e){return null!=e?(ke(this,t,e),b.updateOffset(this,n),this):Te(this,t)}}function Te(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function ke(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&Pe(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),De(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function De(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=(t%12+12)%12;return e+=(t-n)/12,1===n?Pe(e)?29:28:31-n%7%2}we=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},j("M",["MM",2],"Mo",function(){return this.month()+1}),j("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),j("MMMM",0,0,function(e){return this.localeData().months(this,e)}),O("month","M"),x("month",8),ce("M",J),ce("MM",J,G),ce("MMM",function(e,t){return t.monthsShortRegex(e)}),ce("MMMM",function(e,t){return t.monthsRegex(e)}),de(["M","MM"],function(e,t){t[fe]=w(e)-1}),de(["MMM","MMMM"],function(e,t,n,r){var i=n._locale.monthsParse(e,r,n._strict);null!=i?t[fe]=i:_(n).invalidMonth=e});var Ae=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,We="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Oe="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Re(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=w(t);else if(!l(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),De(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Ne(e){return null!=e?(Re(this,e),b.updateOffset(this,!0),this):Te(this,"Month")}var Ie=ae,xe=ae;function Le(){function e(e,t){return t.length-e.length}var t,n,r=[],i=[],o=[];for(t=0;t<12;t++)n=f([2e3,t]),r.push(this.monthsShort(n,"")),i.push(this.months(n,"")),o.push(this.months(n,"")),o.push(this.monthsShort(n,""));for(r.sort(e),i.sort(e),o.sort(e),t=0;t<12;t++)r[t]=ue(r[t]),i[t]=ue(i[t]);for(t=0;t<24;t++)o[t]=ue(o[t]);this._monthsRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Fe(e){var t;if(e<100&&0<=e){var n=Array.prototype.slice.call(arguments);n[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)}else t=new Date(Date.UTC.apply(null,arguments));return t}function Ue(e,t,n){var r=7+t-n;return-(7+Fe(e,0,r).getUTCDay()-t)%7+r-1}function Be(e,t,n,r,i){var o,a,s=1+7*(t-1)+(7+n-r)%7+Ue(e,r,i);return a=s<=0?Ce(o=e-1)+s:s>Ce(e)?(o=e+1,s-Ce(e)):(o=e,s),{year:o,dayOfYear:a}}function He(e,t,n){var r,i,o=Ue(e.year(),t,n),a=Math.floor((e.dayOfYear()-o-1)/7)+1;return a<1?r=a+je(i=e.year()-1,t,n):a>je(e.year(),t,n)?(r=a-je(e.year(),t,n),i=e.year()+1):(i=e.year(),r=a),{week:r,year:i}}function je(e,t,n){var r=Ue(e,t,n),i=Ue(e+1,t,n);return(Ce(e)-r+i)/7}function qe(e,t){return e.slice(t,7).concat(e.slice(0,t))}j("w",["ww",2],"wo","week"),j("W",["WW",2],"Wo","isoWeek"),O("week","w"),O("isoWeek","W"),x("week",5),x("isoWeek",5),ce("w",J),ce("ww",J,G),ce("W",J),ce("WW",J,G),he(["w","ww","W","WW"],function(e,t,n,r){t[r.substr(0,1)]=w(e)}),j("d",0,"do","day"),j("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),j("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),j("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),j("e",0,0,"weekday"),j("E",0,0,"isoWeekday"),O("day","d"),O("weekday","e"),O("isoWeekday","E"),x("day",11),x("weekday",11),x("isoWeekday",11),ce("d",J),ce("e",J),ce("E",J),ce("dd",function(e,t){return t.weekdaysMinRegex(e)}),ce("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ce("dddd",function(e,t){return t.weekdaysRegex(e)}),he(["dd","ddd","dddd"],function(e,t,n,r){var i=n._locale.weekdaysParse(e,r,n._strict);null!=i?t.d=i:_(n).invalidWeekday=e}),he(["d","e","E"],function(e,t,n,r){t[r]=w(e)});var Ye="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Ve="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Ge="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),ze=ae,Ke=ae,Xe=ae;function Je(){function e(e,t){return t.length-e.length}var t,n,r,i,o,a=[],s=[],c=[],u=[];for(t=0;t<7;t++)n=f([2e3,1]).day(t),r=this.weekdaysMin(n,""),i=this.weekdaysShort(n,""),o=this.weekdays(n,""),a.push(r),s.push(i),c.push(o),u.push(r),u.push(i),u.push(o);for(a.sort(e),s.sort(e),c.sort(e),u.sort(e),t=0;t<7;t++)s[t]=ue(s[t]),c[t]=ue(c[t]),u[t]=ue(u[t]);this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function $e(){return this.hours()%12||12}function Ze(e,t){j(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Qe(e,t){return t._meridiemParse}j("H",["HH",2],0,"hour"),j("h",["hh",2],0,$e),j("k",["kk",2],0,function(){return this.hours()||24}),j("hmm",0,0,function(){return""+$e.apply(this)+L(this.minutes(),2)}),j("hmmss",0,0,function(){return""+$e.apply(this)+L(this.minutes(),2)+L(this.seconds(),2)}),j("Hmm",0,0,function(){return""+this.hours()+L(this.minutes(),2)}),j("Hmmss",0,0,function(){return""+this.hours()+L(this.minutes(),2)+L(this.seconds(),2)}),Ze("a",!0),Ze("A",!1),O("hour","h"),x("hour",13),ce("a",Qe),ce("A",Qe),ce("H",J),ce("h",J),ce("k",J),ce("HH",J,G),ce("hh",J,G),ce("kk",J,G),ce("hmm",$),ce("hmmss",Z),ce("Hmm",$),ce("Hmmss",Z),de(["H","HH"],me),de(["k","kk"],function(e,t,n){var r=w(e);t[me]=24===r?0:r}),de(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),de(["h","hh"],function(e,t,n){t[me]=w(e),_(n).bigHour=!0}),de("hmm",function(e,t,n){var r=e.length-2;t[me]=w(e.substr(0,r)),t[ye]=w(e.substr(r)),_(n).bigHour=!0}),de("hmmss",function(e,t,n){var r=e.length-4,i=e.length-2;t[me]=w(e.substr(0,r)),t[ye]=w(e.substr(r,2)),t[be]=w(e.substr(i)),_(n).bigHour=!0}),de("Hmm",function(e,t,n){var r=e.length-2;t[me]=w(e.substr(0,r)),t[ye]=w(e.substr(r))}),de("Hmmss",function(e,t,n){var r=e.length-4,i=e.length-2;t[me]=w(e.substr(0,r)),t[ye]=w(e.substr(r,2)),t[be]=w(e.substr(i))});var et,tt=Ee("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:We,monthsShort:Oe,week:{dow:0,doy:6},weekdays:Ye,weekdaysMin:Ge,weekdaysShort:Ve,meridiemParse:/[ap]\.?m?\.?/i},rt={},it={};function ot(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!rt[e]&&void 0!==zn&&zn&&zn.exports)try{t=et._abbr,require("./locale/"+e),st(t)}catch(e){}return rt[e]}function st(e,t){var n;return e&&((n=u(t)?ut(e):ct(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function ct(e,t){if(null===t)return delete rt[e],null;var n,r=nt;if(t.abbr=e,null!=rt[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=rt[e]._config;else if(null!=t.parentLocale)if(null!=rt[t.parentLocale])r=rt[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;r=n._config}return rt[e]=new A(D(r,t)),it[e]&&it[e].forEach(function(e){ct(e.name,e.config)}),st(e),rt[e]}function ut(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!s(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,r,i,o=0;o<e.length;){for(t=(i=ot(e[o]).split("-")).length,n=(n=ot(e[o+1]))?n.split("-"):null;0<t;){if(r=at(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&a(i,n,!0)>=t-1)break;t--}o++}return et}(e)}function lt(e){var t,n=e._a;return n&&-2===_(e).overflow&&(t=n[fe]<0||11<n[fe]?fe:n[ge]<1||n[ge]>De(n[pe],n[fe])?ge:n[me]<0||24<n[me]||24===n[me]&&(0!==n[ye]||0!==n[be]||0!==n[ve])?me:n[ye]<0||59<n[ye]?ye:n[be]<0||59<n[be]?be:n[ve]<0||999<n[ve]?ve:-1,_(e)._overflowDayOfYear&&(t<pe||ge<t)&&(t=ge),_(e)._overflowWeeks&&-1===t&&(t=_e),_(e)._overflowWeekday&&-1===t&&(t=Se),_(e).overflow=t),e}function dt(e,t,n){return null!=e?e:null!=t?t:n}function ht(e){var t,n,r,i,o,a=[];if(!e._d){var s,c;for(s=e,c=new Date(b.now()),r=s._useUTC?[c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]:[c.getFullYear(),c.getMonth(),c.getDate()],e._w&&null==e._a[ge]&&null==e._a[fe]&&function(e){var t,n,r,i,o,a,s,c;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)o=1,a=4,n=dt(t.GG,e._a[pe],He(Et(),1,4).year),r=dt(t.W,1),((i=dt(t.E,1))<1||7<i)&&(c=!0);else{o=e._locale._week.dow,a=e._locale._week.doy;var u=He(Et(),o,a);n=dt(t.gg,e._a[pe],u.year),r=dt(t.w,u.week),null!=t.d?((i=t.d)<0||6<i)&&(c=!0):null!=t.e?(i=t.e+o,(t.e<0||6<t.e)&&(c=!0)):i=o}r<1||r>je(n,o,a)?_(e)._overflowWeeks=!0:null!=c?_(e)._overflowWeekday=!0:(s=Be(n,r,i,o,a),e._a[pe]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(o=dt(e._a[pe],r[pe]),(e._dayOfYear>Ce(o)||0===e._dayOfYear)&&(_(e)._overflowDayOfYear=!0),n=Fe(o,0,e._dayOfYear),e._a[fe]=n.getUTCMonth(),e._a[ge]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=r[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[me]&&0===e._a[ye]&&0===e._a[be]&&0===e._a[ve]&&(e._nextDay=!0,e._a[me]=0),e._d=(e._useUTC?Fe:function(e,t,n,r,i,o,a){var s;return e<100&&0<=e?(s=new Date(e+400,t,n,r,i,o,a),isFinite(s.getFullYear())&&s.setFullYear(e)):s=new Date(e,t,n,r,i,o,a),s}).apply(null,a),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[me]=24),e._w&&void 0!==e._w.d&&e._w.d!==i&&(_(e).weekdayMismatch=!0)}}var pt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ft=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/Z|[+-]\d\d(?::?\d\d)?/,mt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],yt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],bt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,r,i,o,a,s=e._i,c=pt.exec(s)||ft.exec(s);if(c){for(_(e).iso=!0,t=0,n=mt.length;t<n;t++)if(mt[t][1].exec(c[1])){i=mt[t][0],r=!1!==mt[t][2];break}if(null==i)return void(e._isValid=!1);if(c[3]){for(t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(c[3])){o=(c[2]||" ")+yt[t][0];break}if(null==o)return void(e._isValid=!1)}if(!r&&null!=o)return void(e._isValid=!1);if(c[4]){if(!gt.exec(c[4]))return void(e._isValid=!1);a="Z"}e._f=i+(o||"")+(a||""),Pt(e)}else e._isValid=!1}var _t=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Ct(e){var t,n,r,i,o,a,s,c,u,l,d,h=_t.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(h){var p=(i=h[4],o=h[3],a=h[2],s=h[5],c=h[6],u=h[7],d=[(l=parseInt(i,10),l<=49?2e3+l:l<=999?1900+l:l),Oe.indexOf(o),parseInt(a,10),parseInt(s,10),parseInt(c,10)],u&&d.push(parseInt(u,10)),d);if(n=p,r=e,(t=h[1])&&Ve.indexOf(t)!==new Date(n[0],n[1],n[2]).getDay()&&(_(r).weekdayMismatch=!0,!(r._isValid=!1)))return;e._a=p,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var r=parseInt(n,10),i=r%100;return(r-i)/100*60+i}(h[8],h[9],h[10]),e._d=Fe.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),_(e).rfc2822=!0}else e._isValid=!1}function Pt(e){if(e._f!==b.ISO_8601)if(e._f!==b.RFC_2822){e._a=[],_(e).empty=!0;var t,n,r,i,o,a,s,c,u=""+e._i,l=u.length,d=0;for(r=Y(e._f,e._locale).match(F)||[],t=0;t<r.length;t++)i=r[t],(n=(u.match((m=i,y=e,v(se,m)?se[m](y._strict,y._locale):new RegExp(ue(m.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i})))))||[])[0])&&(0<(o=u.substr(0,u.indexOf(n))).length&&_(e).unusedInput.push(o),u=u.slice(u.indexOf(n)+n.length),d+=n.length),H[i]?(n?_(e).empty=!1:_(e).unusedTokens.push(i),a=i,c=e,null!=(s=n)&&v(le,a)&&le[a](s,c._a,c,a)):e._strict&&!n&&_(e).unusedTokens.push(i);_(e).charsLeftOver=l-d,0<u.length&&_(e).unusedInput.push(u),e._a[me]<=12&&!0===_(e).bigHour&&0<e._a[me]&&(_(e).bigHour=void 0),_(e).parsedDateParts=e._a.slice(0),_(e).meridiem=e._meridiem,e._a[me]=(h=e._locale,p=e._a[me],null==(f=e._meridiem)?p:null!=h.meridiemHour?h.meridiemHour(p,f):(null!=h.isPM&&((g=h.isPM(f))&&p<12&&(p+=12),g||12!==p||(p=0)),p)),ht(e),lt(e)}else Ct(e);else vt(e);var h,p,f,g,m,y}function wt(e){var t,n,r,i,o=e._i,a=e._f;return e._locale=e._locale||ut(e._l),null===o||void 0===a&&""===o?m({nullInput:!0}):("string"==typeof o&&(e._i=o=e._locale.preparse(o)),C(o)?new S(lt(o)):(d(o)?e._d=o:s(a)?function(e){var t,n,r,i,o;if(0===e._f.length)return _(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<e._f.length;i++)o=0,t=y({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Pt(t),g(t)&&(o+=_(t).charsLeftOver,o+=10*_(t).unusedTokens.length,_(t).score=o,(null==r||o<r)&&(r=o,n=t));p(e,n||t)}(e):a?Pt(e):u(n=(t=e)._i)?t._d=new Date(b.now()):d(n)?t._d=new Date(n.valueOf()):"string"==typeof n?(r=t,null===(i=bt.exec(r._i))?(vt(r),!1===r._isValid&&(delete r._isValid,Ct(r),!1===r._isValid&&(delete r._isValid,b.createFromInputFallback(r)))):r._d=new Date(+i[1])):s(n)?(t._a=h(n.slice(0),function(e){return parseInt(e,10)}),ht(t)):c(n)?function(e){if(!e._d){var t=N(e._i);e._a=h([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ht(e)}}(t):l(n)?t._d=new Date(n):b.createFromInputFallback(t),g(e)||(e._d=null),e))}function Mt(e,t,n,r,i){var o,a={};return!0!==n&&!1!==n||(r=n,n=void 0),(c(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||s(e)&&0===e.length)&&(e=void 0),a._isAMomentObject=!0,a._useUTC=a._isUTC=i,a._l=n,a._i=e,a._f=t,a._strict=r,(o=new S(lt(wt(a))))._nextDay&&(o.add(1,"d"),o._nextDay=void 0),o}function Et(e,t,n,r){return Mt(e,t,n,r,!1)}b.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),b.ISO_8601=function(){},b.RFC_2822=function(){};var Tt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Et.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:m()}),kt=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Et.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:m()});function Dt(e,t){var n,r;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return Et();for(n=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](n)||(n=t[r]);return n}var At=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Wt(e){var t=N(e),n=t.year||0,r=t.quarter||0,i=t.month||0,o=t.week||t.isoWeek||0,a=t.day||0,s=t.hour||0,c=t.minute||0,u=t.second||0,l=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===we.call(At,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,r=0;r<At.length;++r)if(e[At[r]]){if(n)return!1;parseFloat(e[At[r]])!==w(e[At[r]])&&(n=!0)}return!0}(t),this._milliseconds=+l+1e3*u+6e4*c+1e3*s*60*60,this._days=+a+7*o,this._months=+i+3*r+12*n,this._data={},this._locale=ut(),this._bubble()}function Ot(e){return e instanceof Wt}function Rt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Nt(e,n){j(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+L(~~(e/60),2)+n+L(~~e%60,2)})}Nt("Z",":"),Nt("ZZ",""),ce("Z",oe),ce("ZZ",oe),de(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=xt(oe,e)});var It=/([\+\-]|\d\d)/gi;function xt(e,t){var n=(t||"").match(e);if(null===n)return null;var r=((n[n.length-1]||[])+"").match(It)||["-",0,0],i=60*r[1]+w(r[2]);return 0===i?0:"+"===r[0]?i:-i}function Lt(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(C(e)||d(e)?e.valueOf():Et(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+r),b.updateOffset(n,!1),n):Et(e).local()}function Ft(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Ut(){return!!this.isValid()&&this._isUTC&&0===this._offset}b.updateOffset=function(){};var Bt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Ht=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function jt(e,t){var n,r,i,o,a,s,c=e,u=null;return Ot(e)?c={ms:e._milliseconds,d:e._days,M:e._months}:l(e)?(c={},t?c[t]=e:c.milliseconds=e):(u=Bt.exec(e))?(n="-"===u[1]?-1:1,c={y:0,d:w(u[ge])*n,h:w(u[me])*n,m:w(u[ye])*n,s:w(u[be])*n,ms:w(Rt(1e3*u[ve]))*n}):(u=Ht.exec(e))?(n="-"===u[1]?-1:1,c={y:qt(u[2],n),M:qt(u[3],n),w:qt(u[4],n),d:qt(u[5],n),h:qt(u[6],n),m:qt(u[7],n),s:qt(u[8],n)}):null==c?c={}:"object"==typeof c&&("from"in c||"to"in c)&&(o=Et(c.from),a=Et(c.to),i=o.isValid()&&a.isValid()?(a=Lt(a,o),o.isBefore(a)?s=Yt(o,a):((s=Yt(a,o)).milliseconds=-s.milliseconds,s.months=-s.months),s):{milliseconds:0,months:0},(c={}).ms=i.milliseconds,c.M=i.months),r=new Wt(c),Ot(e)&&v(e,"_locale")&&(r._locale=e._locale),r}function qt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Yt(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function Vt(r,i){return function(e,t){var n;return null===t||isNaN(+t)||(T(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),Gt(this,jt(e="string"==typeof e?+e:e,t),r),this}}function Gt(e,t,n,r){var i=t._milliseconds,o=Rt(t._days),a=Rt(t._months);e.isValid()&&(r=null==r||r,a&&Re(e,Te(e,"Month")+a*n),o&&ke(e,"Date",Te(e,"Date")+o*n),i&&e._d.setTime(e._d.valueOf()+i*n),r&&b.updateOffset(e,o||a))}jt.fn=Wt.prototype,jt.invalid=function(){return jt(NaN)};var zt=Vt(1,"add"),Kt=Vt(-1,"subtract");function Xt(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(n,"months");return-(n+(t-r<0?(t-r)/(r-e.clone().add(n-1,"months")):(t-r)/(e.clone().add(n+1,"months")-r)))||0}function Jt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ut(e))&&(this._locale=t),this)}b.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",b.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var $t=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Zt(){return this._locale}var Qt=126227808e5;function en(e,t){return(e%t+t)%t}function tn(e,t,n){return e<100&&0<=e?new Date(e+400,t,n)-Qt:new Date(e,t,n).valueOf()}function nn(e,t,n){return e<100&&0<=e?Date.UTC(e+400,t,n)-Qt:Date.UTC(e,t,n)}function rn(e,t){j(0,[e,e.length],0,t)}function on(e,t,n,r,i){var o;return null==e?He(this,r,i).year:((o=je(e,r,i))<t&&(t=o),function(e,t,n,r,i){var o=Be(e,t,n,r,i),a=Fe(o.year,0,o.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,r,i))}j(0,["gg",2],0,function(){return this.weekYear()%100}),j(0,["GG",2],0,function(){return this.isoWeekYear()%100}),rn("gggg","weekYear"),rn("ggggg","weekYear"),rn("GGGG","isoWeekYear"),rn("GGGGG","isoWeekYear"),O("weekYear","gg"),O("isoWeekYear","GG"),x("weekYear",1),x("isoWeekYear",1),ce("G",re),ce("g",re),ce("GG",J,G),ce("gg",J,G),ce("GGGG",ee,K),ce("gggg",ee,K),ce("GGGGG",te,X),ce("ggggg",te,X),he(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,r){t[r.substr(0,2)]=w(e)}),he(["gg","GG"],function(e,t,n,r){t[r]=b.parseTwoDigitYear(e)}),j("Q",0,"Qo","quarter"),O("quarter","Q"),x("quarter",7),ce("Q",V),de("Q",function(e,t){t[fe]=3*(w(e)-1)}),j("D",["DD",2],"Do","date"),O("date","D"),x("date",9),ce("D",J),ce("DD",J,G),ce("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),de(["D","DD"],ge),de("Do",function(e,t){t[ge]=w(e.match(J)[0])});var an=Ee("Date",!0);j("DDD",["DDDD",3],"DDDo","dayOfYear"),O("dayOfYear","DDD"),x("dayOfYear",4),ce("DDD",Q),ce("DDDD",z),de(["DDD","DDDD"],function(e,t,n){n._dayOfYear=w(e)}),j("m",["mm",2],0,"minute"),O("minute","m"),x("minute",14),ce("m",J),ce("mm",J,G),de(["m","mm"],ye);var sn=Ee("Minutes",!1);j("s",["ss",2],0,"second"),O("second","s"),x("second",15),ce("s",J),ce("ss",J,G),de(["s","ss"],be);var cn,un=Ee("Seconds",!1);for(j("S",0,0,function(){return~~(this.millisecond()/100)}),j(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),j(0,["SSS",3],0,"millisecond"),j(0,["SSSS",4],0,function(){return 10*this.millisecond()}),j(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),j(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),j(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),j(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),j(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),O("millisecond","ms"),x("millisecond",16),ce("S",Q,V),ce("SS",Q,G),ce("SSS",Q,z),cn="SSSS";cn.length<=9;cn+="S")ce(cn,ne);function ln(e,t){t[ve]=w(1e3*("0."+e))}for(cn="S";cn.length<=9;cn+="S")de(cn,ln);var dn=Ee("Milliseconds",!1);j("z",0,0,"zoneAbbr"),j("zz",0,0,"zoneName");var hn=S.prototype;function pn(e){return e}hn.add=zt,hn.calendar=function(e,t){var n=e||Et(),r=Lt(n,this).startOf("day"),i=b.calendarFormat(this,r)||"sameElse",o=t&&(k(t[i])?t[i].call(this,n):t[i]);return this.format(o||this.localeData().calendar(i,this,Et(n)))},hn.clone=function(){return new S(this)},hn.diff=function(e,t,n){var r,i,o;if(!this.isValid())return NaN;if(!(r=Lt(e,this)).isValid())return NaN;switch(i=6e4*(r.utcOffset()-this.utcOffset()),t=R(t)){case"year":o=Xt(this,r)/12;break;case"month":o=Xt(this,r);break;case"quarter":o=Xt(this,r)/3;break;case"second":o=(this-r)/1e3;break;case"minute":o=(this-r)/6e4;break;case"hour":o=(this-r)/36e5;break;case"day":o=(this-r-i)/864e5;break;case"week":o=(this-r-i)/6048e5;break;default:o=this-r}return n?o:P(o)},hn.endOf=function(e){var t;if(void 0===(e=R(e))||"millisecond"===e||!this.isValid())return this;var n=this._isUTC?nn:tn;switch(e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-en(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-en(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-en(t,1e3)-1}return this._d.setTime(t),b.updateOffset(this,!0),this},hn.format=function(e){e||(e=this.isUtc()?b.defaultFormatUtc:b.defaultFormat);var t=q(this,e);return this.localeData().postformat(t)},hn.from=function(e,t){return this.isValid()&&(C(e)&&e.isValid()||Et(e).isValid())?jt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},hn.fromNow=function(e){return this.from(Et(),e)},hn.to=function(e,t){return this.isValid()&&(C(e)&&e.isValid()||Et(e).isValid())?jt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},hn.toNow=function(e){return this.to(Et(),e)},hn.get=function(e){return k(this[e=R(e)])?this[e]():this},hn.invalidAt=function(){return _(this).overflow},hn.isAfter=function(e,t){var n=C(e)?e:Et(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},hn.isBefore=function(e,t){var n=C(e)?e:Et(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},hn.isBetween=function(e,t,n,r){var i=C(e)?e:Et(e),o=C(t)?t:Et(t);return!!(this.isValid()&&i.isValid()&&o.isValid())&&("("===(r=r||"()")[0]?this.isAfter(i,n):!this.isBefore(i,n))&&(")"===r[1]?this.isBefore(o,n):!this.isAfter(o,n))},hn.isSame=function(e,t){var n,r=C(e)?e:Et(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=R(t)||"millisecond")?this.valueOf()===r.valueOf():(n=r.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},hn.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},hn.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},hn.isValid=function(){return g(this)},hn.lang=$t,hn.locale=Jt,hn.localeData=Zt,hn.max=kt,hn.min=Tt,hn.parsingFlags=function(){return p({},_(this))},hn.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:I[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=N(e)),r=0;r<n.length;r++)this[n[r].unit](e[n[r].unit]);else if(k(this[e=R(e)]))return this[e](t);return this},hn.startOf=function(e){var t;if(void 0===(e=R(e))||"millisecond"===e||!this.isValid())return this;var n=this._isUTC?nn:tn;switch(e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=en(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=en(t,6e4);break;case"second":t=this._d.valueOf(),t-=en(t,1e3)}return this._d.setTime(t),b.updateOffset(this,!0),this},hn.subtract=Kt,hn.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},hn.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},hn.toDate=function(){return new Date(this.valueOf())},hn.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?q(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):k(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",q(n,"Z")):q(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},hn.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+r+"-MM-DD[T]HH:mm:ss.SSS"+i)},hn.toJSON=function(){return this.isValid()?this.toISOString():null},hn.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},hn.unix=function(){return Math.floor(this.valueOf()/1e3)},hn.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},hn.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},hn.year=Me,hn.isLeapYear=function(){return Pe(this.year())},hn.weekYear=function(e){return on.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},hn.isoWeekYear=function(e){return on.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},hn.quarter=hn.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},hn.month=Ne,hn.daysInMonth=function(){return De(this.year(),this.month())},hn.week=hn.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},hn.isoWeek=hn.isoWeeks=function(e){var t=He(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},hn.weeksInYear=function(){var e=this.localeData()._week;return je(this.year(),e.dow,e.doy)},hn.isoWeeksInYear=function(){return je(this.year(),1,4)},hn.date=an,hn.day=hn.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,r=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-r,"d")):r},hn.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},hn.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null==e)return this.day()||7;var t,n,r=(t=e,n=this.localeData(),"string"==typeof t?n.weekdaysParse(t)%7||7:isNaN(t)?null:t);return this.day(this.day()%7?r:r-7)},hn.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},hn.hour=hn.hours=tt,hn.minute=hn.minutes=sn,hn.second=hn.seconds=un,hn.millisecond=hn.milliseconds=dn,hn.utcOffset=function(e,t,n){var r,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?i:Ft(this);if("string"==typeof e){if(null===(e=xt(oe,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(r=Ft(this)),this._offset=e,this._isUTC=!0,null!=r&&this.add(r,"m"),i!==e&&(!t||this._changeInProgress?Gt(this,jt(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,b.updateOffset(this,!0),this._changeInProgress=null)),this},hn.utc=function(e){return this.utcOffset(0,e)},hn.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ft(this),"m")),this},hn.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=xt(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},hn.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Et(e).utcOffset():0,(this.utcOffset()-e)%60==0)},hn.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},hn.isLocal=function(){return!!this.isValid()&&!this._isUTC},hn.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},hn.isUtc=Ut,hn.isUTC=Ut,hn.zoneAbbr=function(){return this._isUTC?"UTC":""},hn.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},hn.dates=n("dates accessor is deprecated. Use date instead.",an),hn.months=n("months accessor is deprecated. Use month instead",Ne),hn.years=n("years accessor is deprecated. Use year instead",Me),hn.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),hn.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!u(this._isDSTShifted))return this._isDSTShifted;var e={};if(y(e,this),(e=wt(e))._a){var t=e._isUTC?f(e._a):Et(e._a);this._isDSTShifted=this.isValid()&&0<a(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var fn=A.prototype;function gn(e,t,n,r){var i=ut(),o=f().set(r,t);return i[n](o,e)}function mn(e,t,n){if(l(e)&&(t=e,e=void 0),e=e||"",null!=t)return gn(e,t,n,"month");var r,i=[];for(r=0;r<12;r++)i[r]=gn(e,r,n,"month");return i}function yn(e,t,n,r){"boolean"==typeof e?l(t)&&(n=t,t=void 0):(t=e,e=!1,l(n=t)&&(n=t,t=void 0)),t=t||"";var i,o=ut(),a=e?o._week.dow:0;if(null!=n)return gn(t,(n+a)%7,r,"day");var s=[];for(i=0;i<7;i++)s[i]=gn(t,(i+a)%7,r,"day");return s}fn.calendar=function(e,t,n){var r=this._calendar[e]||this._calendar.sameElse;return k(r)?r.call(t,n):r},fn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},fn.invalidDate=function(){return this._invalidDate},fn.ordinal=function(e){return this._ordinal.replace("%d",e)},fn.preparse=pn,fn.postformat=pn,fn.relativeTime=function(e,t,n,r){var i=this._relativeTime[n];return k(i)?i(e,t,n,r):i.replace(/%d/i,e)},fn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return k(n)?n(t):n.replace(/%s/i,t)},fn.set=function(e){var t,n;for(n in e)k(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},fn.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Ae).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},fn.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Ae.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},fn.monthsParse=function(e,t,n){var r,i,o;if(this._monthsParseExact)return function(e,t,n){var r,i,o,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)o=f([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(o,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(o,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=we.call(this._shortMonthsParse,a))?i:null:-1!==(i=we.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=we.call(this._shortMonthsParse,a))?i:-1!==(i=we.call(this._longMonthsParse,a))?i:null:-1!==(i=we.call(this._longMonthsParse,a))?i:-1!==(i=we.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(i=f([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(o="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(o.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}},fn.monthsRegex=function(e){return this._monthsParseExact?(v(this,"_monthsRegex")||Le.call(this),e?this._monthsStrictRegex:this._monthsRegex):(v(this,"_monthsRegex")||(this._monthsRegex=xe),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},fn.monthsShortRegex=function(e){return this._monthsParseExact?(v(this,"_monthsRegex")||Le.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(v(this,"_monthsShortRegex")||(this._monthsShortRegex=Ie),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},fn.week=function(e){return He(e,this._week.dow,this._week.doy).week},fn.firstDayOfYear=function(){return this._week.doy},fn.firstDayOfWeek=function(){return this._week.dow},fn.weekdays=function(e,t){var n=s(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?qe(n,this._week.dow):e?n[e.day()]:n},fn.weekdaysMin=function(e){return!0===e?qe(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},fn.weekdaysShort=function(e){return!0===e?qe(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},fn.weekdaysParse=function(e,t,n){var r,i,o;if(this._weekdaysParseExact)return function(e,t,n){var r,i,o,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)o=f([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(o,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(o,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(o,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=we.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=we.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=we.call(this._weekdaysParse,a))?i:-1!==(i=we.call(this._shortWeekdaysParse,a))?i:-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=we.call(this._shortWeekdaysParse,a))?i:-1!==(i=we.call(this._weekdaysParse,a))?i:-1!==(i=we.call(this._minWeekdaysParse,a))?i:null:-1!==(i=we.call(this._minWeekdaysParse,a))?i:-1!==(i=we.call(this._weekdaysParse,a))?i:-1!==(i=we.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(i=f([2e3,1]).day(r),n&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(o="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[r]=new RegExp(o.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(n&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(n&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!n&&this._weekdaysParse[r].test(e))return r}},fn.weekdaysRegex=function(e){return this._weekdaysParseExact?(v(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(v(this,"_weekdaysRegex")||(this._weekdaysRegex=ze),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},fn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(v(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(v(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ke),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},fn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(v(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(v(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Xe),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},fn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},fn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},st("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===w(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),b.lang=n("moment.lang is deprecated. Use moment.locale instead.",st),b.langData=n("moment.langData is deprecated. Use moment.localeData instead.",ut);var bn=Math.abs;function vn(e,t,n,r){var i=jt(t,n);return e._milliseconds+=r*i._milliseconds,e._days+=r*i._days,e._months+=r*i._months,e._bubble()}function _n(e){return e<0?Math.floor(e):Math.ceil(e)}function Sn(e){return 4800*e/146097}function Cn(e){return 146097*e/4800}function Pn(e){return function(){return this.as(e)}}var wn=Pn("ms"),Mn=Pn("s"),En=Pn("m"),Tn=Pn("h"),kn=Pn("d"),Dn=Pn("w"),An=Pn("M"),Wn=Pn("Q"),On=Pn("y");function Rn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Nn=Rn("milliseconds"),In=Rn("seconds"),xn=Rn("minutes"),Ln=Rn("hours"),Fn=Rn("days"),Un=Rn("months"),Bn=Rn("years"),Hn=Math.round,jn={ss:44,s:45,m:45,h:22,d:26,M:11},qn=Math.abs;function Yn(e){return(0<e)-(e<0)||+e}function Vn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=qn(this._milliseconds)/1e3,r=qn(this._days),i=qn(this._months);t=P((e=P(n/60))/60),n%=60,e%=60;var o=P(i/12),a=i%=12,s=r,c=t,u=e,l=n?n.toFixed(3).replace(/\.?0+$/,""):"",d=this.asSeconds();if(!d)return"P0D";var h=d<0?"-":"",p=Yn(this._months)!==Yn(d)?"-":"",f=Yn(this._days)!==Yn(d)?"-":"",g=Yn(this._milliseconds)!==Yn(d)?"-":"";return h+"P"+(o?p+o+"Y":"")+(a?p+a+"M":"")+(s?f+s+"D":"")+(c||u||l?"T":"")+(c?g+c+"H":"")+(u?g+u+"M":"")+(l?g+l+"S":"")}var Gn=Wt.prototype;return Gn.isValid=function(){return this._isValid},Gn.abs=function(){var e=this._data;return this._milliseconds=bn(this._milliseconds),this._days=bn(this._days),this._months=bn(this._months),e.milliseconds=bn(e.milliseconds),e.seconds=bn(e.seconds),e.minutes=bn(e.minutes),e.hours=bn(e.hours),e.months=bn(e.months),e.years=bn(e.years),this},Gn.add=function(e,t){return vn(this,e,t,1)},Gn.subtract=function(e,t){return vn(this,e,t,-1)},Gn.as=function(e){if(!this.isValid())return NaN;var t,n,r=this._milliseconds;if("month"===(e=R(e))||"quarter"===e||"year"===e)switch(t=this._days+r/864e5,n=this._months+Sn(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(Cn(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},Gn.asMilliseconds=wn,Gn.asSeconds=Mn,Gn.asMinutes=En,Gn.asHours=Tn,Gn.asDays=kn,Gn.asWeeks=Dn,Gn.asMonths=An,Gn.asQuarters=Wn,Gn.asYears=On,Gn.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12):NaN},Gn._bubble=function(){var e,t,n,r,i,o=this._milliseconds,a=this._days,s=this._months,c=this._data;return 0<=o&&0<=a&&0<=s||o<=0&&a<=0&&s<=0||(o+=864e5*_n(Cn(s)+a),s=a=0),c.milliseconds=o%1e3,e=P(o/1e3),c.seconds=e%60,t=P(e/60),c.minutes=t%60,n=P(t/60),c.hours=n%24,s+=i=P(Sn(a+=P(n/24))),a-=_n(Cn(i)),r=P(s/12),s%=12,c.days=a,c.months=s,c.years=r,this},Gn.clone=function(){return jt(this)},Gn.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},Gn.milliseconds=Nn,Gn.seconds=In,Gn.minutes=xn,Gn.hours=Ln,Gn.days=Fn,Gn.weeks=function(){return P(this.days()/7)},Gn.months=Un,Gn.years=Bn,Gn.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,r,i,o,a,s,c,u,l,d=this.localeData(),h=(t=!e,n=d,r=jt(this).abs(),i=Hn(r.as("s")),o=Hn(r.as("m")),a=Hn(r.as("h")),s=Hn(r.as("d")),c=Hn(r.as("M")),u=Hn(r.as("y")),(l=i<=jn.ss&&["s",i]||i<jn.s&&["ss",i]||o<=1&&["m"]||o<jn.m&&["mm",o]||a<=1&&["h"]||a<jn.h&&["hh",a]||s<=1&&["d"]||s<jn.d&&["dd",s]||c<=1&&["M"]||c<jn.M&&["MM",c]||u<=1&&["y"]||["yy",u])[2]=t,l[3]=0<+this,l[4]=n,function(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}.apply(null,l));return e&&(h=d.pastFuture(+this,h)),d.postformat(h)},Gn.toISOString=Vn,Gn.toString=Vn,Gn.toJSON=Vn,Gn.locale=Jt,Gn.localeData=Zt,Gn.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Vn),Gn.lang=$t,j("X",0,0,"unix"),j("x",0,0,"valueOf"),ce("x",re),ce("X",/[+-]?\d+(\.\d{1,3})?/),de("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),de("x",function(e,t,n){n._d=new Date(w(e))}),b.version="2.24.0",e=Et,b.fn=hn,b.min=function(){return Dt("isBefore",[].slice.call(arguments,0))},b.max=function(){return Dt("isAfter",[].slice.call(arguments,0))},b.now=function(){return Date.now?Date.now():+new Date},b.utc=f,b.unix=function(e){return Et(1e3*e)},b.months=function(e,t){return mn(e,t,"months")},b.isDate=d,b.locale=st,b.invalid=m,b.duration=jt,b.isMoment=C,b.weekdays=function(e,t,n){return yn(e,t,n,"weekdays")},b.parseZone=function(){return Et.apply(null,arguments).parseZone()},b.localeData=ut,b.isDuration=Ot,b.monthsShort=function(e,t){return mn(e,t,"monthsShort")},b.weekdaysMin=function(e,t,n){return yn(e,t,n,"weekdaysMin")},b.defineLocale=ct,b.updateLocale=function(e,t){if(null!=t){var n,r,i=nt;null!=(r=at(e))&&(i=r._config),(n=new A(t=D(i,t))).parentLocale=rt[e],rt[e]=n,st(e)}else null!=rt[e]&&(null!=rt[e].parentLocale?rt[e]=rt[e].parentLocale:null!=rt[e]&&delete rt[e]);return rt[e]},b.locales=function(){return r(rt)},b.weekdaysShort=function(e,t,n){return yn(e,t,n,"weekdaysShort")},b.normalizeUnits=R,b.relativeTimeRounding=function(e){return void 0===e?Hn:"function"==typeof e&&(Hn=e,!0)},b.relativeTimeThreshold=function(e,t){return void 0!==jn[e]&&(void 0===t?jn[e]:(jn[e]=t,"s"===e&&(jn.ss=t-1),!0))},b.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},b.prototype=hn,b.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},b},"object"==typeof i&&void 0!==zn?zn.exports=a():"function"==typeof D&&D.amd?D(a):o.moment=a(),s=this,c=function(){"use strict";function u(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,t=undefined,i=undefined,s=function(e,t){h[r]=e,h[r+1]=t,2===(r+=2)&&(i?i(p):b())};var e=void 0!==window?window:undefined,o=e||{},a=o.MutationObserver||o.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(p,1)}}var h=new Array(1e3);function p(){for(var e=0;e<r;e+=2){(0,h[e])(h[e+1]),h[e]=undefined,h[e+1]=undefined}r=0}var f,g,m,y,b=undefined;function v(e,t){var n=arguments,r=this,i=new this.constructor(C);i[S]===undefined&&U(i);var o,a=r._state;return a?(o=n[a-1],s(function(){return L(a,i,o,r._result)})):R(r,i,e,t),i}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(C);return D(t,e),t}c?b=function(){return process.nextTick(p)}:a?(g=0,m=new a(p),y=document.createTextNode(""),m.observe(y,{characterData:!0}),b=function(){y.data=g=++g%2}):l?((f=new MessageChannel).port1.onmessage=p,b=function(){return f.port2.postMessage(0)}):b=e===undefined&&"function"==typeof require?function(){try{var e=require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(p)}:d()}catch(e){return d()}}():d();var S=Math.random().toString(36).substring(16);function C(){}var P=void 0,w=1,M=2,E=new I;function T(e){try{return e.then}catch(e){return E.error=e,E}}function k(e,t,n){var r,i,o,a;t.constructor===e.constructor&&n===v&&t.constructor.resolve===_?(o=e,(a=t)._state===w?W(o,a._result):a._state===M?O(o,a._result):R(a,undefined,function(e){return D(o,e)},function(e){return O(o,e)})):n===E?O(e,E.error):n===undefined?W(e,t):u(n)?(r=t,i=n,s(function(t){var n=!1,e=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(i,r,function(e){n||(n=!0,r!==e?D(t,e):W(t,e))},function(e){n||(n=!0,O(t,e))},t._label);!n&&e&&(n=!0,O(t,e))},e)):W(e,t)}function D(e,t){var n;e===t?O(e,new TypeError("You cannot resolve a promise with itself")):"function"==typeof(n=t)||"object"==typeof n&&null!==n?k(e,t,T(t)):W(e,t)}function A(e){e._onerror&&e._onerror(e._result),N(e)}function W(e,t){e._state===P&&(e._result=t,e._state=w,0!==e._subscribers.length&&s(N,e))}function O(e,t){e._state===P&&(e._state=M,e._result=t,s(A,e))}function R(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+w]=n,i[o+M]=r,0===o&&e._state&&s(N,e)}function N(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=undefined,i=undefined,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?L(n,r,i,o):i(o);e._subscribers.length=0}}function I(){this.error=null}var x=new I;function L(e,t,n,r){var i=u(n),o=undefined,a=undefined,s=undefined,c=undefined;if(i){if((o=function(e,t){try{return e(t)}catch(e){return x.error=e,x}}(n,r))===x?(c=!0,a=o.error,o=null):s=!0,t===o)return void O(t,new TypeError("A promises callback cannot return that same promise."))}else o=r,s=!0;t._state!==P||(i&&s?D(t,o):c?O(t,a):e===w?W(t,o):e===M&&O(t,o))}var F=0;function U(e){e[S]=F++,e._state=undefined,e._result=undefined,e._subscribers=[]}function B(e,t){this._instanceConstructor=e,this.promise=new e(C),this.promise[S]||U(this.promise),n(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?W(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&W(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}function H(e){this[S]=F++,this._result=this._state=undefined,this._subscribers=[],C!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof H?function(t,e){try{e(function(e){D(t,e)},function(e){O(t,e)})}catch(e){O(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return B.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===P&&n<e;n++)this._eachEntry(t[n],n)},B.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===_){var i=T(t);if(i===v&&t._state!==P)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===H){var o=new n(C);k(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},B.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===P&&(this._remaining--,e===M?O(r,n):this._result[t]=n),0===this._remaining&&W(r,this._result)},B.prototype._willSettleAt=function(e,t){var n=this;R(e,undefined,function(e){return n._settledAt(w,t,e)},function(e){return n._settledAt(M,t,e)})},H.all=function(e){return new B(this,e).promise},H.race=function(i){var o=this;return n(i)?new o(function(e,t){for(var n=i.length,r=0;r<n;r++)o.resolve(i[r]).then(e,t)}):new o(function(e,t){return t(new TypeError("You must pass an array to race."))})},H.resolve=_,H.reject=function(e){var t=new this(C);return O(t,e),t},H._setScheduler=function(e){i=e},H._setAsap=function(e){s=e},H._asap=s,H.prototype={constructor:H,then:v,catch:function(e){return this.then(null,e)}},H.polyfill=function(){var e=undefined;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=H},(H.Promise=H).prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})},H},"object"==typeof i&&void 0!==zn?zn.exports=c():"function"==typeof D&&D.amd?D(c):s.ES6Promise=c(),u=this,l=function(){return function(n){var r={};function i(e){if(r[e])return r[e].exports;var t=r[e]={exports:{},id:e,loaded:!1};return n[e].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}return i.m=n,i.c=r,i.p="",i(0)}([function(e,t,n){"use strict";var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=n(1),r=n(7),l=n(17),d=n(3)("socket.io-client");e.exports=t=i;var h=t.managers={};function i(e,t){"object"===(void 0===e?"undefined":c(e))&&(t=e,e=undefined),t=t||{};var n,r=u(e),i=r.source,o=r.id,a=r.path,s=h[o]&&a in h[o].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?(d("ignoring socket cache for %s",i),n=l(i,t)):(h[o]||(d("new io instance for %s",i),h[o]=l(i,t)),n=h[o]),r.query&&!t.query?t.query=r.query:t&&"object"===c(t.query)&&(t.query=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(t.query)),n.socket(r.path,t)}t.protocol=r.protocol,t.connect=i,t.Manager=n(17),t.Socket=n(44)},function(e,t,n){(function(i){"use strict";var o=n(2),a=n(3)("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||i.location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(a("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),a("parse %s",e),n=o(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n}}).call(t,function(){return this}())},function(e,t){var s=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var i=s.exec(e||""),o={},a=14;a--;)o[c[a]]=i[a]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o}},function(n,o,r){(function(e){function t(){try{return o.storage.debug}catch(e){}if(void 0!==e&&"env"in e)return e.env.DEBUG}(o=n.exports=r(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+o.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var r=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,n),e},o.save=function(e){try{null==e?o.storage.removeItem("debug"):o.storage.debug=e}catch(e){}},o.load=t,o.useColors=function(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},o.enable(t())}).call(o,r(4))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,s,t){(s=e.exports=n.debug=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,r=0;r<n;r++)t[r]&&("-"===(e=t[r].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,n;for(t=0,n=s.skips.length;t<n;t++)if(s.skips[t].test(e))return!1;for(t=0,n=s.names.length;t<n;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=t(6),s.names=[],s.skips=[],s.formatters={};var c,u=0;function n(e){function t(){}function r(){var i=r,e=+new Date,t=e-(c||e);i.diff=t,i.prev=c,i.curr=e,c=e,null==i.useColors&&(i.useColors=s.useColors()),null==i.color&&i.useColors&&(i.color=s.colors[u++%s.colors.length]);for(var o=new Array(arguments.length),n=0;n<o.length;n++)o[n]=arguments[n];o[0]=s.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(e,t){if("%%"===e)return e;a++;var n=s.formatters[t];if("function"==typeof n){var r=o[a];e=n.call(i,r),o.splice(a,1),a--}return e}),o=s.formatArgs.apply(i,o),(r.log||s.log||console.log.bind(console)).apply(i,o)}r.enabled=!(t.enabled=!1);var n=s.enabled(e)?r:t;return n.namespace=e,n}},function(e,t){var i=36e5,o=864e5;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var n,r=typeof e;if("string"===r&&0<e.length)return function(e){if(1e4<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}(e);if("number"===r&&!1===isNaN(e))return t.long?a(n=e,o,"day")||a(n,i,"hour")||a(n,6e4,"minute")||a(n,1e3,"second")||n+" ms":function(e){if(o<=e)return Math.round(e/o)+"d";if(i<=e)return Math.round(e/i)+"h";if(6e4<=e)return Math.round(e/6e4)+"m";if(1e3<=e)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,a,t){var s=t(8)("socket.io-parser"),c=t(11),n=t(13),o=t(14),r=t(16);function i(){}function u(e){var t="",n=!1;return t+=e.type,a.BINARY_EVENT!=e.type&&a.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(n=!0,t+=e.nsp),null!=e.id&&(n&&(t+=",",n=!1),t+=e.id),null!=e.data&&(n&&(t+=","),t+=c.stringify(e.data)),s("encoded %j as %s",e,t),t}function l(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function h(e){return{type:a.ERROR,data:"parser error"}}a.protocol=4,a.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],a.CONNECT=0,a.DISCONNECT=1,a.EVENT=2,a.ACK=3,a.ERROR=4,a.BINARY_EVENT=5,a.BINARY_ACK=6,a.Encoder=i,a.Decoder=l,i.prototype.encode=function(e,t){var n,i;(s("encoding packet %j",e),a.BINARY_EVENT==e.type||a.BINARY_ACK==e.type)?(n=e,i=t,o.removeBlobs(n,function(e){var t=o.deconstructPacket(e),n=u(t.packet),r=t.buffers;r.unshift(n),i(r)})):t([u(e)])},n(l.prototype),l.prototype.add=function(e){var t;if("string"==typeof e)t=function(e){var t={},n=0;if(t.type=Number(e.charAt(0)),null==a.types[t.type])return h();if(a.BINARY_EVENT==t.type||a.BINARY_ACK==t.type){for(var r="";"-"!=e.charAt(++n)&&(r+=e.charAt(n),n!=e.length););if(r!=Number(r)||"-"!=e.charAt(n))throw new Error("Illegal attachments");t.attachments=Number(r)}if("/"==e.charAt(n+1))for(t.nsp="";++n;){var i=e.charAt(n);if(","==i)break;if(t.nsp+=i,n==e.length)break}else t.nsp="/";var o=e.charAt(n+1);if(""!==o&&Number(o)==o){for(t.id="";++n;){var i=e.charAt(n);if(null==i||Number(i)!=i){--n;break}if(t.id+=e.charAt(n),n==e.length)break}t.id=Number(t.id)}e.charAt(++n)&&(t=function(e,t){try{e.data=c.parse(t)}catch(e){return h()}return e}(t,e.substr(n)));return s("decoded %s as %j",e,t),t}(e),a.BINARY_EVENT==t.type||a.BINARY_ACK==t.type?(this.reconstructor=new d(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!r(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,o,t){function n(){var e;try{e=o.storage.debug}catch(e){}return e}(o=e.exports=t(9)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+o.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var r=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,n),e},o.save=function(e){try{null==e?o.storage.removeItem("debug"):o.storage.debug=e}catch(e){}},o.load=n,o.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(e){return JSON.stringify(e)},o.enable(n())},function(e,s,t){(s=e.exports=function(e){function t(){}function r(){var i=r,e=+new Date,t=e-(c||e);i.diff=t,i.prev=c,i.curr=e,c=e,null==i.useColors&&(i.useColors=s.useColors()),null==i.color&&i.useColors&&(i.color=s.colors[u++%s.colors.length]);var o=Array.prototype.slice.call(arguments);o[0]=s.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(e,t){if("%%"===e)return e;a++;var n=s.formatters[t];if("function"==typeof n){var r=o[a];e=n.call(i,r),o.splice(a,1),a--}return e}),"function"==typeof s.formatArgs&&(o=s.formatArgs.apply(i,o));var n=r.log||s.log||console.log.bind(console);n.apply(i,o)}t.enabled=!1,r.enabled=!0;var n=s.enabled(e)?r:t;return n.namespace=e,n}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},s.disable=function(){s.enable("")},s.enable=function(e){s.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,r=0;r<n;r++)t[r]&&("-"===(e=t[r].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.substr(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){var t,n;for(t=0,n=s.skips.length;t<n;t++)if(s.skips[t].test(e))return!1;for(t=0,n=s.names.length;t<n;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=t(10),s.names=[],s.skips=[],s.formatters={};var c,u=0},function(e,t){var i=36e5,o=864e5;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){if(1e4<(e=""+e).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}(e):t.long?a(r=e,o,"day")||a(r,i,"hour")||a(r,6e4,"minute")||a(r,1e3,"second")||r+" ms":o<=(n=e)?Math.round(n/o)+"d":i<=n?Math.round(n/i)+"h":6e4<=n?Math.round(n/6e4)+"m":1e3<=n?Math.round(n/1e3)+"s":n+"ms";var n,r}},function(e,c,t){(function(a,s){(function(){var F={function:!0,object:!0},e=F[typeof c]&&c&&!c.nodeType&&c,U=F[typeof window]&&window||this,t=e&&F[typeof a]&&a&&!a.nodeType&&"object"==typeof s&&s;function B(e,c){e||(e=U.Object()),c||(c=U.Object());var u=e.Number||U.Number,l=e.String||U.String,t=e.Object||U.Object,d=e.Date||U.Date,n=e.SyntaxError||U.SyntaxError,P=e.TypeError||U.TypeError,r=e.Math||U.Math,i=e.JSON||U.JSON;"object"==typeof i&&i&&(c.stringify=i.stringify,c.parse=i.parse);var w,M,E,o=t.prototype,T=o.toString,h=new d(-0xc782b5b800cec);try{h=-109252==h.getUTCFullYear()&&0===h.getUTCMonth()&&1===h.getUTCDate()&&10==h.getUTCHours()&&37==h.getUTCMinutes()&&6==h.getUTCSeconds()&&708==h.getUTCMilliseconds()}catch(e){}function p(e){if(p[e]!==E)return p[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=p("json-stringify")&&p("json-parse");else{var n,r='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var i=c.stringify,o="function"==typeof i&&h;if(o){(n=function(){return 1}).toJSON=n;try{o="0"===i(0)&&"0"===i(new u)&&'""'==i(new l)&&i(T)===E&&i(E)===E&&i()===E&&"1"===i(n)&&"[1]"==i([n])&&"[null]"==i([E])&&"null"==i(null)&&"[null,null,null]"==i([E,T,null])&&i({a:[n,!0,!1,null,"\0\b\n\f\r\t"]})==r&&"1"===i(null,n)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new d(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new d(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new d(-1))}catch(e){o=!1}}t=o}if("json-parse"==e){var a=c.parse;if("function"==typeof a)try{if(0===a("0")&&!a(!1)){var s=5==(n=a(r)).a.length&&1===n.a[0];if(s){try{s=!a('"\t"')}catch(e){}if(s)try{s=1!==a("01")}catch(e){}if(s)try{s=1!==a("1.")}catch(e){}}}}catch(e){s=!1}t=s}}return p[e]=!!t}if(!p("json")){var f="[object Function]",k="[object Number]",D="[object String]",A="[object Array]",s=p("bug-string-char-index");if(!h)var W=r.floor,a=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(e,t){return a[t]+365*(e-1970)+W((e-1969+(t=+(1<t)))/4)-W((e-1901+t)/100)+W((e-1601+t)/400)};if((w=o.hasOwnProperty)||(w=function(e){var n,t={};return(t.__proto__=null,t.__proto__={toString:1},t).toString!=T?w=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=t.constructor,w=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,w.call(this,e)}),M=function(e,t){var n,a,r,i=0;for(r in(n=function(){this.valueOf=0}).prototype.valueOf=0,a=new n)w.call(a,r)&&i++;return n=a=null,i?M=2==i?function(e,t){var n,r={},i=T.call(e)==f;for(n in e)i&&"prototype"==n||w.call(r,n)||!(r[n]=1)||!w.call(e,n)||t(n)}:function(e,t){var n,r,i=T.call(e)==f;for(n in e)i&&"prototype"==n||!w.call(e,n)||(r="constructor"===n)||t(n);(r||w.call(e,n="constructor"))&&t(n)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],M=function(e,t){var n,r,i=T.call(e)==f,o=!i&&"function"!=typeof e.constructor&&F[typeof e.hasOwnProperty]&&e.hasOwnProperty||w;for(n in e)i&&"prototype"==n||!o.call(e,n)||t(n);for(r=a.length;n=a[--r];o.call(e,n)&&t(n));}),M(e,t)},!p("json-stringify")){var g={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},R=function(e,t){return("000000"+(t||0)).slice(-e)},N=function(e){for(var t='"',n=0,r=e.length,i=!s||10<r,o=i&&(s?e.split(""):e);n<r;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=g[a];break;default:if(a<32){t+="\\u00"+R(2,a.toString(16));break}t+=i?o[n]:e.charAt(n)}}return t+'"'},I=function(e,t,n,r,i,o,a){var s,c,u,l,d,h,p,f,g,m,y,b,v,_,S,C;try{s=t[e]}catch(e){}if("object"==typeof s&&s)if("[object Date]"!=(c=T.call(s))||w.call(s,"toJSON"))"function"==typeof s.toJSON&&(c!=k&&c!=D&&c!=A||w.call(s,"toJSON"))&&(s=s.toJSON(e));else if(-1/0<s&&s<1/0){if(O){for(d=W(s/864e5),u=W(d/365.2425)+1970-1;O(u+1,0)<=d;u++);for(l=W((d-O(u,0))/30.42);O(u,l+1)<=d;l++);d=1+d-O(u,l),p=W((h=(s%864e5+864e5)%864e5)/36e5)%24,f=W(h/6e4)%60,g=W(h/1e3)%60,m=h%1e3}else u=s.getUTCFullYear(),l=s.getUTCMonth(),d=s.getUTCDate(),p=s.getUTCHours(),f=s.getUTCMinutes(),g=s.getUTCSeconds(),m=s.getUTCMilliseconds();s=(u<=0||1e4<=u?(u<0?"-":"+")+R(6,u<0?-u:u):R(4,u))+"-"+R(2,l+1)+"-"+R(2,d)+"T"+R(2,p)+":"+R(2,f)+":"+R(2,g)+"."+R(3,m)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if("[object Boolean]"==(c=T.call(s)))return""+s;if(c==k)return-1/0<s&&s<1/0?""+s:"null";if(c==D)return N(""+s);if("object"==typeof s){for(_=a.length;_--;)if(a[_]===s)throw P();if(a.push(s),y=[],S=o,o+=i,c==A){for(v=0,_=s.length;v<_;v++)b=I(v,s,n,r,i,o,a),y.push(b===E?"null":b);C=y.length?i?"[\n"+o+y.join(",\n"+o)+"\n"+S+"]":"["+y.join(",")+"]":"[]"}else M(r||s,function(e){var t=I(e,s,n,r,i,o,a);t!==E&&y.push(N(e)+":"+(i?" ":"")+t)}),C=y.length?i?"{\n"+o+y.join(",\n"+o)+"\n"+S+"}":"{"+y.join(",")+"}":"{}";return a.pop(),C}};c.stringify=function(e,t,n){var r,i,o,a;if(F[typeof t]&&t)if((a=T.call(t))==f)i=t;else if(a==A){o={};for(var s,c=0,u=t.length;c<u;s=t[c++],((a=T.call(s))==D||a==k)&&(o[s]=1));}if(n)if((a=T.call(n))==k){if(0<(n-=n%1))for(r="",10<n&&(n=10);r.length<n;r+=" ");}else a==D&&(r=n.length<=10?n:n.slice(0,10));return I("",((s={})[""]=e,s),i,o,r,"",[])}}if(!p("json-parse")){var m,y,b=l.fromCharCode,v={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},_=function(){throw m=y=null,n()},S=function(){for(var e,t,n,r,i,o=y,a=o.length;m<a;)switch(i=o.charCodeAt(m)){case 9:case 10:case 13:case 32:m++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=s?o.charAt(m):o[m],m++,e;case 34:for(e="@",m++;m<a;)if((i=o.charCodeAt(m))<32)_();else if(92==i)switch(i=o.charCodeAt(++m)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=v[i],m++;break;case 117:for(t=++m,n=m+4;m<n;m++)48<=(i=o.charCodeAt(m))&&i<=57||97<=i&&i<=102||65<=i&&i<=70||_();e+=b("0x"+o.slice(t,m));break;default:_()}else{if(34==i)break;for(i=o.charCodeAt(m),t=m;32<=i&&92!=i&&34!=i;)i=o.charCodeAt(++m);e+=o.slice(t,m)}if(34==o.charCodeAt(m))return m++,e;_();default:if(t=m,45==i&&(r=!0,i=o.charCodeAt(++m)),48<=i&&i<=57){for(48==i&&(48<=(i=o.charCodeAt(m+1))&&i<=57)&&_(),r=!1;m<a&&(48<=(i=o.charCodeAt(m))&&i<=57);m++);if(46==o.charCodeAt(m)){for(n=++m;n<a&&(48<=(i=o.charCodeAt(n))&&i<=57);n++);n==m&&_(),m=n}if(101==(i=o.charCodeAt(m))||69==i){for(43!=(i=o.charCodeAt(++m))&&45!=i||m++,n=m;n<a&&(48<=(i=o.charCodeAt(n))&&i<=57);n++);n==m&&_(),m=n}return+o.slice(t,m)}if(r&&_(),"true"==o.slice(m,m+4))return m+=4,!0;if("false"==o.slice(m,m+5))return m+=5,!1;if("null"==o.slice(m,m+4))return m+=4,null;_()}return"$"},C=function(e){var t,n;if("$"==e&&_(),"string"==typeof e){if("@"==(s?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=S());n||(n=!0))n&&(","==e?"]"==(e=S())&&_():_()),","==e&&_(),t.push(C(e));return t}if("{"==e){for(t={};"}"!=(e=S());n||(n=!0))n&&(","==e?"}"==(e=S())&&_():_()),","!=e&&"string"==typeof e&&"@"==(s?e.charAt(0):e[0])&&":"==S()||_(),t[e.slice(1)]=C(S());return t}_()}return e},x=function(e,t,n){var r=L(e,t,n);r===E?delete e[t]:e[t]=r},L=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if(T.call(i)==A)for(r=i.length;r--;)x(i,r,n);else M(i,function(e){x(i,e,n)});return n.call(e,t,i)};c.parse=function(e,t){var n,r;return m=0,y=""+e,n=C(S()),"$"!=S()&&_(),m=y=null,t&&T.call(t)==f?L(((r={})[""]=n,r),"",t):n}}}return c.runInContext=B,c}if(!t||t.global!==t&&t.window!==t&&t.self!==t||(U=t),e)B(U,e);else{var n=U.JSON,r=U.JSON3,i=!1,o=B(U,U.JSON3={noConflict:function(){return i||(i=!0,U.JSON=n,U.JSON3=r,n=r=null),o}});U.JSON={parse:o.parse,stringify:o.stringify}}}).call(this)}).call(c,t(12)(e),function(){return this}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}(e.exports=n).prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){(function(l){var d=n(15),h=n(16);t.deconstructPacket=function(e){var a=[],t=e.data;var n=e;return n.data=function e(t){if(!t)return t;if(h(t)){var n={_placeholder:!0,num:a.length};return a.push(t),n}if(d(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=e(t[i]);return r}if("object"==typeof t&&!(t instanceof Date)){for(var o in r={},t)r[o]=e(t[o]);return r}return t}(t),n.attachments=a.length,{packet:n,buffers:a}},t.reconstructPacket=function(e,i){return e.data=function e(t){if(t&&t._placeholder)return i[t.num];if(d(t)){for(var n=0;n<t.length;n++)t[n]=e(t[n]);return t}if(t&&"object"==typeof t){for(var r in t)t[r]=e(t[r]);return t}return t}(e.data),e.attachments=undefined,e},t.removeBlobs=function(e,s){var c=0,u=e;!function e(t,n,r){if(!t)return t;if(l.Blob&&t instanceof Blob||l.File&&t instanceof File){c++;var i=new FileReader;i.onload=function(){r?r[n]=this.result:u=this.result,--c||s(u)},i.readAsArrayBuffer(t)}else if(d(t))for(var o=0;o<t.length;o++)e(t[o],o,t);else if(t&&"object"==typeof t&&!h(t))for(var a in t)e(t[a],a,t)}(u),c||s(u)}}).call(t,function(){return this}())},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(t,function(){return this}())},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=n(18),o=n(44),i=n(35),a=n(7),u=n(46),s=n(47),l=n(3)("socket.io-client:manager"),d=n(42),h=n(48),p=Object.prototype.hasOwnProperty;function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"===(void 0===e?"undefined":r(e))&&(t=e,e=undefined),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}(e.exports=f).prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},i(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(n,e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=c(this.uri,this.opts);var t=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=u(t,"open",function(){r.onopen(),n&&n()}),o=u(t,"error",function(e){if(l("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),n){var t=new Error("Connection error");t.data=e,n(t)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;l("connect attempt will timeout after %d",a);var s=setTimeout(function(){l("connect attempt timed out after %d",a),i.destroy(),t.close(),t.emit("error","timeout"),r.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(i),this.subs.push(o),this},f.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",s(this,"ondata"))),this.subs.push(u(e,"ping",s(this,"onping"))),this.subs.push(u(e,"pong",s(this,"onpong"))),this.subs.push(u(e,"error",s(this,"onerror"))),this.subs.push(u(e,"close",s(this,"onclose"))),this.subs.push(u(this.decoder,"decoded",s(this,"ondecoded")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},f.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new o(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",i),n.on("connect",function(){n.id=r.engine.id}),this.autoConnect&&i()}function i(){~d(r.connecting,n)||r.connecting.push(n)}return n},f.prototype.destroy=function(e){var t=d(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},f.prototype.packet=function(n){l("writing packet %j",n);var r=this;n.query&&0===n.type&&(n.nsp+="?"+n.query),r.encoding?r.packetBuffer.push(n):(r.encoding=!0,this.encoder.encode(n,function(e){for(var t=0;t<e.length;t++)r.engine.write(e[t],n.options);r.encoding=!1,r.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();l("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(l("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(l("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(l("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){e.exports=n(19)},function(e,t,n){e.exports=n(20),e.exports.parser=n(27)},function(t,e,u){(function(r){var n=u(21),e=u(35),d=u(3)("engine.io-client:socket"),i=u(42),o=u(27),a=u(2),s=u(43),c=u(36);function h(e,t){if(!(this instanceof h))return new h(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=a(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=a(t.host).host),this.secure=null!=t.secure?t.secure:r.location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(r.location?location.hostname:"localhost"),this.port=t.port||(r.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized===undefined?null:t.rejectUnauthorized,this.forceNode=!!t.forceNode;var n="object"==typeof r&&r;n.global===n&&(t.extraHeaders&&0<Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}(t.exports=h).priorWebsocketSuccess=!1,e(h.prototype),h.protocol=o.protocol,(h.Socket=h).Transport=u(26),h.transports=u(21),h.parser=u(27),h.prototype.createTransport=function(e){d('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);return t.EIO=o.protocol,t.transport=e,this.id&&(t.sid=this.id),new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress})},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){d("setting transport %s",e.name);var t=this;this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),(this.transport=e).on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},h.prototype.probe=function(n){d('probing transport "%s"',n);var r=this.createTransport(n,{probe:1}),i=!1,o=this;function e(){if(o.onlyBinaryUpgrades){var e=!this.supportsBinary&&o.transport.supportsBinary;i=i||e}i||(d('probe transport "%s" opened',n),r.send([{type:"ping",data:"probe"}]),r.once("packet",function(e){if(!i)if("pong"===e.type&&"probe"===e.data){if(d('probe transport "%s" pong',n),o.upgrading=!0,o.emit("upgrading",r),!r)return;h.priorWebsocketSuccess="websocket"===r.name,d('pausing current transport "%s"',o.transport.name),o.transport.pause(function(){i||"closed"!==o.readyState&&(d("changing transport and sending upgrade packet"),l(),o.setTransport(r),r.send([{type:"upgrade"}]),o.emit("upgrade",r),r=null,o.upgrading=!1,o.flush())})}else{d('probe transport "%s" failed',n);var t=new Error("probe error");t.transport=r.name,o.emit("upgradeError",t)}}))}function a(){i||(i=!0,l(),r.close(),r=null)}function t(e){var t=new Error("probe error: "+e);t.transport=r.name,a(),d('probe transport "%s" failed because of error: %s',n,e),o.emit("upgradeError",t)}function s(){t("transport closed")}function c(){t("socket closed")}function u(e){r&&e.name!==r.name&&(d('"%s" works - aborting "%s"',e.name,r.name),a())}function l(){r.removeListener("open",e),r.removeListener("error",t),r.removeListener("close",s),o.removeListener("close",c),o.removeListener("upgrading",u)}h.priorWebsocketSuccess=!1,r.once("open",e),r.once("error",t),r.once("close",s),this.once("close",c),this.once("upgrading",u),r.open()},h.prototype.onOpen=function(){if(d("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){d("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(d('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(s(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else d('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){d("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},h.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(d("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},h.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=undefined),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),d("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},h.prototype.onError=function(e){d("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){d('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~i(this.transports,e[n])&&t.push(e[n]);return t}}).call(e,function(){return this}())},function(e,t,n){(function(a){var s=n(22),c=n(24),u=n(39),e=n(40);t.polling=function(e){var t=!1,n=!1,r=!1!==e.jsonp;if(a.location){var i="https:"===location.protocol,o=location.port;o||(o=i?443:80),t=e.hostname!==location.hostname||o!==e.port,n=e.secure!==i}{if(e.xdomain=t,e.xscheme=n,"open"in new s(e)&&!e.forceJSONP)return new c(e);if(!r)throw new Error("JSONP disabled");return new u(e)}},t.websocket=e}).call(t,function(){return this}())},function(e,t,n){(function(i){var o=n(23);e.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||o))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(i[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this}())},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(l,e,d){(function(i){var o=d(22),r=d(25),e=d(35),t=d(37),a=d(3)("engine.io-client:polling-xhr");function n(){}function s(e){if(r.call(this,e),this.requestTimeout=e.requestTimeout,i.location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!==i.location.hostname||n!==e.port,this.xs=e.secure!==t}else this.extraHeaders=e.extraHeaders}function c(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=undefined!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function u(){for(var e in c.requests)c.requests.hasOwnProperty(e)&&c.requests[e].abort()}l.exports=s,l.exports.Request=c,t(s,r),s.prototype.supportsBinary=!0,s.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new c(e)},s.prototype.doWrite=function(e,t){var n="string"!=typeof e&&e!==undefined,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},s.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},e(c.prototype),c.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new o(e),n=this;try{a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if(this.supportsBinary&&(t.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},a("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}i.document&&(this.index=c.requestsCount++,c.requests[this.index]=this)},c.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},c.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},c.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},c.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}i.document&&delete c.requests[this.index],this.xhr=null}},c.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===e)t=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){for(var n=new Uint8Array(this.xhr.response),r=[],i=0,o=n.length;i<o;i++)r.push(n[i]);t=String.fromCharCode.apply(null,r)}else t=this.xhr.responseText}catch(e){this.onError(e)}null!=t&&this.onData(t)},c.prototype.hasXDR=function(){return void 0!==i.XDomainRequest&&!this.xs&&this.enablesXDR},c.prototype.abort=function(){this.cleanup()},c.requestsCount=0,c.requests={},i.document&&(i.attachEvent?i.attachEvent("onunload",u):i.addEventListener&&i.addEventListener("beforeunload",u,!1))}).call(e,function(){return this}())},function(e,t,n){var r=n(26),i=n(36),o=n(27),a=n(37),s=n(38),c=n(3)("engine.io-client:polling");e.exports=l;var u=null!=new(n(22))({xdomain:!1}).responseType;function l(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}a(l,r),l.prototype.name="polling",l.prototype.doOpen=function(){this.poll()},l.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},l.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},l.prototype.onData=function(e){var r=this;c("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,function(e,t,n){if("opening"===r.readyState&&r.onOpen(),"close"===e.type)return r.onClose(),!1;r.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},l.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},l.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){var r=n(27);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}n(35)((e.exports=i).prototype),i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,m,r){(function(u){var i,e=r(28),o=r(29),p=r(30),s=r(31),l=r(32);u&&u.ArrayBuffer&&(i=r(33));var t="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),n="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),d=t||n;m.protocol=3;var h=m.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},a=e(h),f={type:"error",data:"parser error"},g=r(34);function c(e,t,n){for(var i=new Array(e.length),r=s(e.length,n),o=function(n,e,r){t(e,function(e,t){i[n]=t,r(e,i)})},a=0;a<e.length;a++)o(a,e[a],r)}m.encodePacket=function(e,t,n,r){"function"==typeof t&&(r=t,t=!1),"function"==typeof n&&(r=n,n=null);var i,o,a,s=e.data===undefined?undefined:e.data.buffer||e.data;if(u.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,t,n){if(!t)return m.encodeBase64Packet(e,n);var r=e.data,i=new Uint8Array(r),o=new Uint8Array(1+r.byteLength);o[0]=h[e.type];for(var a=0;a<i.length;a++)o[a+1]=i[a];return n(o.buffer)}(e,t,r);if(g&&s instanceof u.Blob)return function(e,t,n){if(!t)return m.encodeBase64Packet(e,n);if(d)return function(e,t,n){if(!t)return m.encodeBase64Packet(e,n);var r=new FileReader;return r.onload=function(){e.data=r.result,m.encodePacket(e,t,!0,n)},r.readAsArrayBuffer(e.data)}(e,t,n);var r=new Uint8Array(1);r[0]=h[e.type];var i=new g([r.buffer,e.data]);return n(i)}(e,t,r);if(s&&s.base64)return i=e,o=r,a="b"+m.packets[i.type]+i.data.data,o(a);var c=h[e.type];return undefined!==e.data&&(c+=n?l.encode(String(e.data)):String(e.data)),r(""+c)},m.encodeBase64Packet=function(t,n){var r,i="b"+m.packets[t.type];if(g&&t.data instanceof u.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];n(i+e)},o.readAsDataURL(t.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),s=new Array(a.length),c=0;c<a.length;c++)s[c]=a[c];r=String.fromCharCode.apply(null,s)}return i+=u.btoa(r),n(i)},m.decodePacket=function(e,t,n){if(e===undefined)return f;if("string"==typeof e){if("b"==e.charAt(0))return m.decodeBase64Packet(e.substr(1),t);if(n&&!1===(e=function(e){try{e=l.decode(e)}catch(e){return!1}return e}(e)))return f;var r=e.charAt(0);return Number(r)==r&&a[r]?1<e.length?{type:a[r],data:e.substring(1)}:{type:a[r]}:f}r=new Uint8Array(e)[0];var i=p(e,1);return g&&"blob"===t&&(i=new g([i])),{type:a[r],data:i}},m.decodeBase64Packet=function(e,t){var n=a[e.charAt(0)];if(!i)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=i.decode(e.substr(1));return"blob"===t&&g&&(r=new g([r])),{type:n,data:r}},m.encodePayload=function(e,t,n){"function"==typeof t&&(n=t,t=null);var r=o(e);if(t&&r)return g&&!d?m.encodePayloadAsBlob(e,n):m.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");c(e,function(e,n){m.encodePacket(e,!!r&&t,!0,function(e){var t;n(null,(t=e).length+":"+t)})},function(e,t){return n(t.join(""))})},m.decodePayload=function(e,t,n){if("string"!=typeof e)return m.decodePayloadAsBinary(e,t,n);var r;if("function"==typeof t&&(n=t,t=null),""==e)return n(f,0,1);for(var i,o,a="",s=0,c=e.length;s<c;s++){var u=e.charAt(s);if(":"!=u)a+=u;else{if(""==a||a!=(i=Number(a)))return n(f,0,1);if(a!=(o=e.substr(s+1,i)).length)return n(f,0,1);if(o.length){if(r=m.decodePacket(o,t,!0),f.type==r.type&&f.data==r.data)return n(f,0,1);if(!1===n(r,s+i,c))return}s+=i,a=""}}return""!=a?n(f,0,1):void 0},m.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));c(e,function(e,t){m.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,t){var n=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),a=new Uint8Array(n),s=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);n=r.buffer}a[s++]=t?0:1;var o=n.byteLength.toString();for(i=0;i<o.length;i++)a[s++]=parseInt(o[i]);a[s++]=255;for(r=new Uint8Array(n),i=0;i<r.length;i++)a[s++]=r[i]}),r(a.buffer)})},m.encodePayloadAsBlob=function(e,n){c(e,function(e,s){m.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);e=n.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),o=new Uint8Array(i.length+1);for(r=0;r<i.length;r++)o[r]=parseInt(i[r]);if(o[i.length]=255,g){var a=new g([t.buffer,o.buffer,e]);s(null,a)}})},function(e,t){return n(new g(t))})},m.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var t=e,i=[],o=!1;0<t.byteLength;){for(var a=new Uint8Array(t),s=0===a[0],c="",u=1;255!=a[u];u++){if(310<c.length){o=!0;break}c+=a[u]}if(o)return r(f,0,1);t=p(t,2+c.length),c=parseInt(c);var l=p(t,0,c);if(s)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var d=new Uint8Array(l);l="";for(u=0;u<d.length;u++)l+=String.fromCharCode(d[u])}i.push(l),t=p(t,c)}var h=i.length;i.forEach(function(e,t){r(m.decodePacket(e,n,!0),t,h)})}}).call(m,function(){return this}())},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t,n){(function(i){var o=n(15);e.exports=function(e){return function e(t){if(!t)return!1;if(i.Buffer&&i.Buffer.isBuffer&&i.Buffer.isBuffer(t)||i.ArrayBuffer&&t instanceof ArrayBuffer||i.Blob&&t instanceof Blob||i.File&&t instanceof File)return!0;if(o(t)){for(var n=0;n<t.length;n++)if(e(t[n]))return!0}else if(t&&"object"==typeof t)for(var r in t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return!0;return!1}(e)}}).call(t,function(){return this}())},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),r<n&&(n=r),r<=t||n<=t||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},function(e,t){function a(){}e.exports=function(e,n,r){var i=!1;return r=r||a,0===(o.count=e)?n():o;function o(e,t){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,n(e),n=r):0!==o.count||i||n(null,t)}}},function(e,g,m){var y;(function(p,f){!function(e){var t="object"==typeof g&&g,n=("object"==typeof p&&p&&p.exports,"object"==typeof f&&f);n.global!==n&&n.window;var r,i,o,a=String.fromCharCode;function s(e){for(var t,n,r=[],i=0,o=e.length;i<o;)55296<=(t=e.charCodeAt(i++))&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function c(e,t){return a(e>>t&63|128)}function u(e){if(0==(4294967168&e))return a(e);var t="";return 0==(4294965248&e)?t=a(e>>6&31|192):0==(4294901760&e)?(t=a(e>>12&15|224),t+=c(e,6)):0==(4292870144&e)&&(t=a(e>>18&7|240),t+=c(e,12),t+=c(e,6)),t+=a(63&e|128)}function l(){if(i<=o)throw Error("Invalid byte index");var e=255&r[o];if(o++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(){var e,t;if(i<o)throw Error("Invalid byte index");if(o==i)return!1;if(e=255&r[o],o++,0==(128&e))return e;if(192==(224&e)){if(128<=(t=(31&e)<<6|l()))return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if(2048<=(t=(15&e)<<12|l()<<6|l()))return t;throw Error("Invalid continuation byte")}if(240==(248&e)&&65536<=(t=(15&e)<<18|l()<<12|l()<<6|l())&&t<=1114111)return t;throw Error("Invalid WTF-8 detected")}var h={version:"1.0.0",encode:function(e){for(var t=s(e),n=t.length,r=-1,i="";++r<n;)i+=u(t[r]);return i},decode:function(e){r=s(e),i=r.length,o=0;for(var t,n=[];!1!==(t=d());)n.push(t);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)65535<(t=e[r])&&(i+=a((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=a(t);return i}(n)}};(y=function(){return h}.call(g,m,g,p))===undefined||(p.exports=y)}()}).call(g,m(12)(e),function(){return this}())},function(e,t){!function(){"use strict";for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(256),e=0;e<o.length;e++)d[o.charCodeAt(e)]=e;t.encode=function(e){var t,n=new Uint8Array(e),r=n.length,i="";for(t=0;t<r;t+=3)i+=o[n[t]>>2],i+=o[(3&n[t])<<4|n[t+1]>>4],i+=o[(15&n[t+1])<<2|n[t+2]>>6],i+=o[63&n[t+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,r,i,o,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<s;t+=4)n=d[e.charCodeAt(t)],r=d[e.charCodeAt(t+1)],i=d[e.charCodeAt(t+2)],o=d[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return u}}()},function(c,e){(function(e){var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,t=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),n=t&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),r=i&&i.prototype.append&&i.prototype.getBlob;function o(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function a(e,t){t=t||{};var n=new i;o(e);for(var r=0;r<e.length;r++)n.append(e[r]);return t.type?n.getBlob(t.type):n.getBlob()}function s(e,t){return o(e),new Blob(e,t||{})}c.exports=t?n?e.Blob:s:r?a:undefined}).call(e,function(){return this}())},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}(e.exports=r).prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){"use strict";var n,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,o={},a=0,s=0;function c(e){for(var t="";t=r[e%i]+t,0<(e=Math.floor(e/i)););return t}function u(){var e=c(+new Date);return e!==n?(a=0,n=e):e+"."+c(a++)}for(;s<i;s++)o[r[s]]=s;u.encode=c,u.decode=function(e){var t=0;for(s=0;s<e.length;s++)t=t*i+o[e.charAt(s)];return t},e.exports=u},function(a,e,s){(function(n){var r=s(25),e=s(37);a.exports=t;var i,u=/\n/g,l=/\\n/g;function o(){}function t(e){r.call(this,e),this.query=this.query||{},i||(n.___eio||(n.___eio=[]),i=n.___eio),this.index=i.length;var t=this;i.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=o)},!1)}e(t,r),t.prototype.supportsBinary=!1,t.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},t.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},t.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),a=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=a,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function s(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(l,"\\\n"),this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&s()}:this.iframe.onload=s}}).call(e,function(){return this}())},function(d,e,h){(function(a){var t,n=h(26),s=h(27),r=h(36),e=h(37),i=h(38),c=h(3)("engine.io-client:websocket"),o=a.WebSocket||a.MozWebSocket;if(void 0===window)try{t=h(41)}catch(e){}var u=o;function l(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.usingBrowserWebSocket||(u=t),n.call(this,e)}u||void 0!==window||(u=t),e(d.exports=l,n),l.prototype.name="websocket",l.prototype.supportsBinary=!0,l.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new u(e):new u(e,void 0,t)}catch(e){return this.emit("error",e)}this.ws.binaryType===undefined&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},l.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},l.prototype.write=function(e){var r=this;this.writable=!1;for(var i=e.length,t=0,n=i;t<n;t++)!function(n){s.encodePacket(n,r.supportsBinary,function(e){if(!r.usingBrowserWebSocket){var t={};if(n.options&&(t.compress=n.options.compress),r.perMessageDeflate)("string"==typeof e?a.Buffer.byteLength(e):e.length)<r.perMessageDeflate.threshold&&(t.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(e):r.ws.send(e,t)}catch(e){c("websocket closed before onclose event")}--i||o()})}(e[t]);function o(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}},l.prototype.onClose=function(){n.prototype.onClose.call(this)},l.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=i()),this.supportsBinary||(e.b64=1),(e=r.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},l.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===l.prototype.name)}}).call(e,function(){return this}())},function(e,t){},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t){(function(t){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(a,"").replace(s,""),t.JSON&&JSON.parse?JSON.parse(e):n.test(e.replace(r,"@").replace(i,"]").replace(o,""))?new Function("return "+e)():void 0):null}}).call(t,function(){return this}())},function(e,t,n){"use strict";var o=n(7),r=n(35),a=n(45),i=n(46),s=n(47),c=n(3)("socket.io-client:socket"),u=n(29);e.exports=h;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=r.prototype.emit;function h(e,t,n){this.io=e,this.nsp=t,(this.json=this).ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(h.prototype),h.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[i(e,"open",s(this,"onopen")),i(e,"packet",s(this,"onpacket")),i(e,"close",s(this,"onclose"))]}},h.prototype.open=h.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},h.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},h.prototype.emit=function(e){if(l.hasOwnProperty(e))return d.apply(this,arguments),this;var t=a(arguments),n=o.EVENT;u(t)&&(n=o.BINARY_EVENT);var r={type:n,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),delete this.flags,this},h.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},h.prototype.onopen=function(){c("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:o.CONNECT,query:this.query}):this.packet({type:o.CONNECT}))},h.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},h.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},h.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},h.prototype.ack=function(n){var r=this,i=!1;return function(){if(!i){i=!0;var e=a(arguments);c("sending ack %j",e);var t=u(e)?o.BINARY_ACK:o.ACK;r.packet({type:t,id:n,data:e})}}},h.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},h.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},h.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},h.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},h.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},h.prototype.close=h.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},h.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){"use strict";e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}(e.exports=n).prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])},"object"==typeof i&&"object"==typeof zn?zn.exports=l():"function"==typeof D&&D.amd?D([],l):"object"==typeof i?i.io=l():u.io=l(),d=this,h=function(){return function(n,e){var r=this;e===undefined&&(e=999),r.getOffset=function(e){for(var t=window.getComputedStyle(e,null),n=["paddingTop","paddingBottom"],r=0,i=0;i<n.length;i++)r+=parseInt(t[n[i]]);return r},r.autogrowFn=function(){var e=0,t=!1;return n.scrollHeight-i>r.maxAllowedHeight?(n.style.overflowY="scroll",e=r.maxAllowedHeight):(n.style.overflowY="hidden",n.style.height="auto",e=n.scrollHeight-i,t=!0),n.style.height=e+"px",t};var i=r.getOffset(n);r.rows=n.rows||1,r.lineHeight=n.scrollHeight/r.rows-i/r.rows,r.maxAllowedHeight=r.lineHeight*e-i,n.addEventListener("input",r.autogrowFn)}},"function"==typeof D&&D.amd?D([],h):"object"==typeof zn&&zn.exports?zn.exports=h():d.Autogrow=h();var p,f=Array.prototype,g=Object.prototype,m=Function.prototype,y=(f.push,f.slice,g.toString),b=(g.hasOwnProperty,Array.isArray),v=Object.keys,S=(m.bind,Object.create,Math.pow(2,53)-1),C=(p="length",function(e){return null==e?void 0:e[p]}),P=function(e){var t=C(e);return"number"==typeof t&&0<=t&&t<=S};_.isEmpty=function(e){return null==e||(P(e)&&(_.isArray(e)||_.isString(e)||_.isArguments(e))?0===e.length:0===_.keys(e).length)},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=b||function(e){return"[object Array]"===y.call(e)},_.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},_.each=_.forEach=function(e,t,n){var r,i;if(t=function(i,o,e){if(void 0===o)return i;switch(null==e?3:e){case 1:return function(e){return i.call(o,e)};case 3:return function(e,t,n){return i.call(o,e,t,n)};case 4:return function(e,t,n,r){return i.call(o,e,t,n,r)}}return function(){return i.apply(o,arguments)}}(t,n),P(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=_.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},_.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol"],function(t){_["is"+t]=function(e){return y.call(e)==="[object "+t+"]"}});var w=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],E=function(e,t){var n=M.length,r=e.constructor,i=_.isFunction(r)&&r.prototype||g,o="constructor";for(_.has(e,o)&&!_.contains(t,o)&&t.push(o);n--;)(o=M[n])in e&&e[o]!==i[o]&&!_.contains(t,o)&&t.push(o)};_.allKeys=function(e){if(!_.isObject(e))return[];var t=[];for(var n in e)t.push(n);return w&&E(e,t),t},_.keys=function(e){if(!_.isObject(e))return[];if(v)return v(e);var t=[];for(var n in e)_.has(e,n)&&t.push(n);return w&&E(e,t),t};var T=function(c,u){return function(e){var t=arguments.length;if(u&&(e=Object(e)),t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=c(r),o=i.length,a=0;a<o;a++){var s=i[a];u&&void 0!==e[s]||(e[s]=r[s])}return e}};_.extend=T(_.allKeys),_.extendOwn=_.assign=T(_.keys),void 0!==Se&&(this.firebase=Se),void 0!==_&&(this._=_)};libWrapper.call(SyneriseLibraryScope),SyneriseLibraryScope.ES6Promise&&SyneriseLibraryScope.ES6Promise.Promise||console.error("Main:init Promise library is required");var Autogrow=SyneriseLibraryScope.Autogrow,emojione=SyneriseLibraryScope.emojione,io=SyneriseLibraryScope.io,moment=SyneriseLibraryScope.moment,firebase=SyneriseLibraryScope.firebase,_=SyneriseLibraryScope._,Promise=SyneriseLibraryScope.ES6Promise.Promise,fetch=SyneriseLibraryScope.ES6Fetch.fetch,Headers=SyneriseLibraryScope.ES6Fetch.Headers,Request=SyneriseLibraryScope.ES6Fetch.Request;if(_.cookie.get("_snrs_sdk_d")){var _getTimeMessage=function(){return"SDK ["+timer.get().getElapsedTimeString()+"]"},_callFunctionWithTimeMessage=function(e,t){var n=new Array(t.length+1);n[0]=_getTimeMessage();for(var r=0;r<t.length;++r)n[r+1]=t[r];e.apply(this,n)};dump=_.cookie.get("_snrs_sdk_d_timer")?{debug:function(){_callFunctionWithTimeMessage(console.debug,arguments)},log:function(){_callFunctionWithTimeMessage(console.log,arguments)},info:function(){_callFunctionWithTimeMessage(console.info,arguments)},error:function(){_callFunctionWithTimeMessage(console.error,arguments)},fatal:function(){_callFunctionWithTimeMessage(console.error,arguments)}}:{debug:console.debug.bind(console),log:console.log.bind(console),info:console.info.bind(console),error:function(){ErrorHandler.callFunctionAndLogError(console.error,arguments)},fatal:function(){ErrorHandler.callFunctionAndLogError(console.error,arguments,ErrorHandler.LEVEL.fatal)}}}else dump={debug:emptyFn,log:emptyFn,info:emptyFn,error:function(){ErrorHandler.callFunctionAndLogError(emptyFn,arguments)},fatal:function(){ErrorHandler.callFunctionAndLogError(emptyFn,arguments,ErrorHandler.LEVEL.fatal)}};dump.log("Main:init SyneriseLibraryScope",SyneriseLibraryScope);var Auth={_apiKey:null,_trackerKey:null,apiKey:function(e){return dump.error("Api key is no longer supported"),null},trackerKey:function(e){return void 0!==e?"YOUR_TRACKER_KEY"!=e?Auth._trackerKey=e:null:Auth._trackerKey},getHeaderAuth:function(e){if(!Auth.checkAuth())throw new TypeError("TrackerKey is not set");return"key"==e?"Tracker":"value"==e?this.trackerKey():void 0},checkAuth:function(){return!!this.trackerKey()||(dump.error("TrackerKey is not set"),!1)}};function Client(e){e=e||{},this.uuid=e.uuid||null,this.permUuid=e.permUuid||null,this.customIdentify=e.customIdentify||null,this.tags=null,this.segments=null,this.params=e.params||null,void 0!==this.params&&null!=this.params&&void 0!==this.params.customIdentify&&(this.customIdentify=this.params.customIdentify,delete this.params.customIdentify)}Client.prototype.getTags=function(){dump.log("Client:getTag");var e=this;return new Promise(function(t,n){e.tags?t(e.tags):getData(e).then(function(e){dump.log("Client:getTag RequestManager.getClientTags then",e),t(e.tags?e.tags:[])}).catch(function(e){n(e)})})},Client.prototype.getSegments=function(){dump.log("Client:getSegments");var e=this;return new Promise(function(t,n){e.segments?t(e.segments):getData(e).then(function(e){dump.log("Client:getTag RequestManager.getSegments then",e),t(e.segments?e.segments:[])}).catch(function(e){n(e)})})};var getData=function(r){return dump.log("Client:getData"),new Promise(function(t,n){r.segments&&r.tags?t({tags:r.tags,segments:r.segments}):RequestManager.getClientData(r).then(function(e){dump.log("Client:getData RequestManager.getClientData then",e),r.segments=e.segments?e.segments:[],r.tags=e.tags?e.tags:[],t(e)}).catch(function(e){n(e)})})};Client.prototype.getDynamicContents=function(){dump.log("Client:getDynamicContents",this);var n=this;return new Promise(function(e,t){DynamicContentManager.getDynamicContentsForClient(n).then(e).catch(function(e){dump.error(e,n),t(new Error("Can not get dynamic contents"))})})},Client.prototype.renderDynamicContents=function(){dump.log("Client:renderDynamicContents");var r=this;return new Promise(function(t,n){r.getDynamicContents().then(DynamicContentManager.renderBatchDynamicContents).then(function(e){_.each(e,function(e){r.renderDynamicContent(e)}),t(e)}).catch(function(e){dump.error(e,r),n(new Error("Can not render dynamic contents"))})})},Client.prototype.renderDynamicContent=function(e){return DynamicContentManager.renderDynamicContentForClient(e,this)},Client.prototype.reRenderDynamicContent=function(e){return DynamicContentManager.reRenderDynamicContentForClient(e,this)},Client.prototype.getDynamicContentByUuids=function(n){dump.log("Client:getDynamicContentByUuids",this);var r=this;return new Promise(function(e,t){DynamicContentManager.getDynamicContentByUuidsForClient(r,n).then(e).catch(function(e){dump.error(e,r),t(new Error("Can not get dynamic content"))})})},Client.prototype.renderDynamicContentByUuids=function(e){dump.log("Client:renderDynamicContentByUuids");var r=this;return new Promise(function(t,n){r.getDynamicContentByUuids(e).then(function(e){_.each(e,function(e){r.reRenderDynamicContent(e)}),t(e)}).catch(function(e){dump.error(e,r),n(new Error("Can not render dynamic content"))})})},Client.prototype.getNotifications=function(){dump.log("Client:getNotifications");var n=this;return new Promise(function(t,e){dump.log("Client:getNotifications",n),NotificationManager.getNotificationsForClient(n).then(function(e){dump.log("Client:getNotifications NotificationManager.getNotificationsForClient() then check capping",e);var r=[];_.each(e,function(e){if(e.capping&&_.isObject(e.capping)&&e.id){var t=e.capping;switch(t.type){case"count":if(dump.log("Client.getNotifications capping count limit",t.count),t.count&&0<t.count){var n=Store.getNotificationCapping(e);dump.log("Client.getNotifications check capping",e.id,t.count,n,t.count>n),t.count>n&&r.push(e)}else r.push(e)}}else r.push(e)}),t(r)}).catch(function(e){dump.error(e),t([])})})},Client.prototype.renderNotifications=function(){dump.log("Client:renderNotifications");var n=this;return new Promise(function(t,e){n.getNotifications().then(function(e){return _.each(e,function(e){n.renderNotification(e)}),Promise.resolve(e)}).then(function(){t()}).catch(function(e){dump.error(e),t()})})},Client.prototype.renderNotification=function(s,c){var u=this;return new Promise(function(e,t){c=c||!1;var n=s.conditions&&s.conditions.delay?parseInt(s.conditions.delay,10):0;if(dump.log("Client:renderNotification",s,"delay:",n,"forceRender:",c),!c){if(s.additionalParams&&s.additionalParams.popupAtLeave)return dump.log("Client:renderNotification atach click handlers for leave popup"),NotificationManager.attachHandlerForLeavePopup(u,s),void e();s.additionalParams&&s.additionalParams.popupTransparentBackground?NotificationManager.turnOnPopupTransparentBackground():NotificationManager.turnOffPopupTransparentBackground();var r=0,i=new Date;if(n){var o,a=CookieStore.get("_snrs_notify_delay_"+s.id);if(a?o=new Date(parseInt(a,10)):(o=new Date(i.getTime()+1e3*n),CookieStore.set("_snrs_notify_delay_"+s.id,o.getTime(),300)),dump.log("Client:renderNotification check end date",o),0<(r=o.getTime()-i.getTime()))return dump.log("Client:renderNotification set render timeout",r),setTimeout(function(){u.renderNotification(s,!0)},r),void e(s)}}s.render().then(function(){return CookieStore.remove("_snrs_notify_delay_"+s.id),Promise.resolve(s)}).then(function(e){return dump.log("Client:renderNotification then",e,e.isRendered()),e.isRendered()&&Store.setNotificationCapping(e),Promise.resolve(e)}).then(function(t){var e=!(!t.conditions||!t.conditions.trackEventShow);return dump.log("Client:renderNotification track",t,e,t.isRendered()),t.isRendered()&&e&&RequestManager.track("client.web.browser.page","dynamicContent.show","",{id:t.id,title:t.name,url:window.location.href,userAgent:navigator.userAgent}).then(function(e){dump.log("Notification:render show tracked",t)}),Promise.resolve(t)}).catch(function(e){dump.error(e)}),e(s)})};var ClientManager={currentClient:null,notify:function(t){t=new ContentNotification(t),ClientManager.getCurrentClient().then(function(e){e.renderNotification(t,!0)})},getAndRenderDynamicContentsForClient:function(){ClientManager.getCurrentClient().then(function(e){e.renderDynamicContents()})},getCurrentClient:function(){return new Promise(function(t,n){if(dump.log("ClientManager:getCurrentClient",ClientManager.currentClient),ClientManager.currentClient&&ClientManager.currentClient.uuid&&ClientManager.currentClient.permUuid)t(ClientManager.currentClient);else{var e=ClientManager.getClientFromStore();if(e)ClientManager.currentClient?(ClientManager.currentClient.uuid=e.uuid,ClientManager.currentClient.permUuid=e.permUuid):ClientManager.setCurrentClient(e),dump.log("ClientManager:getCurrentClient return:",ClientManager.currentClient),t(ClientManager.currentClient);else var r=0,i=setInterval(function(){dump.log("ClientManager:getCurrentClient try get client again",r,25);var e=ClientManager.getClientFromStore();e?(clearInterval(i),i=null,ClientManager.currentClient?(ClientManager.currentClient.uuid=e.uuid,ClientManager.currentClient.permUuid=e.permUuid):ClientManager.setCurrentClient(e),dump.log("ClientManager:getCurrentClient return:",ClientManager.currentClient),t(ClientManager.currentClient)):25<=r&&(clearInterval(i),i=null,n(new TypeError("Client has not found"))),r++},50)}})},updateClientParams:function(e,t){void 0===t&&(t=!0),e instanceof Client?ClientManager.currentClient=e:ClientManager.currentClient.params=e,t&&EventManager.clientCreateOrUpdate("Update client data",ClientManager.currentClient.params)},setCurrentClient:function(e){ClientManager.currentClient=e},getClientFromStore:function(){dump.log("ClientManager:getClientFromStore");var e=Store.getClientUuid(),t=Store.getClientPermUuid();if(!e)return dump.log("ClientManager:getClientFromStore return:",null),null;if(!t)return dump.error("ClientManager:getClientFromStore PermUuid not found"),dump.log("ClientManager:getClientFromStore return:",null),null;var n=new Client({uuid:e,permUuid:t});return dump.log("ClientManager:getClientFromStore return:",n),n}},Core={_options:{notificationNewsletterHandlers:!0,disableNotification:!1,disableMessenger:!1,disableWebPush:!1,webpush:{},dynamicContent:{},lang:undefined,acceptLangList:undefined},_profileConfig:null,PROFILE_CONFIG_TYPE_NOTIFICATIONS:"notifications",PROFILE_CONFIG_TYPE_DATA_MARKER:"dataMarker",PROFILE_CONFIG_TYPE_PROVIDERS:"providers",PROFILE_CONFIG_TYPE_PROFILE:"profile",PROFILE_CONFIG_TYPE_WEBPUSH:"webPush",PROFILE_CONFIG_TYPE_MESSENGER:"messenger",PROFILE_CONFIG_TYPE_COOKIE_MATCHERS:"cookieMatchers",getVersion:function(){return _VERSION},getModuleName:function(){return _MODULE_NAME},getBuildTime:function(){return _BUILD_TIME},getFullVersion:function(){return Core.getModuleName()+":"+Core.getVersion()},getBuildHash:function(){return Utils.hashString(Core.getFullVersion()+Core.getBuildTime())+""},getOption:function(e){return void 0!==e?Core._options[e]:Core._options},init:function(r,i){return new Promise(function(t,n){if(Core._options=_.extend(Core._options,r),DeviceManager.init(),Core._options.lang?Core._options.acceptLangList=[Core._options.lang]:Core._options.lang=DeviceManager.getLanguage(),Core._options.acceptLangList||(Core._options.acceptLangList=DeviceManager.getAcceptLanguageList()),dump.log('Core:init module name: "'+Core.getModuleName()+'", version: "'+Core.getVersion()+'", build time: "'+Core.getBuildTime()+'"'),dump.log("Core:init with options",Core._options),Core._options.trackerKey&&Auth.trackerKey(Core._options.trackerKey),Core._options.apiKey&&Auth.apiKey(Core._options.apiKey),!Auth.checkAuth())throw new TypeError("TrackerKey is not set");if(Auth.trackerKey()){var e=[["setTracker",Auth.trackerKey()]];Core._options.customPageVisit&&e.push(["setCustomPageVisit",Core._options.customPageVisit]),Core._options.domain&&e.push(["setDomain",Core._options.domain]),void 0!==SyneriseTC.setCookieMatchersPromise&&e.push(["setCookieMatchersPromise",Core.getProfileConfigByType(Core.PROFILE_CONFIG_TYPE_COOKIE_MATCHERS)]),void 0!==Core._options.clientUuid&&Core._options.clientUuid&&e.push(["setUuid",[Core._options.clientUuid,!0]]),void 0!==Core._options.triggerPageVisitOnHashChange&&e.push(["setTriggerPageVisitOnHashChange",Core._options.triggerPageVisitOnHashChange]),dump.log("Core:init init tracker",e),SyneriseTC.init(e)}Core._options.disableMessenger||void 0===MessengerManager||Core.getProfileConfigByType(Core.PROFILE_CONFIG_TYPE_MESSENGER).then(function(e){e&&!0===e.enabled&&MessengerManager.init()}).catch(function(e){dump.error(e)}),ClientManager.getCurrentClient().then(function(n){return new Promise(function(e,t){if(dump.log("Core:init dynamicContents"),Core._options.disableDynamicContent)return e(n);DynamicContentManager.init(Core._options.dynamicContent).then(function(){Modal.init(),Core._options.dynamicContent.virtualPage||n.renderDynamicContents()}).catch(function(e){dump.error(e)}),e(n)})}).then(function(n){return new Promise(function(e,t){dump.log("Core:init basic data"),"object"==typeof i&&(dump.log("Core:init with client data",i),ClientManager.updateClientParams(i)),Core._options.disableFormMarker||FormMarker.init().catch(function(e){dump.error(e)}),"object"==typeof Core._options.dataLayer&&DataLayer.init(Core._options.dataLayer),ToolMarker.init().catch(function(e){dump.error(e)}),e(n)})}).then(function(n){return new Promise(function(t,e){if(dump.log("Core:init webpush"),Core._options.disableWebPush||void 0===WebPushManager)return t(n);WebPushManager.init(Core._options.webpush).then(function(){t(n)}).catch(function(e){t(n)})})}).then(function(n){return new Promise(function(e,t){if(dump.log("Core:init notifications"),Core._options.disableNotification)return e(n);NotificationManager.init().then(function(){Modal.init(),n.renderNotifications()}).catch(function(e){dump.error(e)}),e(n)})}).then(function(e){dump.log("Core:init done for client",e),t()}).catch(function(e){dump.error(e),n(new TypeError("Client is not identified"))})}).catch(function(e){dump.error(e)})},getProfileConfig:function(){return Utils.uniquePromiseHandler("Core:getProfileConfig",function(t,n){if(Core._profileConfig)return dump.log("Core:getProfileConfig RequestManager.getProfileConfig from cache",Core._profileConfig),t(Core._profileConfig);RequestManager.getProfileConfig().then(function(e){dump.log("Core:getProfileConfig RequestManager.getProfileConfig then",e),Core._profileConfig=e,t(Core._profileConfig)}).catch(function(e){n(e)})})},getProfileConfigByType:function(r){return new Promise(function(t,n){Core.getProfileConfig().then(function(e){if(dump.log("Core:getProfileConfigByType for type",r),!e)return t(null);t(e[r]||null)}).catch(function(e){n(e)})})},getWebPushProfileConfig:function(){return new Promise(function(o,t){var r=Core.getOption("acceptLangList")?Core.getOption("acceptLangList").join(","):undefined;Core.getProfileConfig().then(function(e){return new Promise(function(t,n){if(dump.log("Core:getWebPushProfileConfig get webpush config",e),Core._profileConfig&&Core._profileConfig[Core.PROFILE_CONFIG_TYPE_WEBPUSH]!==undefined)return dump.log("Core:getWebPushProfileConfig get from cache",Core._profileConfig[Core.PROFILE_CONFIG_TYPE_WEBPUSH]),t(Core._profileConfig);RequestManager.getWebPushProfileConfig(r).then(function(e){dump.log("Core:getWebPushProfileConfig RequestManager.getWebPushProfileConfig then",e),Core._profileConfig[Core.PROFILE_CONFIG_TYPE_WEBPUSH]=e,t(Core._profileConfig)}).catch(function(e){n(e)})})}).then(function(e){if(dump.log("Core:getWebPushProfileConfig",e),!(e&&e[Core.PROFILE_CONFIG_TYPE_PROVIDERS]&&e[Core.PROFILE_CONFIG_TYPE_PROFILE]&&e[Core.PROFILE_CONFIG_TYPE_WEBPUSH]))return dump.log("Core:getWebPushProfileConfig configs required for webpush are not defined.",e),dump.log("Core:getWebPushProfileConfig configs isProvidersConfig: "+!!e[Core.PROFILE_CONFIG_TYPE_PROVIDERS]+" isProfileConfig: "+!!e[Core.PROFILE_CONFIG_TYPE_PROFILE]+" isWebPushConfig: "+!!e[Core.PROFILE_CONFIG_TYPE_WEBPUSH]),o(null);var t=e[Core.PROFILE_CONFIG_TYPE_PROFILE],n=e[Core.PROFILE_CONFIG_TYPE_PROVIDERS];if(!n||!n.fcm)return dump.log("Core:getWebPushProfileConfig Fcm settings are not configured.",n),o(null);var r={sender_id:n.fcm.sender_id,agreement_page_domain:"https://"+t.subdomain+".snrpush.com"};dump.log("Core:getWebPushProfileConfig webpushData",e[Core.PROFILE_CONFIG_TYPE_WEBPUSH]),dump.log("Core:getWebPushProfileConfig extendData",r);var i=_.extend({},e[Core.PROFILE_CONFIG_TYPE_WEBPUSH],r);o(i||null)}).catch(function(e){t(e)})})}},DataLayer={_allowDataLayerAction:["add","remove","purchase","refund"],_initObserverPush:!1,init:function(t){try{dump.log("DataLayer:init",t),this.validData(t)&&(this.observerPush(t,this.eventData),this.eventsData(t))}catch(e){dump.error("DataLayer:init",t,e)}},validData:function(e){return!!Array.isArray&&Array.isArray(e)},eventsData:function(e){var t=this;e.forEach(function(e){t.eventData(t,e)})},eventData:function(t,e){if(dump.log("DataLayer:eventData - search ecommerce",e),"object"==typeof e.ecommerce){dump.log("DataLayer:eventData - found ecommerce",e);var n=e.ecommerce;t._allowDataLayerAction.forEach(function(e){"object"==typeof n[e]&&t.track(n,e)})}return!0},getParamsCookie:function(e){var t={};try{var n=CookieStore.getJson(e);if(n)for(var r in n)n.hasOwnProperty(r)&&r.match("(snrs?|utm)_.*")&&(t[r]=n[r])}catch(e){dump.log("DataLayer:eventData - parse snrs_params",item)}return t},observerPush:function(e,t){if(!this._initObserverPush)if("function"==typeof e.push){var n=e.push,r=this;e.push=function(){try{dump.log("DataLayer:observerPush - callback push",arguments[0]),t(r,arguments[0])}catch(e){try{dump.error("DataLayer:observerPush - callback push error E: ",e)}catch(e){}}return n.apply(this,arguments)},this._initObserverPush=!0}else dump.log("DataLayer:observerPush - dataLayer.push is not a function",item)},buildRequest:function(e,t){return{label:"datalayer.ecommerce",object:"datalayer."+t,params:{data:e,snrs_params:this.getParamsCookie("_snrs_params")}}},track:function(e,t){var n=this.buildRequest(e,t);return RequestManager.trackProxy(n)}},DeviceManager={DEVICE_TYPE_DESKTOP:"desktop",DEVICE_TYPE_MOBILE:"mobile",_screen:null,_isCrawler:null,_crawlerExclusionList:null,_crawlerList:["Googlebot","Mediapartners-Google","Web Preview","bot","Applebot","spider","crawler","Feedfetcher","Slurp","Twiceler","Nutch","BecomeBot","bingbot","BingPreview","Google Web Preview","WordPress.com mShots","Seznam","facebookexternalhit","Yandex","Teoma","ThumbSniper","Phantom","Nuhk","DuckDuckBot","sogou","Exabot","facebook","ia_archiver","slack","msnbot","adidxbot","Ask Jeeves"],init:function(){dump.log("DeviceManager:init"),DeviceManager._screen=DeviceManager.getScreenInfo()},getScreenInfo:function(){var e=null,t=null,n=null,r=[],i=null;if(screen)e=screen.width+"x"+screen.height,t=screen.colorDepth+"-bit";else if(java){var o=java.awt.Toolkit.getDefaultToolkit().getScreenSize();e=o.width+"x"+o.height}navigator.language?n=navigator.language.toLowerCase():navigator.browserLanguage?n=navigator.browserLanguage.toLowerCase():navigator.languages&&navigator.languages.length&&(n=navigator.languages[0].toLowerCase()),navigator.languages&&navigator.languages.length?r=navigator.languages:n&&r.push(n),document.characterSet?i=Utils.encodeString(document.characterSet):document.charset&&(i=Utils.encodeString(document.charset));var a=DeviceManager.DEVICE_TYPE_DESKTOP;if(e){var s=e.split("x");for(var c in a=DeviceManager.DEVICE_TYPE_MOBILE,s)s.hasOwnProperty(c)&&1024<parseInt(s[c],10)&&(a=DeviceManager.DEVICE_TYPE_DESKTOP)}return{encoding:i,resolution:e,color:t,language:n,deviceType:a,acceptLanguageList:r,isCrawler:DeviceManager.isCrawler()}},getProtocol:function(){var e=void 0!==document.location.protocol?document.location.protocol:"https";return(e=e.replace(":","")).match("https?")||(e="https"),e},isCrawler:function(){if(null===DeviceManager._isCrawler){DeviceManager._isCrawler=!1;var e=navigator.userAgent||"";if(DeviceManager._crawlerExclusionList&&(e=e.replace(new RegExp(DeviceManager._crawlerExclusionList.join("|"),"g"),"").trim()),e){var t=new RegExp(DeviceManager._crawlerList.join("|"),"g").exec(e);dump.log("DeviceManager:isCrawler matches",e,t),t&&t.length&&(DeviceManager._isCrawler=!0)}dump.log("DeviceManager:isCrawler",DeviceManager._isCrawler)}return!!DeviceManager._isCrawler},checkDeviceType:function(e){return dump.log("DeviceManager:checkDeviceType",e),_.isString(e)&&(e=[e]),_.inArray(DeviceManager._screen.deviceType,e)},getAcceptLanguageList:function(){return dump.log("DeviceManager:getAcceptLanguageList",DeviceManager._screen.acceptLanguageList),DeviceManager._screen.acceptLanguageList},getLanguage:function(){return dump.log("DeviceManager:getLanguage",DeviceManager._screen.language),DeviceManager._screen.language}};function DynamicContent(e,t){if(t=t||!0,(e=e||{}).options=e.options||{},this._container=null,this._nodes=[],this._status=DynamicContent.STATUS_NEW,this.id=e.id||null,this.subject=e.subject||null,this.displayType=e.displayType||null,this.toReRender=e.containsJinjava||e.isSegment||null,this.targetRestriction=new DynamicContentTargetRestriction(e.targetRestriction,!1),this.variants=[],Array.isArray(e.variants))for(var n in e.variants)e.variants.hasOwnProperty(n)&&(this.variants[n]=new DynamicContentVariant(e.variants[n],!1));this.viewsPage=new DynamicContentViewsPage({include:e.viewsPageUrl,exclude:e.viewsExcludePageUrl},!1),this.utm=new DynamicContentUtm(e.options.utm,!1),this.frequency=new DynamicContentFrequency(e.frequency,!1),this.stopDisplay=new DynamicContentStopDisplay(e.stopDisplay,!1),this.trigger=new DynamicContentTrigger(e.trigger,!1),this.capping=new DynamicContentCapping(e.capping,!1),t&&this.validate()}DynamicContent.DISPLAY_TYPE_OBJECT="OBJECT",DynamicContent.DISPLAY_TYPE_LAYER="LAYER",DynamicContent.DISPLAY_TYPE_OPTIONS_LIST=[DynamicContent.DISPLAY_TYPE_OBJECT,DynamicContent.DISPLAY_TYPE_LAYER],DynamicContent.STATUS_RENDERED="RENDERED",DynamicContent.STATUS_TRIGGERED="TRIGGERED",DynamicContent.STATUS_WAITING_TO_TRIGGER="WAITING_TO_TRIGGER",DynamicContent.STATUS_NEW="NEW",DynamicContent.prototype.validate=function(){if(!this.id)throw new Error("Invalid id");if(!this.displayType||-1===DynamicContent.DISPLAY_TYPE_OPTIONS_LIST.indexOf(this.displayType))throw new Error('Display type ("'+self.displayType+'") is incorrect, only '+DynamicContent.DISPLAY_TYPE_OPTIONS_LIST.join(",")+" is allowed");if(!Array.isArray(this.variants)||!this.variants.length)throw new Error("Invalid variants");switch(this.getVariant().validate(),this.displayType){case DynamicContent.DISPLAY_TYPE_OBJECT:if(!this.getVariant().getTargetSelector())throw new Error("Target selector not defined");if(!this.getVariant().getTargetSelectorPrefix())throw new Error("Target selector prefix not defined");break;case DynamicContent.DISPLAY_TYPE_LAYER:}return this.targetRestriction.validate(),this.viewsPage.validate(),this.utm.validate(),this.frequency.validate(),this.stopDisplay.validate(),this.trigger.validate(),this.capping.validate(),!0},DynamicContent.prototype.hasNodes=function(){return!!this._nodes.length},DynamicContent.prototype.getNodes=function(){return this._nodes},DynamicContent.prototype.getStatus=function(){return this._status},DynamicContent.prototype.isToReRender=function(){return this.toReRender},DynamicContent.prototype.isAbx=function(){return this.abx},DynamicContent.prototype.getId=function(){return this.id},DynamicContent.prototype.getSubject=function(){return this.subject},DynamicContent.prototype.getVariant=function(){return this.variants[0]},DynamicContent.prototype.getVariantId=function(){return this.getVariant().getId()},DynamicContent.prototype.getVariantName=function(){return this.getVariant().getName()},DynamicContent.prototype.getContent=function(){return this.getVariant().getContent()},DynamicContent.prototype.getTargetContainer=function(){var e=this.getVariant().getTargetSelector();return e?document.querySelector(e):null},DynamicContent.prototype.getContentToRender=function(){return this.getVariant().getContentToRender()},DynamicContent.prototype.isContentHtml=function(){return this.getVariant().isContentHtml()},DynamicContent.prototype.isContentCss=function(){return this.getVariant().isContentCss()},DynamicContent.prototype.isContentJs=function(){return this.getVariant().isContentJs()},DynamicContent.prototype.isTriggerInstant=function(){return this.trigger.isInstant()},DynamicContent.prototype.isRendered=function(){return this._status===DynamicContent.STATUS_RENDERED},DynamicContent.prototype.isDisplayTypeObject=function(){return this.displayType===DynamicContent.DISPLAY_TYPE_OBJECT},DynamicContent.prototype.setStatusRendered=function(){return this._status=DynamicContent.STATUS_RENDERED,dump.log("DynamicContent:setStatusRendered",this),this},DynamicContent.prototype.setStatusWaitingToTrigger=function(){return this._status=DynamicContent.STATUS_WAITING_TO_TRIGGER,dump.log("DynamicContent:setStatusWaitingToTrigger",this),this},DynamicContent.prototype.setStatusTriggered=function(){return this._status=DynamicContent.STATUS_TRIGGERED,dump.log("DynamicContent:setStatusTriggered",this),this},DynamicContent.prototype.isStatusReadyToRender=function(){return _.inArray(this.getStatus(),[DynamicContent.STATUS_NEW,DynamicContent.STATUS_TRIGGERED])},DynamicContent.prototype.isStatusNew=function(){return this.getStatus()===DynamicContent.STATUS_NEW},DynamicContent.prototype.isVisibleOnScreen=function(){return!!this.isRendered()&&Utils.isVisibleAtLeastOneElementOnScreen(this.getNodes())},DynamicContent.prototype.getUtmWithParametersFlatMap=function(){return this.utm.getUtmWithParametersFlatMap()},DynamicContent.prototype.render=function(){var r=this;return new Promise(function(e,t){dump.log("DynamicContent:render",r);var n=document.createDocumentFragment();(r.displayType===DynamicContent.DISPLAY_TYPE_LAYER?r.renderLayer(n):r.renderObject(n)).then(e).catch(t)})},DynamicContent.prototype.renderLayer=function(n){var r=this;return new Promise(function(e,t){if(Modal.isShown())return t(new Error("Other layer shown"));_.containerInnerHtml(n,r.getContentToRender()),r._nodes=_.getNodesArray(n),DynamicContentManager.attachHandlers(r).then(function(){Modal.setContent(n),r._container=Modal._contentCtr,r.isContentJs()&&_.executeScriptsForNodes(r.getNodes()),r.setStatusRendered(),Modal.show(),e()}).catch(t)})},DynamicContent.prototype.renderObject=function(r){var i=this;return new Promise(function(e,t){var n=i.getTargetContainer();_.containerInnerHtml(r,i.getContentToRender()),i._nodes=_.getNodesArray(r),DynamicContentManager.attachHandlers(i).then(function(){i.renderObjectForContainerByPrefix(n,r,i.getVariant().getTargetSelectorPrefix()),i._container=n,i.isContentJs()&&_.executeScriptsForNodes(i.getNodes()),i.setStatusRendered(),e()}).catch(t)})},DynamicContent.prototype.renderObjectForContainerByPrefix=function(e,t,n){switch(n){case DynamicContentVariant.TARGET_SELECTOR_PREFIX_BEFORE:this.renderObjectForContainerBefore(e,t);break;case DynamicContentVariant.TARGET_SELECTOR_PREFIX_AFTER:this.renderObjectForContainerAfter(e,t);break;case DynamicContentVariant.TARGET_SELECTOR_PREFIX_INNER:this.renderObjectForContainerInner(e,t)}},DynamicContent.prototype.renderObjectForContainerBefore=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw dump.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert before",e,e.parentNode,this),new Error("Invalid node to insert before");_.insertBefore(e,t)},DynamicContent.prototype.renderObjectForContainerAfter=function(e,t){if(!e.parentNode||e.parentNode.nodeType!==Node.ELEMENT_NODE||"html"===e.parentNode.nodeName.toLowerCase())throw dump.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert after",e,e.parentNode,this),new Error("Invalid node to insert after");_.insertAfter(e,t)},DynamicContent.prototype.renderObjectForContainerInner=function(e,t){if("html"===e.nodeName.toLowerCase())throw dump.error("DynamicContent:renderObjectForContainerBefore Invalid node to insert inner",e,this),new Error("Invalid node to insert inner");_.replaceChildren(e,t)};var DynamicContentManager={_virtualPage:!1,_dynamicContents:null,_stylesUrl:["https://www.snrcdn.net/sdk/3.0/synerise-javascript-sdk.css"],_callbackStack:{customVariablesFunction:function(){return{}}},_selectorObservers:{},renderedDynamicContents:[],setCustomVariablesFunction:function(e){DynamicContentManager._callbackStack.customVariablesFunction=e},prepareStyles:function(){return SourceManager.loadStyles(DynamicContentManager._stylesUrl)},init:function(n){return new Promise(function(e,t){DynamicContentManager.prepareStyles(),DynamicContentStore.clearExpiredKeysFromStore(),!0===n.virtualPage&&(DynamicContentManager._virtualPage=!0),e()})},getDynamicContentByUuids:function(n,r){return new Promise(function(e,t){RequestManager.getDynamicContentByUuids(n,r).then(DynamicContentManager.parseDataToObjects).then(DynamicContentManager.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},getDynamicContentsFiltered:function(n){return new Promise(function(e,t){RequestManager.getDynamicContentsFiltered(n).then(DynamicContentManager.setDynamicContentsCache).then(DynamicContentManager.parseDataToObjects).then(DynamicContentManager.filterUnsupportedDynamicContents).then(e).catch(function(e){t(e)})})},setDynamicContentsCache:function(n){return new Promise(function(e,t){DynamicContentStore.setDynamicContentsCache(n),e(n)})},getDynamicContentsCached:function(e){return new Promise(function(t,n){DynamicContentManager._dynamicContents=DynamicContentStore.getDynamicContentsCached(),DynamicContentManager._dynamicContents?DynamicContentManager.parseDataToObjects(DynamicContentManager._dynamicContents).then(DynamicContentManager.filterUnsupportedDynamicContents).then(t).catch(function(e){n(e)}):DynamicContentManager.getDynamicContentsFiltered(e).then(function(e){t(e)}).catch(function(e){n(e)})})},getDynamicContentsForClient:function(n){return dump.log("DynamicContentManager:getDynamicContentsForClient",n),new Promise(function(e,t){DynamicContentManager.getDynamicContentsCached(n).then(function(e){return dump.log("DynamicContentManager:getDynamicContentsCached result",n),DynamicContentManager.filterDynamicContentsForClient(n,e)}).then(e).catch(t)})},getDynamicContentByUuidsForClient:function(e,r){return dump.log("DynamicContentManager:getgetDynamicContentByUuidsForClient",e),new Promise(function(t,n){DynamicContentManager.getDynamicContentByUuids(e,r).then(function(e){t(e)}).catch(function(e){n(e)})})},parseDataToObjects:function(r){return new Promise(function(e,t){dump.log("DynamicContentManager:parseToObjects");var n=[];_.isEmpty(r)||_.each(r,function(t){try{var e=new DynamicContent(t);n.push(e)}catch(e){dump.error("DynamicContentManager:parseToObjects error",e,t)}}),dump.log("DynamicContentManager:parseToObjects after parse",n),e(n)})},filterDynamicContentsForClient:function(r,i){return dump.log("DynamicContentManager:filterDynamicContentsForClient",r,i),new Promise(function(e,t){var n=[];if(_.isEmpty(i))return e(n);_.each(i,function(e){DynamicContentManager.checkStopDisplay(e,r)&&DynamicContentManager.checkFrequency(e,r)&&n.push(e)}),e(n)})},checkFrequency:function(e){if(!e.frequency.isLimited())return!0;var t;e.frequency.isSessionExpiration()&&(dump.log("DynamicContentManager:checkFrequency renew session frequency expiration",e),DynamicContentManager.renewFrequencyExpiration(e),t=setInterval(function(){dump.log("DynamicContentManager:checkFrequency renew session frequency expiration after interval",e),DynamicContentManager.renewFrequencyExpiration(e)},1e3*DynamicContentFrequency.EXPIRATION_SESSION/10),setTimeout(function(){t&&(dump.log("DynamicContentManager:checkFrequency stop renewing session frequency - timeout",e),clearInterval(t))},1e3*DynamicContentFrequency.EXPIRATION_ON_PAGE_FOR_SESSION));var n=DynamicContentManager.getFrequencyValue(e);return dump.log("DynamicContentManager:checkFrequency frequencyValueStored",n),!e.frequency.checkFrequencyLimit(n)||(dump.info("DynamicContentManager:checkFrequency - invalid",n),!1)},renewFrequencyExpiration:function(e){if(!e.frequency.isLimited())return 0;var t=DynamicContentStore.renewFrequencyExpiration(e);return t?t.value:null},incrementFrequencyValue:function(e){return e.frequency.isLimited()?DynamicContentStore.incrementFrequency(e).value:0},getFrequencyValue:function(e){if(!e.frequency.isLimited())return 0;var t=DynamicContentStore.getFrequencyWithCheckExpiration(e);return t?t.value:null},filterUnsupportedDynamicContents:function(r){return new Promise(function(e,t){dump.log("DynamicContentManager:filterUnsupportedDynamicContents",r);var n=[];if(_.isEmpty(r))return e(n);_.each(r,function(e){DynamicContentManager.checkDevices(e)&&DynamicContentManager.checkViewsPage(e)&&n.push(e)}),e(n)})},renderBatchDynamicContents:function(i){return new Promise(function(e,t){dump.log("DynamicContentManager:renderBatchDynamicContents",i);var n=[],r=[];if(_.isEmpty(i))return e(n);_.each(i,function(e){if(e.isStatusReadyToRender()&&DynamicContentManager.checkViewsPage(e)){if(e.isStatusNew()&&!e.isTriggerInstant());else if(e.isDisplayTypeObject()&&!e.getTargetContainer());else if(e.isToReRender())return void r.push(e)}else;n.push(e)}),dump.log("DynamicContentManager:renderBatchDynamicContents::batched",r),DynamicContentManager.reRenderDynamicContents(r),e(n)})},checkDevices:function(e){var t=e.targetRestriction.getDevices();return!(t.length&&!DeviceManager.checkDeviceType(function(e){var t={};t[DynamicContentTargetRestriction.TARGET_RESTRICTION_DESKTOP]=DeviceManager.DEVICE_TYPE_DESKTOP,t[DynamicContentTargetRestriction.TARGET_RESTRICTION_MOBILE]=DeviceManager.DEVICE_TYPE_MOBILE;var n=[];return _.each(e,function(e){n.push(t[e]?t[e]:e)}),n}(t)))||(dump.info("DynamicContentManager:validDevices - invalid",t,e),!1)},checkViewsPage:function(e){return!!e.viewsPage.isMatchPageUrl(location.href)||(dump.info("DynamicContentManager:checkViewsPage - invalid",location.href,e),!1)},attachTrigger:function(e){if(dump.info("DynamicContentManager:attachTrigger",e,e.getStatus()),!e.isStatusNew()||e.isTriggerInstant())return Promise.resolve();switch(e.setStatusWaitingToTrigger(),e.trigger.getType()){case DynamicContentTrigger.TYPE_ON_LANDING:return DynamicContentManager.attachTriggerOnLanding(e);case DynamicContentTrigger.TYPE_ON_EXIT:return DynamicContentManager.attachTriggerOnExit(e);case DynamicContentTrigger.TYPE_AFTER_SCROLL:return DynamicContentManager.attachTriggerAfterScroll(e)}},attachTriggerOnLanding:function(e){if(dump.info("DynamicContentManager:attachTriggerOnLanding",e,e.trigger.isDelay()),!e.trigger.isDelay())return Promise.resolve();var t=function(){DynamicContentStore.removeTimeForDelay(e),DynamicContentManager.renderDynamicContentForClientAfterTriggered(e)},n=new Date,r=DynamicContentStore.getTimeForDelay(e);dump.info("DynamicContentManager:attachTriggerOnLanding stored date time",r,e),null===r?r=DynamicContentStore.setTimeForDelay(e,n):DynamicContentStore.renewTimeForDelay(e);var i=r.getTime()-n.getTime();return 0<i?(dump.log("DynamicContentManager:attachTriggerOnLanding set timeout",i,e),setTimeout(function(){t()},i)):t(),Promise.resolve()},attachTriggerOnExit:function(n){return dump.info("DynamicContentManager:attachTriggerOnExit",n),Utils.addEvent(document,"mouseout",function e(t){t.clientY<=0&&(Utils.removeEvent(document,"mouseout",e),_.preventDefault(t),dump.info("DynamicContentManager:attachTriggerOnExit mouseOut",t.clientY,n),DynamicContentManager.renderDynamicContentForClientAfterTriggered(n))}),Promise.resolve()},attachTriggerAfterScroll:function(n){var r;function e(e){var t=Utils.getScrollPercentage();return!!n.trigger.checkScrollingAchieved(t)&&(r&&clearInterval(r),dump.info("DynamicContentManager:attachTriggerAfterScroll scrollPercentage achieved",t,n),DynamicContentManager.renderDynamicContentForClientAfterTriggered(n),!0)}return dump.info("DynamicContentManager:attachTriggerAfterScroll",n,n.trigger.isDelay()),e()||(r=setInterval(e,250)),Promise.resolve()},attachHandlerForTrackEventShow:function(t){var n;function e(e){return!!t.isVisibleOnScreen()&&(n&&clearInterval(n),dump.info("DynamicContentManager:attachHandlerForTrackEventShow dc is visible on screen",t),EventManager.trackDynamicContentEventShow(t),!0)}return dump.info("DynamicContentManager:attachHandlerForTrackEventShow",t),e()||(n=setInterval(e,200)),Promise.resolve()},attachTargetSelectorObserver:function(t){if(dump.log("DynamicContentManager:attachTargetSelectorObserver",t),!DynamicContentManager._selectorObservers[t.getId()]&&!1===DynamicContentManager._virtualPage)try{var e=document.body||document,n=MutationObserver||WebKitMutationObserver||null,r="function"==typeof n,i=function(){t.getTargetContainer()&&(dump.log("DynamicContentManager:attachTargetSelectorObserver::findTargetSelector",t),dump.log("DynamicContentManager:attachTargetSelectorObserver::stopObserve",t),DynamicContentManager._selectorObservers[t.getId()]&&(r?DynamicContentManager._selectorObservers[t.getId()].disconnect():clearInterval(DynamicContentManager._selectorObservers[t.getId()]),DynamicContentManager._selectorObservers[t.getId()]=null),DynamicContentManager.renderDynamicContentForClientAfterTriggered(t))};r?(DynamicContentManager._selectorObservers[t.getId()]=new n(i),DynamicContentManager._selectorObservers[t.getId()].observe(e,{childList:!0,subtree:!0,attributes:!0})):DynamicContentManager._selectorObservers[t.getId()]=setInterval(i,200)}catch(e){dump.error("DynamicContentManager:attachTargetSelectorObserver::catch",e,t)}return Promise.resolve()},reRenderDynamicContents:function(t){return ClientManager.getCurrentClient().then(function(e){e.renderDynamicContentByUuids(t)}),Promise.resolve()},renderDynamicContentForClientAfterTriggered:function(e){dump.info("DynamicContentManager:renderDynamicContentAfterTriggered",e),e.setStatusTriggered(),DynamicContentManager.renderDynamicContentForCurrentClient(e)},renderDynamicContentForCurrentClient:function(n){return dump.info("DynamicContentManager:renderDynamicContentForCurrentClient",n),new Promise(function(e,t){ClientManager.getCurrentClient().then(function(e){return e.renderDynamicContent(n)}).then(e).catch(t)})},attachHandlers:function(e){return dump.info("DynamicContentManager:attachHandlers",e,e.hasNodes()),e.hasNodes()?Promise.all([DynamicContentManager.attachHandlersForStopDisplaySettings(e)]):(dump.info("DynamicContentManager:attachHandlers Nodes list empty",e),Promise.resolve())},attachHandlersForStopDisplaySettings:function(t){if(dump.info("DynamicContentManager:attachHandlersForStopDisplaySettings",t,t.stopDisplay.isStopAfterAction()),!t.stopDisplay.isStopAfterAction())return Promise.resolve();function e(e){dump.info("DynamicContentManager:attachHandlersForStopDisplaySettings handler",e,t),DynamicContentManager.stopDisplayAnymore(t)}Utils.attachHandlerForElements(_.getElementsByTagNameIncludesItself(t.getNodes(),"a"),"click",e,!1),Utils.attachHandlerForElements(_.getElementsByTagNameIncludesItself(t.getNodes(),"button"),"click",e,!1)},stopDisplayAnymore:function(e){return DynamicContentStore.stopDisplay(e)},checkStopDisplay:function(e){return dump.info("DynamicContentManager:checkStopDisplay",e,e.stopDisplay.isStopDefined()),!e.stopDisplay.isStopDefined()||(!DynamicContentStore.checkStopDisplay(e)||(dump.info("DynamicContentManager:checkStopDisplay - stopped",e),!1))},incrementViewsForStopDisplay:function(e){if(!e.stopDisplay.isStopAfterShow())return 0;var t=DynamicContentStore.incrementViewsForStopDisplay(e),n=DynamicContentManager.getViewsForStopDisplay(e);return dump.log("DynamicContentManager:incrementViewsForStopDisplay viewsValueStored",n),e.stopDisplay.checkShowTimesLimit(n)&&(dump.info("DynamicContentManager:incrementViewsForStopDisplay - views limit achieved",n),DynamicContentManager.stopDisplayAnymore(e),DynamicContentStore.removeViewsForStopDisplay(e)),t},getViewsForStopDisplay:function(e){return e.stopDisplay.isStopAfterShow()?DynamicContentStore.getViewsForStopDisplay(e):0},onAfterDynamicContentRender:function(n,e){return new Promise(function(e,t){new Promise(function(e,t){if(dump.log("Client:renderDynamicContent increment views",n.isRendered(),n.capping.isLimited(),n),!n.isRendered()||!n.capping.isLimited())return e();RequestManager.incrementDynamicContentViews(n),e()}).then(function(){return new Promise(function(e,t){if(dump.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.frequency.isLimited())return e();DynamicContentManager.incrementFrequencyValue(n),e()})}).then(function(){return new Promise(function(e,t){if(dump.log("Client:renderDynamicContent incrementFrequency",n.frequency.isLimited(),n),!n.isRendered()||!n.stopDisplay.isStopAfterShow())return e();DynamicContentManager.incrementViewsForStopDisplay(n),e()})}).then(function(){return new Promise(function(e,t){return dump.log("Client:renderDynamicContent track show",n.isRendered(),n),n.isRendered()?DynamicContentManager.attachHandlerForTrackEventShow(n):e()})}).then(e).catch(t)})},renderDynamicContentForClient:function(n,r){return new Promise(function(e,t){dump.log("DynamicContentManager:renderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()&&DynamicContentManager.checkViewsPage(n)?n.isStatusNew()&&!n.isTriggerInstant()?DynamicContentManager.attachTrigger(n):n.isDisplayTypeObject()&&!n.getTargetContainer()?DynamicContentManager.attachTargetSelectorObserver(n):n.isToReRender()?DynamicContentManager.reRenderDynamicContents([n]):n.render().then(function(){return DynamicContentManager.renderedDynamicContents.push(n),DynamicContentManager.onAfterDynamicContentRender(n,r)}):Promise.resolve(!1)).then(function(){e(n.isRendered())}).catch(function(e){dump.error(e,self,n),t(new Error("Can not render dynamic content"))})})},reRenderDynamicContentForClient:function(n,r){return new Promise(function(e,t){dump.log("DynamicContentManager:reRenderDynamicContentForClient",r,n.isStatusReadyToRender(),n.getStatus(),n),(n.isStatusReadyToRender()?n.render().then(function(){return DynamicContentManager.renderedDynamicContents.push(n),DynamicContentManager.onAfterDynamicContentRender(n,r)}):Promise.resolve(!1)).then(function(){e(n.isRendered())}).catch(function(e){dump.error(e,self,n),t(new Error("Can not reRender dynamic content"))})})},getRenderedDynamicContent:function(){return DynamicContentManager.renderedDynamicContents},getVariables:function(){try{var t=this._callbackStack.customVariablesFunction()}catch(e){dump.error("DynamicContentManager:getVariables -> customVariablesFunction error",e),t={}}try{var n=SyneriseTC.getOgTag()}catch(e){dump.error("DynamicContentManager:getVariables -> SyneriseTC.getOgTag error",e),n={}}"object"!=typeof n&&(n={}),"object"!=typeof t&&(t={});var e=Object.assign({},n,t);for(var r in e)"string"!=typeof e[r]&&delete e[r];return e},getVariants:function(){var e=DynamicContentStore.getDynamicContentsVariants();return"object"!=typeof e&&(e={}),Object.assign({},e)}};function DynamicContentCapping(e,t){t=t||!0,e=e||{},this.viewsLimit=null,e.viewsLimit&&(this.viewsLimit=parseInt(e.viewsLimit,10)),t&&this.validate()}function DynamicContentFrequency(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=_.extend({count:null,times:null,timesType:null},e.options),this.options.count=this.options.count?parseInt(this.options.count,10):null,this.options.times=this.options.times?parseInt(this.options.times,10):null,this.calculateCountAndExpiration(),t&&this.validate()}function DynamicContentStopDisplay(e,t){t=t||!0,e=e||{},this._count=null,this._expiration=null,this.type=e.type,this.options=_.extend({times:null},e.options),this.options.times=this.options.times?parseInt(this.options.times,10):null,t&&this.validate()}function DynamicContentTargetRestriction(e,t){t=t||!0,this.options=e||[],t&&this.validate()}function DynamicContentTrigger(e,t){switch(t=t||!0,e=e||{},this._delayInSeconds=null,this.type=e.type,this.options={},this.type){case DynamicContentTrigger.TYPE_ON_LANDING:this.options=_.extend({delayType:null,delayValue:null},e.options),this.options.delayValue=this.options.delayValue?parseInt(this.options.delayValue,10):null,this.calculateDelayInSeconds();break;case DynamicContentTrigger.TYPE_AFTER_SCROLL:this.options=_.extend({scrollingPercentage:null},e.options),this.options.scrollingPercentage=this.options.scrollingPercentage?parseInt(this.options.scrollingPercentage,10):null}t&&this.validate()}function DynamicContentUtm(e,t){t=t||!0,e=e||{},this.utm={utmCampaign:e.utmCampaign,utmMedium:e.utmMedium,utmSource:e.utmSource},this.parameters=_.extend({},e.parameters),t&&this.validate()}function DynamicContentVariant(e,t){t=t||!0,this.options=_.extend({id:null,name:null,percentage:null,content:{css:"",html:"",js:"",raw:""},selector:null,selectorPrefix:null},e),t&&this.validate()}function DynamicContentViewsPage(e,t){t=t||!0,this.options=_.extend({},{include:[],exclude:[]},e),t&&this.validate()}DynamicContentCapping.prototype.validate=function(){if(null!==this.viewsLimit&&isNaN(this.viewsLimit))throw new Error("Invalid views limit");return!0},DynamicContentCapping.prototype.isLimited=function(){return null!==this.viewsLimit},DynamicContentCapping.prototype.getViewsLimit=function(){return this.viewsLimit},DynamicContentFrequency.TYPE_ALWAYS="ALWAYS",DynamicContentFrequency.TYPE_ONCE="ONCE",DynamicContentFrequency.TYPE_ONCE_PER_VISIT="ONCE_PER_VISIT",DynamicContentFrequency.TYPE_ONCE_PER_DAY="ONCE_PER_DAY",DynamicContentFrequency.TYPE_MAXIMUM="MAXIMUM",DynamicContentFrequency.TYPE_OPTIONS_LIST=[DynamicContentFrequency.TYPE_ALWAYS,DynamicContentFrequency.TYPE_ONCE,DynamicContentFrequency.TYPE_ONCE_PER_VISIT,DynamicContentFrequency.TYPE_ONCE_PER_DAY,DynamicContentFrequency.TYPE_MAXIMUM],DynamicContentFrequency.TIME_TYPE_HOURS="HOURS",DynamicContentFrequency.TIME_TYPE_DAYS="DAYS",DynamicContentFrequency.TIME_TYPE_WEEKS="WEEKS",DynamicContentFrequency.TIME_TYPE_OPTIONS_LIST=[DynamicContentFrequency.TIME_TYPE_HOURS,DynamicContentFrequency.TIME_TYPE_DAYS,DynamicContentFrequency.TIME_TYPE_WEEKS],DynamicContentFrequency.EXPIRATION_SESSION=300,DynamicContentFrequency.EXPIRATION_ON_PAGE_FOR_SESSION=1800,DynamicContentFrequency.EXPIRATION_HOUR=3600,DynamicContentFrequency.EXPIRATION_DAY=86400,DynamicContentFrequency.EXPIRATION_WEEK=604800,DynamicContentFrequency.EXPIRATION_MAX_VALUE=2592e3,DynamicContentFrequency.prototype.validate=function(){var e=this.getType();if(!_.inArray(e,DynamicContentFrequency.TYPE_OPTIONS_LIST))throw new Error('Frequency type ("'+e+'") is incorrect, only ['+DynamicContentFrequency.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e===DynamicContentFrequency.TYPE_MAXIMUM){if(!_.inArray(this.options.timesType,DynamicContentFrequency.TIME_TYPE_OPTIONS_LIST))throw new Error('Frequency time type ("'+this.options.timesType+'") is incorrect, only ['+DynamicContentFrequency.TIME_TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(null===this.options.count||isNaN(this.options.count))throw new Error("Invalid count limit");if(null===this.options.times||isNaN(this.options.times))throw new Error("Invalid times limit")}return!0},DynamicContentFrequency.prototype.isLimited=function(){return this.getType()!==DynamicContentFrequency.TYPE_ALWAYS},DynamicContentFrequency.prototype.getType=function(){return this.type},DynamicContentFrequency.prototype.getExpiration=function(){return this._expiration},DynamicContentFrequency.prototype.isExpiration=function(){return null!==this._expiration},DynamicContentFrequency.prototype.isSessionExpiration=function(){return this.isExpiration()&&this.getType()===DynamicContentFrequency.TYPE_ONCE_PER_VISIT},DynamicContentFrequency.prototype.getCount=function(){return this._count},DynamicContentFrequency.prototype.isCount=function(){return null!==this._count},DynamicContentFrequency.prototype.calculateCountAndExpiration=function(){switch(this.type){case DynamicContentFrequency.TYPE_ALWAYS:this._count=null,this._expiration=null;break;case DynamicContentFrequency.TYPE_ONCE:this._count=1,this._expiration=DynamicContentFrequency.EXPIRATION_MAX_VALUE;break;case DynamicContentFrequency.TYPE_ONCE_PER_VISIT:this._count=1,this._expiration=DynamicContentFrequency.EXPIRATION_SESSION;break;case DynamicContentFrequency.TYPE_ONCE_PER_DAY:this._count=1,this._expiration=DynamicContentFrequency.EXPIRATION_DAY;break;case DynamicContentFrequency.TYPE_MAXIMUM:if(this._count=isNaN(this.options.count)?null:this.options.count,(this._expiration=null)!==this._count&&!isNaN(this.options.times))switch(this.options.timesType){case DynamicContentFrequency.TIME_TYPE_HOURS:this._expiration=this.options.times*DynamicContentFrequency.EXPIRATION_HOUR;break;case DynamicContentFrequency.TIME_TYPE_DAYS:this._expiration=this.options.times*DynamicContentFrequency.EXPIRATION_DAY;break;case DynamicContentFrequency.TIME_TYPE_WEEKS:this._expiration=this.options.times*DynamicContentFrequency.EXPIRATION_WEEK}}},DynamicContentFrequency.prototype.checkFrequencyLimit=function(e){return dump.log("DynamicContentFrequency:checkFrequencyLimit",e,this._count,this),this.isCount()&&this.getCount()<=e},DynamicContentStopDisplay.TYPE_NEVER="NEVER",DynamicContentStopDisplay.TYPE_AFTER_ACTION="AFTER_ACTION",DynamicContentStopDisplay.TYPE_AFTER_SHOW="AFTER_SHOW",DynamicContentStopDisplay.TYPE_OPTIONS_LIST=[DynamicContentStopDisplay.TYPE_NEVER,DynamicContentStopDisplay.TYPE_AFTER_ACTION,DynamicContentStopDisplay.TYPE_AFTER_SHOW],DynamicContentStopDisplay.STOP_DISPLAY_EXPIRATION_MAX_VALUE=2592e3,DynamicContentStopDisplay.prototype.validate=function(){var e=this.getType();if(!_.inArray(e,DynamicContentStopDisplay.TYPE_OPTIONS_LIST))throw new Error('Stop display type ("'+e+'") is incorrect, only ['+DynamicContentStopDisplay.TYPE_OPTIONS_LIST.join(",")+"] is allowed");if(e===DynamicContentStopDisplay.TYPE_AFTER_SHOW&&(null===this.options.times||isNaN(this.options.times)))throw new Error("Invalid times limit");return!0},DynamicContentStopDisplay.prototype.isStopDefined=function(){return this.getType()!==DynamicContentStopDisplay.TYPE_NEVER},DynamicContentStopDisplay.prototype.getType=function(){return this.type},DynamicContentStopDisplay.prototype.getShowTimes=function(){return this.options.times},DynamicContentStopDisplay.prototype.isShowTimes=function(){return this.isStopAfterShow()},DynamicContentStopDisplay.prototype.isStopAfterShow=function(){return this.getType()===DynamicContentStopDisplay.TYPE_AFTER_SHOW},DynamicContentStopDisplay.prototype.isStopAfterAction=function(){return this.getType()===DynamicContentStopDisplay.TYPE_AFTER_ACTION},DynamicContentStopDisplay.prototype.checkShowTimesLimit=function(e){return dump.log("DynamicContentStopDisplay:checkShowTimesLimit",e,this.getShowTimes(),this),this.isShowTimes()&&this.getShowTimes()<=e},DynamicContentTargetRestriction.TARGET_RESTRICTION_MOBILE="MOBILE",DynamicContentTargetRestriction.TARGET_RESTRICTION_DESKTOP="DESKTOP",DynamicContentTargetRestriction.TARGET_RESTRICTION_OPTIONS_LIST=[DynamicContentTargetRestriction.TARGET_RESTRICTION_MOBILE,DynamicContentTargetRestriction.TARGET_RESTRICTION_DESKTOP],DynamicContentTargetRestriction.prototype.validate=function(){if(!Array.isArray(this.options))throw new Error("Invalid target restriction options");var e=this.getDevices();return e.length&&_.each(e,function(e){if(!_.inArray(e,DynamicContentTargetRestriction.TARGET_RESTRICTION_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+DynamicContentTargetRestriction.TARGET_RESTRICTION_OPTIONS_LIST.join(",")+"] is allowed")}),!0},DynamicContentTargetRestriction.prototype.getDevices=function(){return this.options},DynamicContentTrigger.TYPE_ON_LANDING="ON_LANDING",DynamicContentTrigger.TYPE_ON_EXIT="ON_EXIT",DynamicContentTrigger.TYPE_AFTER_SCROLL="AFTER_SCROLL",DynamicContentTrigger.TYPE_OPTIONS_LIST=[DynamicContentTrigger.TYPE_ON_LANDING,DynamicContentTrigger.TYPE_ON_EXIT,DynamicContentTrigger.TYPE_AFTER_SCROLL],DynamicContentTrigger.DELAY_TYPE_SECONDS="SECONDS",DynamicContentTrigger.DELAY_TYPE_MINUTES="MINUTES",DynamicContentTrigger.DELAY_TYPE_OPTIONS_LIST=[DynamicContentTrigger.DELAY_TYPE_SECONDS,DynamicContentTrigger.DELAY_TYPE_MINUTES],DynamicContentTrigger.TRIGGER_DELAY_EXPIRATION_VALUE=300,DynamicContentTrigger.prototype.validate=function(){var e=this.getType();if(!_.inArray(e,DynamicContentTrigger.TYPE_OPTIONS_LIST))throw new Error('Trigger type ("'+e+'") is incorrect, only ['+DynamicContentTrigger.TYPE_OPTIONS_LIST.join(",")+"] is allowed");switch(e){case DynamicContentTrigger.TYPE_ON_LANDING:if(null!==this.options.delayValue){if(isNaN(this.options.delayValue))throw new Error("Invalid delay value");if(!_.inArray(this.options.delayType,DynamicContentTrigger.DELAY_TYPE_OPTIONS_LIST))throw new Error('Delay type ("'+this.options.delayType+'") is incorrect, only ['+DynamicContentTrigger.DELAY_TYPE_OPTIONS_LIST.join(",")+"] is allowed")}break;case DynamicContentTrigger.TYPE_AFTER_SCROLL:if(null===this.options.scrollingPercentage||isNaN(this.options.scrollingPercentage))throw new Error("Invalid scrolling percentage")}return!0},DynamicContentTrigger.prototype.isInstant=function(){return this.getType()===DynamicContentTrigger.TYPE_ON_LANDING&&!this.isDelay()},DynamicContentTrigger.prototype.getType=function(){return this.type},DynamicContentTrigger.prototype.isDelay=function(){return null!==this.options.delayValue},DynamicContentTrigger.prototype.getDelay=function(){return this.options.delayValue},DynamicContentTrigger.prototype.getDelayType=function(){return this.options.delayType},DynamicContentTrigger.prototype.getScrollingPercentage=function(){return this.options.scrollingPercentage},DynamicContentTrigger.prototype.isTypeOnLanging=function(){return this.getType()===DynamicContentTrigger.TYPE_ON_LANDING},DynamicContentTrigger.prototype.isTypeOnExit=function(){return this.getType()===DynamicContentTrigger.TYPE_ON_EXIT},DynamicContentTrigger.prototype.isTypeAfterScroll=function(){return this.getType()===DynamicContentTrigger.TYPE_AFTER_SCROLL},DynamicContentTrigger.prototype.getDelayInSeconds=function(){return this._delayInSeconds},DynamicContentTrigger.prototype.isDelayInSeconds=function(){return null!==this._delayInSeconds},DynamicContentTrigger.prototype.calculateDelayInSeconds=function(){if(null!==this.options.delayValue&&!isNaN(this.options.delayValue))switch(this.options.delayType){case DynamicContentTrigger.DELAY_TYPE_SECONDS:this._delayInSeconds=this.options.delayValue;break;case DynamicContentTrigger.DELAY_TYPE_MINUTES:this._delayInSeconds=60*this.options.delayValue}},DynamicContentTrigger.prototype.checkScrollingAchieved=function(e){return this.isTypeAfterScroll()&&this.getScrollingPercentage()<=e},DynamicContentUtm.prototype.validate=function(){return!0},DynamicContentUtm.prototype.getUtm=function(){return this.utm},DynamicContentUtm.prototype.getUtmCampaign=function(){return this.utm.utmCampaign},DynamicContentUtm.prototype.getUtmMedium=function(){return this.utm.utmMedium},DynamicContentUtm.prototype.getUtmSource=function(){return this.utm.utmSource},DynamicContentUtm.prototype.getParameters=function(){return this.parameters},DynamicContentUtm.prototype.getUtmWithParametersFlatMap=function(){return _.extend({},this.getParameters(),this.getUtm())},DynamicContentVariant.TARGET_SELECTOR_PREFIX_BEFORE="BEFORE",DynamicContentVariant.TARGET_SELECTOR_PREFIX_AFTER="AFTER",DynamicContentVariant.TARGET_SELECTOR_PREFIX_INNER="INNER",DynamicContentVariant.TARGET_SELECTOR_PREFIX_OPTIONS_LIST=[DynamicContentVariant.TARGET_SELECTOR_PREFIX_BEFORE,DynamicContentVariant.TARGET_SELECTOR_PREFIX_AFTER,DynamicContentVariant.TARGET_SELECTOR_PREFIX_INNER],DynamicContentVariant.prototype.validate=function(){if(!this.getName())throw new Error("Name not defined");var e=this.getTargetSelectorPrefix();if(e&&!_.inArray(e,DynamicContentVariant.TARGET_SELECTOR_PREFIX_OPTIONS_LIST))throw new Error('Target selector prefix ("'+e+'") is incorrect, only ['+DynamicContentVariant.TARGET_SELECTOR_PREFIX_OPTIONS_LIST.join(",")+"] is allowed");return!0},DynamicContentVariant.prototype.getId=function(){return this.options.id},DynamicContentVariant.prototype.getName=function(){return this.options.name},DynamicContentVariant.prototype.getContent=function(){return this.options.content},DynamicContentVariant.prototype.getTargetSelector=function(){return this.options.selector},DynamicContentVariant.prototype.getTargetSelectorPrefix=function(){return this.options.selectorPrefix},DynamicContentVariant.prototype.isContent=function(){return this.isContentHtml()||this.isContentCss()||this.isContentJs()},DynamicContentVariant.prototype.isContentHtml=function(){return!!this.getContent().html},DynamicContentVariant.prototype.isContentCss=function(){return!!this.getContent().css},DynamicContentVariant.prototype.isContentJs=function(){return!!this.getContent().js},DynamicContentVariant.prototype.getContentHtml=function(){return this.getContent().html},DynamicContentVariant.prototype.getContentCss=function(){return this.getContent().css},DynamicContentVariant.prototype.getContentJs=function(){return this.getContent().js},DynamicContentVariant.prototype.getContentToRender=function(){var e="";return this.isContentCss()&&(e+=this.getContentCssToRender()),this.isContentHtml()&&(e+=this.getContentHtmlToRender()),this.isContentJs()&&(e+=this.getContentJsToRender()),e},DynamicContentVariant.prototype.getContentHtmlToRender=function(){return this.getContentHtml()},DynamicContentVariant.prototype.getContentCssToRender=function(){return'<style type="text/css">'+this.getContentCss()+"</style>"},DynamicContentVariant.prototype.getContentJsToRender=function(){return'<script type="application/javascript">'+this.getContentJs()+"<\/script>"},DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_EQUALS="EQUALS",DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_CONTAIN="CONTAIN",DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_REGEXP="REGEXP",DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST=[DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_EQUALS,DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_CONTAIN,DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_REGEXP],DynamicContentViewsPage.prototype.validate=function(){if(!Array.isArray(this.options.include)||!Array.isArray(this.options.exclude))throw new Error("Invalid views page url options");return _.each(this.options,function(e,t){Array.isArray(e)&&_.each(e,function(e){if(!_.inArray(e.type,DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST))throw new Error('Type of views page url ("'+e.type+'") is incorrect, only ['+DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_OPTIONS_LIST.join(",")+'] is allowed (in "'+t+'" mode)')})}),!0},DynamicContentViewsPage.prototype.getIncludePages=function(){return this.options.include},DynamicContentViewsPage.prototype.getExcludePages=function(){return this.options.exclude},DynamicContentViewsPage.prototype.isIncludePages=function(){return this.options.include&&this.options.include.length},DynamicContentViewsPage.prototype.isExcludePages=function(){return this.options.exclude&&this.options.exclude.length},DynamicContentViewsPage.prototype.isMatchPageUrl=function(e){dump.log("DynamicContentViewsPage:isMatchPageUrl",e,this.options,this);var o=this;function i(e,t,n){switch(n){case DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_EQUALS:return e===t;case DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_CONTAIN:return-1!==e.indexOf(t);case DynamicContentViewsPage.VIEWS_PAGE_URL_TYPE_REGEXP:try{var r=t.replace(/\\\\/g,"\\"),i=new RegExp(r,"m");return dump.log("DynamicContentViewsPage:regExp object",i),i.test(e)}catch(e){throw dump.error("DynamicContentViewsPage:isMatchPageUrl RegExp invalid",r,n,e,o),e}}}function t(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(i(e,r.requirement,r.type))return r}return!1}if(this.isIncludePages()){if(!1===(n=t(e,this.getIncludePages())))return dump.log("DynamicContentViewsPage:isMatchPageUrl included - not allowed",this.getIncludePages(),this),!1;dump.log("DynamicContentViewsPage:isMatchPageUrl included - allowed",n,this)}if(this.isExcludePages()){var n;if(!1!==(n=t(e,this.getExcludePages())))return dump.log("DynamicContentViewsPage:isMatchPageUrl excluded - not allowed",n,this.getExcludePages(),this),!1;dump.log("DynamicContentViewsPage:isMatchPageUrl excluded - allowed",this)}return!0};var EventManager={track:function(e,t){dump.log("EventManager:track",e,t);var n={label:e,object:"event.track"};return t&&(n.params=t),RequestManager.trackProxy(n)},clientCreateOrUpdate:function(e,t){dump.log("EventManager:clientCreateOrUpdate",e,t);var n={label:e,object:"client.data"};t&&(n.params=t),String.prototype.hashCode=function(){var e,t,n=0;if(0===this.length)return n;for(e=0,t=this.length;e<t;e++)n=(n<<5)-n+this.charCodeAt(e),n|=0;return n};var r=JSON.stringify(n).hashCode(),i=localStorage.getItem("snrsClientHashCode");if(dump.log("EventManager:clientCreateOrUpdate: currentHashCode & lcHashCode",r,i),typeof i===undefined||i!=r)return dump.log("EventManager:clientCreateOrUpdate: SEND REQUEST:",n),localStorage.setItem("snrsClientHashCode",r),RequestManager.trackProxy(n)},sendFormData:function(e,t,n,r,i){return SyneriseTC.sendFormData(e,t,n,r,i)},trackCustomEvent:function(i,o,a){return dump.log("EventManager:trackCustomEvent",i,o,a),new Promise(function(n,r){ClientManager.getCurrentClient().then(function(e){if(!e)return r(new Error("Client not exists"));if(!e.uuid)return r(new Error("Client is not identified"));if(!i)return r(new Error("Category and action is required"));o=o||{};var t={uuid:e.uuid};o=_.extend(t,o),RequestManager.track("client.web.browser.page",i,a,o).then(function(e){dump.log("EventManager:trackCustomEvent fetch then",e),n(e)}).catch(function(e){dump.error("EventManager:trackCustomEvent fetch error",e),r(e)})}).catch(function(e){dump.error("Can not get current client",e),r(new Error("Client not exists"))})})},trackClientEvent:function(i,o,a){return dump.log("EventManager:trackClientEvent",i,o,a),new Promise(function(n,r){ClientManager.getCurrentClient().then(function(e){if(!e)return r(new Error("Client not exists"));if(!e.uuid)return r(new Error("Client is not identified"));if(!i||!o)return r(new Error("Category and action is required"));a=a||{};var t={uuid:e.uuid};a=_.extend(t,a),RequestManager.track(i,o,e.uuid,a).then(function(e){dump.log("EventManager:trackClientEvent fetch then",e),n(e)}).catch(function(e){dump.error("EventManager:trackClientEvent fetch error",e),r(e)})}).catch(function(e){dump.error("Can not get current client",e),r(new Error("Client not exists"))})})},trackDynamicContentEventShow:function(e){dump.log("EventManager:trackDynamicContentEventShow",e);var t={id:e.getId(),title:e.getSubject(),variantId:e.getVariantId(),variantName:e.getVariantName(),url:window.location.href,userAgent:navigator.userAgent};e.frequency.isLimited()&&(t.frequencyCounter=DynamicContentManager.getFrequencyValue(e),t.frequencyLimitAchieved=!DynamicContentManager.checkFrequency(e));var n=e.getUtmWithParametersFlatMap();return t=_.extend({},n||{},t),EventManager.trackClientEvent("client.web.browser.page","dynamicContent.show",t)}},FormMarker={_dataMarker:null,_blockReloadInitForm:!1,_isInitObserveMarker:!1,init:function(){try{return new Promise(function(e,t){FormMarker.getDataMarker().then(function(e){dump.log("FormMarker:init  FormMarker.getDataMarker() then",e),FormMarker.marker(e)}).then(function(){FormMarker.bindLiveFormMarker()}).catch(function(e){dump.error(e),t(e)})})}catch(e){dump.error("FormMarker::init",e)}},reloadInitForm:function(){0==FormMarker._blockReloadInitForm&&(FormMarker._blockReloadInitForm=!0,setTimeout(function(){FormMarker._blockReloadInitForm=!1,FormMarker.init()},1e3))},getDataMarker:function(){return new Promise(function(t,n){FormMarker._dataMarker?(dump.log("FormMarker:getFormMarker RequestManager.getFormMarker from cache",FormMarker._dataMarker),t(FormMarker._dataMarker)):Core.getProfileConfigByType(Core.PROFILE_CONFIG_TYPE_DATA_MARKER).then(function(e){return dump.log("FormMarker:getFormMarker RequestManager.getFormMarker then",e),Promise.resolve(e)}).catch(function(e){n(e)}).then(function(e){dump.log("FormMarker:getFormMarker RequestManager.getFormMarker then filtered",e),FormMarker._dataMarker=e,t(FormMarker._dataMarker)}).catch(function(e){n(e)})})},marker:function(t){try{dump.log("FormMarker:marker",t),this.validData(t)&&this.markerForm(t)}catch(e){dump.error("FormMarker:marker",t,e)}},validData:function(e){return!!Array.isArray&&Array.isArray(e)},addAttribute:function(e,t){dump.log("FormMarker:addAttribute",e,t),e.setAttribute("data-synerise",t)},addDataValue:function(e,t){dump.log("FormMarker:addDataValue",e,t),e.setAttribute("data-synerise-value",t)},checkCondition:function(e){return!(e.conditions_include_page&&-1==document.URL.indexOf(e.conditions_include_page)||e.conditions_exclude_page&&-1!==document.URL.indexOf(e.conditions_exclude_page))},markerForm:function(e){var n=this,r=[];e.forEach(function(t){if(t.selector&&n.checkCondition(t)){var e=document.querySelectorAll(t.selector);dump.log("FormMarker:markerForm search selector: ["+t.selector+"] found: "+e.length),e.forEach(function(e){t.attribute&&!e.hasAttribute("data-synerise")&&(n.addAttribute(e,t.attribute),"form"==e.tagName.toLowerCase()&&r.push(e)),""==t.data_value||e.hasAttribute("data-value")||n.addDataValue(e,t.data_value)})}}),n.tcSyneriseForm(r)},bindLiveFormMarker:function(){if(0==FormMarker._isInitObserveMarker)if(dump.log("bindLiveFormMarker init!"),FormMarker._isInitObserveMarker=!0,"MutationObserver"in window){var e=document.querySelector("body");new MutationObserver(function(e){var r=new RegExp("<s*form","i");e.forEach(function(e){for(var t=0;t<e.addedNodes.length;++t){var n=e.addedNodes[t].nodeValue?e.addedNodes[t].nodeValue:e.addedNodes[t].outerHTML;r.test(n)&&(dump.log("bindLiveFormMarker call reloadInitForm:",e.addedNodes[t]),FormMarker.reloadInitForm())}})}).observe(e,{attributes:!1,childList:!0,characterData:!1})}else dump.log("[FormMarker] bindLiveFormMarker MutationObserver is not supported by your browser."),setTimeout(FormMarker.reloadInitForm(),3e3)},tcSyneriseForm:function(e){dump.log("FormMarker:tcSyneriseForm"),e.forEach(function(e){dump.log("FormMarker:initFormCatch element: ",e),SyneriseTC.initFormCatch(e)})}},ToolMarker={init:function(){var n=this;return new Promise(function(e,t){"#_snrs_tool_marker"==window.location.hash&&(CookieStore.set("_snrs_tool_marker",1),n.removeHashFromUrl()),1==CookieStore.get("_snrs_tool_marker")&&n.appendToolMarker()})},appendToolMarker:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://www.snrcdn.net/tracker-marker/2.0/syneriseToolMarker.min.js",document.body.appendChild(e)},removeHashFromUrl:function(){history.pushState("",document.title,window.location.pathname+window.location.search)}},Modal={_initialized:!1,_html:'<div class="snrs-modal-wrapper"><div class="snrs-modal"><div class="snrs-modal-btn-close"></div><div class="snrs-modal-content"></div><div class="popup-backdrop"></div></div></div>',_container:null,_containerModal:null,_contentCtr:null,_closeBtn:null,_modalShowClass:"snrs-modal-show",_hideClass:"snrs-hide",_transparentModalClass:"snrs-transparent-modal",_cancelBtnClass:"snrs-notify--cancel",_closeBtnClass:"snrs-notify--close",_saveBtnClass:"snrs-notify--allow",_callbackStack:{onCancel:function(){},onClose:function(){},onSave:function(){},onShow:function(){},onHide:function(){}},_attachGeneralActions:function(){dump.log("Modal:_attachGeneralActions"),Modal._closeBtn&&Utils.addEvent(Modal._closeBtn,"click",function(e){Modal.close()})},_modalCloseBtnVisibility:function(e){if(dump.log("Modal:_modalCloseBtnVisibility",e),!Modal._closeBtn)return!1;e?Utils.removeClass(Modal._closeBtn,Modal._hideClass):Utils.addClass(Modal._closeBtn,Modal._hideClass)},_triggerCallback:function(e){if(dump.log("Modal:_triggerCallback",e),Modal._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=Modal._callbackStack[e];if(_.isFunction(r))if(!1===r.apply(Modal,t))return!1}},_attachContentActions:function(){dump.log("Modal:_attachContentActions");var e=Modal._contentCtr.getElementsByClassName(Modal._cancelBtnClass);dump.log("Modal:_attachContentActions attach cancel items",e.length,e),0<e.length&&_.each(e,function(e,t){Utils.addEvent(e,"click",function(e){dump.log("Modal:_attachGeneralActions action - on cancel ",e,this),Modal.cancel()})});var t=Modal._contentCtr.getElementsByClassName(Modal._closeBtnClass);dump.log("Modal:_attachContentActions attach close items",t.length,t),0<t.length?(Modal._modalCloseBtnVisibility(!1),_.each(t,function(e,t){Utils.addEvent(e,"click",function(e){dump.log("Modal:_attachGeneralActions action - on close ",e,this),Modal.close()})})):Modal._modalCloseBtnVisibility(!0);var n=Modal._contentCtr.getElementsByClassName(Modal._saveBtnClass);dump.log("Modal:_attachContentActions attach save items",n.length,n),0<n.length&&_.each(n,function(e,t){Utils.addEvent(e,"click",function(e){dump.log("Modal:_attachGeneralActions action - on save ",e,this),Modal.save()})})},onCancel:function(e){Modal._callbackStack.onCancel=e},onClose:function(e){Modal._callbackStack.onClose=e},onSave:function(e){Modal._callbackStack.onSave=e},onShow:function(e){Modal._callbackStack.onShow=e},onHide:function(e){Modal._callbackStack.onHide=e},init:function(){if(dump.log("Modal:init - initialized:",Modal._initialized),!Modal._initialized){var e=document.createElement("div");e.innerHTML=Modal._html,Modal._container=e.childNodes[0],Modal._contentCtr=Modal._container.querySelector(".snrs-modal-content"),Modal._closeBtn=Modal._container.querySelector(".snrs-modal-btn-close"),Modal._containerModal=Modal._container.querySelector(".snrs-modal"),document.body&&(document.body.appendChild(Modal._container),Modal._attachGeneralActions()),Modal._initialized=!0}},setContent:function(e){dump.log("Modal:setContent",!!e),_.replaceChildren(Modal._contentCtr,e),Modal._attachContentActions()},show:function(){var e=Modal.isShown();dump.log("Modal:show - hasShow",!!e),e||(Utils.addClass(Modal._container,Modal._modalShowClass),Modal._triggerCallback("onShow"))},hide:function(){var e=Modal.isShown();dump.log("Modal:hide - hasShow",!!e),e&&(Utils.removeClass(Modal._container,Modal._modalShowClass),Modal._triggerCallback("onHide"))},isShown:function(){return Utils.hasClass(Modal._container,Modal._modalShowClass)},isTransparentModal:function(){return Utils.hasClass(Modal._containerModal,Modal._transparentModalClass)},turnOnTransparentModal:function(){Modal.isTransparentModal()||Utils.addClass(Modal._containerModal,Modal._transparentModalClass)},turnOffTransparentModal:function(){Modal.isTransparentModal()&&Utils.removeClass(Modal._containerModal,Modal._transparentModalClass)},isHidden:function(){return!Modal.isShown()},cancel:function(){Modal.isShown()&&(!1!==Modal._triggerCallback("onCancel")&&Modal.hide())},close:function(){Modal.isShown()&&(!1!==Modal._triggerCallback("onClose")&&Modal.hide())},save:function(){Modal.isShown()&&(!1!==Modal._triggerCallback("onSave")&&Modal.hide())}};function ContentNotification(e){e=e||{},this._container=null,this._contentCtr=null,this._nativeObject=null,this._status=ContentNotification.STATUS_NEW,this.id=e.id||null,this.name=e.name||null,this.content=e.content||null,this.conditions=e.conditions||{},this.conditions.includeType=this.conditions.includeType||ContentNotification.PAGE_URL_MATCH_TYPE_CONTAINS,this.conditions.excludeType=this.conditions.excludeType||ContentNotification.PAGE_URL_MATCH_TYPE_CONTAINS,this.capping=e.capping||{type:"count",expiration:null,count:null},this.additionalParams=e.additionalParams||{},this.type=e.type||"content",this.template=e.template||"default",this.contentSent=e.contentSent||null,this.contentAlreadyExists=e.contentAlreadyExists||null,this.contentProducts=e.contentProducts||null,this.targetSelector=e.targetSelector||null,this.leavePopupNotOpened=!0,this.isNative="native"===this.type}ContentNotification.STATUS_RENDERED="RENDERED",ContentNotification.STATUS_NEW="NEW",ContentNotification.PAGE_URL_MATCH_TYPE_CONTAINS="contains",ContentNotification.PAGE_URL_MATCH_TYPE_EQUALS="equals",ContentNotification.PAGE_URL_MATCH_TYPE_ALLOWED_LIST=[ContentNotification.PAGE_URL_MATCH_TYPE_EQUALS,ContentNotification.PAGE_URL_MATCH_TYPE_CONTAINS],ContentNotification.prototype.getStatus=function(){return this._status},ContentNotification.prototype.isPageUrlAllowed=function(u){function e(e){return-1!==ContentNotification.PAGE_URL_MATCH_TYPE_ALLOWED_LIST.indexOf(e)||(dump.error("ContentNotification:isMatchPageUrl invalid type",e,this),!1)}function t(e,t,n){var r,i,o,a=t.split("|");for(var s in a)if(a.hasOwnProperty(s)){var c=a[s];if(r=u,i=c,(o=n)===ContentNotification.PAGE_URL_MATCH_TYPE_EQUALS?r===i:o===ContentNotification.PAGE_URL_MATCH_TYPE_CONTAINS?-1!==r.indexOf(i):void 0)return!0}return!1}if(dump.log("ContentNotification:isMatchPageUrl",u,this.conditions,this),this.conditions.pageUrl){if(!e(this.conditions.includeType))return!1;if(!(n=t(0,this.conditions.pageUrl,this.conditions.includeType)))return dump.log("ContentNotification:isMatchPageUrl included - not allowed",this.conditions.pageUrl,this.conditions.includeType,n,this),!1;dump.log("ContentNotification:isMatchPageUrl included",n,this)}if(this.conditions.excludePageUrl){if(!e(this.conditions.excludeType))return!1;var n;if(!(n=!t(0,this.conditions.excludePageUrl,this.conditions.excludeType)))return dump.log("ContentNotification:isMatchPageUrl excluded - not allowed",this.conditions.excludePageUrl,this.conditions.excludeType,n,this),!1;dump.log("ContentNotification:isMatchPageUrl excluded",!n,this)}return!0},ContentNotification.prototype.isRendered=function(){return this._status===ContentNotification.STATUS_RENDERED},ContentNotification.prototype.setStatusRendered=function(){return this._status=ContentNotification.STATUS_RENDERED,dump.log("ContentNotification:setStatusRendered",this),this},ContentNotification.prototype.render=function(){var o=this;return new Promise(function(t,n){if(dump.log("ContentNotification:render isNative",o,o.isNative),o.isNative)switch(o.template){case"web_push_agreement":if(WebPushManager.getMode()!==WebPushManager.CONFIG_WEBPUSH_MODE_NATIVE)return n(new Error('Web push service mode ("'+WebPushManager.getMode()+'") does not support auto triggering web push agreement'));var e=WebPushManager.getBrowserPermissionState();if(dump.log("ContentNotification:render check permission",e),e!==WebPushState.BROWSER_PERMISSION_DEFAULT)return n(new Error('Auto triggering native web push agreement is disabled if browser permission is "'+e+'"'));dump.log("ContentNotification:render subscribe",o),WebPushManager.subscribe().then(function(e){return dump.log("ContentNotification:render subscribe then Notification permission",o,e),(void 0===e||e)&&o.setStatusRendered(),t()}).catch(function(e){dump.error("ContentNotification:render subscribe error occurred",e),n(e)});break;default:return n(new Error('Template type ("'+o.template+'") is incorrect for notification, only "web_push_agreement" is allowed for native notification'))}else{var r=document.createElement("div");switch(r.className+=" snrs-notify",r.className+=" snrs-notify-type-"+o.type,r.className+=" snrs-notify-template-"+o.template,r.className+=" snrs-notify-rendered",o.type){case"popup":document.querySelector("snrs-notify-type-popup")?n():(r.innerHTML=_.unescapeHtml(o.content),Modal.setContent(r),o._container=Modal._contentCtr,o._contentCtr=r);break;case"content":var i=o.targetSelector?document.querySelector(o.targetSelector):null;if(dump.log("ContentNotification:render container",i),!i)return n(new Error("Can not found container("+o.targetSelector+") for notification"));r.innerHTML=_.unescapeHtml(o.content),o._container=i,o._contentCtr=r;break;default:return n(new Error('Notification type ("'+o.type+'") is incorrect, only "popup", "content" is allowed'))}if(!o._container)return n(new Error("ContentNotification container is not defined"));o._contentCtr&&_.executeScripts(o._contentCtr),NotificationManager.attachHandlers(o).then(function(e){return dump.log("ContentNotification:render attachHandlers then",o,e),(void 0===e||e)&&("popup"===o.type?Modal.show():"content"===o.type&&_.replaceChildren(o._container,o._contentCtr),o.setStatusRendered()),t()}).catch(function(e){dump.error("ContentNotification:render attachHandlers error occurred",e),n(e)})}})};var NotificationManager={_notifications:null,_stylesUrl:["https://www.snrcdn.net/sdk/3.0/synerise-javascript-sdk.css"],init:function(e){return new Promise(function(t,n){NotificationManager.getNotifications().then(function(e){dump.log("NotificationManager:init  NotificationManager.getNotifications() then",e),t(e)}).catch(function(e){dump.error(e),n(e)})})},getConnectedSocket:function(){return void 0===SocketManager?Promise.reject(new Error("Socket module not defined")):SocketManager.getConnectedSocket()},initSocketNotification:function(){return new Promise(function(t,n){dump.log("NotificationManager:initSocketNotification"),NotificationManager.getConnectedSocket().then(function(e){e.on("dynamicContentMessage",function(t){NotificationManager.renderNotificationForCurrentClient(t).catch(function(e){dump.error("Can not render notification for message",t),dump.error(e)})}),dump.log('NotificationManager:initSocketNotification listening "dynamicContentMessage"',e),t()}).catch(function(e){dump.error(e),n(e)})})},renderNotificationForCurrentClient:function(e){return new Promise(function(n,r){dump.log("NotificationManager:renderNotificationForCurrentClient",e),ClientManager.getCurrentClient().then(function(t){NotificationManager.filterUnsupportedNotifications([new ContentNotification(e)]).then(function(e){e.length&&t.renderNotification(e[0],!0).then(function(e){dump.log("NotificationManager:renderNotificationForCurrentClient rendered",e),n()}).catch(r)}).catch(r)}).catch(r)})},prepareStyles:function(){return SourceManager.loadStyles(NotificationManager._stylesUrl)},attachHandlers:function(s){return new Promise(function(e,t){if(!s._contentCtr)return e(!1);switch(s.template){case"newsletter":if(Core.getOption("notificationNewsletterHandlers")){var n=s._contentCtr.getElementsByTagName("form");_.each(n,function(o){var a=o.onsubmit;o.onsubmit=function(e){dump.log("Notification:render form submit then",o,s),(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var t=this,n=function(e){e&&void 0!==SyneriseTC&&SyneriseTC.sendFormData(e.type,e.fields,e.fieldsMapping),"function"===(typeof a).toLowerCase()&&a.call(t),s.contentSent&&setTimeout(function(){dump.log("Notification:render form submit then saved",o,s),s._contentCtr.innerHTML=_.unescapeHtml(s.contentSent)},1e3),"popup"==s.type&&setTimeout(function(){dump.log("Notification:render form submit - close modal",o,s),Modal.hide()},5e3)};if(void 0!==SyneriseTC){var r=SyneriseTC.getFormData(o);r.type=o.getAttribute("data-synerise");var i=void 0!==r.fieldsMapping.email?r.fields[r.fieldsMapping.email]:undefined;dump.log("Notification:render form submit then - check email exists:",!!s.contentAlreadyExists,i),s.contentAlreadyExists?RequestManager.checkNewsletterSubscription(i).then(function(e){dump.log("RequestManager.checkNewsletterSubscription then",e),0==e?n(r):"subscribed"===e||"waiting_for_confirmation"===e?(s._contentCtr.innerHTML=_.unescapeHtml(s.contentAlreadyExists),"popup"==s.type&&setTimeout(function(){dump.log("Notification:render form submit - close modal",o,s),Modal.hide()},4e3)):(dump.error("Invalid response. Can not check newsletter subscription"),n(r))}).catch(function(e){dump.error("Can not check newsletter subscription",e),n(r)}):n(r)}else dump.error("Synerise tracking codes is not defined."),n();return!1}})}else void 0!==SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr);return e(!0);case"products":return void 0!==SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),s._container.style.display="none",s.contentProducts&&RequestManager.getProductSku(s.contentProducts,Store.getClientUuid()).then(function(e){s._container.style.display="block";var t=s._contentCtr.getElementsByClassName("snrs-products");return 0<t.length?(t[0].innerHTML=e,new ProductSlider({sliderSelector:"ul.snrs-products"}),void 0!==SyneriseTC&&SyneriseTC.initFormCatch(t[0])):(s._contentCtr.innerHTML=e,void 0!==SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr)),Promise.resolve(e)}),e(!0);case"web_push_agreement":if(void 0===WebPushManager)return dump.info("NotificationManager:attachHandlers Web push module not defined",s),e(!1);if(!WebPushManager.checkSubscribeRequestNeed())return dump.log("NotificationManager:attachHandlers Web push agreement is not needed",s),e(!1);WebPushManager.isWebPushAppReady().then(function(){void 0!==SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),WebPushManager.attachHandlers(s._contentCtr),e(!0)}).catch(function(){e(!1)});break;default:return void 0!==SyneriseTC&&SyneriseTC.initFormCatch(s._contentCtr),void 0!==WebPushManager&&WebPushManager.attachHandlers(s._contentCtr),e(!0)}})},getNotifications:function(){return new Promise(function(t,n){NotificationManager._notifications?(dump.log("NotificationManager:getNotifications RequestManager.getNotifications from cache",NotificationManager._notifications),t(NotificationManager._notifications)):Core.getProfileConfigByType(Core.PROFILE_CONFIG_TYPE_NOTIFICATIONS).then(NotificationManager.parseDataToObjects).then(NotificationManager.filterUnsupportedNotifications).then(function(e){dump.log("NotificationManager:getNotifications RequestManager.getNotifications then filtered",e),NotificationManager._notifications=e,NotificationManager.prepareStyles(),t(NotificationManager._notifications)}).catch(function(e){n(e)})})},getNotificationsForClient:function(e){return new Promise(function(t,n){dump.log("NotificationManager:getNotificationsForClient",e),e.getTags().then(function(a){e.getSegments().then(function(e){var o={};o.tags=a,o.segments=e,NotificationManager.getNotifications().then(function(e){dump.log("NotificationManager:getNotificationsForClient NotificationManager.getNotifications() then",e,o);var i=[];_.each(e,function(t){if(t.conditions)if(t.conditions.include){var e=t.conditions.include;switch(e.type){case"segments":e.items&&_.each(e.items,function(e){_.inArray(e,o.segments)&&i.push(t)});break;case"tag":e.items&&_.each(e.items,function(e){_.inArray(e,o.tags)&&i.push(t)});break;case"all":i.push(t)}}else if(t.conditions.exclude){var n=t.conditions.exclude;switch(n.type){case"tag":if(n.items){var r=!0;_.each(n.items,function(e){_.inArray(e,a)&&(r=!1)}),r&&i.push(t)}}}}),t(i)}).catch(n)})})})},parseDataToObjects:function(r){return new Promise(function(e,t){dump.log("NotificationManager:parseToObjects");var n=[];_.isEmpty(r)||_.each(r,function(e,t){n.push(new ContentNotification(e))}),e(n)})},getUnsupportedModules:function(){return new Promise(function(e,t){dump.log("NotificationManager:getUnsupportedModules");var n={};Promise.all([new Promise(function(e,t){if(void 0===WebPushManager)return dump.info("NotificationManager:getUnsupportedModules Web push module not defined"),n.webPush=!0,e();WebPushManager.isWebPushSupported().then(function(){e()}).catch(function(){n.webPush=!0,e()})})]).then(function(){e(n)}).catch(function(e){t(e)})})},filterUnsupportedNotifications:function(n){return new Promise(function(e,t){dump.log("NotificationManager:filterUnsupportedNotifications",n),NotificationManager.getUnsupportedModules().then(function(u){dump.log("NotificationManager:filterUnsupportedNotifications getUnsupportedModules than",n,u);var l=[];if(!_.isEmpty(n)){var d={};_.each(n,function(e){if("web_push_agreement"===e.template){if(u.webPush)return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (unsuported webpush module)",e);if(!WebPushManager.checkSubscribeRequestNeed())return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (Web push agreement is not needed)",e)}if(e.conditions){if(!e.isPageUrlAllowed(location.href))return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current page url)",e);if(e.conditions.deviceType&&!DeviceManager.checkDeviceType(e.conditions.deviceType))return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (wrong current device type)",e);if(e.conditions.timeFrom||e.conditions.timeTo){dump.log("NotificationManager:filterUnsupportedNotifications filter for time showing",e.conditions.timeFrom,e.conditions.timeTo,e);var t,n,r=e.conditions.timeFrom,i=e.conditions.timeTo,o=new Date,a=function(e){return e.toISOString().replace(/t/i," ").replace(/\.\d+./,"")};if(null==r){var s=new Date;s.setDate(o.getDate()-7),r=a(s)}if(null==i){var c=new Date;c.setDate(o.getDate()+7),i=a(c)}if(t=r.length<19?Utils.prepareTimeForDate(r||"00:00:00",o):new Date(r),(n=i.length<19?Utils.prepareTimeForDate(i||"23:59:59",o):new Date(i)).setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),t.setTime(t.getTime()-60*t.getTimezoneOffset()*1e3),"Invalid Date"===t.toString()||"Invalid Date"===n.toString())return void dump.error("NotificationManager:filterUnsupportedNotifications filtered (invalid showing time)",t,n,e);if(o<t||n<o)return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (wrong showing time)",o,t,n)}}if("content"===e.type){if(!e.targetSelector)return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (empty target selector)",e);if(d[e.targetSelector])return void dump.log("NotificationManager:filterUnsupportedNotifications filtered (with same target selector)",e);d[e.targetSelector]=!0}l.push(e)})}return e(l)}).catch(function(e){t(e)})})},leavePopupOpenEventHandler:function(e,t,n){t.leavePopupNotOpened&&n.clientY<=0&&(n.preventDefault(),e.renderNotification(t,!0),t.leavePopupNotOpened=!1)},attachHandlerForLeavePopup:function(e,t){document.addEventListener("mouseout",NotificationManager.leavePopupOpenEventHandler.bind(this,e,t))},turnOffPopupTransparentBackground:function(){Modal.turnOffTransparentModal()},turnOnPopupTransparentBackground:function(){Modal.turnOnTransparentModal()}},ProductSlider=function(e){for(var t in this.properties={sliderSelector:"ul.snrs-products",slidesTagName:"LI",displayedItemCount:5,slideIntervalMiliseconds:3e3,isResponsive:!0,navigateLeftSelector:".snrs-left-arrow",navigateRightSelector:".snrs-right-arrow",breakingPoints:{small:650,medium:1280}},e)e.hasOwnProperty(t)&&(this.properties[t]=e[t]);this.slider=document.querySelector(this.properties.sliderSelector),null!==this.slider&&(this.slidesCollection=this.slider.getElementsByTagName(this.properties.slidesTagName),this.slideCount=this.slidesCollection.length,this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount),this.position=0,this.init())};ProductSlider.prototype.init=function(){this.setResponsivity(),this.slider.style.width=this.sliderPercentWidth+"%",this.createNavigation(),this.setSlidesWidth(),this.setInterval=setInterval(this.slideRTL.bind(this),this.properties.slideIntervalMiliseconds),this.attachSlideEvents()},ProductSlider.prototype.setResponsivity=function(){var e=window.innerWidth;e>this.properties.breakingPoints.small&&e<this.properties.breakingPoints.medium?this.properties.displayedItemCount=3:e<this.properties.breakingPoints.small&&(this.properties.displayedItemCount=1),this.roundedSlideCount=Math.ceil(this.slideCount/this.properties.displayedItemCount)*this.properties.displayedItemCount,this.sliderPercentWidth=100*Math.ceil(this.roundedSlideCount/this.properties.displayedItemCount)},ProductSlider.prototype.setSlidesWidth=function(){for(var e=1/this.roundedSlideCount*100+"%",t=0,n=this.slidesCollection.length;t<n;t+=1)this.slidesCollection[t].style.width=e},ProductSlider.prototype.getSlideDistance=function(){return 100*this.position/Math.ceil(this.slideCount/this.properties.displayedItemCount)},ProductSlider.prototype.slideRTL=function(){this.position=++this.position<Math.ceil(this.slideCount/this.properties.displayedItemCount)?this.position:0,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},ProductSlider.prototype.slideLTR=function(){this.position=0<=--this.position?this.position:Math.ceil(this.slideCount/this.properties.displayedItemCount)-1,this.slider.style.transform="translateX(-"+this.getSlideDistance()+"%)"},ProductSlider.prototype.createNavigation=function(){var e=document.createElement("DIV"),t=document.createElement("DIV");e.className="snrs-arrow snrs-left-arrow",t.className="snrs-arrow snrs-right-arrow",document.querySelector(".snrs-products-slider").appendChild(e),document.querySelector(".snrs-products-slider").appendChild(t)},ProductSlider.prototype.attachSlideEvents=function(){var e=this;document.querySelector(this.properties.navigateLeftSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideLTR(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)}),document.querySelector(this.properties.navigateRightSelector).addEventListener("click",function(){clearInterval(e.setInterval),e.slideRTL(),e.setInterval=setInterval(e.slideRTL.bind(e),e.properties.slideIntervalMiliseconds)})},ProductSlider.prototype.off=function(){for(var e=0,t=this.properties.slidesCollection.length;e<t;e+=1)this.properties.slidesCollection[e].style.width="";clearInterval(this.setInterval),this.properties.slider.style.width="",this.properties.slider.style.transform="",document.querySelector(this.properties.navigateRight).remove(),document.querySelector(this.properties.navigateLeft).remove()};var RequestManager={trackUrl:"https://tck.snrbox.com/tracker",trackIGifUrl:"https://tck.snrbox.com/_i.gif",trackSdkProxyUrl:"https://tck.snrbox.com/sdk-proxy",rtomUrl:"https://api.snrbox.com/rtom",rtomProxyUrl:"https://proxy.snrbox.com/rtom",dynamicContentUrl:"https://dc.snrbox.com/v3",productsRenderBySkuUrl:location.protocol+"//"+location.hostname+"/dynamicblock/products",utils:{processStatus:function(e){return dump.log("RequestManager:utils:processStatus",e),200===e.status||201===e.status||0===e.status?Promise.resolve(e):Promise.reject(new Error(e.statusText))},getDataKey:function(e){return void 0!==e.data?Promise.resolve(e.data):Promise.reject(new Error("Can no get data from response"))},getDataFromKeyName:function(e,t){return void 0!==e[t]?Promise.resolve(e[t]):Promise.reject(new Error("Can no get data from response"))},parseJson:function(e){return e.json()},fetchWithTimeout:function(e,t){void 0!==t&&null!=t||(t=4e3);var n=new AbortController,r=n.signal,i=setTimeout(function(){n.abort()},t);return fetch(e,{signal:r}).then(function(e){return clearTimeout(i),i=undefined,Promise.resolve(e)}).then(RequestManager.utils.processStatus).catch(function(e){return clearTimeout(i),i=undefined,"AbortError"===e.name?Promise.reject(new Error("Request Timeout")):Promise.reject(e)})},fetchWithTimeoutAndLog:function(e,t){return ErrorHandler.handleFetch(e,RequestManager.utils.fetchWithTimeout(e,t))},trackEventWithCheckPossibility:function(e){return DeviceManager.isCrawler()?new Error("Can not track event - crawler detected"):RequestManager.utils.fetchWithTimeoutAndLog(e,4e3)}},getProductSku:function(o,e){dump.log("RequestManager:getProductSku");var t={"no-buy":"stats/transaction/no-buy-products","last-view":"products/last-view","top-vew":"products/top-vew",recommend:"products/recommend",similar:"products/recommend"},i=null;void 0!==t[o]&&(i=t[o]);var a="";if("similar"==o){sku="";try{sku=document.head.querySelector('meta[property="product:retailer_part_no"]').content}catch(e){}a="sku="+sku}else a="clientUUID="+encodeURIComponent(e);return"function"==typeof srRenderProducts&&(a+="&onlySku=1"),new Promise(function(n,t){var e={"Content-Type":"application/json"};e[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var r=new Request(RequestManager.rtomProxyUrl+"/"+i+"?"+a,{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(e)});RequestManager.utils.fetchWithTimeoutAndLog(r).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){if(dump.log("RequestManager:getProductSku fetch then",e),_.isEmpty(e)||_.isEmpty(e.items))throw new TypeError("Empty list product to render");var i="";if("function"==typeof srRenderProducts){var t=[];e.items.forEach(function(e){t.push(e.sku)}),srRenderProducts(t,o,function(e){n(e)})}else e.items.forEach(function(e){var t=e.category!==undefined?'<p class="snrs-product-category">'+e.category+"</p>":"",n=e.sku!==undefined?'<p class="snrs-product-sku">'+e.sku+"</p>":"",r=e.name!==undefined?'<p class="snrs-product-title">'+e.name+"</p>":"";i+=i='<li class="snrs-product" ><a  class="snrs-product-href" href="'+e.url+"?snr_medium=synerise_products&snr_source=synerise&snr_campaign="+o+'" ><img  class="snrs-product-image" alt="'+e.name+'" src="'+e.image+'"/></a>'+t+n+r+"</li>"}),n('<div class="snrs-products-slider"><ul class="snrs-products">'+i+"</ul></div>")}).catch(function(e){dump.error("RequestManager:getProductSku fetch error",e),t(e)})})},checkNewsletterSubscription:function(r){dump.log("RequestManager:checkNewsletterSubscription");var i={"Content-Type":"application/json"};return i[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value"),new Promise(function(t,n){var e=new Request(RequestManager.rtomUrl+"/newsletter/check-subscription?email="+encodeURIComponent(r),{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(i)});RequestManager.utils.fetchWithTimeoutAndLog(e).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){return void 0!==e.status?Promise.resolve(e.status):Promise.reject(new Error("Can no get status from response"))}).then(function(e){dump.log("RequestManager:checkNewsletterSubscription fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:checkNewsletterSubscription fetch error",e),n(e)})})},getNotifications:function(){return dump.log("RequestManager:getNotifications"),new Promise(function(t,n){var e={"Content-Type":"application/json"};e[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var r=new Request(RequestManager.rtomProxyUrl+"/clients/notificationTemplates",{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(e)});RequestManager.utils.fetchWithTimeoutAndLog(r).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(RequestManager.utils.getDataKey).then(function(e){dump.log("RequestManager:getNotifications fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getNotifications fetch error",e),n(e)})})},getDynamicContentsFiltered:function(a){return dump.log("RequestManager:getDynamicContentsFiltered"),new Promise(function(t,n){var e=Core.getOption("acceptLangList")?Core.getOption("acceptLangList").join(","):undefined,r=RequestManager.dynamicContentUrl+"/dynamicContent/filtered?uuid="+encodeURIComponent(a.uuid)+"&code="+Auth.trackerKey();e&&(r+="&acceptLanguage="+encodeURIComponent(e));DynamicContentManager.getVariables();var i=DynamicContentManager.getVariants(),o=new Request(r,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers({"Content-Type":"text/plain"}),body:JSON.stringify({variantFilters:i})});dump.log("RequestManager:getDynamicContentsFiltered fetch",r),RequestManager.utils.fetchWithTimeoutAndLog(o).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){dump.log("RequestManager:getDynamicContentsFiltered fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getDynamicContentsFiltered fetch error",e),n(e)})})},getDynamicContentByUuids:function(s,c){return dump.log("RequestManager:getDynamicContentByUuids"),new Promise(function(t,n){var e=Core.getOption("acceptLangList")?Core.getOption("acceptLangList").join(","):undefined,r=RequestManager.dynamicContentUrl+"/dynamicContent/byUuids?uuid="+encodeURIComponent(s.uuid)+"&code="+Auth.trackerKey();e&&(r+="&acceptLanguage="+encodeURIComponent(e));var i=DynamicContentManager.getVariables(),o={};_.each(c,function(e){o[e.getId()]=e.getVariantId()||0});var a=new Request(r,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers({"Content-Type":"text/plain"}),body:JSON.stringify({variantFilters:o,variables:i,referer:location.href})});dump.log("RequestManager:getDynamicContentByUuids fetch",r),RequestManager.utils.fetchWithTimeoutAndLog(a).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){dump.log("RequestManager:getDynamicContentByUuids fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getDynamicContentByUuids fetch error",e),n(e)})})},getProfileConfig:function(){return dump.log("RequestManager:getProfileConfig"),new Promise(function(t,n){var e={"Content-Type":"application/json"};e[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var r=new Request(RequestManager.rtomProxyUrl+"/configs/getPublicConfigForContext",{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(e)});RequestManager.utils.fetchWithTimeoutAndLog(r).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){dump.log("RequestManager:getProfileConfig fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getProfileConfig fetch error",e),n(e)})})},getWebPushProfileConfig:function(o){return dump.log("RequestManager:getWebPushProfileConfig"),new Promise(function(t,n){var e={"Content-Type":"application/json"};e[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var r=RequestManager.rtomProxyUrl+"/web-push/get-public-config";o&&(r+="?acceptLanguage="+encodeURIComponent(o));var i=new Request(r,{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(e)});RequestManager.utils.fetchWithTimeoutAndLog(i).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){dump.log("RequestManager:getWebPushProfileConfig fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getWebPushProfileConfig fetch error",e),n(e)})})},getClientTags:function(r){dump.log("RequestManager:getClientTags",r);var i={"Content-Type":"application/json"};return i[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value"),new Promise(function(t,n){var e=new Request(RequestManager.rtomProxyUrl+"/clients/tagsHash?uuid="+encodeURIComponent(r.uuid),{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(i)});RequestManager.utils.fetchWithTimeoutAndLog(e).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(RequestManager.utils.getDataKey).then(function(e){dump.log("RequestManager:getClientTags fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:getClientTags fetch error",e),n(e)})})},getClientData:function(e){dump.log("RequestManager:getClientData",e);return{"Content-Type":"application/json"}[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value"),new Promise(function(e,t){e({segments:[],tags:[]})})},track:function(a,s,c,u){return dump.log("RequestManager:track",a,s,c,u),new Promise(function(t,n){var e=ClientManager.getClientFromStore();if(e){c=c||"",u=u||{};var r={uuid:e.uuid};u=_.extend(r,u);var i={category:a,action:s,label:c,params:JSON.stringify(u),uuid:e.uuid,tracker:Auth.getHeaderAuth("value"),hash:Math.random().toString(36).substring(2,8)},o=new Request(RequestManager.trackIGifUrl+"?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i),{method:"GET",mode:"cors",redirect:"follow"});RequestManager.utils.trackEventWithCheckPossibility(o).then(function(e){dump.log("RequestManager:track fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:track fetch error",e),n(e)})}else n(new Error("Can not track event if client not exists"))})},trackProxy:function(o){return dump.log("RequestManager:trackProxy",o),new Promise(function(t,n){var e=ClientManager.getClientFromStore();if(!e)return n(new Error("Can not track event if client not exists"));if(!(o=_.extend({uuid:e.uuid},o)).label)return n(new Error("Can not track unknown event"));if(!o.object)return n(new Error('Can not track event - "object" is required'));var r=RequestManager.trackSdkProxyUrl+"?code="+Auth.trackerKey(),i=new Request(r,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers({"Content-Type":"text/plain"}),body:JSON.stringify(o)});RequestManager.utils.trackEventWithCheckPossibility(i).then(function(e){dump.log("RequestManager:trackProxy fetch then",e),t(e)}).catch(function(e){dump.error("RequestManager:trackProxy fetch error",e),n(e)})})},subscribeWebPushForClient:function(){return dump.log("RequestManager:subscribeWebPushForClient"),new Promise(function(r,i){ClientManager.getCurrentClient().then(function(e){if(!e)return i(new Error("Can not subscribe if client not exists"));if(!e.uuid)return i(new Error("Client is not identified"));var t={"Content-Type":"application/json"};t[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var n=new Request(RequestManager.rtomUrl+"/web-push/subscribe",{method:"POST",mode:"cors",redirect:"follow",headers:new Headers(t),body:JSON.stringify({uuid:e.uuid,url:location.href})});RequestManager.utils.fetchWithTimeoutAndLog(n).then(RequestManager.utils.processStatus).then(function(e){dump.log("RequestManager:subscribeWebPushForClient fetch then",e),r(e)}).catch(function(e){dump.error("RequestManager:subscribeWebPushForClient fetch error",e),i(e)})}).catch(function(){i(new Error("Client is not exists"))})})},unsubscribeWebPushForClient:function(){return dump.log("RequestManager:unsubscribeWebPushForClient"),new Promise(function(r,i){ClientManager.getCurrentClient().then(function(e){if(!e)return i(new Error("Can not unsubscribe if client not exists"));if(!e.uuid)return i(new Error("Client is not identified"));var t={"Content-Type":"application/json"};t[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var n=new Request(RequestManager.rtomUrl+"/web-push/unsubscribe",{method:"POST",mode:"cors",redirect:"follow",headers:new Headers(t),body:JSON.stringify({uuid:e.uuid,url:location.href})});RequestManager.utils.fetchWithTimeoutAndLog(n).then(RequestManager.utils.processStatus).then(function(e){dump.log("RequestManager:unsubscribeWebPushForClient fetch then",e),r(e)}).catch(function(e){dump.error("RequestManager:unsubscribeWebPushForClient fetch error",e),i(e)})}).catch(function(){i(new Error("Client is not exists"))})})},addBrowserPermissionWebPushForClient:function(o,a){return dump.log("RequestManager:addBrowserPermissionWebPushForClient",o),new Promise(function(r,i){ClientManager.getCurrentClient().then(function(e){if(!e)return i(new Error("Can not subscribe if client not exists"));if(!e.uuid)return i(new Error("Client is not identified"));if(!o)return i(new Error("Token is required"));var t={"Content-Type":"application/json"};t[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var n=new Request(RequestManager.rtomUrl+"/web-push/add-browser-permission",{method:"POST",mode:"cors",redirect:"follow",headers:new Headers(t),body:JSON.stringify({uuid:e.uuid,token:o,domain:a,url:location.href})});RequestManager.utils.fetchWithTimeoutAndLog(n).then(RequestManager.utils.processStatus).then(function(e){dump.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),r(e)}).catch(function(e){dump.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),i(e)})}).catch(function(){i(new Error("Client is not exists"))})})},checkWebPushSubscriptionForClient:function(o){return dump.log("RequestManager:checkWebPushSubscriptionForClient"),new Promise(function(r,i){ClientManager.getCurrentClient().then(function(e){if(!e)return i(new Error("Can not subscribe if client not exists"));if(!e.uuid)return i(new Error("Client is not identified"));var t={"Content-Type":"application/json"};t[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var n=new Request(RequestManager.rtomUrl+"/web-push/check-subscription?uuid="+encodeURIComponent(e.uuid)+"&domain="+encodeURIComponent(o||""),{method:"GET",mode:"cors",redirect:"follow",headers:new Headers(t)});RequestManager.utils.fetchWithTimeoutAndLog(n).then(RequestManager.utils.processStatus).then(RequestManager.utils.parseJson).then(function(e){return RequestManager.utils.getDataFromKeyName(e,"subscription")}).then(function(e){dump.log("RequestManager:addBrowserPermissionWebPushForClient fetch then",e),r(e)}).catch(function(e){dump.error("RequestManager:addBrowserPermissionWebPushForClient fetch error",e),i(e)})}).catch(function(e){dump.error("RequestManager:checkWebPushSubscriptionForClient error occurred",e),i(new Error("Client is not exists"))})})},incrementDynamicContentViews:function(a){return dump.log("RequestManager:incrementDynamicContentViews",a),new Promise(function(i,o){ClientManager.getCurrentClient().then(function(e){var t={"Content-Type":"application/json"};t[Auth.getHeaderAuth("key")]=Auth.getHeaderAuth("value");var n=RequestManager.dynamicContentUrl+"/dynamicContent/incrementView",r=new Request(n,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers(t),body:JSON.stringify({uuid:e.uuid,campaignId:a.getId()})});RequestManager.utils.fetchWithTimeoutAndLog(r).then(RequestManager.utils.processStatus).then(function(e){dump.log("RequestManager:incrementDynamicContentViews fetch then",e),i(e)}).catch(function(e){dump.error("RequestManager:incrementDynamicContentViews fetch error",e),o(e)})}).catch(function(e){dump.error("RequestManager:incrementDynamicContentViews error",e),o(new Error("Client not exists"))})})}},SourceManager={_sourcesMap:{},loadStyles:function(n){return new Promise(function(e,t){if(!(n=SourceManager.deduplicateSources(n)).length)return e();Utils.addStyles(n).then(function(){e()}).catch(function(e){dump.error(e),t(e)})})},deduplicateSources:function(e){if(!e)return[];var t=[];return _.each(e,function(e){SourceManager._sourcesMap[e]||(t.push(e),SourceManager._sourcesMap[e]=!0)}),t}},CookieStore={set:function(e,t,n,r,i){_.isObject(t)&&(t=Store.prepareObjectToString(t));var o=new Date,a=0;a=void 0!==n?1e3*n:62208e6,o.setTime(o.getTime()+a),CookieStore.setForDateExpires(e,t,o,r,i)},setForDateExpires:function(e,t,n,r,i){_.isObject(t)&&(t=Store.prepareObjectToString(t)),n||(n=new Date).setTime(n.getTime()+62208e6);var o={path:i||"/"};o.expires=n,void 0!==r&&(o.domain=r),_.cookie.set(e,t,o)},get:function(e){var t=_.cookie.get(e);return dump.log("CookieStore:get",e,t),/:/.test(t)&&(t=Store.prepareStringToObject(t)),dump.log("CookieStore:get return",t),t},getJson:function(e){var t=_.cookie.get(e);dump.log("CookieStore:getJson",e,t);try{return t?JSON.parse(t):{}}catch(e){dump.error("CookieStore:getJson ERROR: parse json",t)}return null},remove:function(e){_.cookie.remove(e)}},DynamicContentStore={FREQUENCY_PREFIX:"_snrs_dc_frq_",STOP_DISPLAY_PREFIX:"_snrs_dc_sd_",VIEWS_FOR_STOP_DISPLAY_PREFIX:"_snrs_dc_views_sd_",DELAY_PREFIX:"_snrs_dc_delay_",CAMPAIGNS:"_snrs_dc_campaigns",EXPIRE:"_snrs_dc_expire",TESTS:"_snrs_dc_tests",getKeyList:function(){return[DynamicContentStore.FREQUENCY_PREFIX,DynamicContentStore.STOP_DISPLAY_PREFIX,DynamicContentStore.VIEWS_FOR_STOP_DISPLAY_PREFIX,DynamicContentStore.DELAY_PREFIX,DynamicContentStore.CAMPAIGNS,DynamicContentStore.EXPIRE,DynamicContentStore.TESTS]},clearExpiredKeysFromStore:function(){if(dump.log("DynamicContentStore:clearExpiredKeysFromStore"),!LocalStore.isAvailable())return!0;var e=DynamicContentStore.getKeyList();return _.each(e,function(e){LocalStore.clearExpiredKeysFromContainer(e)}),!0},incrementFrequency:function(e){var t=e.frequency.getExpiration();null===t&&(t=DynamicContentFrequency.EXPIRATION_MAX_VALUE);var n=DynamicContentStore.getFrequencyWithCheckExpiration(e);n||(n={value:0,expires:new Date((new Date).getTime()+1e3*t).getTime()});if(n.value++,LocalStore.isAvailable())LocalStore.setToContainer(DynamicContentStore.FREQUENCY_PREFIX,e.id,n);else{var r=DynamicContentStore.FREQUENCY_PREFIX+e.id;CookieStore.setForDateExpires(r,n,new Date(n.expires))}return n},renewFrequencyExpiration:function(e){var t=e.frequency.getExpiration(),n=DynamicContentStore.getFrequencyWithCheckExpiration(e);if(dump.log("Store:renewFrequencyExpiration",n,e),n){var r=new Date((new Date).getTime()+1e3*t);if(n.expires=r.getTime(),dump.log("Store:renewFrequencyExpiration set",n,t,r,e),LocalStore.isAvailable())LocalStore.setToContainer(DynamicContentStore.FREQUENCY_PREFIX,e.id,n);else{var i=DynamicContentStore.FREQUENCY_PREFIX+e.id;CookieStore.setForDateExpires(i,n,new Date(n.expires))}}return n},getFrequency:function(e){var t;return(t=LocalStore.isAvailable()?LocalStore.getFromContainer(DynamicContentStore.FREQUENCY_PREFIX,e.id):CookieStore.get(DynamicContentStore.FREQUENCY_PREFIX+e.id))?(t.value=parseInt(t.value,10),t.expires=parseInt(t.expires,10),isNaN(t.value)||isNaN(t.expires)?null:t):null},getFrequencyWithCheckExpiration:function(e){var t=DynamicContentStore.getFrequency(e);return DynamicContentStore.checkExpirationFrequencyForData(e,t)},checkExpirationFrequencyForData:function(e,t){if(t){var n=new Date;if(t.expires<n.getTime())return DynamicContentStore.removeFrequency(e),null}return t},removeFrequency:function(e){LocalStore.isAvailable()?LocalStore.removeFromContainer(DynamicContentStore.FREQUENCY_PREFIX,e.id):CookieStore.remove(DynamicContentStore.FREQUENCY_PREFIX+e.id)},stopDisplay:function(e){var t=DynamicContentStopDisplay.STOP_DISPLAY_EXPIRATION_MAX_VALUE;CookieStore.set(DynamicContentStore.STOP_DISPLAY_PREFIX+e.id,1,t)},checkStopDisplay:function(e){return dump.log("Store:checkStopDisplay value",CookieStore.get(DynamicContentStore.STOP_DISPLAY_PREFIX+e.id)),!!CookieStore.get(DynamicContentStore.STOP_DISPLAY_PREFIX+e.id)},incrementViewsForStopDisplay:function(e){var t=DynamicContentStopDisplay.STOP_DISPLAY_EXPIRATION_MAX_VALUE,n=DynamicContentStore.getViewsForStopDisplay(e),r=++n;return CookieStore.set(DynamicContentStore.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id,r,t),r},getViewsForStopDisplay:function(e){return CookieStore.get(DynamicContentStore.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id)||0},removeViewsForStopDisplay:function(e){return CookieStore.remove(DynamicContentStore.VIEWS_FOR_STOP_DISPLAY_PREFIX+e.id)},setTimeForDelay:function(e,t){t=t||new Date;var n=DynamicContentTrigger.TRIGGER_DELAY_EXPIRATION_VALUE,r=e.trigger.getDelayInSeconds(),i=new Date(t.getTime()+1e3*r);return CookieStore.set(DynamicContentStore.DELAY_PREFIX+e.id,i.getTime(),n),i},renewTimeForDelay:function(e){var t=DynamicContentTrigger.TRIGGER_DELAY_EXPIRATION_VALUE,n=DynamicContentStore.getTimeForDelay(e);return null!==n&&CookieStore.set(DynamicContentStore.DELAY_PREFIX+e.id,n.getTime(),t),n},getTimeForDelay:function(e){var t=CookieStore.get(DynamicContentStore.DELAY_PREFIX+e.id),n=parseInt(t,10);return isNaN(n)?null:new Date(n)},removeTimeForDelay:function(e){return CookieStore.remove(DynamicContentStore.DELAY_PREFIX+e.id)},getDynamicContentsCached:function(){var e=LocalStore.getJson(DynamicContentStore.CAMPAIGNS),t=LocalStore.getString(DynamicContentStore.EXPIRE);return!LocalStore.isAvailable()||!Object.keys(e).length||!t||18e4<Date.now()-parseInt(t)?null:e},setDynamicContentsCache:function(e){LocalStore.isAvailable()?(LocalStore.setJson(DynamicContentStore.CAMPAIGNS,e),LocalStore.setString(DynamicContentStore.EXPIRE,Date.now()),DynamicContentStore.setDynamicContentsVariants()):dump.error("DynamicContentStore:setDynamicContentsCache error")},setDynamicContentsVariants:function(){if(LocalStore.isAvailable()){LocalStore.removeContainer(DynamicContentStore.TESTS);var e=LocalStore.getJson(DynamicContentStore.CAMPAIGNS);_.each(e,function(e){var t=e.id,n=e.variants[0];n&&n.id&&e.isABX&&LocalStore.setToContainer(DynamicContentStore.TESTS,t,n.id)})}else dump.error("DynamicContentStore:setDynamicContentVariant error")},getDynamicContentVariant:function(e){var t=null;return LocalStore.isAvailable()?t=LocalStore.getFromContainer(DynamicContentStore.TESTS,e):dump.error("DynamicContentStore:getDynamicContentVariant error"),t},getDynamicContentsVariants:function(){var e=null;return LocalStore.isAvailable()?e=LocalStore.getJson(DynamicContentStore.TESTS):dump.error("DynamicContentStore:getDynamicContentVariant error"),e}},LocalStore={_is_available:null,setJson:function(e,t){if(!LocalStore.isAvailable())return!1;var n=Store.prepareObjectToJsonString(t);return dump.log("LocalStore:set",e,n),localStorage[e]=n,!0},getJson:function(e){if(!LocalStore.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:undefined,n=Store.prepareJsonStringToObject(t);return dump.log("LocalStore:get",e,n),n},saveContainer:function(e,t){return!!LocalStore.isAvailable()&&(Object.keys(t).length?LocalStore.setJson(e,t):LocalStore.removeContainer(e),!0)},getContainer:function(e,t){return!!LocalStore.isAvailable()&&(LocalStore.getJson(e)||{})},removeContainer:function(e){return!!LocalStore.isAvailable()&&(LocalStore.remove(e),!0)},getFromContainer:function(e,t){if(!LocalStore.isAvailable())return!1;var n=LocalStore.getContainer(e);return n[t]!==undefined?n[t]:null},setToContainer:function(e,t,n){if(!LocalStore.isAvailable())return!1;var r=LocalStore.getContainer(e);return(r=r||{})[t]=n,LocalStore.saveContainer(e,r),!0},removeFromContainer:function(e,t){if(!LocalStore.isAvailable())return!1;var n=LocalStore.getContainer(e);return delete n[t],LocalStore.saveContainer(e,n),!0},clearExpiredKeysFromContainer:function(i,o,a){if(!LocalStore.isAvailable())return!1;o=o||new Date,a=a||"expires";var e=LocalStore.getContainer(i),s={},c=!1;return _.each(e,function(e,t){var n=parseInt(e[a],10);if(isNaN(n))s[t]=e;else{var r=new Date(n);r<o.getTime()?(dump.log("LocalStore:clearExpiredKeysFromContainer key expired",t,r,i,e),c=!0):s[t]=e}}),c&&LocalStore.saveContainer(i,e),!0},set:function(e,t){return!!LocalStore.isAvailable()&&(_.isObject(t)&&(t=Store.prepareObjectToString(t)),dump.log("LocalStore:set",e,t),localStorage[e]=t,!0)},get:function(e){if(!LocalStore.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:undefined;return dump.log("LocalStore:get",e,t),t!==undefined&&/:/.test(t)&&(t=Store.prepareStringToObject(t)),dump.log("LocalStore:get return",t),t},setString:function(e,t){return!!LocalStore.isAvailable()&&(dump.log("LocalStore:setString",e,t),localStorage[e]=t,!0)},getString:function(e){if(!LocalStore.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:undefined;return dump.log("LocalStore:getString",e,t),t},remove:function(e){return!!LocalStore.isAvailable()&&(dump.log("LocalStore:remove",e),void 0!==localStorage[e]&&delete localStorage[e],!0)},isAvailable:function(e){if(null!==LocalStore._is_available)return LocalStore._is_available;if("undefined"!=typeof Storage&&"undefined"!=typeof localStorage)try{localStorage.setItem("lsCheck",1),localStorage.removeItem("lsCheck"),LocalStore._is_available=!0}catch(e){dump.log("[LocalStore]:isAvailable Local storage isn't available"),LocalStore._is_available=!1}else dump.log("[LocalStore]:isAvailable Local storage isn't available"),LocalStore._is_available=!1;return LocalStore._is_available}},Store={prepareObjectToJsonString:function(e){return JSON.stringify(e)},prepareJsonStringToObject:function(t){var e={};if("string"===(typeof t).toLowerCase())try{e=JSON.parse(t)}catch(e){dump.error("Store:parseJson - Wrong JSON format",t)}return e},prepareObjectToString:function(e){var n="";return _.isObject(e)&&(_.each(e,function(e,t){""!==e&&(n+=t+":"+e+"&")}),n=n.substring(0,n.length-1)),n},prepareStringToObject:function(e){var n={};if(_.isString(e)){var t=e.split("&");_.each(t,function(e){var t=e.split(":");1<t.length&&(n[t[0]]=t[1])})}return n},getClientUuid:function(){dump.log("Store:getClientUuid");var e=CookieStore.get("_snrs_p"),t=null;return void 0!==e&&void 0!==e.uuid&&"null"!==e.uuid&&(t=e.uuid),dump.log("Store:getClientUuid value:",t),t},getClientPermUuid:function(){dump.log("Store:getClientPermUuid");var e=CookieStore.get("_snrs_puuid"),t=null;return null!=e&&"null"!==e&&(t=e),dump.log("Store:getClientPermUuid value:",t),t},setNotificationCapping:function(e){if(dump.log("Store:setNotificationCapping",e),e.capping&&_.isObject(e.capping)&&e.id){var t=e.capping;switch(t.type){case"count":if(t.count&&0<t.count)if(t.expiration){r=(r=CookieStore.get("_snrs_notify_capping_"+e.id))||0,CookieStore.set("_snrs_notify_capping_"+e.id,++r,t.expiration),dump.log("Store:setNotificationCapping done",r,"with expiration",t.expiration)}else{var n=CookieStore.get("_snrs_notify_capping");n&&_.isObject(n)||(n={});var r=n[e.id]||0;n[e.id]=++r,CookieStore.set("_snrs_notify_capping",n),dump.log("Store:setNotificationCapping done",r)}}}},getNotificationCapping:function(e){if(dump.log("Store:getNotificationCapping",e),e.id){var t=0;if(e.capping&&e.capping.expiration)t=(t=CookieStore.get("_snrs_notify_capping_"+e.id))||0;else{var n=CookieStore.get("_snrs_notify_capping");n&&_.isObject(n)&&n[e.id]&&(t=n[e.id])}return dump.log("Store:getNotificationCapping value",t),t}}},WebPushApp={PERMISSION_AGREED:"agreed",PERMISSION_BLOCKED:"blocked",PERMISSION_DEFAULT:"default",_provider:null,init:function(){return dump.log("WebPushApp:init"),Utils.uniquePromiseHandler("WebPushApp.init",function(e,t){if(dump.log("WebPushApp:init",WebPushManager._config.mode),WebPushManager._config.mode===WebPushManager.CONFIG_WEBPUSH_MODE_NATIVE)WebPushApp._provider=WebPushNativeApp;else{if(WebPushManager._config.mode!==WebPushManager.CONFIG_WEBPUSH_MODE_EXTERNAL)return t(new Error("Unable to init web push app"));WebPushApp._provider=WebPushExternalApp}WebPushApp.initProvider().then(function(){dump.log("WebPushApp:init done"),e()}).catch(function(e){dump.error("WebPushApp:init error",e),t(e)})})},parseFirebaseErrorCode:function(e){switch(e){case"messaging/permission-blocked":case"messaging/notifications-blocked":return WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED;case"messaging/permission-default":case"messaging/notifications-default":return WebPushManager.EVENT_ERROR_CODE_PERMISSION_DEFAULT;default:return WebPushManager.EVENT_ERROR_CODE_PERMISSION_UNKNOWN}},initProvider:function(){return dump.log("WebPushApp:initProvider",WebPushApp._provider),WebPushApp._provider.init()},requestPermission:function(e){return WebPushApp._provider.requestPermission(e)},getToken:function(){return WebPushApp._provider.getToken()},deleteToken:function(e){return WebPushApp._provider.deleteToken(e)},showNotification:function(e){return WebPushApp._provider.showNotification(e)},getPermission:function(){return WebPushApp._provider.getPermission()},getDomain:function(){return WebPushApp._provider.getDomain()}},WebPushExternalApp={_iframe:null,init:function(){return new Promise(function(e,t){return dump.log("WebPushExternalApp:init"),WebPushManager._config.agreement_page_domain?WebPushManager._config.agreement_page_url?WebPushManager._config.external_page_iframe_url?void WebPushExternalApp.initIframe().then(function(){e()}).catch(function(e){t(e)}):t(new Error("Url for iframe external page is required")):t(new Error("Url for agreement page is required")):t(new Error("Domain for agreement page is required"))})},initIframe:function(){return new Promise(function(e,t){if(dump.log("WebPushExternalApp:initIframe"),WebPushExternalApp._iframe)return e();var n=null,r=WebPushManager._config.agreement_page_domain+WebPushManager._config.external_page_iframe_url+"?tc="+encodeURIComponent(Auth.trackerKey());Core.getOption("acceptLangList")&&(r+="&lang="+encodeURIComponent(Core.getOption("acceptLangList").join(",")));var i=document.createElement("iframe");i.width=0,i.height=0,i.src=r,i.style="display: none; visibility: hidden; height: 0px; width: 0px;",i.onload=function(){dump.log("WebPushExternalApp:initIframe iframe loaded"),n&&(clearTimeout(n),n=null,WebPushExternalApp._iframe=i,e())},n=setTimeout(function(){t(new Error("Timeout occurred while loading iframe"))},4e3),document.body.appendChild(i)})},getDomain:function(){var e,t=WebPushManager._config.agreement_page_domain.split("/");return 2<t.length&&(e=t[2]),dump.log("WebPushExternalApp:getDomain",e),e},createPromiseWithIframeRequired:function(e){return WebPushExternalApp._iframe?new Promise(e):Promise.reject(new Error("WebPush external app is not initialized"))},sendAndGetResponseFromIframe:function(a,s){return WebPushExternalApp.createPromiseWithIframeRequired(function(n,r){s=void 0!==s?s:1e3,a.payload||(a.payload={}),dump.log("WebPushExternalApp:sendAndGetResponseFromIframe with timeout",a,s);var t=WebPushExternalApp._iframe.contentWindow,i=null,o=null;WebPushManager.getMessageChannel().then(function(e){e.port1.onmessage=function(e){if(dump.log("WebPushExternalApp:sendAndGetResponseFromIframe onmessage took",o.getElapsedTimeString(),e.data,e),i){if(clearTimeout(i),i=null,!e.data||!e.data.payload||"webpush.success"!==e.data.action){if("webpush.error"===e.data.action&&e.data.payload){var t=new Error(e.data.payload.message||"Unknown error message");return e.data.payload.code&&(t.code=e.data.payload.code),r(t)}return r(new Error("Invalid response"))}n(e.data)}},i=setTimeout(function(){r(new Error("Timeout occurred while waiting for response"))},s),o=timer.create("sendAndGetResponseFromIframe"+a.action),t.postMessage(a,WebPushManager._config.agreement_page_domain,[e.port2])}).catch(function(e){dump.error("WebPushExternalApp:sendAndGetResponseFromIframe Can not get message channel",e),r(new Error("Can not get message channel"))})})},onExternalWindowAgreementMessageHandler:function(e){switch(dump.log("WebPushExternalApp:onExternalWindowAgreementMessageHandler onmessage",e.data,e),e.data.action){case"webpush.subscribe":case"webpush.subscribeExists":WebPushState.setSubscription(WebPushState.SUBSCRIPTION_SUBSCRIBE,!0),WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_AGREED,!0);break;case"webpush.subscribeBlock":WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_BLOCKED,!0)}},requestPermission:function(i){return new Promise(function(n,r){i=i||{},dump.log("WebPushExternalApp:requestPermission",i),WebPushExternalApp.getPermission().then(function(e){if(e===WebPushApp.PERMISSION_AGREED)return n(!1);if(e===WebPushApp.PERMISSION_BLOCKED){var t=new Error("Unable to request permission - has been blocked");return t.code=WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED,r(t)}return WebPushExternalApp.requestPermissionByAgreementPage(i)}).catch(function(e){return dump.error("WebPushExternalApp:requestPermission Can not get permission",e),WebPushExternalApp.requestPermissionByAgreementPage(i)})})},requestPermissionByAgreementPage:function(u){return new Promise(function(n,r){u=u||{},dump.log("WebPushExternalApp:requestPermissionByAgreementPage",u);var e=screen.width/2-240,t=screen.height/2-270,i=WebPushManager._config.agreement_page_domain+WebPushManager._config.agreement_page_url+"?tc="+encodeURIComponent(Auth.trackerKey());Core.getOption("acceptLangList")&&(i+="&lang="+encodeURIComponent(Core.getOption("acceptLangList").join(",")));var o="width=480, height=540, left="+e+", top= "+t;dump.log("WebPushExternalApp:requestPermissionByAgreementPage open window",i,o);var a=window.open(i,"snrsWebPushWindow",o);dump.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler",a),a||(dump.error("WebPushExternalApp:requestPermissionByAgreementPage Can not open an agreement window - has been blocked by browser"),r(new Error("Can not open an agreement window - has been blocked by browser")));var s,c=(new Date).getTime();s=setInterval(function(){var e=(new Date).getTime(),t=e-c;if(dump.log("WebPushExternalApp:requestPermissionByAgreementPage webPushWindowHandler connecting to agreement window (time: %s ms)",t),3e3<=e-c&&s)return clearInterval(s),s=undefined,a.close(),r(new Error("Can not connect to agreement window - timeout occurred"));WebPushManager.getMessageChannel().then(function(e){e.port1.onmessage=function(e){dump.log("WebPushExternalApp:requestPermissionByAgreementPage agreement window onmessage",e.data,e),"webpush.readyToSendMessage"===e.data.action&&s&&(clearInterval(s),s=undefined,WebPushManager.getMessageChannel().then(function(e){e.port1.onmessage=WebPushExternalApp.onExternalWindowAgreementMessageHandler,a.postMessage({action:"webpush.readyToReceiveStatus",payload:{}},WebPushManager._config.agreement_page_domain,[e.port2]),n()}).catch(function(e){dump.error("WebPushExternalApp:requestPermissionByAgreementPage onSuccessConnectToWindow Can not get message channel",e),r(new Error("Can not get message channel"))}))},a.postMessage({action:"webpush.readyToReceiveMessage",payload:{}},WebPushManager._config.agreement_page_domain,[e.port2])}).catch(function(e){s&&(clearInterval(s),s=undefined),dump.error("WebPushExternalApp:requestPermissionByAgreementPage Can not get message channel",e),r(new Error("Can not get message channel"))})},50)})},getPermission:function(){return dump.log("WebPushExternalApp:getPermission"),WebPushExternalApp.createPromiseWithIframeRequired(function(t,n){WebPushExternalApp.sendAndGetResponseFromIframe({action:"webpush.getPermission",payload:{}}).then(function(e){if(dump.info("WebPushExternalApp:getPermission then response",e),e.payload.permission===undefined)return Promise.reject(new Error("Invalid response from iframe worker"));t(e.payload.permission)}).catch(function(e){dump.error("WebPushExternalApp:getPermission Can not get permission",e),n(new Error("Can not get permission"))})})},getToken:function(){return dump.log("WebPushExternalApp:getToken"),WebPushExternalApp.createPromiseWithIframeRequired(function(t,n){WebPushExternalApp.sendAndGetResponseFromIframe({action:"webpush.getToken",payload:{}}).then(function(e){dump.info("WebPushExternalApp:getToken then response",e),t(e.payload.token)}).catch(function(e){dump.error("WebPushExternalApp:getToken Can not get token",e);var t=WebPushApp.parseFirebaseErrorCode(e.code);t===WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&((e=new Error("Can not get token, it has been blocked")).code=t),n(e)})})},deleteToken:function(e){return dump.log("WebPushExternalApp:deleteToken"),WebPushExternalApp.createPromiseWithIframeRequired(function(e,t){return dump.info("WebPushExternalApp:deleteToken This functionality for external mode is not supported yet"),t(new Error("Not supported yet"))})},showNotification:function(e){return dump.log("WebPushExternalApp:showNotification",e),WebPushExternalApp.createPromiseWithIframeRequired(function(t,n){dump.info("WebPushExternalApp:showNotification payload",e),WebPushExternalApp.sendAndGetResponseFromIframe({action:"webpush.showNotification",payload:e||{}}).then(function(e){dump.info("WebPushExternalApp:showNotification then response",e),t()}).catch(function(e){dump.error("WebPushExternalApp:showNotification Can not show notification",e),n(e)})})}},WebPushFloatingButton={_initialized:!1,_html:null,_container:null,_widgetCtr:null,_widgetStateCtr:null,_buttonTriggerCtr:null,_closeBtn:null,_widgetClass:"snrs-webpush--widget",_widgetStateContainerClass:"snrs-webpush--widget-state-container",_buttonTriggerClass:"snrs-webpush--widget-trigger",_triggerWidgetCloseClass:"snrs-webpush--trigger-widget-close",_triggerWidgetOpenClass:"snrs-webpush--trigger-widget-open",_triggerHideClass:"snrs-webpush--trigger-hide",_triggerShowClass:"snrs-webpush--trigger-show",_containerShownClass:"snrs-webpush--shown",_widgetOpenedClass:"snrs-webpush--widget-opened",_statePrefixClass:"snrs-webpush--state-",STATE_SUBSCRIBE:"subscribe",STATE_UNSUBSCRIBE:"unsubscribe",STATE_UNKNOWN:"unknown",_closeBtnClass:"snrs-webpush--close",_options:{},_callbackStack:{onStateContentChange:function(){},onStateChange:function(){},onButtonTriggerClick:function(){},onWidgetClose:function(){},onWidgetOpen:function(){},onShow:function(){},onHide:function(){}},getStateOptionList:function(){return[WebPushFloatingButton.STATE_SUBSCRIBE,WebPushFloatingButton.STATE_UNSUBSCRIBE,WebPushFloatingButton.STATE_UNKNOWN]},init:function(r){return new Promise(function(e,t){if(dump.log("WebPushFloatingButton:init - initialized:",WebPushFloatingButton._initialized,r),WebPushFloatingButton._initialized)return e();if(WebPushFloatingButton._options=_.extend({},r),!WebPushFloatingButton._options)return dump.error("WebPushFloatingButton:init - options are not defined",WebPushFloatingButton._options),t(new Error("Options are not defined"));if(WebPushFloatingButton._html=WebPushFloatingButton._options.content,!WebPushFloatingButton._html)return dump.error("WebPushFloatingButton:init - Content is not defined",WebPushFloatingButton._options),t(new Error("Content is not defined"));if(WebPushFloatingButton._options.change_state&&_.isEmpty(WebPushFloatingButton._options.state_content))return dump.error("WebPushFloatingButton:init - State content options are not defined",WebPushFloatingButton._options),t(new Error("State content options are not defined"));var n=document.createElement("div");if(n.innerHTML=WebPushFloatingButton._html,WebPushFloatingButton._container=n.childNodes[0],WebPushFloatingButton._widgetCtr=WebPushFloatingButton._container.querySelector("."+WebPushFloatingButton._widgetClass),WebPushFloatingButton._widgetStateCtr=WebPushFloatingButton._container.querySelector("."+WebPushFloatingButton._widgetStateContainerClass),WebPushFloatingButton._buttonTriggerCtr=WebPushFloatingButton._container.querySelector("."+WebPushFloatingButton._buttonTriggerClass),!WebPushFloatingButton._widgetCtr||!WebPushFloatingButton._buttonTriggerCtr)return dump.error("WebPushFloatingButton:init - Content is invalid",WebPushFloatingButton._widgetCtr,WebPushFloatingButton._buttonTriggerCtr),t(new Error("Content is invalid"));WebPushFloatingButton._options.change_state&&!WebPushFloatingButton._widgetStateCtr&&(dump.info("WebPushFloatingButton:init - Widget state container is not defined - used widget container instead"),Utils.addClass(WebPushFloatingButton._widgetCtr,WebPushFloatingButton._widgetStateContainerClass),WebPushFloatingButton._widgetStateCtr=WebPushFloatingButton._widgetCtr),Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._containerShownClass),WebPushFloatingButton.updateState(WebPushFloatingButton.STATE_UNKNOWN),document.body&&(document.body.appendChild(WebPushFloatingButton._container),WebPushFloatingButton.attachGeneralActions(window.document)),WebPushFloatingButton._initialized=!0,e()})},attachGeneralActions:function(e){dump.log("WebPushFloatingButton:_attachGeneralActions"),e=e||WebPushFloatingButton._container,Utils.attachHandlerByClassName(e,WebPushFloatingButton._buttonTriggerClass,"click",WebPushFloatingButton.onButtonTriggerClick.bind(WebPushFloatingButton)),Utils.attachHandlerByClassName(e,WebPushFloatingButton._triggerWidgetCloseClass,"click",WebPushFloatingButton.closeWidget.bind(WebPushFloatingButton)),Utils.attachHandlerByClassName(e,WebPushFloatingButton._triggerWidgetOpenClass,"click",WebPushFloatingButton.openWidget.bind(WebPushFloatingButton)),Utils.attachHandlerByClassName(e,WebPushFloatingButton._triggerHideClass,"click",WebPushFloatingButton.hide.bind(WebPushFloatingButton)),Utils.attachHandlerByClassName(e,WebPushFloatingButton._triggerShowClass,"click",WebPushFloatingButton.show.bind(WebPushFloatingButton))},updateState:function(e){if(dump.log("WebPushFloatingButton:updateState",e,WebPushFloatingButton._options),!_.inArray(e,WebPushFloatingButton.getStateOptionList()))throw new Error('State value "'+e+'" is invalid');Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._statePrefixClass+WebPushFloatingButton.STATE_UNKNOWN),Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._statePrefixClass+WebPushFloatingButton.STATE_SUBSCRIBE),Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._statePrefixClass+WebPushFloatingButton.STATE_UNSUBSCRIBE),Utils.addClass(WebPushFloatingButton._container,WebPushFloatingButton._statePrefixClass+e),WebPushFloatingButton._triggerCallback("onStateChange",e),WebPushFloatingButton._options.change_state&&WebPushFloatingButton._widgetStateCtr&&(WebPushFloatingButton._options.state_content&&WebPushFloatingButton._options.state_content[e]!==undefined?(WebPushFloatingButton._widgetStateCtr.innerHTML=WebPushFloatingButton._options.state_content[e],WebPushFloatingButton.attachGeneralActions(WebPushFloatingButton._widgetStateCtr),WebPushFloatingButton._triggerCallback("onStateContentChange",e,WebPushFloatingButton._widgetStateCtr)):dump.error("WebPushFloatingButton:updateState Content is not defined for current state",e,WebPushFloatingButton._options.state_content))},_triggerCallback:function(e){if(dump.log("WebPushFloatingButton:_triggerCallback",e,WebPushFloatingButton._callbackStack),WebPushFloatingButton._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=WebPushFloatingButton._callbackStack[e];if(_.isFunction(r))if(dump.log("WebPushFloatingButton:_triggerCallback call with args",e,t,r),!1===r.apply(WebPushFloatingButton,t))return!1}},onStateContentChangeHandler:function(e){WebPushFloatingButton._callbackStack.onStateContentChange=e},onStateChangeHandler:function(e){WebPushFloatingButton._callbackStack.onStateChange=e},onButtonTriggerClickHandler:function(e){WebPushFloatingButton._callbackStack.onButtonTriggerClick=e},onWidgetCloseHandler:function(e){WebPushFloatingButton._callbackStack.onWidgetClose=e},onWidgetOpenHandler:function(e){WebPushFloatingButton._callbackStack.onWidgetOpen=e},onShowHandler:function(e){WebPushFloatingButton._callbackStack.onShow=e},onHideHandler:function(e){WebPushFloatingButton._callbackStack.onHide=e},show:function(){var e=WebPushFloatingButton.isShown();dump.log("WebPushFloatingButton:show - hasShow",!!e),e||(Utils.addClass(WebPushFloatingButton._container,WebPushFloatingButton._containerShownClass),WebPushFloatingButton._triggerCallback("onShow"))},hide:function(){var e=WebPushFloatingButton.isShown();dump.log("WebPushFloatingButton:hide - hasShow",!!e),e&&(Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._containerShownClass),WebPushFloatingButton._triggerCallback("onHide"))},isShown:function(){return Utils.hasClass(WebPushFloatingButton._container,WebPushFloatingButton._containerShownClass)},isHidden:function(){return!WebPushFloatingButton.isShown()},isWidgetOpened:function(){return Utils.hasClass(WebPushFloatingButton._container,WebPushFloatingButton._widgetOpenedClass)},isWidgetClosed:function(){return!WebPushFloatingButton.isWidgetOpened()},onButtonTriggerClick:function(){return!1!==WebPushFloatingButton._triggerCallback("onButtonTriggerClick")&&(WebPushFloatingButton.isWidgetOpened()?WebPushFloatingButton.closeWidget():WebPushFloatingButton.openWidget())},closeWidget:function(){var e=WebPushFloatingButton.isWidgetOpened();dump.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e&&(Utils.removeClass(WebPushFloatingButton._container,WebPushFloatingButton._widgetOpenedClass),WebPushFloatingButton._triggerCallback("onWidgetClose"))},openWidget:function(){var e=WebPushFloatingButton.isWidgetOpened();dump.log("WebPushFloatingButton:closeWidget - isWidgetOpened",!!e),e||(Utils.addClass(WebPushFloatingButton._container,WebPushFloatingButton._widgetOpenedClass),WebPushFloatingButton._triggerCallback("onWidgetOpen"))}},WebPushManager={CONFIG_WEBPUSH_MODE_NATIVE:"native",CONFIG_WEBPUSH_MODE_EXTERNAL:"external",EVENT_ERROR_CODE_PERMISSION_BLOCKED:"permission-blocked",EVENT_ERROR_CODE_PERMISSION_DEFAULT:"permission-default",EVENT_ERROR_CODE_PERMISSION_UNKNOWN:"permission-unknown",_stylesUrl:[],_config:{},_appIsReady:undefined,_callbackStack:{onWebPushSubscribe:function(){},onWebPushSubscribeBlock:function(){},onWebPushSubscribeDiscard:function(){},onWebPushUnsubscribe:function(){},onBrowserPermissionAgree:function(){},onBrowserPermissionBlock:function(){},onBrowserPermissionDiscard:function(){},onMessage:function(){}},onWebPushSubscribe:function(e){WebPushManager._callbackStack.onWebPushSubscribe=e},onWebPushSubscribeBlock:function(e){WebPushManager._callbackStack.onWebPushSubscribeBlock=e},onWebPushSubscribeDiscard:function(e){WebPushManager._callbackStack.onWebPushSubscribeDiscard=e},onWebPushUnsubscribe:function(e){WebPushManager._callbackStack.onWebPushUnsubscribe=e},onBrowserPermissionAgree:function(e){WebPushManager._callbackStack.onBrowserPermissionAgree=e},onBrowserPermissionBlock:function(e){WebPushManager._callbackStack.onBrowserPermissionBlock=e},onBrowserPermissionDiscard:function(e){WebPushManager._callbackStack.onBrowserPermissionDiscard=e},onMessage:function(e){WebPushManager._callbackStack.onMessage=e},getConfigWebpushModeSupportedList:function(){return[WebPushManager.CONFIG_WEBPUSH_MODE_NATIVE,WebPushManager.CONFIG_WEBPUSH_MODE_EXTERNAL]},init:function(n){return Utils.uniquePromiseHandler("WebPushManager.init",function(e,t){dump.log("WebPushManager:init",n),Core.getWebPushProfileConfig().then(function(e){return Promise.resolve(_.extend(e||{},n||{}))}).then(WebPushManager.setConfig).then(WebPushManager.initState).then(WebPushManager.isWebPushSupported).then(function(){return WebPushManager.attachHandlers(window.document)}).then(function(){return WebPushManager.initApp().then(function(){return WebPushManager.checkAndSynchronizeStateIfRequired().then(function(e){dump.log("WebPushManager:init checkAndSynchronizeStateIfRequired then",e)}).catch(function(e){dump.error("WebPushManager:init checkAndSynchronizeStateIfRequired then error",e)}),Promise.resolve()}).then(function(){return WebPushManager.initFloatingButton().then(function(){dump.log("WebPushManager:init initFloatingButton done")}).catch(function(e){dump.error("WebPushManager:init initFloatingButton Can not init floating button - error occurred",e)}),Promise.resolve()}).catch(function(e){dump.error("WebPushManager:init initApp error",e)}),Promise.resolve()}).then(function(){dump.log("WebPushManager:init done"),e()}).catch(function(e){dump.error("WebPushManager:init error",e),t(e)})})},getMode:function(){return WebPushManager._config.mode},getDomain:function(){return WebPushApp.getDomain()},initFloatingButton:function(){return new Promise(function(e,t){if(!WebPushManager._config.floating_button)return dump.log("WebPushManager:init Floating button is disabled",WebPushManager._config),e();var n=WebPushManager._config.language;return n?(WebPushFloatingButton.onStateContentChangeHandler(WebPushManager.onFloatingButtonStateContentChange.bind(WebPushManager)),WebPushFloatingButton.init(n.floating_button).then(function(){WebPushManager.attachHandlers(WebPushFloatingButton._container),WebPushManager.updateFloatingButtonState(),WebPushFloatingButton.show(),e()}).catch(t)):(dump.error("WebPushManager:init Can not init floating button - language config is not defined",WebPushManager._config),t(new Error("Language config is not defined")))})},onFloatingButtonStateContentChange:function(e,t){dump.log("WebPushManager:onFloatingButtonStateContentChange",e,t),WebPushManager.attachHandlers(t)},onWebPushStateSubscriptionChange:function(e,t){dump.log("WebPushManager:onWebPushStateChange",e,t),dump.log("WebPushManager:onWebPushStateChange WebPushFloatingButton._initialized",WebPushFloatingButton._initialized),WebPushFloatingButton._initialized&&WebPushManager.updateFloatingButtonState()},updateFloatingButtonState:function(){return new Promise(function(e,t){if(!WebPushFloatingButton._initialized)return dump.error("WebPushManager:init Can not update floating button state - module is not initialized",WebPushFloatingButton),t(new Error("Can not update floating button state - module is not initialized"));var n=null;switch(WebPushState.getSubscription()){case WebPushState.SUBSCRIPTION_UNKNOWN:n=WebPushFloatingButton.STATE_UNKNOWN;break;case WebPushState.SUBSCRIPTION_SUBSCRIBE:n=WebPushFloatingButton.STATE_SUBSCRIBE;break;case WebPushState.SUBSCRIPTION_UNSUBSCRIBE:n=WebPushFloatingButton.STATE_UNSUBSCRIBE}WebPushFloatingButton.updateState(n),e()})},initApp:function(){return new Utils.uniquePromiseHandler("WebPushManager.initApp",function(e,t){dump.log("WebPushManager:initApp"),WebPushApp.init().then(function(){var e=WebPushState.getSubscription();return dump.log("WebPushManager:initApp check subscription",e),e!==WebPushState.SUBSCRIPTION_UNKNOWN?Promise.resolve():(dump.log("WebPushManager:initApp 0"),new Promise(function(t,e){WebPushManager.sendRequestToCheckSubscription().then(function(e){dump.log("WebPushManager:initApp sendRequestToCheckSubscription then",e),WebPushState.setSubscription(e,!0),t()}).catch(function(e){dump.error("WebPushManager:initApp Can not get subscription",e),t()})}))}).then(function(){var e=WebPushState.getBrowserPermission();return dump.log("WebPushManager:initApp check browser permission",e),e!==WebPushState.BROWSER_PERMISSION_DEFAULT?Promise.resolve():(dump.log("WebPushManager:initApp 0"),new Promise(function(t,e){WebPushManager.getBrowserPermission().then(function(e){dump.log("WebPushManager:initApp getBrowserPermission then",e),WebPushState.setBrowserPermission(e,!1),t()}).catch(function(e){dump.error("WebPushManager:initApp Can not get browser permission",e),t()})}))}).then(function(){dump.log("WebPushManager:initApp done"),WebPushManager._appIsReady=!0,e()}).catch(function(e){return dump.error("WebPushManager:initApp Can not init web push app",e),WebPushManager._appIsReady=!1,t(new Error("Can not init web push app"))})})},prepareStyles:function(){return new Promise(function(e,t){if(dump.log("WebPushManager:prepareStyles"),!WebPushManager._stylesUrl)return e();Utils.addStyles(WebPushManager._stylesUrl).then(function(){e()}).catch(function(e){dump.error(e),t(e)})})},setConfig:function(r){return new Promise(function(e,t){r=r||{},dump.log("WebPushManager:setConfig",r);var n={service_worker_path:"/snr-sw.js",service_worker_scope:"/",sender_id:null,agreement_page_domain:null,agreement_page_url:"/agreement.html",external_page_iframe_url:"/iframeWorker.html",mode:WebPushManager.CONFIG_WEBPUSH_MODE_NATIVE,enabled:!1};dump.log("WebPushManager:setConfig extend",n,WebPushManager._config,r),WebPushManager._config=_.extend({},n,WebPushManager._config,r),WebPushManager._config.service_worker_path||(WebPushManager._config.service_worker_path=n.service_worker_path),WebPushManager._config.service_worker_scope||(WebPushManager._config.service_worker_scope=n.service_worker_scope),dump.log("WebPushManager:setConfig return ",WebPushManager._config),e()})},initState:function(){return new Promise(function(t,e){dump.log("WebPushManager:initState"),WebPushState.init().then(function(){dump.log("WebPushManager:initState done"),WebPushState.onStateSubscriptionChangeHandler(WebPushManager.onWebPushStateSubscriptionChange.bind(WebPushManager)),t()}).catch(function(e){return dump.error("WebPushManager:initState Can not restore state from cache",e),t()})})},checkAndSynchronizeStateIfRequired:function(){return new Promise(function(e,t){dump.log("WebPushManager:checkAndSynchronizeStateIfRequired");WebPushState.getBrowserPermission(),WebPushState.getSubscription();if(WebPushState.isSubscriptionSaved()&&WebPushState.isBrowserPermissionSaved())return e();Promise.resolve().then(function(){var e=WebPushState.getBrowserPermission();return WebPushState.isBrowserPermissionSaved()||e!==WebPushState.BROWSER_PERMISSION_AGREED?Promise.resolve():(dump.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving browser permission",e),new Promise(function(t,e){WebPushManager.getToken().then(function(e){if(dump.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken then",e),!WebPushState.isTokenChanged(e))return dump.log("WebPushManager:checkAndSynchronizeStateIfRequired getToken token has the same value - do not send request",e),WebPushState.setBrowserPermissionSaved(!0),t(e);WebPushState.setToken(e),WebPushManager.sendBrowserPermissionRequest(e).then(function(){WebPushState.setBrowserPermissionSaved(!0)}).catch(function(e){dump.error("WebPushManager:checkAndSynchronizeStateIfRequired sendAddBrowserPermissionRequest then error",e)}),t(e)}).catch(function(e){dump.error("WebPushManager:checkAndSynchronizeStateIfRequired getToken then error",e),t()})}))}).then(function(e){var n=WebPushState.getSubscription();return WebPushState.isSubscriptionSaved()||n===WebPushState.SUBSCRIPTION_UNKNOWN?Promise.resolve():(dump.log("WebPushManager:checkAndSynchronizeStateIfRequired try saving subscription",n),new Promise(function(e,t){if(n===WebPushState.SUBSCRIPTION_SUBSCRIBE)WebPushManager.sendSubscribeRequest().then(function(){WebPushState.setSubscriptionSaved(!0)}).catch(function(e){dump.error("WebPushManager:checkAndSynchronizeStateIfRequired sendSubscribeRequest then error",e)});else{if(n!==WebPushState.SUBSCRIPTION_UNSUBSCRIBE)return e();WebPushManager.sendUnsubscribeRequest().then(function(){WebPushState.setSubscriptionSaved(!0)}).catch(function(e){dump.error("WebPushManager:checkAndSynchronizeStateIfRequired sendUnsubscribeRequest then error",e)})}e()}))}).then(function(){e()}).catch(function(e){t(e)})})},getBrowserPermission:function(){return dump.log("WebPushManager:getBrowserPermission"),new Promise(function(t,e){WebPushApp.getPermission().then(function(e){dump.log("WebPushManager:getBrowserPermission getPermission then",e),t(WebPushManager.mapAppPermissionToBrowserPermissionValues(e))}).catch(e)})},getSubscription:function(){return dump.log("WebPushManager:getSubscription"),WebPushManager.getSubscriptionState()},mapAppPermissionToBrowserPermissionValues:function(e){switch(e){case WebPushApp.PERMISSION_DEFAULT:return WebPushState.BROWSER_PERMISSION_DEFAULT;case WebPushApp.PERMISSION_BLOCKED:return WebPushState.BROWSER_PERMISSION_BLOCKED;case WebPushApp.PERMISSION_AGREED:return WebPushState.BROWSER_PERMISSION_AGREED}},isWebPushSupported:function(){return new Promise(function(e,t){return dump.log("WebPushManager:isWebPushSupported",WebPushManager._config,document.location,DeviceManager.getProtocol()),WebPushManager._config.enabled?_.inArray(WebPushManager._config.mode,WebPushManager.getConfigWebpushModeSupportedList())?WebPushManager._config.mode===WebPushManager.CONFIG_WEBPUSH_MODE_NATIVE&&"localhost"!==document.location.hostname&&"https"!==DeviceManager.getProtocol()?(dump.error('WebPushManager:isWebPushSupported WebPush service do not support unsecured protocol "%s"',document.location.protocol),t(new Error("WebPush service do not support unsecured protocol"))):"PushManager"in window?void e():(dump.error("WebPushManager:isWebPushSupported This browser does not support push notification"),t(new Error("This browser does not support push notification"))):(dump.error('WebPushManager:isWebPushSupported WebPush mode "%s" is not supported',WebPushManager._config.mode),t(new Error("WebPush mode is not supported"))):(dump.error("WebPushManager:isWebPushSupported WebPush is currently disabled",WebPushManager._config.enabled),t(new Error("WebPush is currently disabled")))})},isWebPushAppReady:function(){return new Promise(function(e,t){dump.log("WebPushManager:isWebPushAppReady",WebPushManager._appIsReady),(!0===WebPushManager._appIsReady?Promise.resolve():!1===WebPushManager._appIsReady?Promise.reject(new Error("App not initialized")):WebPushManager.initApp()).then(function(){e()}).catch(function(e){return dump.error("WebPushManager:isWebPushAppReady WebPush app is currently not available"),t(new Error("WebPush is currently not available"))})})},checkSubscribeRequestNeed:function(){var e=WebPushState.getSubscription(),t=WebPushState.getBrowserPermission();return dump.log("WebPushManager:checkSubscribeRequestNeed",e,t),t===WebPushState.BROWSER_PERMISSION_DEFAULT||t===WebPushState.BROWSER_PERMISSION_AGREED&&e!==WebPushState.SUBSCRIPTION_SUBSCRIBE},getSubscriptionState:function(){return WebPushState.getSubscription()},getBrowserPermissionState:function(){return WebPushState.getBrowserPermission()},attachHandlers:function(n,r){return new Promise(function(e,t){dump.log("WebPushManager:attachEvents",n,r),Utils.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribe","click",WebPushManager.onWebPushTriggerSubscribeHandler,r),Utils.attachHandlerByClassName(n,"snrs-webpush--trigger-subscribeDiscard","click",WebPushManager.onWebPushTriggerSubscribeDiscardHandler,r),Utils.attachHandlerByClassName(n,"snrs-webpush--trigger-unsubscribe","click",WebPushManager.onWebPushTriggerUnsubscribeHandler,r),e()})},onWebPushTriggerSubscribeHandler:function(){return new Promise(function(t,n){dump.log("WebPushManager:onWebPushTriggerSubscribeHandler"),WebPushManager.subscribe().then(function(e){return dump.log("WebPushManager:onWebPushTriggerSubscribeHandler requestPermission then hasShowed value",e),t(e)}).catch(function(e){dump.error("WebPushManager:onWebPushTriggerSubscribeHandler requestPermission error occurred",e),n(e)})})},onWebPushTriggerSubscribeDiscardHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushTriggerSubscribeDiscardHandler"),WebPushManager.onWebPushSubscribeDiscardHandler().then(function(){e()}).catch(function(e){dump.error("WebPushManager:onWebPushTriggerSubscribeDiscardHandler onWebPushSubscribeDiscardHandler error occurred",e),t(e)})})},onWebPushTriggerUnsubscribeHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushTriggerUnsubscribeHandler"),WebPushManager.unsubscribe().then(function(){dump.log("WebPushManager:onWebPushTriggerUnsubscribeHandler requestPermission then"),e()}).catch(function(e){dump.error("WebPushManager:onWebPushTriggerUnsubscribeHandler error occurred",e),t(e)})})},getMessageChannel:function(){return new Promise(function(e,t){if(dump.log("WebPushManager:getMessageChannel"),!window.MessageChannel)return t(new Error("MessageChannel is not supported"));var n=new window.MessageChannel;dump.log("WebPushManager:getMessageChannel result",n),e(n)})},onServiceWorkerMessageHandler:function(e){if(dump.log("WebPushManager:onServiceWorkerMessageHandler onmessage",e.data,e),"message.click"===e.data.action){var t=e.data.notificationPayload;WebPushManager.onMessageClickHandler(t.data)}},onMessageClickHandler:function(n){return new Promise(function(e,t){dump.log("WebPushManager:onMessageClickHandler",n),e()})},onBrowserPermissionAgreeHandler:function(){return new Promise(function(t,n){dump.log("WebPushManager:onBrowserPermissionAgreeHandler"),WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_AGREED,!1),WebPushManager.getToken().then(function(e){dump.log("WebPushManager:onBrowserPermissionAgreeHandler getToken then",e),EventManager.trackClientEvent("client.web.browser.page","webpush.permissionAgree",{url:window.location.href,userAgent:navigator.userAgent,token:e}),WebPushManager._callbackStack.onBrowserPermissionAgree(),WebPushManager.onWebPushSubscribeHandler(),t()}).catch(function(e){dump.error("WebPushManager:onBrowserPermissionAgreeHandler getToken then error",e),n(e)})})},onBrowserPermissionBlockHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onBrowserPermissionBlockHandler"),WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_BLOCKED,!1),EventManager.trackClientEvent("client.web.browser.page","webpush.permissionBlock",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager._callbackStack.onBrowserPermissionBlock(),WebPushManager.onWebPushSubscribeBlockHandler(),e()})},onBrowserPermissionDiscardHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onBrowserPermissionDiscardHandler"),EventManager.trackClientEvent("client.web.browser.page","webpush.permissionDiscard",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager._callbackStack.onBrowserPermissionDiscard(),WebPushManager.onWebPushSubscribeDiscardHandler(),e()})},onWebPushSubscribeHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushSubscribeHandler"),WebPushState.setSubscription(WebPushState.SUBSCRIPTION_SUBSCRIBE,!1),EventManager.trackClientEvent("client.web.browser.page","webpush.subscribe",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager.checkAndSynchronizeStateIfRequired(),WebPushManager._callbackStack.onWebPushSubscribe(),e()})},onWebPushSubscribeBlockHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushSubscribeBlockHandler"),EventManager.trackClientEvent("client.web.browser.page","webpush.subscribeBlock",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager._callbackStack.onWebPushSubscribeBlock(),e()})},onWebPushSubscribeDiscardHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushSubscribeDiscardHandler"),EventManager.trackClientEvent("client.web.browser.page","webpush.subscribeDiscard",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager._callbackStack.onWebPushSubscribeDiscard(),e()})},onWebPushUnsubscribeHandler:function(){return new Promise(function(e,t){dump.log("WebPushManager:onWebPushUnsubscribeHandler"),WebPushState.setSubscription(WebPushState.SUBSCRIPTION_UNSUBSCRIBE,!1),EventManager.trackClientEvent("client.web.browser.page","webpush.unsubscribe",{url:window.location.href,userAgent:navigator.userAgent}),WebPushManager.checkAndSynchronizeStateIfRequired(),WebPushManager._callbackStack.onWebPushUnsubscribe(),e()})},requestPermission:function(e){return new Promise(function(t,n){e=e||{},WebPushApp.requestPermission(e).then(function(e){dump.log("WebPushManager:requestPermission then",e),t(e)}).catch(function(e){dump.error("WebPushManager:requestPermission then error",e),n(e)})})},subscribe:function(e){return new Promise(function(t,n){e=e||{},WebPushApp.requestPermission(e).then(function(e){if(dump.log("WebPushManager:requestPermission then",e),!1===e)return WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_AGREED,!1),WebPushManager.onWebPushSubscribeHandler(),t(e);t(e)}).catch(function(e){dump.error("WebPushManager:requestPermission then error",e),e.code===WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED&&(WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_BLOCKED,!1),WebPushManager.onWebPushSubscribeBlockHandler()),n(e)})})},unsubscribe:function(n){return new Promise(function(e,t){n=n||{},dump.log("WebPushManager:unsubscribe"),WebPushManager.onWebPushUnsubscribeHandler().then(function(){dump.log("WebPushManager:unsubscribe then"),e()}).catch(function(e){dump.error("WebPushManager:unsubscribe then error",e),t(new Error("Unable to unsubscribe webpush notifications"))})})},getToken:function(){return new Promise(function(t,n){WebPushApp.getToken().then(function(e){if(e)return dump.log("WebPushManager:getToken Token has been received",e),t(e);dump.log("WebPushManager:getToken Can not get token, permission required"),t()}).catch(function(e){dump.error("WebPushManager:getToken Can not get token, it has been blocked",e),n(e)})})},deleteToken:function(e){return new Promise(function(t,n){WebPushApp.deleteToken(e).then(function(e){dump.log("WebPushManager:deleteToken Token has been deleted",e),WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_AGREED,!1),t()}).catch(function(e){dump.error("WebPushManager:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},sendSubscribeRequest:function(){return new Promise(function(e,t){dump.log("WebPushManager:sendSubscribeRequest"),RequestManager.subscribeWebPushForClient().then(function(){dump.log("WebPushManager:sendSubscribeRequest subscribed"),e()}).catch(function(e){dump.error("WebPushManager:sendSubscribeRequest Can not subscribe, error occurred",e),t(new Error("Can not save subscribe status of notifications, error occurred"))})})},sendUnsubscribeRequest:function(){return new Promise(function(e,t){return dump.log("WebPushManager:sendUnsubscribeRequest"),RequestManager.unsubscribeWebPushForClient().then(function(){dump.log("WebPushManager:sendUnsubscribeRequest unsubscribed"),e()}).catch(function(e){dump.error("WebPushManager:sendUnsubscribeRequest Can not unsubscribe web push, error occurred",e),t(new Error("Can not save unsubscribe status of notifications, error occurred"))}),e()})},sendRequestToCheckSubscription:function(){return new Promise(function(t,n){dump.log("WebPushManager:sendRequestToCheckSubscription for domain",WebPushManager.getDomain()),RequestManager.checkWebPushSubscriptionForClient(WebPushManager.getDomain()).then(function(e){if(dump.log("WebPushManager:sendRequestToCheckSubscription subscription",e,WebPushManager.getDomain()),!_.inArray(e,WebPushState.getSubscriptionOptionList()))return Promise.reject(new Error("Subscription status is invalid"));t(e)}).catch(function(e){dump.error("WebPushManager:sendRequestToCheckSubscription Can not get subscription status of notifications, error occurred",e),n(new Error("Can not get subscription status of notifications, error occurred"))})})},sendBrowserPermissionRequest:function(n){return new Promise(function(e,t){dump.log("WebPushManager:sendBrowserPermissionRequest for domain",WebPushManager.getDomain()),RequestManager.addBrowserPermissionWebPushForClient(n,WebPushManager.getDomain()).then(function(){dump.log("WebPushManager:sendBrowserPermissionRequest Token has been saved",n,WebPushManager.getDomain()),e()}).catch(function(e){dump.error("WebPushManager:sendBrowserPermissionRequest Can not save token, error occurred",e),t(new Error("Can not save token, error occurred"))})})},onTokenRefresh:function(){dump.log("WebPushManager:onTokenRefresh"),WebPushState.setBrowserPermission(WebPushState.BROWSER_PERMISSION_AGREED,!1),WebPushManager.checkAndSynchronizeStateIfRequired()},onMessageHandler:function(e){dump.log("WebPushManager:onMessageHandler",e),e&&_.isDocumentVisible()&&(e.notification?WebPushManager.showNotification(e):e.data&&WebPushManager.onMessageClickHandler(e.data),WebPushManager._callbackStack.onMessage(e))},showNotification:function(n){return new Promise(function(e,t){if(dump.log("WebPushManager:showNotification",n),!n||!n.notification)return t(new Error("Payload is empty or it have not notification key"));n.notification=_.extend({},n.data,n.notification),WebPushApp.showNotification(n).then(function(){dump.log("WebPushManager:showNotification then",n)}).catch(function(e){dump.error("Can not show notification",e),t(new Error("Can not show notification"))})})}},WebPushNativeApp={_firebaseAppNamespace:"SyneriseApp",_firebaseApp:null,_firebaseMessangingApp:null,_serviceWorkerRegistration:null,init:function(){return new Promise(function(e,t){dump.log("WebPushNativeApp:init firebase",firebase),WebPushNativeApp.initFcmApp().then(WebPushNativeApp.registerServiceWorker).then(function(){dump.log("WebPushNativeApp:init done"),e()}).catch(function(e){dump.error("WebPushNativeApp:init error",e),t(e)})})},initFcmApp:function(){return new Promise(function(e,t){if(dump.log("WebPushNativeApp:initFcmApp"),!firebase)return t(new Error("Firebase Cloud Messaging APP is required"));if(!WebPushManager._config.sender_id)return t(new Error("Sender id is required for web push"));var n={messagingSenderId:WebPushManager._config.sender_id};WebPushNativeApp._firebaseApp=firebase.initializeApp(n,WebPushNativeApp._firebaseAppNamespace),WebPushNativeApp._firebaseMessangingApp=firebase.messaging(WebPushNativeApp._firebaseApp),WebPushNativeApp._firebaseMessangingApp.onTokenRefresh(function(){dump.log("WebPushNativeApp:initFcmApp onTokenRefresh"),WebPushManager.onTokenRefresh()}),WebPushNativeApp._firebaseMessangingApp.onMessage(function(e){dump.log("WebPushNativeApp:initFcmApp onMessage",e),WebPushManager.onMessageHandler(e)}),e()})},registerServiceWorker:function(){return new Promise(function(t,n){if(dump.log("WebPushNativeApp:registerServiceWorker"),!WebPushNativeApp._firebaseApp||!WebPushNativeApp._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));if(!("serviceWorker"in navigator))return n(new Error("Service worker in not supported"));var e=Core.getBuildHash();navigator.serviceWorker.register(WebPushManager._config.service_worker_path+"?hash="+e,{scope:WebPushManager._config.service_worker_scope}).then(function(e){dump.log("WebPushNativeApp:registerServiceWorker Registration succeeded. Scope is "+e.scope),WebPushNativeApp._serviceWorkerRegistration=e,WebPushNativeApp._firebaseMessangingApp.useServiceWorker(WebPushNativeApp._serviceWorkerRegistration),t()}).catch(function(e){dump.fatal("WebPushNativeApp:registerServiceWorker Registration failed with ",e),n(new Error("Service worker registration failed"))})})},getDomain:function(){return location.hostname},requestPermission:function(e){return new Promise(function(t,n){if(e=e||{},dump.log("WebPushNativeApp:requestPermission",e),!WebPushNativeApp._firebaseApp||!WebPushNativeApp._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));WebPushNativeApp.getToken().then(function(e){if(dump.log("WebPushNativeApp:requestPermission getToken then",e),e)return t(!1);WebPushNativeApp._firebaseMessangingApp.requestPermission().then(function(e){dump.log("WebPushNativeApp:requestPermission Notification permission granted",e),WebPushManager.onBrowserPermissionAgreeHandler()}).catch(function(e){dump.error("WebPushNativeApp:requestPermission Unable to get permission to notify",e);var t=new Error("Unable to get permission to notify");switch(t.code=WebPushApp.parseFirebaseErrorCode(e.code),t.code){case WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED:WebPushManager.onBrowserPermissionBlockHandler();break;case WebPushManager.EVENT_ERROR_CODE_PERMISSION_DEFAULT:WebPushManager.onBrowserPermissionDiscardHandler()}}),t()}).catch(function(e){dump.error("WebPushNativeApp:requestPermission getToken then error",e);var t=new Error("Unable to request permission to notify");t.code=e.code,n(t)})})},getPermission:function(){return new Promise(function(n,r){if(dump.log("WebPushNativeApp:getPermission"),!WebPushNativeApp._firebaseApp||!WebPushNativeApp._firebaseMessangingApp)return r(new Error("WebPush manager is not initialized"));WebPushNativeApp.getToken().then(function(e){return dump.log("WebPushNativeApp:getPermission getToken then",e),n(e?WebPushApp.PERMISSION_AGREED:WebPushApp.PERMISSION_DEFAULT)}).catch(function(e){if(dump.error("WebPushNativeApp:getPermission getToken then error",e),e.code===WebPushManager.EVENT_ERROR_CODE_PERMISSION_BLOCKED)return n(WebPushApp.PERMISSION_BLOCKED);var t=new Error("Unable to get permission");t.code=e.code,r(t)})})},getToken:function(){return new Promise(function(t,n){if(dump.log("WebPushNativeApp:getToken"),!WebPushNativeApp._firebaseApp||!WebPushNativeApp._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));WebPushNativeApp._firebaseMessangingApp.getToken().then(function(e){dump.log("WebPushNativeApp:getToken then",e),t(e)}).catch(function(e){dump.error(e),dump.error("WebPushNativeApp:getToken Can not get token, it has been blocked",e);var t=new Error("Can not get token, it has been blocked");t.code=WebPushApp.parseFirebaseErrorCode(e.code),n(t)})})},deleteToken:function(e){return new Promise(function(t,n){if(dump.log("WebPushNativeApp:deleteToken"),!WebPushNativeApp._firebaseApp||!WebPushNativeApp._firebaseMessangingApp)return n(new Error("WebPush manager is not initialized"));WebPushNativeApp._firebaseMessangingApp.deleteToken(e).then(function(e){t(e)}).catch(function(e){dump.error("WebPushNativeApp:deleteToken Can not delete token, error occurred",e),n(new Error("Can not delete token, error occurred"))})})},showNotification:function(r){return new Promise(function(n,t){dump.log("WebPushNativeApp:showNotification",r),navigator.serviceWorker.ready.then(function(e){dump.log("WebPushNativeApp:showNotification serviceWorker ready",r,e,navigator.serviceWorker.controller),WebPushManager.getMessageChannel().then(function(e){var t={action:"worker.showNotification",notificationPayload:r};e.port1.onmessage=WebPushManager.onServiceWorkerMessageHandler,navigator.serviceWorker.controller.postMessage(t,[e.port2]),n()}).catch(function(e){dump.error("Can not show notification. Can not get message channel",e),t(new Error("Can not show notification. Can not get message channel"))})}).catch(function(e){dump.error("Can not show notification. Service worker is not ready yet",e),t(new Error("Can not show notification. Service worker is not ready yet"))})})}},WebPushState={SUBSCRIPTION_SUBSCRIBE:"subscribe",SUBSCRIPTION_UNSUBSCRIBE:"unsubscribe",SUBSCRIPTION_UNKNOWN:"unknown",BROWSER_PERMISSION_AGREED:"agreed",BROWSER_PERMISSION_BLOCKED:"blocked",BROWSER_PERMISSION_DEFAULT:"default",_data:{subscription:"unknown",subscriptionSaved:!1,permission:"default",permissionSaved:!1,tokenTime:null,tokenHash:null},_dataLocalStorageKey:"snr-wp-state",_tokenSavedIntervalRefresh:36e5,_callbackStack:{onStateChange:function(){},onStateSubscriptionChange:function(){}},init:function(){return new Promise(function(t,e){dump.log("WebPushState:init"),WebPushState.restoreStateFromLocalCache().then(function(){var e=Store.getClientUuid();dump.log("WebPushState:init current state",WebPushState._data),dump.log("WebPushState:init uuids",e,WebPushState._data.uuid),dump.log("WebPushState:init synchronized",WebPushState._data.permissionSaved),WebPushState._data.uuid&&e&&e===WebPushState._data.uuid?WebPushState._data.tokenTime?(new Date).getTime()-WebPushState._data.tokenTime>=WebPushState._tokenSavedIntervalRefresh&&(dump.log("WebPushState:init timeout occurred for token saved status, clear permission saved status"),WebPushState._data.permissionSaved=!1):(dump.log("WebPushState:init token time is not defined, clear permission saved status"),WebPushState._data.permissionSaved=!1):(dump.log("WebPushState:init other client uuid, clear state for this client"),WebPushState._data.permissionSaved=!1,WebPushState._data.subscriptionSaved=!1,WebPushState._data.subscription=WebPushState.SUBSCRIPTION_UNKNOWN,WebPushState._data.tokenHash=null,WebPushState._data.tokenTime=null,WebPushState.saveStateInLocalCache()),dump.log("WebPushState:init done",WebPushState._data),t()}).catch(function(e){return dump.error("WebPushState:init Can not restore state from cache - used default values",e),t()})})},_triggerCallback:function(e){if(dump.log("WebPushState:_triggerCallback",e),WebPushState._callbackStack[e]){for(var t=new Array(arguments.length-1),n=0;n<t.length;++n)t[n]=arguments[n+1];var r=WebPushState._callbackStack[e];if(_.isFunction(r))if(dump.log("WebPushState:_triggerCallback call with args",e,t,r),!1===r.apply(WebPushState,t))return!1}},onStateChangeHandler:function(e){WebPushState._callbackStack.onStateChange=e},onStateSubscriptionChangeHandler:function(e){WebPushState._callbackStack.onStateSubscriptionChange=e},getBrowserPermissionOptionList:function(){return[WebPushState.BROWSER_PERMISSION_AGREED,WebPushState.BROWSER_PERMISSION_BLOCKED,WebPushState.BROWSER_PERMISSION_DEFAULT]},getSubscriptionOptionList:function(){return[WebPushState.SUBSCRIPTION_SUBSCRIBE,WebPushState.SUBSCRIPTION_UNSUBSCRIBE,WebPushState.SUBSCRIPTION_UNKNOWN]},getSubscription:function(){return WebPushState._data.subscription},isSubscriptionSaved:function(){return WebPushState._data.subscriptionSaved},setSubscription:function(e,t){if(t=void 0!==t&&!!t,dump.log("WebPushState:setSubscription",e,t),!_.inArray(e,WebPushState.getSubscriptionOptionList()))throw new Error('Subscription value "'+e+'" is invalid');var n=WebPushState._data.subscription;WebPushState._data.subscription=e,WebPushState._data.subscriptionSaved=t,WebPushState._triggerCallback("onStateSubscriptionChange",e,n),WebPushState.saveStateInLocalCache()},setSubscriptionSaved:function(e){e=void 0!==e&&!!e,dump.log("WebPushState:setSubscriptionSaved",e),WebPushState._data.subscriptionSaved=e,WebPushState.saveStateInLocalCache()},getBrowserPermission:function(){return WebPushState._data.permission},isBrowserPermissionSaved:function(){return WebPushState._data.permissionSaved},setBrowserPermission:function(e,t){if(t=void 0!==t&&!!t,dump.log("WebPushState:setBrowserPermission",e,t),!_.inArray(e,WebPushState.getBrowserPermissionOptionList()))throw new Error('Browser permission value "'+e+'" is invalid');WebPushState._data.permission=e,WebPushState._data.permissionSaved=t,WebPushState._data.tokenTime=(new Date).getTime(),WebPushState.saveStateInLocalCache()},isToken:function(){return!!WebPushState._data.tokenHash},setToken:function(e){dump.log("WebPushState:setToken",e),WebPushState.setTokenHash(e?WebPushState.prepareHashForToken(e):null)},setTokenHash:function(e){dump.log("WebPushState:setTokenHash",e),WebPushState._data.tokenHash=e||null,WebPushState.saveStateInLocalCache()},prepareHashForToken:function(e){return dump.log("WebPushState:prepareHashForToken",e),Utils.hashString(e)+""},isTokenChanged:function(e){if(dump.log("WebPushState:isTokenChanged",e),!e)throw new Error("Token not defined");return!WebPushState._data.tokenHash||WebPushState._data.tokenHash!==WebPushState.prepareHashForToken(e)},setBrowserPermissionSaved:function(e){e=void 0!==e&&!!e,dump.log("WebPushState:setBrowserPermissionSaved",e),WebPushState._data.permissionSaved=e,WebPushState._data.tokenTime=(new Date).getTime(),WebPushState.saveStateInLocalCache()},saveStateInLocalCache:function(){return new Promise(function(e,t){if(dump.log("WebPushState:saveStateInLocalCache",WebPushState._data),LocalStore.isAvailable()){var n=WebPushState.prepareObjectForCacheState(WebPushState._data);LocalStore.set(WebPushState._dataLocalStorageKey,n),dump.log("WebPushState:saveStateInLocalCache saved stateObject",n)}WebPushFloatingButton._triggerCallback("onStateChange",WebPushState._data),e()})},restoreStateFromLocalCache:function(){return new Promise(function(e,t){if(dump.log("WebPushState:restoreStateFromLocalCache"),!LocalStore.isAvailable())return e();var n=LocalStore.get(WebPushState._dataLocalStorageKey),r=WebPushState.prepareObjectFromCacheState(n);if(r)for(var i in r)r.hasOwnProperty(i)&&(WebPushState._data[i]=r[i]);dump.log("WebPushState:restoreStateFromLocalCache restored state",WebPushState._data),e()})},prepareObjectForCacheState:function(e){dump.log("WebPushState:prepareObjectForCacheState state",e);var t=Store.getClientUuid(),n={permissionSaved:e.permissionSaved?"1":"0",subscriptionSaved:e.subscriptionSaved?"1":"0"};return e.tokenTime&&(n.tokenTime=e.tokenTime),e.tokenHash&&(n.tokenHash=e.tokenHash),e.subscription&&(n.subscription=e.subscription),e.permission&&(n.permission=e.permission),t&&(n.uuid=t),dump.log("WebPushState:prepareObjectForCacheState return stateForCache",n),n},prepareObjectFromCacheState:function(e){dump.log("WebPushState:prepareObjectFromCacheState",e);var t={};return void 0===e?dump.log("WebPushState:prepareObjectFromCacheState Not found"):(t.permissionSaved="1"===e.permissionSaved,t.subscriptionSaved="1"===e.subscriptionSaved,e.tokenTime&&(t.tokenTime=parseInt(e.tokenTime,10)),e.tokenHash&&(t.tokenHash=e.tokenHash),e.subscription&&(t.subscription=e.subscription),e.permission&&(t.permission=e.permission),e.uuid&&(t.uuid=e.uuid),dump.log("WebPushState:prepareObjectFromCacheState state",t)),t}},MessengerConfig,MessengerManager,MessengerWidget,SocketManager;MessengerConfig={lang:{pl:{repeat_under_time:{FEW_MINUTES:"Zazwyczaj odpowiadamy w kilka minut. Bądź czujny",FEW_HOURS:"Zazwyczaj odpowiadamy w przeciągu kilku godzin. Bądź czujny.",IN_A_DAY:"Zazwyczaj odpowiadamy w przeciągu jednego dnia. Bądź czujny."},drop_email:{header:"Witaj",c2a:"Podaj nam swój adres email, żebyśmy mogli Cię powiadomić, gdy odpowiemy.",sumup:"Dziękujemy, dostaniesz powiadomienie na ten adres email."},send_a_message:"Napisz wiadomość ...",close:"Zamknij",start_new_conversation:"Zacznij rozmowę",message_status:{delivered:"Dostarczona",was_read:"Odczytana"}},en:{repeat_under_time:{FEW_MINUTES:"Typically replies in a few minutes. Don't miss their reply.",FEW_HOURS:"Typically replies in a few hours. Don't miss their reply.",IN_A_DAY:"Typically replies in a day. Don't miss their reply."},drop_email:{header:"Hello there!",c2a:"Let us notify you by email when we reply.",sumup:"Thank you, you will receive notification to this e-mail."},send_a_message:"Send a message ...",close:"Close",start_new_conversation:"Start new conversation",message_status:{delivered:"Delivered",was_read:"Read"}},de:{repeat_under_time:{FEW_MINUTES:"{{name}} antwortet in der Regel innerhalb ein paar Minuten. Bitte, sei wachsam.",FEW_HOURS:"{{name}} antwortet in der Regel innerhalb ein paar Stunden. Bitte, sei wachsam.",IN_A_DAY:"{{name}} antwortet in der Regel innerhalb 24 Stunden. Bitte, sei wachsam."},drop_email:{header:"Hallo",c2a:"Gib uns deine E-mail Adresse, damit wir dich über unsere Antwort informieren könnten.",sumup:"Vielen Dank, du bekommst eine Benachrichtigung auf diese Email Adresse!"},send_a_message:"Schreib eine Nachricht ...",close:"Schließ",start_new_conversation:"Starte ein Gespräch"},fr:{repeat_under_time:{FEW_MINUTES:"{{name}} normalement il répond en quel que minute. Être vigilant.",FEW_HOURS:"{{name}} normalement il répond en quel que heure. Être vigilant.",IN_A_DAY:"{{name}} normalement répond en un jour. Être vigilant."},drop_email:{header:"Bienvenue",c2a:"S'il vous plaît donnez-nous votre courrier afin que nous puissions vous informer de la réponse.",sumup:"Merci vous recevoir une notification à cette courrier."},send_a_message:"Écrire message ...",close:"Ferme",start_new_conversation:"Ouvrir conversation"},ru:{repeat_under_time:{FEW_MINUTES:"{{name}} oбычо отвечает в течение нескольких минут. Ждите на наш ответ.",FEW_HOURS:"{{name}} oбычо отвечает в течение нескольких часов. Ждите на наш ответ.",IN_A_DAY:"{{name}} oбычо отвечает в течение нескольких суток. Ждите на наш ответ."},drop_email:{header:"Привет",c2a:"Дайте нам Ваш адрес e-mail, чтовы мы могли Вам отправить ответ.",sumup:"Спасибо, вы получите сообщение на этот адрес e-mail."},send_a_message:"Отправьте сообщение ...",close:"Закройте",start_new_conversation:"Начните новый чат"},cz:{repeat_under_time:{FEW_MINUTES:"{{name}} obvykle reaguje během několika minut. Buď ve střehu.",FEW_HOURS:"{{name}} obvykle reaguje během několika hodin. Buď ve střehu.",IN_A_DAY:"{{name}} obvykle reaguje během jednoho dne. Buď ve střehu."},drop_email:{header:"Vítej",c2a:"Dej nám svoji e-mailovou adresu, abychom Tě infromovali o naší odpovědí.",sumup:"Děkuji, dostanete upozornění na tuto e-mailovou adresu."},send_a_message:"Napiš zprávu ...",close:"Zavři",start_new_conversation:"Začni konverzaci"},it:{repeat_under_time:{FEW_MINUTES:"{{name}} risponde in genere nel giro di pochi minuti. Essere attenti.",FEW_HOURS:"{{name}} risponde in genere entro poche ore. Essere attenti.",IN_A_DAY:"{{name}} risponde in genere entro al giorno. Essere attenti."},drop_email:{header:"Benvenuto",c2a:"Dacci il tuo indirizzo di posta elettronica in modo che possiamo comunicheremo quando la risposta.",sumup:"Grazie, si otterrà una notifica a questo indirizzo email."},send_a_message:"Scrivere un messaggio ...",close:"Vicino",start_new_conversation:"Avviare la conversazione"},hu:{repeat_under_time:{FEW_MINUTES:"{{name}} rendszerint reagál néhány percen belül. Légy éber.",FEW_HOURS:"{{name}} rendszerint reagál néhány órán belül. Légy éber.",IN_A_DAY:"{{name}} rendszerint reagál napi egyszeri. Légy éber."},drop_email:{header:"Helló",c2a:"Kérjük, adja meg az email címét, hogy értesítsük Önt a válasz",sumup:"Köszönöm, akkor kapok egy értesítést, hogy az email címre."},send_a_message:"Írj egy üzenetet ...",close:"Bezárás",start_new_conversation:"Indítsunk el egy beszélgetést"},es:{repeat_under_time:{FEW_MINUTES:"{{name}} en general responde en unos pocos minutos. Toma la atencion.",FEW_HOURS:"{{name}} en general responde a las pocas horas. Toma la atencion.",IN_A_DAY:"{{name}} en general corresponde a un día. Toma la atencion."},drop_email:{header:"Bienvenido",c2a:"Escribe su dirección de correo electrónico para que podamos notificarle cuando contesta.",sumup:"Gracias, usted recibirá una notificación a esta dirección de correo electrónico."},send_a_message:"Escribie un mensaje...",close:"Cerrar",start_new_conversation:"Iniciar una conversación"}},trans:function(key){var lang,val;lang=0<MessengerManager.settings.lang.length?MessengerManager.settings.lang[0].language.substring(0,2):Core.getOption("lang").substring(0,2);try{return val=eval("MessengerConfig.lang[lang]."+key),val||key}catch(e){return key}}},MessengerManager={_clientJsUrl:"https://messenger.snrbox.com/socket.io/socket.io.js",widget:null,isWidgetOpened:!1,forceWidgetHide:!1,retryConnCount:0,wasInitialized:!1,lastVendor:null,lastMessageAuthor:null,settings:null,lastReadTime:0,numUnreadedMsg:0,primaryVendor:[],dsVendors:{},dsTeamVendor:null,isDropEmailBoxDisplayed:!1,autoBotScenarioCapping:{after_1s:!1,after_2s:!1},callbackStack:{onOpen:function(){},onClose:function(){},onMessageSend:function(){},onMessageReceived:function(){}},primarySocketDataFrame:function(){return new Promise(function(t,n){return ClientManager.getCurrentClient().then(function(e){var t,n,r;return t=new Date,n={uuid:e.permUuid,role:"client"},r={roomData:{roomIndex:"default",roomHash:SocketManager.getConnectionRoomHash(),owner:n},options:Core.getOption(),clientData:e,author:{role:"client"},time:t.getTime(),trackerKey:Auth.trackerKey()},dump.log("MessengerManager:primarySocketDataFrame:",r),Promise.resolve(r)}).then(function(e){return t({socket:MessengerManager.getSocket(),dataFrame:e})}).catch(function(e){return dump.error(e),n(e)})})},init:function(){return new Promise(function(n,r){if(!MessengerManager.wasInitialized)return dump.log("MessengerManager:init"),MessengerManager.widget=new MessengerWidget(Core.getOption()),MessengerManager.getConnectedSocket().then(function(e){var t;return dump.log("MessengerManager:init getSocket then",e),t=SocketManager.getConnectionMessageSettings(),e.on("vendorChatMessage",function(e){if(dump.log("MessengerManager:chatMessage"),"vendor"===e.author.role&&"undefined"===MessengerManager.getVendor(e.author.id))throw new Error("Vendor for message not exist on local store");if(MessengerManager.widget.addMessageRow(e),e.body)return MessengerManager.callbackStack.onMessageReceived(e.body)}),e.on("messageStatus",function(e){return dump.log("MessengerManager:messageStatus",e),MessengerManager.widget.setMessageStatus(e)}),e.on("initClientServerConnection",function(e){if(dump.log("MessengerManager:initClientServerConnection"),!e.trackerKey||Auth.trackerKey()===e.trackerKey)return MessengerManager.wasInitialized?void 0:MessengerManager.wasInitialized=!0;dump.log("MessengerManager:TrackerKey mismatch!!!")}),MessengerManager.settings=t.config.settings,MessengerManager.allowInitWidget(MessengerManager.settings).then(function(){return MessengerManager.primaryVendor=[{name:MessengerManager.settings.name,avatar:MessengerManager.settings.avatar,type:"TEAM"}],MessengerManager.widget.render()}).then(function(){return dump.log("MessengerManager:initClientServerConnection:allowInitWidget:setVendors"),t.lastReadTime&&(MessengerManager.lastReadTime=parseInt(t.lastReadTime[t.roomHash])),MessengerManager.setVendors(MessengerManager.primaryVendor)}).then(function(){return dump.log("MessengerManager:initClientServerConnection:allowInitWidget:setAvatars"),MessengerManager.widget.setAvatars(MessengerManager.primaryVendor),0<MessengerManager.settings.lang.length&&MessengerManager.widget.addIntroText(MessengerManager.settings.lang[0].intro_text),dump.log("MessengerManager:initClientServerConnection:allowInitWidget:setHeader"),MessengerManager.widget.setHeader(MessengerManager.settings.name,MessengerManager.settings.repeat_under_time,MessengerManager.dsTeamVendor)}).then(function(){return dump.log("MessengerManager:initClientServerConnection:allowInitWidget:initLuncherMessage"),MessengerManager.widget.initLuncherMessage(t),MessengerManager.forceWidgetHide||MessengerManager.widget.show(),Promise.resolve()}).then(function(){return n()}).catch(function(e){return dump.error(e),SocketManager.closeConnectedSocket(),r(e)})}).catch(function(e){return dump.error(e),r(e)})})},allowInitWidget:function(n){return new Promise(function(e,t){return dump.log("MessengerManager:allowInitWidget:settings",n),n.enabled?"object"==typeof n.whitelist_domain&&null!==n.whitelist_domain&&n.whitelist_domain.indexOf("http://"+document.location.host)<0&&n.whitelist_domain.indexOf("https://"+document.location.host)<0&&n.whitelist_domain.indexOf(document.location.host)<0&&0<n.whitelist_domain.length?(dump.log("MessengerManager:allowInitWidget: NOT ALLOWED TO INIT - Domain is not defined on whitelist."),t(new Error("Domain not defined on whitelist"))):(dump.log("MessengerManager:allowInitWidget: Success"),e()):(dump.log("MessengerManager:allowInitWidget: NOT ALLOWED TO INIT - Widget is disable."),t(new Error("Messenger widget disabled in settings")))})},hide:function(){if(MessengerManager.forceWidgetHide=!0,dump.log("MessengerWidget::MessengerManager.forceWidgetHide:hide",MessengerManager.forceWidgetHide),MessengerManager.widget)return MessengerManager.widget.hide()},show:function(){if(MessengerManager.forceWidgetHide=!1,dump.log("MessengerWidget::MessengerManager.forceWidgetHide:show",MessengerManager.forceWidgetHide),MessengerManager.widget)return MessengerManager.widget.show()},open:function(){return MessengerManager.widget.open()},onOpen:function(e){return MessengerManager.callbackStack.onOpen=e},close:function(){return MessengerManager.widget.close()},onClose:function(e){return MessengerManager.callbackStack.onClose=e},onMessageSend:function(e){return MessengerManager.callbackStack.onMessageSend=e},onMessageReceived:function(e){return MessengerManager.callbackStack.onMessageReceived=e},setVendors:function(a){return new Promise(function(e,t){var n,r,i,o;for(n=i=0,o=a.length;i<o;n=++i)"TEAM"===(r=a[n]).type&&(MessengerManager.dsTeamVendor=r),MessengerManager.dsVendors[r.id]=r;return e()})},getVendor:function(e){return MessengerManager.dsVendors[e]},pushMessage:function(t,n){return MessengerManager.primarySocketDataFrame().then(function(e){return dump.log("MessengerManager:pushMessage",e.dataFrame),e.dataFrame.body=t,e.dataFrame.type="message",e.dataFrame.uuid=MessengerManager.generateMessageUUID(),n&&MessengerManager.widget.addMessageRow(e.dataFrame),e.socket.emit("clientChatMessage",e.dataFrame),MessengerWidget.prototype.runAutoBotScenario(),MessengerManager.callbackStack.onMessageSend(t)})},pushIsWritingStatus:function(t){return MessengerManager.primarySocketDataFrame().then(function(e){return e.dataFrame.isWriting=t,e.socket.emit("isWritingStatus",e.dataFrame)})},pushUpdateMessage:function(t,n,r){return MessengerManager.primarySocketDataFrame().then(function(e){return e.dataFrame.uuid=t,e.dataFrame.index=n,e.dataFrame.bodyNewValue=r,e.socket.emit("clientUpdateMessage",e.dataFrame)})},pushClientLastMessageWasRead:function(){return MessengerManager.primarySocketDataFrame().then(function(e){return MessengerManager.widget.budgeUpdate().reset(),e.socket.emit("clientLastMessageWasRead",e.dataFrame)})},pushAutoBotScenario:function(t){return MessengerManager.primarySocketDataFrame().then(function(e){return e.dataFrame.uuid=MessengerManager.generateMessageUUID(),e.dataFrame.intervalTimeFlag=t,e.dataFrame.lastMessageAuthor=MessengerManager.lastMessageAuthor,e.dataFrame.lastVendor=MessengerManager.lastVendor,e.dataFrame.teamVendor=MessengerManager.dsTeamVendor,e.dataFrame.isDropEmailBoxDisplayed=MessengerManager.isDropEmailBoxDisplayed,e.socket.emit("autoBotScenario",e.dataFrame)})},getConnectedSocket:function(){return void 0===SocketManager?Promise.reject(new Error("Socket module not defined")):SocketManager.getConnectedSocket()},getSocket:function(){return void 0===SocketManager?Promise.reject(new Error("Socket module not defined")):SocketManager.getSocket()},generateMessageUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t;return t=16*Math.random()|0,("x"===e?t:3&t|8).toString(16)})}},MessengerWidget=function(e){this.options=e||{},this.msgTextarea=null,this.luncher=null,this.messagesContainer=null,this.messagesUploadInput=null,this.launcherBadge=null,this.lastAvatarHendler=null,this.lastMessageHendler=null,this.prevDate=0},MessengerWidget.prototype.render=function(){var h;return h=this,new Promise(function(e,t){var n,r,i,o,a,s,c,u,l,d;dump.log("MessengerWidget:render",h),r='<div class="snrs-messenger-conteiner snrs-messenger-hide" id="snrs-messenger">\n    <div id="snrs-messenger-archive-list"></div>\n    <div class="snrs-messenger-conversation" style="display:none;">\n        <div id="snrs-messanger-header" class="snrs-messanger-header">\n            <a class="snrs-messanger-client-list-btn">Close</a>\n            <div id="snrs-messanger-title" class="snrs-messanger-user-title snrs-flexbox">\n                <div class="snrs-messanger-user-title__item">\n                    <h2></h2>\n                    <span class="snrs-messanger-users-status snrs-messanger--is-active"></span>\n                </div>\n                <span id="snrs-messanger-header-avatar"></span>\n                <span id="snrs-messenger-header-close-btn"></span>\n            </div>\n        </div>\n        <div class="snrs-messanger-body" id="snrs-messanger-body">\n            <div id="snrs-messanger-team-profile">\n                <ul id="snrs-messanger-team-avatar-container"></ul>\n            </div>\n            <div class="conversation-list snrs-conversation-list">\n                <div class="snrs-chat-header">\n                    <a class="snrs-messanger-client-list-btn snrs-messanger-client-list-btn--close">'+MessengerConfig.trans("close")+'</a>\n                    <p class="title snrs-messenger-title snrs-default__item">Conversations</p>\n                    <a href="" class="snrs-default__item snrs-btn-new-conversation">'+MessengerConfig.trans("start_new_conversation")+'</a>\n                </div>\n                <div class="snrs-messenger-chat-body__item snrs-flexbox">\n                    <div class="snrs-messenger-chat-body--photo">\n                        <img src="" height="40" width="40">\n                        <span class="snrs-messenger-available snrs-is-visible"></span>\n                    </div>\n                    <div class="snrs-messenger-chat-body--content snrs-flexbox snrs-flex__item">\n                        <div class="snrs-flex__item">\n                            <p class="name snrs-messenger-name">Kevin Bennet</p>\n                            <span class="snrs-text"></span>\n                        </div>\n                        <div class="snrs-flex__item time snrs-messenger-time">\n                            <time>2:55 pm</time>\n                            <span class="snrs-messenger-circle"></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="snrs-messages-list-conteiner">\n                <div id="snrs-message-list"></div>\n            </div>\n            \x3c!--\n            <div class="snrs-messanger-draw-container snrs-message-inner-wrapper">\n              <div class="snrs-messanger-circle-draw" id="c1"></div>\n              <div class="snrs-messanger-circle-draw" id="c2"></div>\n              <div class="snrs-messanger-circle-draw" id="c3"></div>\n              <span><b>Jonh Doe</b> and <b>Anna Bloom</b> are typing</span>\n            </div> --\x3e\n        </div>\n        <form id="snrs-messenger-form" enctype="multipart/form-data">\n            <div id="snrs-textarea-wrapper" class="snrs-textarea-wrapper">\n                <textarea rows="1" id="snrs-messenger-textarea" placeholder="'+MessengerConfig.trans("send_a_message")+'"></textarea>\n                <div class="snrs-messenger-textarea-btn">\n                    <button id="emojione-luncher" class="snrs-messenger-textarea-btn-new-conversation"></button>\n                    <button id="snrs-messenger-textarea-btn-attachement" class="snrs-messenger-textarea-btn-attachement"></button>\n                </div>\n                <div id="snrs-emotjione" class="snrs-emotjione snrs-slide-animation">\n                    <ul id="emojione-list"">\n                    <div class="snrs-arrow-down"></div>\n                    </ul>\n                </div>\n            </div>\n            <input id="snrs-upload-input" type="file" name="uploads[]" style="display: none;">\n        </form>\n    </div>\n</div>',(d=document.createElement("div")).innerHTML=r,document.body.appendChild(d),l=document.getElementById("snrs-textarea-wrapper"),u=document.getElementById("snrs-messanger-body"),n=document.getElementById("snrs-messenger-form"),c=document.getElementById("snrs-messenger-textarea-btn-attachement"),h.msgTextarea=document.getElementById("snrs-messenger-textarea"),h.luncher=document.querySelectorAll(".snrs-messenger-mode-vendor .snrs-messenger-launcher")[0],h.messagesContainer=document.querySelectorAll(".snrs-messenger-conteiner")[0],h.messagesUploadInput=document.getElementById("snrs-upload-input"),h.defineMomentLocale(),dump.log("MessengerWidget::render:start"),h.msgTextarea.addEventListener("input",function(){l.style.height=h.msgTextarea.style.height,u.style.bottom=n.offsetHeight+10+"px"}),_.addEvent(c,"click",function(e){h.messagesUploadInput.value=null,h.messagesUploadInput.click(),e.preventDefault()}),h.messagesUploadInput.addEventListener("change",function(){var e,t,n,a,r,s,i,o,c,u,l;for(u="https://api.snrbox.com/rtom/storages/messenger/upload?tracker="+Auth.trackerKey(),(l=new XMLHttpRequest).open("POST",u),n=new FormData,c=this.files,s=r=0,i=c.length;r<i;s=++r)a=c[s],e=new Date,t=URL.createObjectURL(a),o={time:e.getTime(),author:{role:"client"},body:{template:"templateUploadFile",params:{fileSrc:t,type:a.type,name:a.name}}},h.addMessageRow(o),n.append("uploads",a),dump.log("messagesUploadInput",a);return l.onload=function(e){var t,n,r,i,o;if(200===this.status){for(i=JSON.parse(this.response).result.files.uploads,o=[],s=t=0,n=i.length;t<n;s=++t)r={template:"templateUploadFile",params:{fileSrc:(a=i[s]).path.origin,name:a.name,type:a.type}},dump.log("MessengerWidget:messagesUploadInput:onload",r),o.push(MessengerManager.pushMessage(r,!1));return o}},l.send(n)}),a=o=0,i=3,s="none",h.msgTextarea.addEventListener("keydown",function(e){var t;13===e.keyCode&&""!==(t=h.msgTextarea.value.trim())&&t.length<2048&&(MessengerManager.pushMessage(t,!0),h.msgTextarea.value="",i=o=0,e.preventDefault())}),setInterval(function(){var e,t,n;if(n=document.activeElement===h.msgTextarea&&0<h.msgTextarea.value.length,e=a<5,t=h.msgTextarea.value.length!==o,i++,e&&n||t||i<3){if(h.msgTextarea.value.length===o?a++:(a=0,o=h.msgTextarea.value.length),"writing"!==s)return s="writing",dump.log("isWriting: TRUE send MONIT"),MessengerManager.pushIsWritingStatus(1)}else if("stop_writing"!==s&&"none"!==s)return s="stop_writing",dump.log("isWriting: FALSE send MONIT"),MessengerManager.pushIsWritingStatus(0)},1e3),h.generateEmojione(),dump.log("MessengerWidget::render:End"),e()})},MessengerWidget.prototype.defineMomentLocale=function(){var n,r,i,e;"pl"===(0<MessengerManager.settings.lang.length?MessengerManager.settings.lang[0].language.substring(0,2):Core.getOption("lang").substring(0,2))&&(n="styczeń_luty_marzec_kwiecień_maj_czerwiec_lipiec_sierpień_wrzesień_październik_listopad_grudzień".split("_"),r="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_września_października_listopada_grudnia".split("_"),i=function(e){return e%10<5&&1<e%10&&~~(e/10)%10!=1},e=function(e,t,n){var r;switch(r=e+" ",n){case"ss":return r+(i(e)?"sekundy":"sekund");case"m":return t?"minuta":"minutę";case"mm":return r+(i(e)?"minuty":"minut");case"h":return t?"godzina":"godzinę";case"hh":return r+(i(e)?"godziny":"godzin");case"MM":return r+(i(e)?"miesiące":"miesięcy");case"yy":return r+(i(e)?"lata":"lat")}},moment.defineLocale("pl",{months:function(e,t){return e?""===t?"("+r[e.month()]+"|"+n[e.month()]+")":/D MMMM/.test(t)?r[e.month()]:n[e.month()]:n},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_paź_lis_gru".split("_"),weekdays:"niedziela_poniedziałek_wtorek_środa_czwartek_piątek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_śr_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_Śr_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dziś o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedzielę o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W środę o] LT";case 6:return"[W sobotę o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zeszłą niedzielę o] LT";case 3:return"[W zeszłą środę o] LT";case 6:return"[W zeszłą sobotę o] LT";default:return"[W zeszły] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:e,m:e,mm:e,h:e,hh:e,d:"1 dzień",dd:"%d dni",M:"miesiąc",MM:e,y:"rok",yy:e},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}))},MessengerWidget.prototype.scrollToBottom=function(){var e;(e=document.getElementById("snrs-messanger-body")).scrollTop=e.scrollHeight},MessengerWidget.prototype.scrollTollbar=function(){var e,t,n;n=document.getElementById("snrs-messanger-body"),t=document.getElementById("snrs-messanger-header"),e=document.getElementById("snrs-messanger-contact-form"),n.onscroll=function(){20<n.scrollTop?(t.className="snrs-messanger-header snrs-is-scrolled",e&&(e.className="snrs-messanger-contact-form snrs-show-element--slide")):(t.className="snrs-messanger-header",e&&(e.className="snrs-messanger-contact-form"))}},MessengerWidget.prototype.initLuncherMessage=function(P){var w;return w=this,new Promise(function(e,t){var n,r,i,o,a,s,c,u,l,d,h,p,f,g,m,y,b,v,S,C;for((d=document.createElement("div")).className="snrs-messenger-launcher",w.messagesContainer.appendChild(d),(h=document.createElement("div")).id="snrs-messenger-launcher-button",d.appendChild(h),n=document.getElementById("snrs-messanger-header-avatar"),i=document.getElementById("snrs-messenger-header-close-btn"),(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<640?(n.style.display="none",i.style.display="block"):(n.style.display="block",i.style.display="none"),(r=document.createElement("span")).id="snrs-messenger-launcher-badge",d.appendChild(r),(a=document.createElement("div")).id="snrs-messenger-launcher-info",d.appendChild(a),f=document.getElementById("snrs-messanger-body"),b=document.getElementsByClassName("snrs-messenger-conversation"),m=document.getElementsByClassName("snrs-messanger-client-list-btn"),y=document.getElementsByClassName("snrs-messanger-client-list-btn--close"),g=document.getElementsByClassName("conversation-list"),v=document.getElementsByClassName("snrs-messanger-body"),S=document.getElementById("emojione-luncher"),l=c=o=0,p=(C=P.historyMessages).length;c<p;l=++c)s=C[l],u=JSON.parse(s),w.addMessageRow(u).then(function(){if(++o===P.historyMessages.length&&"client"===u.author.role)return dump.log("self.setMessageStatus",{uuid:u.uuid,time:u.time,status:"delivered"}),w.setMessageStatus({uuid:u.uuid,time:u.time,status:"delivered"})});return dump.log("MessengerWidget::initLuncherMessage:step2"),void 0!==P.avatar&&(h.style.background="url("+P.avatar+") no-repeat top center / 55px 55px"),_.addEvent(h,"click",function(e){!(b[0].style.display="block")===MessengerManager.isWidgetOpened?(MessengerManager.pushClientLastMessageWasRead(),MessengerWidget.prototype.scrollToBottom(),d.className="snrs-messenger-launcher snrs-messenger-launcher-button-active",b[0].className="snrs-messenger-conversation snrs-messenger-sheet-active",w.onOpen()):(d.className="snrs-messenger-launcher",b[0].className="snrs-messenger-conversation",w.onClose())}),_.addEvent(i,"click",function(e){b[0].style.display="none",!0===MessengerManager.isWidgetOpened?(d.className="snrs-messenger-launcher",b[0].className="snrs-messenger-conversation",w.onClose()):(d.className="snrs-messenger-launcher snrs-messenger-launcher-button-active",b[0].className="snrs-messenger-conversation snrs-messenger-sheet-active",w.onOpen())}),_.addEvent(m[0],"click",function(e){"conversation-list"===g[0].className?(g[0].className="conversation-list snrs-conversation-list--open",v[0].className="snrs-messanger-body snrs-scroll-hidden"):(g[0].className="conversation-list",v[0].className="snrs-messanger-body")}),_.addEvent(y[0],"click",function(e){g[0].className="conversation-list",v[0].className="snrs-messanger-body"}),(f=document.getElementsByClassName("snrs-messanger-body")[0]).addEventListener("mousewheel",function(e){f.clientHeight+f.scrollTop+e.deltaY>=f.scrollHeight?(e.preventDefault(),f.scrollTop=f.scrollHeight):f.scrollTop+e.deltaY<=0&&(e.preventDefault(),f.scrollTop=0)},!1),_.addEvent(S,"click",function(e){document.getElementById("snrs-emotjione").classList.toggle("snrs-slide-animation--visible"),e.preventDefault()}),_.addEvent(f,"click",function(e){document.getElementById("snrs-emotjione").classList.remove("snrs-slide-animation--visible")}),dump.log("MessengerWidget::initLuncherMessage:step3"),e()})},MessengerWidget.prototype.initFullWindowMessenger=function(e){var r;return r=this,new Promise(function(e,t){var n;n=document.getElementsByClassName("snrs-messenger-conversation"),dump.log("MessengerWidget:toVendorMode",r.luncher),n[0].className="snrs-messenger-conversation snrs-messenger-sheet-active",r.luncher.remove()})},MessengerWidget.prototype.generateEmojione=function(){var e,t,n,r,i,o;for(r=this,i=[":smiley:",":laughing:",":wink:",":disappointed:",":joy:",":cry:",":heart:",":broken_heart:",":kissing_heart:",":dizzy_face:",":sunglasses:",":confused:",":stuck_out_tongue:",":open_mouth:",":thumbsup:",":thumbsdown:",":ok_hand:",":muscle:",":angry:",":sob:"],emojione.ascii=!0,o=document.getElementById("emojione-list"),t=0;t<i.length;)(n=document.createElement("li")).setAttribute("data-emojione",i[t]),n.setAttribute("title",emojione.toShort(i[t])),o.appendChild(n),e=emojione.shortnameToImage(i[t]),n.innerHTML=e,_.addEvent(n,"click",function(e){return r.msgTextarea.value+=this.getAttribute("data-emojione"),document.getElementById("emojione-luncher").click(),r.msgTextarea.focus()}),t++;return dump.log("MessengerWidget:generateEmojione")},MessengerWidget.prototype.addMessageRow=function(h){var p;return p=this,new Promise(function(e,t){var n,r,i,o,a,s,c,u,l,d;h.body&&(dump.log("MessengerWidget:addMessageRow",h),u=document.getElementById("snrs-message-list"),o=document.createElement("div"),document.getElementsByClassName("snrs-msg-group"),432e5<h.time-p.prevDate&&((r=document.createElement("div")).className="snrs-message-divider",u.appendChild(r),(i=document.createElement("span")).innerText=moment(h.time).subtract(0,"days").calendar(),r.appendChild(i)),o.className="snrs-msg-group snrs-msg-group",h.uuid&&o.setAttribute("id",h.uuid),h.index&&o.setAttribute("data-index",h.index),o.setAttribute("title",moment(moment.unix(h.time/1e3).format()).calendar()),a=document.createElement("div"),h.body.template?a.className="snrs-message-type snrs-"+h.body.template:a.className="snrs-message-type","vendor"===h.author.role?(void 0===(d=MessengerManager.getVendor(h.author.id))&&(d=MessengerManager.dsTeamVendor),p.lastAvatarHendler&&(p.lastAvatarHendler.style.visibility="hidden"),l="remote",(n=p.preperAvatarObj(d,"span")).setAttribute("class","snrs-messenger-avatar"),a.appendChild(n),"bot_message"===h.type?MessengerWidget.prototype.setHeader(d.name,0,d):MessengerWidget.prototype.setHeader(d.name,h.time/1e3,d)):l="local",o.className+="-"+l,p.lastAvatarHendler=n,p.prevDate=h.time,MessengerManager.lastMessageAuthor=h.author,u.appendChild(o),o.appendChild(a),setTimeout(function(){return o.classList.add("snrs-slide-animation--visible")},50),(s=document.createElement("div")).className="snrs-message-inner-wrapper",s.innerHTML=MessengerWidget.prototype.dispatchBody(h.body),a.appendChild(s),h.time&&((c=document.createElement("time")).setAttribute("data-time",h.time),c.className="snrs-message-inner-time",c.innerText=moment(h.time).fromNow(),a.appendChild(c)),MessengerWidget.prototype.scrollTollbar(),!0===MessengerManager.isWidgetOpened?(MessengerManager.pushClientLastMessageWasRead(),MessengerWidget.prototype.scrollToBottom()):MessengerWidget.prototype.budgeUpdate(h.time)),e()})},MessengerWidget.prototype.budgeUpdate=function(e){var t;return this.launcherBadge=document.getElementById("snrs-messenger-launcher-badge"),e&&!1===MessengerManager.isWidgetOpened&&(t="",e>MessengerManager.lastReadTime&&(this.launcherBadge.className="snrs-messenger-badge-active",MessengerManager.numUnreadedMsg++,t=MessengerManager.numUnreadedMsg,9<MessengerManager.numUnreadedMsg&&(t="9+")),this.launcherBadge.innerHTML=t),{reset:function(){var e;return(e=document.getElementById("snrs-messenger-launcher-badge")).className="",MessengerManager.numUnreadedMsg=0,e.innerHTML=""}}},MessengerWidget.prototype.setMessageStatus=function(e){var t,n,r;if(dump.log("MessengerWidget:setMessageStatus:",e),e.status&&e.uuid&&e.time&&(n=document.getElementById(e.uuid)))return t=MessengerConfig.trans("message_status."+e.status),(r=n.getElementsByClassName("snrs-message-inner-time")[0]).setAttribute("data-time",e.time),r.innerHTML="<span>"+t+"</span> "+moment(e.time).format("HH:mm")},MessengerWidget.prototype.dispatchBody=function(e){return e=MessengerWidget.prototype[e.template]?MessengerWidget.prototype[e.template](e):MessengerWidget.prototype.urlify(Utils.escapeHTML(e)),emojione.ascii=!0,e=emojione.shortnameToImage(e)},MessengerWidget.prototype.templateUploadFile=function(e){var t,n,r;return 0<=e.params.type.indexOf("image")?((r=document.createElement("img")).src=e.params.fileSrc,n='<span class="snrs-messanger-upload-item-image"><a target="_blank" href="'+e.params.fileSrc+'">'+r.outerHTML+"</a></span>"):(t=(t=e.params.name.split("."))[t.length],["pdf","xml","xls","xlsx","csv","zip","rar","doc","docx","pptx","ppt","txt"].indexOf(t)<0&&(t="application"),n='<span class="snrs-messanger-upload-item-'+t+'"><a href="'+e.params.fileSrc+'">'+e.params.name+"</a></span>"),n},MessengerWidget.prototype.templateDropEmailForm=function(e){var t,n,r,i,s;return i='<span class="snrs-messenger--emialico"></span>\n<p>'+MessengerConfig.trans("drop_email.header")+"</p>\n<span>"+MessengerConfig.trans("drop_email.c2a")+'</span>\n<ul class="snrs-messenger--simple-list">\n    <li id="snrs-messenger-tab-drop-email"><a href="#" class="active">Email</a></li>\n    <li id="snrs-messenger-tab-drop-sms"><a href="#">SMS</a></li>  \n    <li id="snrs-messenger-tab-drop-call"><a href="#">Call</a></li>\n</ul>\n<form method="" class="snrs-messanger-contact-form__item snrs-flexbox">\n    <input placeholder="Your email" type="email" name="email" id="snr-messenger-drop-input" class="snrs-messanger-contact-form-input">\n    <input type="button" value="OK" class="snrs-messanger-contact-form-button">\n</form>',s='<span class="snrs-messenger--emialico"></span>\n<span>'+MessengerConfig.trans("drop_email.sumup")+'</span>\n<span id="snr-messenger-drop-email-log">'+e.params.email+"</span>",e.params.email?(t="snrs-messanger-contact-form snrs-messanger-contact-log",r=s):(t="snrs-messanger-contact-form",r=i),n='<div id="snrs-messanger-contact-form" class="'+t+'">\n    '+r+"\n</div>",_.addEvent(document,"click",function(e){var o,a;if("snrs-messanger-contact-form-button"===e.target.className)return a=document.getElementById("snr-messenger-drop-input"),/\S+@\S+\.\S+/.test(a.value)?((o=document.getElementById("snrs-messanger-contact-form")).innerHTML=s,o.setAttribute("class","snrs-messanger-contact-form snrs-messanger-contact-log"),EventManager.sendFormData("messenger-drop-email",{email:a.value},null,null,function(e){var t,n,r,i;return ClientManager.getCurrentClient()._result.formEmailDrop=a.value,i=o.parentNode.parentNode.parentNode.getAttribute("id"),r=o.parentNode.parentNode.parentNode.getAttribute("data-index"),n=new Date,t={template:"templateDropEmailForm",params:{email:a.value,time:n.getTime()}},MessengerManager.pushUpdateMessage(i,r,t),document.getElementById("snr-messenger-drop-email-log").innerText=a.value})):document.getElementById("snrs-messanger-contact-form").setAttribute("class","snrs-messanger-contact-form snrs-messenger-invalid-email")}),MessengerManager.isDropEmailBoxDisplayed=!0,n},MessengerWidget.prototype.templateRepeatUnderMessage=function(e){return MessengerConfig.trans("repeat_under_time."+MessengerManager.settings.repeat_under_time).replace(/{{name}}/g,MessengerManager.settings.name)},MessengerWidget.prototype.runAutoBotScenario=function(){if(MessengerManager.autoBotScenarioCapping.after_1s||(MessengerManager.autoBotScenarioCapping.after_1s=!0,setTimeout(function(){return MessengerManager.pushAutoBotScenario("after_1s")},1e3)),!MessengerManager.autoBotScenarioCapping.after_2s)return MessengerManager.autoBotScenarioCapping.after_2s=!0,setTimeout(function(){return MessengerManager.pushAutoBotScenario("after_2s")},2e3)},MessengerWidget.prototype.addIntroText=function(e){var t,n;if(0<e.length)return t=document.getElementById("snrs-messanger-team-profile"),(n=document.createElement("span")).innerText=e,t.appendChild(n)},MessengerWidget.prototype.setHeader=function(n,r,i){return new Promise(function(e,t){return dump.log("MessengerWidget:setHeader:vendor:",n,r,i),MessengerWidget.prototype.setHeaderTitle(n),MessengerWidget.prototype.setHeaderActiveTime(r),MessengerWidget.prototype.setHeaderAvatar(i),e()})},MessengerWidget.prototype.setHeaderTitle=function(e){return this,document.querySelectorAll("#snrs-messanger-title h2")[0].innerText=e},MessengerWidget.prototype.setHeaderActiveTime=function(e){var t,n;return n=new Date,t=parseInt((parseInt(n.getTime())-1e3*parseInt(e))/1e3),e=0<e&&t<300?moment(moment.unix(e).format()).fromNow():MessengerConfig.trans("repeat_under_time."+MessengerManager.settings.repeat_under_time),document.querySelectorAll("#snrs-messanger-title span")[0].innerText=e},MessengerWidget.prototype.setHeaderAvatar=function(e){var t;return t=document.getElementById("snrs-messanger-header-avatar"),this.preperAvatarObj(e,null,t)},MessengerWidget.prototype.setButtonForNewConveration=function(e,t){return this,document.querySelectorAll("#snrs-messanger-title button")[0].innerText="Start new conversation"},MessengerWidget.prototype.setAvatars=function(e){var t,n,r,i,o,a;for(this,t=document.getElementById("snrs-messanger-team-avatar-container"),a=[],n=i=0,o=e.length;i<o;n=++i)r=e[n],a.push(t.appendChild(this.preperAvatarObj(r,"li")));return a},MessengerWidget.prototype.preperAvatarObj=function(e,t,n){var r;return void 0===n&&(n=document.createElement(t)),e.avatar?(n.title=e.name,n.style.backgroundImage="url('"+e.avatar+"')"):e.name&&(r=e.name.split(" "),n.title=e.name,n.textContent=r[1]?[r[0][0],r[1][0]].join(""):r[0][0]),n},MessengerWidget.prototype.urlify=function(e){var t;return t=/(((https?:\/\/)|(www\.))[^\s]+)/g,e.replace(t,function(e,t,n){return'<a href="'+("www."===n?"http://"+e:e)+'" target="_blank">'+e+"</a>"})},MessengerWidget.prototype.show=function(){var e;if(e=document.getElementById("snrs-messenger"))return e.setAttribute("class","snrs-messenger-conteiner snrs-messenger-show")},MessengerWidget.prototype.hide=function(){var e;if(e=document.getElementById("snrs-messenger"))return e.setAttribute("class","snrs-messenger-conteiner snrs-messenger-hide")},MessengerWidget.prototype.open=function(){if(!MessengerManager.isWidgetOpened)return document.getElementById("snrs-messenger-launcher-button").click()},MessengerWidget.prototype.close=function(){if(MessengerManager.isWidgetOpened)return document.getElementById("snrs-messenger-launcher-button").click()},MessengerWidget.prototype.onOpen=function(){return MessengerManager.isWidgetOpened=!0,MessengerManager.callbackStack.onOpen()},MessengerWidget.prototype.onClose=function(){return MessengerManager.isWidgetOpened=!1,MessengerManager.callbackStack.onClose()},SocketManager={_endpointUrl:"wss://messenger.snrbox.com",_socket:null,retryConnCount:0,reconnectConfig:{maxRetryAttempt:10,retryConnTime:1500},connectionInitialized:!1,_connectionMessageSettings:null,defaultOptions:{transports:["websocket"]},getIO:function(e,t){return io(e,t)},getSocket:function(){return null===SocketManager._socket&&(SocketManager._socket=SocketManager.getIO(SocketManager._endpointUrl,SocketManager.defaultOptions)),dump.log("SocketManager:getSocket",SocketManager._socket),SocketManager._socket},closeConnectedSocket:function(){if(null!==SocketManager._socket)return SocketManager._socket.close()},getConnectedSocket:function(){return Utils.persistentPromiseHandler("SocketManager:getConnectedSocket",function(t,n){return SocketManager.getSocket(),SocketManager.initSocket().then(function(e){return t(SocketManager._socket)}).catch(function(e){return dump.error(e),n(e)})})},initSocket:function(){return new Promise(function(r,i){return dump.log("SocketManager:initSocket"),SocketManager._socket.on("connect",function(){var n;return dump.log("SocketManager:initSocket connect"),n=SocketManager._socket,SocketManager.getClientData().then(function(t){return n.on("initClientServerConnectionTryRetry",function(e){return setTimeout(function(){if(SocketManager.retryConnCount++,dump.log("SocketManager:initClientServerConnectionTryRetry:"+SocketManager.retryConnCount),t.retryConnCount=SocketManager.retryConnCount,t.retryConnCount<=SocketManager.reconnectConfig.maxRetryAttempt&&n.emit("initClientConnection",t),t.retryConnCount>SocketManager.reconnectConfig.maxRetryAttempt)return n.close()},SocketManager.reconnectConfig.retryConnTime)}),n.on("disconnect",function(e){return dump.log("SocketManager:disconnect",e)}),n.on("connect_error",function(e){return dump.log("SocketManager:socket:connect_error",e)}),n.on("connect_timeout",function(e){return dump.log("SocketManager:socket:connect_timeout",e)}),n.on("error",function(e){return dump.log("SocketManager:socket:error",e)}),n.on("reconnect",function(e){return dump.log("SocketManager:socket:reconnect",e)}),n.on("reconnect_attempt",function(){return dump.log("SocketManager:socket:reconnect_attempt")}),n.on("reconnecting",function(e){return dump.log("SocketManager:socket:reconnecting",e)}),n.on("reconnect_error",function(e){return dump.log("SocketManager:socket:reconnect_error",e)}),n.on("reconnect_failed",function(){return dump.log("SocketManager:socket:reconnect_failed")}),n.on("initClientServerConnection",function(e){return dump.log("SocketManager:initClientServerConnection"),e.trackerKey&&Auth.trackerKey()!==e.trackerKey?(dump.log("SocketManager:TrackerKey mismatch!!!"),i(new Error("Tracker key mismatch for socket"))):SocketManager.connectionInitialized?void 0:(SocketManager.connectionInitialized=!0,dump.log("SocketManager:initClientServerConnection connection initialized",e,t),SocketManager.setConnectionMessageSettings(e),r(e))}),n.emit("initClientConnection",t,function(e){return dump.log("SocketManager:initClientConnection:callback",e)})}).catch(function(e){return dump.error(e),i(e)})})})},setConnectionMessageSettings:function(e){return SocketManager._connectionMessageSettings=e,SocketManager},getConnectionMessageSettings:function(){return SocketManager._connectionMessageSettings},getConnectionRoomHash:function(){return SocketManager._connectionMessageSettings?SocketManager._connectionMessageSettings.roomHash:null},getClientData:function(){return new Promise(function(n,e){return ClientManager.getCurrentClient().then(function(e){var t;return t={roomData:{roomIndex:"default",owner:{uuid:e.permUuid,role:"client"}},trackerKey:Auth.trackerKey(),source:window.location.href,retryConnCount:0},dump.log("SocketManager:getClientData",t),n(t)}).catch(e)})}},ErrorHandler.init({startTime:startDate.getTime()});try{var SyneriseSDKInterface={init:Core.init.bind(Core),auth:{apiKey:Auth.apiKey.bind(Auth),trackerKey:Auth.trackerKey.bind(Auth)},client:{getCurrentClient:ClientManager.getCurrentClient.bind(ClientManager),update:ClientManager.updateClientParams.bind(ClientManager),notify:ClientManager.notify.bind(ClientManager)},event:{track:EventManager.track.bind(EventManager),sendFormData:EventManager.sendFormData.bind(EventManager),trackCustomEvent:EventManager.trackCustomEvent.bind(EventManager)},dataLayer:{init:DataLayer.init.bind(DataLayer)},dynamicContent:{setCustomVariablesFunction:DynamicContentManager.setCustomVariablesFunction.bind(DynamicContentManager),get:ClientManager.getAndRenderDynamicContentsForClient.bind(ClientManager),getRendered:DynamicContentManager.getRenderedDynamicContent.bind(DynamicContentManager)},device:{getAcceptLanguageList:DeviceManager.getAcceptLanguageList.bind(DataLayer),getLanguage:DeviceManager.getLanguage.bind(DataLayer),getProtocol:DeviceManager.getProtocol.bind(DataLayer),getScreenInfo:DeviceManager.getScreenInfo.bind(DataLayer),isCrawler:DeviceManager.isCrawler.bind(DataLayer)},form:{marker:FormMarker.marker.bind(FormMarker),initMarker:FormMarker.init.bind(FormMarker)},core:{getVersion:Core.getVersion.bind(Core),getModuleName:Core.getModuleName.bind(Core),getFullVersion:Core.getFullVersion.bind(Core),getBuildTime:Core.getBuildTime.bind(Core),getBuildHash:Core.getBuildHash.bind(Core),getOption:Core.getOption.bind(Core)}};void 0!==WebPushManager&&(SyneriseSDKInterface.webPush={init:WebPushManager.init.bind(WebPushManager),checkSubscribeRequestNeed:WebPushManager.checkSubscribeRequestNeed.bind(WebPushManager),isWebPushSupported:WebPushManager.isWebPushSupported.bind(WebPushManager),isWebPushAppReady:WebPushManager.isWebPushAppReady.bind(WebPushManager),requestPermission:WebPushManager.requestPermission.bind(WebPushManager),subscribe:WebPushManager.subscribe.bind(WebPushManager),unsubscribe:WebPushManager.unsubscribe.bind(WebPushManager),getToken:WebPushManager.getToken.bind(WebPushManager),showNotification:WebPushManager.showNotification.bind(WebPushManager),onMessage:WebPushManager.onMessage.bind(WebPushManager),onWebPushSubscribe:WebPushManager.onWebPushSubscribe.bind(WebPushManager),onWebPushSubscribeBlock:WebPushManager.onWebPushSubscribeBlock.bind(WebPushManager),onWebPushSubscribeDiscard:WebPushManager.onWebPushSubscribeDiscard.bind(WebPushManager),onBrowserPermissionAgree:WebPushManager.onBrowserPermissionAgree.bind(WebPushManager),onBrowserPermissionBlock:WebPushManager.onBrowserPermissionBlock.bind(WebPushManager),onBrowserPermissionDiscard:WebPushManager.onBrowserPermissionDiscard.bind(WebPushManager)}),void 0!==MessengerManager&&(SyneriseSDKInterface.messenger={init:MessengerManager.init.bind(MessengerManager),hide:MessengerManager.hide.bind(MessengerManager),show:MessengerManager.show.bind(MessengerManager),open:MessengerManager.open.bind(MessengerManager),onOpen:MessengerManager.onOpen.bind(MessengerManager),close:MessengerManager.close.bind(MessengerManager),onClose:MessengerManager.onClose.bind(MessengerManager),onMessageSend:MessengerManager.onMessageSend.bind(MessengerManager),onMessageReceived:MessengerManager.onMessageReceived.bind(MessengerManager),socket:MessengerManager.getSocket.bind(MessengerManager)})}catch(e){dump.fatal(e)}var syneriseObjectNamespace=window.SyneriseObjectNamespace||"SR",syneriseObjectPrototype=window[syneriseObjectNamespace];window[syneriseObjectNamespace]=SyneriseSDKInterface}(window,void 0),void 0===SyneriseTC)var SyneriseTC;!function(){if("object"===(typeof SyneriseTC).toLowerCase())return console.error("WARNING: SyneriseTC is already initialized!");var u={config:null,providers:{native:null,evercookie:null},domain:null,init:function(e,t){(this.config=e).domain&&(this.domain=e.domain);var n=!0;for(var r in this.config.providers)if(this.config.providers.hasOwnProperty(r)){var i=void 0!==this.config.providers[r]?this.config.providers[r]:[];switch(r){case"evercookie":n=!1;var o=this,a=function(){void 0!==i.baseurl&&(i.baseurl=SyneriseTC.getProtocol()+"://"+SyneriseTC.getHost(SyneriseTC.dataType.staticFile)+i.baseurl),o.providers.evercookie=o.createEvercookieProvider(i),o.ready(t)};"undefined"!=typeof evercookie?(f.log("EVERCOOKIE IS COMPILED IN"),a()):SyneriseTC.appendJS(SyneriseTC.getProtocol()+"://"+SyneriseTC.getHost(SyneriseTC.dataType.staticFile)+"/evercookie/js/evercookie.js",a);break;case"native":this.providers.native=this.createNativeProvider(i)}}return($this=this).get("native","_snrs_sdk_domain",function(e){e&&($this.domain=e)}),n&&this.ready(t),this},ready:function(e){return"function"==typeof e&&e(),this},getDomain:function(){if(null!==this.domain)return this.domain;var e=document.location.hostname;return"localhost"===e?e:e="."+(e=e.replace(/^www\./i,""))},set:function(e,t,n,r,i,o,a){var s=l.get(e+t);void 0!==o&&o||(o=this.getDomain());var c="SET cookie [provider: "+e+'] "'+t+'" value: "'+n+'", exp: "'+r+'"';i&&(c+=', path: "'+i+'"'),o&&(c+=', domain: "'+o+'"'),f.log(c);var u=this.getProvider(e).set(t,n,r,i,o,a);return f.log("Cookie have been SET [provider: "+e+'] "'+t+'" in '+s.getElapsedTimeString()),u},get:function(t,n,r){var i=l.get(t+n);f.log("GET cookie [provider: "+t+'] "'+n+'"');var o=this;this.getProvider("native").get(n,function(e){e?(f.log('GOT cookie [provider: native] "'+n+'" with value: "'+e+'" in '+i.getElapsedTimeString()),r(e)):o.getProvider(t).get(n,function(e){f.log("GOT cookie [provider: "+t+'] "'+n+'" with value: "'+e+'" in '+i.getElapsedTimeString()),r(e)})})},remove:function(e,t){return f.log("REMOVE cookie [provider: "+e+'] "'+t+'"'),this.getProvider(e).remove(t,this.getDomain())},getProvider:function(e){return void 0!==this.providers[e]&&this.providers[e]?this.providers[e]:this.providers.native},createEvercookieProvider:function(e){return{driver:function(e){void 0!==e.domain&&e.domain||(e.domain=u.getDomain());var t=new evercookie(e);return t.evercookie_lso=function(e,t){},t.evercookie_cache=function(e,t){},t.evercookie_userdata=function(e,t){},t}(e),cookieReady:!1,cookieValue:null,set:function(e,t,n,r,i,o){return this.driver.set(e,t),this},get:function(e,t){return this.driver.get(e,t)},remove:function(e,t){return this.driver.set(e,null)}}},createNativeProvider:function(e){return{set:function(e,t,n,r,i,o){return void 0!==r&&r||(r="/"),r="; path="+r,i=void 0!==i&&i?"; domain="+i:"",o=void 0!==o&&o?"; secure":"",document.cookie=e+"="+t+"; expires="+n+i+r+o,this},get:function(e,t){var n="";if(""!==document.cookie)for(var r=document.cookie.split("; "),i=0;i<r.length;i++){var o=r[i].split("=")[0],a=r[i].split("=")[1];e===o&&(n=unescape(a))}t(n)},remove:function(e,t){return this.set(e,null,0,null,t)}}}},a={CoRtb:function(){return{init:function(e,r){d.get("//green.erne.co/synerise/cm?type=iframe",function(e){if(200===e.status){var t=e.getResponseHeader("rtb_c");if(f.log("XHR - CoRtb - rtb_c: "+t),t&&"null"!==t.toLowerCase()){r(t);var n=document.createElement("iframe");n.width=0,n.height=0,n.style="display: none; visibility: hidden; height: 0px; width: 0px;",n.onload=function(){(n.contentDocument||n.contentWindow.document).body.innerHTML=e.responseText,f.log("CookieMatching[CoRtb]: iframe loaded")},document.body.appendChild(n)}}else f.error("XHR - ERROR LOADING CoRtb COOKIE MATCHING !!!"),r(!1)},{})}}}},e={cookieMatchersPromise:null,loadedCookieMatchers:[],setCookieMatchersPromise:function(e){this.cookieMatchersPromise=e},getCookieMatchersPromise:function(){return this.cookieMatchersPromise},initCookieMatchers:function(){var t=this;f.log("initCookieMatchers",t.cookieMatchersPromise),t.cookieMatchersPromise&&t.cookieMatchersPromise.then(function(e){f.log("initCookieMatchers then",e),Array.isArray(e)&&e.forEach(function(e){t.initCookieMatching(e.name,e.auth)})})},initCookieMatching:function(e,i){f.log("CookieMatcher: Initializing `"+e+"`");var o=l.get("CookieMatcher["+e+"]"),t=new n(e);t.load(SyneriseTC.getUuid(),function(e){if(!1===e)return!1;var t=SyneriseTC.prepareUrl(SyneriseTC.dataType.traffic,"/external-client-mapping"),n={userGuid:i,uuid:SyneriseTC.getUuid(),externalIdentifier:e},r={tracker:SyneriseTC.trackerUID,ver:"1.0"};d.post(t,JSON.stringify(n),function(){o.log()},r,"application/json")}),this.loadedCookieMatchers.push(t)},resetCookieMatchers:function(){for(var e in this.loadedCookieMatchers)this.loadedCookieMatchers.hasOwnProperty(e)&&this.loadedCookieMatchers[e].resetCache()}};function n(r){var i="synerise-cookieMatch-"+r,o={expires:null,externalId:null};return{load:function(e,t){var n=function(){if(void 0===a[r])return f.error("CookieMatcher: `"+r+"` is not recognized!"),!1;var e=s.get(i);return e&&(o=JSON.parse(e)),o.expires>(new Date).getTime()?(f.balloon("CookieMatcher["+r+"] - cached! - "+e),!1):a[r]()}();if(!n)return t(!1),!1;n.init(e,function(e){f.balloon("CookieMatcher["+r+"] - externalId: `"+e+"` !"),e&&(o={expires:(new Date).getTime()+72e5,externalId:e},s.save(i,JSON.stringify(o))),t(e)})},resetCache:function(){f.log("CookieMatcher: `"+r+"` is not recognized!"),s.remove(i)}}}function t(t,n){try{if(n.log("createHashChangeHandler"),"onhashchange"in t){if(t.addEventListener)return n.log("createHashChangeHandler created by addEventListener"),{addHashChangeCallback:function(e){t.addEventListener("hashchange",e)},removeHashChangeCallback:function(e){t.removeEventListener("hashchange",e)}};if(t.attachEvent)return n.log("createHashChangeHandler created by attachEvent"),{addHashChangeCallback:function(e){t.attachEvent("onhashchange",e)},removeHashChangeCallback:function(e){t.detachEvent("onhashchange",e)}}}return n.log("createHashChangeHandler unsupported"),{addHashChangeCallback:function(){},removeHashChangeCallback:function(){}}}catch(e){return n.error("createHashChangeHandler error occurred",e),{addHashChangeCallback:function(){},removeHashChangeCallback:function(){}}}}SyneriseTC={ver:3,dataType:{traffic:"traffic",formData:"formData",staticFile:"staticFile"},stat:{},server_port:{traffic:{http:80,https:443},formData:{http:80,https:443},staticFile:{http:80,https:443}},hosts:{traffic:"tck.snrbox.com",formData:"tck.snrbox.com",staticFile:"tc.snrbox.com"},forceProtocol:"https",domain:null,uuid:null,permUuid:null,emailHash:"",resetUuid:!1,uniqueVisitTime:86400,campaignUID:0,trackerUID:"",ushash:"_ush",ushashValue:"",short_last:1800,perm_last:94608e4,cookieManagerConfig:{providers:{native:{}}},cookieList:{},cookiePath:"/",uniqueVisits:1,allVisits:1,sessionVisits:1,appear:Math.round((new Date).getTime()/1e3),lastVisit:0,screen:null,ref:null,os:null,user:null,pageTimeLast:0,singleSessUid:g(),productId:null,botNotReact:!0,triggerPageVisitOnHashChange:!1,formCatch:{storageKeyIndex:"synerise-form-catch",stdType:"form",inputDataAttr:{skip:"skip",skipAsAttribute:"skip-as-attribute",email:"email"},skipFields:["__EVENTVALIDATION","__VIEWSTATEGENERATOR","__VIEWSTATE","__EVENTARGUMENT","__EVENTTARGET"],catchMode:"only-defined"},trafficStorageKeyIndex:"synerise-traffic-storage",gACode:null,customStatParams:null,customPageVisit:!1,trackerSpecialParams:{emailClick:{requiredParams:{snrs_cl:".+",snrs_cp:".+",snrs_cp_title:".*",snrs_medium:"email",snrs_he:"(-?[0-9]+)?"},category:"client.web.browser.mail",action:"newsletter.click",labelFromParam:"snrs_cp",processStatParams:function(e,t){if(SyneriseTC.checkEmailHashExists()||e.uuid===t.snrs_cl?SyneriseTC.checkEmailHashExists()&&t.snrs_he&&e.emailHash!==t.snrs_he&&SyneriseTC.setNewUUIDAndEmailHash(t.snrs_he,t.snrs_cl):(e.oldUuid=e.uuid,e.uuid=t.snrs_cl,SyneriseTC.setNewUUIDAndEmailHash(t.snrs_he,t.snrs_cl)),"1"==t.snrs_redir)return!1;var n={id:t.snrs_cp,campaignTitle:t.snrs_cp_title};e.params=SyneriseTC.appendToJson(e.params,n)}},webPushClick:{requiredParams:{snrs_cl:".+",snrs_cp:".+",snrs_cp_title:".*",snrs_medium:"web_push",snrs_he:"(-?[0-9]+)?"},category:"client.web.browser.pushmessage",action:"webpush.click",labelFromParam:"snrs_cp",processStatParams:function(e,t){if(SyneriseTC.checkEmailHashExists()||e.uuid===t.snrs_cl?!SyneriseTC.checkEmailHashExists()&&t.snrs_he&&e.emailHash!==t.snrs_he&&SyneriseTC.setNewUUIDAndEmailHash(t.snrs_he,t.snrs_cl):(e.oldUuid=e.uuid,e.uuid=t.snrs_cl,SyneriseTC.setNewUUIDAndEmailHash(t.snrs_he,t.snrs_cl)),"1"==t.snrs_redir)return!1;var n={id:t.snrs_cp,campaignTitle:t.snrs_cp_title};e.params=SyneriseTC.appendToJson(e.params,n)}},utm:{requiredParams:{"(snrs?|utm)_.*":".*"},processStatParams:function(s,c){u.get("native","_snrs_params",function(e){for(var t in f.log("utm processStatParams stat&snrsUrlParams&cookieSnrsParams",s,c,e),e&&(e=JSON.parse(e)),e||(e={}),f.log("utm processStatParams cookieSnrsParams",e),c)if(c.hasOwnProperty(t)){var n=c[t];e[t]=n}for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];e[r]=escape(i)}f.log("utm processStatParams cookieSnrsParams after escape",e);var o=new Date;o.setTime(o.getTime()+2592e5);var a=o.toGMTString();u.set("native","_snrs_params",JSON.stringify(e),a),s.params=SyneriseTC.appendToJson(s.params,e)})}},uuidFromUrl:{requiredParams:{snrs_cl:".+",snrs_he:"(-?[0-9]+)?"},processStatParams:function(e,t){SyneriseTC.checkEmailHashExists()||e.uuid===t.snrs_cl?SyneriseTC.checkEmailHashExists()&&t.snrs_he&&e.user_hash!==t.snrs_he&&SyneriseTC.setNewUUIDAndEmailHash(t.snrs_he,t.snrs_cl):(e.oldUuid=e.uuid,e.uuid=t.snrs_cl,SyneriseTC.setUuid(t.snrs_cl))}}},callbacks:{onReady:[],onStore:[]},isReady:!1,isInitialized:!1,ready:function(e){return f.log("Added onReady callback"),this.isReady?this.executeCallbacks([e]):this.callbacks.onReady.push(e),this},enhanceCookieManagerConfig:function(e){for(var t in e)e[t][0]&&e[t][1]&&"setDomain"===e[t][0]&&(this.cookieManagerConfig.domain=e[t][1])},init:function(e){if(f.setDebugLevel(),this.isInitialized)f.log("ALREADY INITIALIZED!");else{this.isInitialized=!0,l.get(),this.prepareCookieList();var t=this;f.log("Initializing cookie managers"),this.enhanceCookieManagerConfig(e),u.init(this.cookieManagerConfig,function(){f.log("Cookie manager initialized"),t.setInitParams(e),t.collect(),t.checkUserHash(),t.manageCookies(t.getCookieList(),function(){t.checkExternalCookies(function(){if(t.gACode&&null!==t.gACode&&t.setGATracker(),!1===t.customPageVisit&&t.initPageHandler(),t.initFormCatch(),!1===t.customPageVisit){var e=t.storeData(t.trafficStorageKeyIndex,t.buildParamsForStat());t.storeTraffic({},function(){t.removeStoredData(t.trafficStorageKeyIndex,e)})}t.isReady=!0,f.log("Executing onReady callbacks"),t.executeCallbacks(t.callbacks.onReady),l.log(l.get()),void 0!==t.initCookieMatchers&&t.initCookieMatchers()})})})}},getPageHandler:function(){return this._pageHandler||(this._pageHandler=r(this,window.history,f)),this._pageHandler},getHashChangeHandler:function(){return this._hashChangeHandler||(this._hashChangeHandler=t(window,f)),this._hashChangeHandler},initPageHandler:function(){var e=this.getPageHandler();e&&(e.attachHistoryHandler(),this.getTriggerPageVisitOnHashChange()&&e.attachHashHandler(this.getHashChangeHandler()))},setTriggerPageVisitOnHashChange:function(e){this.triggerPageVisitOnHashChange=e},getTriggerPageVisitOnHashChange:function(){return this.triggerPageVisitOnHashChange},setInitParams:function(e){for(var t in f.balloon("Init with params",e),e)if(e.hasOwnProperty(t))try{var n=e[t][0];if(void 0!==n){if(!this.hasOwnProperty(n)){f.log(new Error('Unknown function "'+n+'" in init args!'));continue}var r=e[t][1];Array.isArray(r)||(r=[r]),this[n].apply(this,r)}}catch(e){f.log(e),f.balloon("Method not allowed or missing args")}if(""===this.trackerUID||!this.trackerUID)throw new Error("Method not allowed or missing args")},checkExternalCookies:function(t){var n=this;u.get("native","_snrs_reset_uuid",function(e){"true"!==e&&1!==parseInt(e)||(f.balloon("Reset UUID by cookie flag"),n.setResetUuid(!0),u.remove("native","_snrs_reset_uuid")),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)&&(f.balloon("Reset UUID by cookie with value"+e),n.setUuid(e),n.setResetUuid(!0),u.remove("native","_snrs_reset_uuid")),"function"==typeof t&&t()})},setUuid:function(t,e){if(this.uuid=t,f.balloon("SETTING UUID TO: "+this.uuid),this.permUuid||(this.permUuid=this.uuid,f.balloon("SETTING PERM-UUID TO: "+this.permUuid)),!0===e){var n=this.getCookieList();this.removeCookie(n.perm),this.manageCookies(n,function(){})}try{SR.client.getCurrentClient().then(function(e){e&&(e.uuid=t,SR.client.update(e,!1))})}catch(e){f.error("ERROR: setUuid SR.client",e)}},getUuid:function(){return this.uuid},setResetUuid:function(e){f.balloon("SET RESET UUID TO: "+e),this.resetUuid=e},getResetUuid:function(){return this.resetUuid},mergeObjects:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];"object"==typeof r&&"object"==typeof e[n]?e[n]=this.mergeObjects(e[n],r):e[n]=r}return e},appendToJson:function(e,t){var n=t;return e&&(n=JSON.parse(e),n=SyneriseTC.mergeObjects(n,t)),JSON.stringify(n)},parseDataType:function(e){return void 0===e?this.dataType.traffic:void 0!==this.dataType[e]?e:this.dataType.traffic},getProtocol:function(){if(void 0!==this.forceProtocol&&this.forceProtocol)return this.forceProtocol;var e=void 0!==document.location.protocol?document.location.protocol:"https";return(e=e.replace(":","")).match("https?")||(e="https"),e},getHost:function(e){return e=this.parseDataType(e),this.hosts[e]},getPort:function(e,t){t=this.parseDataType(t);var n=this.server_port[t].http;return"undefined"!==this.server_port[t][e]&&(n=this.server_port[t][e]),n},prepareUrl:function(e,t){var n=this.getProtocol();return n+"://"+this.getHost(e)+":"+this.getPort(n,e)+t},prepareCookieList:function(){this.cookieList={shorta:{name:"_snrs_sa",last:this.short_last},shortb:{name:"_snrs_sb",last:this.short_last},perm:{name:"_snrs_p",last:this.perm_last},uuid:{name:"_snrs_uuid",last:this.perm_last},permUuid:{name:"_snrs_puuid",last:this.perm_last}}},getCookieList:function(){return this.cookieList&&this.cookieList.length||this.prepareCookieList(),this.cookieList},manageCookies:function(t,n){var r=0;for(var i in t)t.hasOwnProperty(i)&&r++;var o=this;for(var i in t)t.hasOwnProperty(i)&&this.getCookie(t[i],function(e){void 0!==e&&e&&o.updateOpt(e),o.setCookie(t[i]),0===--r&&n()});o.setStartOpt()},setStartOpt:function(){var e=Math.round((new Date).getTime()/1e3);this.appear=this.appear||e,this.initial=this.initial||e,this.lastVisit=this.lastVisit||e,this.current=this.current||e,this.allVisits=this.allVisits||1,this.sessionVisits=this.sessionVisits||1,this.uniqueVisits=this.uniqueVisits||1},updateOpt:function(e){for(var t=e.split("&"),n={},r=(new Date).getTime()/1e3,i=0;i<t.length;i++){var o=t[i].split(":");n[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}n.hasOwnProperty("uuid")&&"undefined"!==n.uuid&&"null"!==n.uuid&&n.uuid&&(this.setUuid(n.uuid),n.hasOwnProperty("permUuid")||(this.permUuid=this.getUuid())),n.hasOwnProperty("permUuid")&&"undefined"!==n.permUuid&&"null"!==n.permUuid&&n.permUuid&&(this.permUuid=n.permUuid),n.hasOwnProperty("emailHash")&&"undefined"!==n.emailHash&&"null"!==n.emailHash&&n.emailHash&&(this.emailHash=n.emailHash),n.hasOwnProperty("appear")&&(this.appear=n.appear,this.pageTimeLast=Math.round(r-this.appear),n.hasOwnProperty("ssuid")&&(this.singleSessUid=n.ssuid)),n.hasOwnProperty("init")&&(this.initial=n.init),n.hasOwnProperty("last")&&(this.lastVisit=n.last,r-this.lastVisit>this.uniqueVisitTime?(this.lastVisit=r,n.hasOwnProperty("uniqueVisits")&&(this.uniqueVisits=++n.uniqueVisits)):n.hasOwnProperty("uniqueVisits")&&(this.uniqueVisits=n.uniqueVisits)),n.hasOwnProperty("sessionVisits")&&(this.sessionVisits=++n.sessionVisits),n.hasOwnProperty("allVisits")&&(this.allVisits=++n.allVisits),n.hasOwnProperty("init")&&(this.current=Math.round((new Date).getTime()/1e3))},storeData:function(e,t,n){void 0!==n&&n||(n=e+"_"+g());var r=this.getSavedData(e);return s.save(n,JSON.stringify(t)),r[n]=n,s.save(e,JSON.stringify(r)),n},removeStoredData:function(e,t){var n=this.getSavedData(e);s.remove(t),delete n[t],s.save(e,JSON.stringify(n))},resendStoredData:function(e,t){var n=this.getSavedData(e);if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=JSON.parse(s.get(r));f.log("SAVED DATA: "+r,i),i?(void 0===i.__retried__&&(i.__retried__=1),f.log("RESEND DATA RETRY: "+i.__retried__),100<i.__retried__?this.removeStoredData(e,r):(i.__retried__++,this.storeData(e,i,r),t(r,i))):this.removeStoredData(e,r)}},sleep:function(e){for(var t=(new Date).getTime();(new Date).getTime()<t+e;);},caughtForms:[],initFormCatch:function(e){e=void 0===e?document:e;var s=this,t=[];"form"===e.nodeName.toLowerCase()?t.push(e):t=e.getElementsByTagName("form");for(var n=0;n<t.length;n++)!function(i){var o=i.getAttribute("data-synerise");if(null!==o&&-1===s.caughtForms.indexOf(i)){""===o.replace(" ","")&&(o=s.formCatch.stdType),f.balloon("Binding to form: "+o,i);var e=i.getAttribute("data-synerise-catch-mode")||s.formCatch.catchMode;f.log("Catch mode: "+e);var a=i.onsubmit;i.onsubmit=function(e){f.log("Form on submit",e,this);var t=!0;"function"===(typeof a).toLowerCase()&&(t=a(e),f.log("Original submit returned:",t));try{if(!1===t)f.balloon("STOPPED FORM SUBMIT (ORIGINAL SUBMIT RETURNED FALSE)",i);else{var n=s.getFormData(i),r=i.getAttribute("data-synerise");r&&(o=r),s.sendFormData.call(s,o,n.fields,n.fieldsMapping,n.skipAsAttributes)}}catch(e){f.error("ERROR:",e)}return s.sleep(500),t},s.caughtForms.push(i)}}(t[n])},getSavedForms:function(){return this.parseJson(s.get(this.formCatch.storageKeyIndex))},getSavedData:function(e){return this.parseJson(s.get(e))},sendForm:function(e){},setNewUUIDAndEmailHash:function(e,t){f.log('Set new uuid and emailHash" '+e+" "+t+'"'),f.balloon("Email hash has been changed !"),f.balloon('CHANGING UUID! "'+this.uuid+'" to "'+t+'"'),this.setUuid(t),this.setResetUuid(!0),this.emailHash=e;var n=this.getCookieList();this.setCookie(n.perm)},checkEmailHashExists:function(){return this.emailHash&&"null"!==this.emailHash&&"0"!==this.emailHash&&0!==this.emailHash},resetUUIDByEmailHash:function(e){if(e){if(this.checkEmailHashExists()&&(f.log('Saved email hash: "'+this.emailHash+'"'),parseInt(e)!==parseInt(this.emailHash))){f.balloon("Email hash has been changed !");f.balloon('CHANGING UUID! "'+this.uuid+'" to "null"'),this.setUuid(null),this.setResetUuid(!0)}this.emailHash=e;var t=this.getCookieList();this.setCookie(t.perm)}},sendFormData:function(e,t,n,r,i){f.log("sendFormData",this,e,t,n,r);var o=this;if(i=i||function(){},void 0!==n&&n||(n=this.formCatch.inputDataAttr),n.email=n.email||this.formCatch.inputDataAttr.email,void 0!==t[n.email]){var a=t[n.email],s=this.hashString(a);f.log('Generated hash "'+s+'" from email "'+a+'"'),this.resetUUIDByEmailHash(s)}var c={formType:e,formFieldsMapping:JSON.stringify(n),formData:JSON.stringify(t),formSkipAsAttributes:JSON.stringify(r),category:"client.web.browser.contact",action:"form.submit",label:e},u=this.storeData(this.formCatch.storageKeyIndex,this.customStatParams);this.storeFormData(c,function(){o.removeStoredData(o.formCatch.storageKeyIndex,u),i(this.uuid)}),this.customStatParams=null},getCookie:function(e,t){var n=e.last>this.short_last?"evercookie":"native";u.get(n,e.name,t)},setCookie:function(e){var t=e.last>this.short_last?"evercookie":"native",n=this.buildSForCookie(e.name),r=new Date;r.setTime(r.getTime()+1e3*e.last);var i=r.toGMTString();return u.set(t,e.name,n,i)},removeCookie:function(e){var t=e.last>this.short_last?"evercookie":"native";return u.remove(t,e.name)},checkUserHash:function(){var e={name:this.ushash},t=this;this.getCookie(e,function(e){e&&(t.ushashValue=e)})},setTracker:function(e){this.trackerUID=e},setCustomPageVisit:function(e){this.customPageVisit=e},setDomain:function(e){f.log("set custom domain",e),this.domain=e},setCampaign:function(e){this.campaignUID=e},setGAnalyticsCode:function(e){this.gACode=e},setProductId:function(e){this.productId=e},collect:function(){this.screen=this.getScreenInfo(),this.ref=this.getReferrer();var e=this.getOsInfo();return!1!==e&&(this.os=e),this.user=this.getUserInfo(),!1},isCrawler:function(){return"BOT"===this.os.os},hashString:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t},buildSForCookie:function(e){var t=[],n=[];if(n[this.cookieList.shorta.name]={ssuid:this.singleSessUid,appear:this.appear,sessionVisits:this.sessionVisits},n[this.cookieList.shortb.name]={ssuid:this.singleSessUid,leaves:Math.round((new Date).getTime()/1e3)},n[this.cookieList.perm.name]={host:this.user.hostn,permUuid:this.permUuid,uuid:this.uuid,emailHash:this.emailHash,user_hash:this.ushashValue,init:this.initial,last:this.lastVisit,current:this.current,uniqueVisits:this.uniqueVisits,allVisits:this.allVisits},n[this.cookieList.uuid.name]=this.uuid,n[this.cookieList.permUuid.name]=this.permUuid,"string"===(typeof n[e]).toLowerCase())return n[e];for(var r in n[e])n[e].hasOwnProperty(r)&&t.push(encodeURIComponent(r)+":"+encodeURIComponent(n[e][r]));return t.join("&")},buildSForStat:function(e){return function e(t,n){var r=[];for(var i in t)if(t.hasOwnProperty(i)&&i){var o=n?n+"["+i+"]":i,a=t[i];if(!i.trim())continue;r.push("object"==typeof a&&a?e(a,o):encodeURIComponent(o)+"="+encodeURIComponent(a))}return r.join("&")}(this.buildParamsForStat(e))},buildParamsForStat:function(e){var t=Math.round((new Date).getTime()/1e3),n=SR?SR.core:null,r=n?n.getFullVersion()+":"+n.getBuildTime():null,i={uuid:this.getUuid(),ssuid:this.singleSessUid,user_hash:this.ushashValue,emailHash:this.emailHash,tck:this.user.trcr,campaign:this.user.campaign,host:this.user.hostn,location:this.user.loc,title:this.user.ptitle,ver:this.user.ver,color:this.screen.color,encoding:this.screen.encoding,lang:this.screen.language,res:this.screen.resolution,refdomain:this.ref.domain,ref:this.ref.ref,browser:this.os.browser,browserver:this.os.browserVersion,ecookies:this.os.cookies,mobile:this.os.mobile,os:this.os.os,osver:this.os.osVersion,init:t,last:this.lastVisit,current:t,long:this.pageTimeLast,visits:this.allVisits,s_visits:this.sessionVisits,u24_visits:this.uniqueVisits,productRef:this.productId,eventUUID:g(),snr_sdk_version:r};this.user.uriHash&&(i.uriHash=this.user.uriHash),i.uuid&&null!=i.uuid||delete i.uuid,this.getResetUuid()&&(i.resetUuid=this.getResetUuid(),void 0!==this.resetCookieMatchers&&this.resetCookieMatchers()),this.appendOgTags(i),this.customStatParams&&(i.params=this.customStatParams),i.params&&"string"!==(typeof i.params).toLowerCase()&&(i.params=JSON.stringify(i.params));var o=this.getSnrsUrlParams(),a=function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],i=!1;for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];if(o.match(n)&&a.match(r)){i=!0;break}}if(!i)return!1}return!0};for(var s in f.balloon("SnrsUrlParams: "+JSON.stringify(o)),this.trackerSpecialParams)if(this.trackerSpecialParams.hasOwnProperty(s)){var c=null,u=null,l=null,d=!0,h=this.trackerSpecialParams[s];a(o,h.requiredParams)?("function"==typeof h.processStatParams&&(d=!1!==h.processStatParams(i,o)),d&&(void 0!==h.category&&h.category&&(c=h.category),void 0!==h.action&&h.action&&(u=h.action),void 0!==h.label?l=h.label:void 0!==h.labelFromParam&&(l=o[h.labelFromParam])),f.log('Processing "'+s+'" special params. Result: '+c+" / "+u+" / "+l),c&&(i.category=c),u&&(i.action=u),l&&(i.label=l)):f.log('Special params in url failed for "'+s+'". For parameters: ',o,h.requiredParams)}if(void 0!==e&&e)for(var p in e)e.hasOwnProperty(p)&&(i[p]=e[p]);return i},getSnrsUrlParams:function(){var e={},t=document.location.search.split("&");for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],i=new RegExp(/(\?|&)?((snrs?|utm)_[^=\?&]+)=([^=&\?]*)/gi).exec(r);i&&5===i.length&&(e[i[2]]=i[4])}return e},appendOgTags:function(e){var t=this.getOgTag();0!=Object.keys(t).length?(e.ogTags=JSON.stringify(t),f.log("Adding og tags: "+e.ogTags)):f.log("No og tags in document"),delete t},getOgTag:function(){for(var e={},t={"product:category":"array"},n=new RegExp("og:("+["title","url","type","site_name","image"].join("|")+")|product:.+","i"),r=document.getElementsByTagName("meta"),i=0;i<r.length;i++){var o=r[i];if(o.getAttribute("property")){var a=o.getAttribute("property");if(!n.test(a))continue;var s=o.getAttribute("content");if(void 0!==t[a])switch(t[a]){case"array":void 0===e[a]&&(e[a]=[]),e[a].push(s)}else void 0===e[a]&&(e[a]=s)}}return e},getScreenInfo:function(){var e=null,t=null,n=null,r=null;if(screen)e=screen.width+"x"+screen.height,t=screen.colorDepth+"-bit";else if(java){var i=java.awt.Toolkit.getDefaultToolkit().getScreenSize();e=i.width+"x"+i.height}return navigator.language?n=navigator.language.toLowerCase():navigator.browserLanguage&&(n=navigator.browserLanguage.toLowerCase()),document.characterSet?r=this.encodeString(document.characterSet):document.charset&&(r=this.encodeString(document.charset)),{encoding:r,resolution:e,color:t,language:n}},parseJson:function(t){var e={};if("string"===(typeof t).toLowerCase())try{e=JSON.parse(t)}catch(e){f.balloon("parseJson - Wrong JSON format! :: "+t)}else e={};return e},getOsInfo:function(){var e,t,n,r=navigator.appVersion,i=navigator.userAgent,o=navigator.appName,a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);-1!==(t=i.indexOf("Opera"))?(o="Opera",a=i.substring(t+6),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("OPR/"))?(o="Opera",a=i.substring(t+4)):-1!==(t=i.indexOf("Edge"))?(o="Microsoft Edge",a=i.substring(t+5)):-1!==(t=i.indexOf("MSIE"))?(o="Microsoft Internet Explorer",a=i.substring(t+5)):-1!==(t=i.indexOf("Chrome"))?(o="Chrome",a=i.substring(t+7)):-1!==(t=i.indexOf("Safari"))?(o="Safari",a=i.substring(t+7),-1!==(t=i.indexOf("Version"))&&(a=i.substring(t+8))):-1!==(t=i.indexOf("Firefox"))?(o="Firefox",a=i.substring(t+8)):-1!==i.indexOf("Trident/")?(o="Microsoft Internet Explorer",a=i.substring(i.indexOf("rv:")+3)):(e=i.lastIndexOf(" ")+1)<(t=i.lastIndexOf("/"))&&(o=i.substring(e,t),a=i.substring(t+1),o.toLowerCase()==o.toUpperCase()&&(o=navigator.appName)),-1!==(n=a.indexOf(";"))&&(a=a.substring(0,n)),-1!==(n=a.indexOf(" "))&&(a=a.substring(0,n)),-1!==(n=a.indexOf(")"))&&(a=a.substring(0,n)),s=parseInt(""+a,10),isNaN(s)&&(a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10));var c=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(r),u=!!navigator.cookieEnabled;void 0!==navigator.cookieEnabled||u||(document.cookie="testcookie",u=-1!==document.cookie.indexOf("testcookie"));var l="-",d=[{s:"BOT",r:/(Googlebot|Mediapartners-Google|Web Preview|bot|Applebot|spider|crawler|Feedfetcher|Slurp|Twiceler|Nutch|BecomeBot|bingbot|BingPreview|Google Web Preview|WordPress.com mShots|Seznam|facebookexternalhit|Yandex|Teoma|ThumbSniper|Phantom|Nuhk|DuckDuckBot|sogou|Exabot|facebook|ia_archiver|slack|msnbot|adidxbot|Ask Jeeves)/},{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}];for(var h in d)if(d.hasOwnProperty(h)){var p=d[h];if(p.r.test(i)){l=p.s;break}}var f="-";switch(/Windows/.test(l)&&(f=/Windows (.*)/.exec(l)[1],l="Windows"),l){case"Mac OS X":var g=/Mac OS X (10[\.\_\d]+)/.exec(i);null!==g&&(f=g[1]);break;case"Android":f=/Android ([\.\_\d]+)/.exec(i)[1];break;case"iOS":f=(f=/OS (\d+)_(\d+)_?(\d+)?/.exec(r))[1]+"."+f[2]+"."+(0|f[3])}return{browser:o,browserVersion:a,mobile:c,os:l,osVersion:f,cookies:u}},getUserInfo:function(){var e=document.location.pathname+document.location.search,t={ver:this.ver,trcr:this.trackerUID,campaign:this.campaignUID,ptitle:this.encodeString(document.title),hostn:this.encodeString(document.location.hostname),loc:e};return location.hash&&(t.uriHash=location.hash),t},getReferrer:function(){var e,t,n,r=document.referrer,i=0;return"0"==r||""==r||"-"==r?{domain:"",ref:""}:(e=r.indexOf("://"))<0?{domain:"",ref:""}:(n="",-1<(t=r.substring(e+3,r.length)).indexOf("/")&&(-1<(n=t.substring(t.indexOf("/"),t.length)).indexOf("?")&&(n=n.substring(0,n.indexOf("?"))),t=t.substring(0,t.indexOf("/"))),-1<(e=(i=t=t.toLowerCase()).indexOf(":"))&&(i=i.substring(0,e)),0===t.indexOf("www.")&&(t=t.substring(4,t.length)),{domain:this.encodeChar(t,null),ref:this.encodeChar(n,null)})},setGATracker:function(){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.innerText="ga('set', '&uid', '"+this.uuid+"');ga('set', 'dimension1', '"+this.uuid+"'); ga('send', 'pageview');",document.body.appendChild(e)},getFormData:function(e,t){var n,r,i={fieldsMapping:{},fields:{},skipAsAttributes:[]};if(!e||"form"!==e.nodeName.toLowerCase())return i;var o,a,s="",c=e.getAttribute("data-synerise-catch-mode")||this.formCatch.catchMode;for(f.log("Catch mode: "+c),n=e.elements.length-1;0<=n;n-=1){a=(o=e.elements[n]).name;var u=o.getAttribute("data-synerise");if(u!==this.formCatch.inputDataAttr.skip)if("all"===c||null!==u){if(u===this.formCatch.inputDataAttr.skipAsAttribute&&(i.skipAsAttributes.push(a),u=null),""===a){if(!u)continue;a=u}if(-1===this.formCatch.skipFields.indexOf(a)){s="";var l=o.getAttribute("data-synerise-value");switch(null!=l?s=l:void 0!==o.value&&(s=o.value),!0===t&&(s=this.encodeString(s)),o.nodeName.toUpperCase()){case"INPUT":switch(void 0!==u&&u&&(i.fieldsMapping[u]=a),o.type){case"password":case"reset":break;case"text":case"hidden":case"button":case"submit":i.fields[a]=s;break;case"checkbox":case"radio":o.checked&&(i.fields[a]=s);break;case"file":break;default:i.fields[a]=s}break;case"TEXTAREA":i.fields[a]=s;break;case"SELECT":switch(o.type){case"select-one":i.fields[a]=s;break;case"select-multiple":for(r=o.options.length-1;0<=r;r-=1)if(o.options[r].selected){var d=o.options[r].getAttribute("data-synerise-value");s=null!=d?d:o.options[r].value,!0===t&&(s=this.encodeString(s)),i.fields[a]=s}}break;case"BUTTON":switch(o.type){case"submit":case"button":i.fields[a]=s}}}else f.log("Skipped field: "+a)}else f.log('Skipped field: "'+a+'" - "data-synerise" attribute is not defined')}return i},domObject:{getClassList:function(e){if(void 0!==e.className)return e.className.split(" ")},hasClass:function(e,t){for(var n=this.getClassList(e),r=0;r<n.length;r++)if(n[r]===t)return!0;return!1}},appendJS:function(e,t){l.get(e),f.balloon("JS Loading: "+e);var n=document.createElement("script");n.onload=function(){f.balloon("JS Loaded: "+e+" in "+l.get(e).getElapsedTimeString()),t&&t()},n.src=e;var r=function(e,t){var n=document.getElementsByTagName(e);return!!n.length&&((n=n[0]).appendChild(t),!0)};r("head",n)||r("body",n)||r("html",n)},encodeString:function(e,t){return"function"==typeof encodeURIComponent?t?encodeURI(e):encodeURIComponent(e):escape(e)},encodeChar:function(e){var t="";if(!e||""===e)return"";for(var n=0;n<e.length;n++)" "===e.charAt(n)?t+="+":t+=e.charAt(n);return t},executeCallbacks:function(e,t){if(t=void 0===t?[this]:t,!e||!e.length)return!1;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];"function"===(typeof r).toLowerCase()&&r.apply(this,r,t)}},store:function(e,r,t){if(r="function"===(typeof r).toLowerCase()?r:function(){},this.isCrawler())return f.warning("Prevented store - crawler detected"),void r.apply(this,r,[this]);t=this.parseDataType(t);var i=l.get("store_"+t),n=this.buildSForStat(e),o=this.prepareUrl(t,"/gif/"+this.trackerUID+"?"+n),a=this;d.get(o,function(e){if(200===e.status){a.setResetUuid(!1);var t=e.getResponseHeader("Client-UUID");t&&"null"!==t.toLowerCase()&&(f.balloon("GOT Client-UUID IN HEADER FROM tck: `"+t+"` !"),a.setUuid(t,!0)),i.log(),r.apply(a,r,[a])}else if(f.error("XHR - ERROR LOADING PIX !!!"),!a.getUuid()||"null"==a.getUuid().toLowerCase()){var n=g();f.balloon("UUID is NULL SET NEW UUID: `"+n+"` !"),a.setUuid(n,!0),r.apply(a,r,[a])}})},storeTraffic:function(e,t){this.store(e,t,this.dataType.traffic)},storeFormData:function(e,t){this.store(e,t,this.dataType.formData)},pageVisit:function(e){f.log("custom page visit with data: ",e),this.collect();var t=this.storeData(this.trafficStorageKeyIndex,this.buildParamsForStat());this.storeTraffic(e,function(){this.removeStoredData(this.trafficStorageKeyIndex,t)})}},void 0!==e&&(SyneriseTC.initCookieMatchers=e.initCookieMatchers.bind(e),SyneriseTC.resetCookieMatchers=e.resetCookieMatchers.bind(e),SyneriseTC.initCookieMatching=e.initCookieMatching.bind(e),SyneriseTC.setCookieMatchersPromise=e.setCookieMatchersPromise.bind(e),SyneriseTC.getCookieMatchersPromise=e.getCookieMatchersPromise.bind(e));var s={isAvailable:function(){if("undefined"!=typeof Storage&&"undefined"!=typeof localStorage)try{return localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage"),!0}catch(e){return f.log("Local storage isn't available"),!1}return f.log("Local storage isn't available"),!1},save:function(e,t){return!!this.isAvailable()&&(f.log('LocalStorage - SAVE: "'+e+'" with value: "'+t+'"'),localStorage[e]=t,!0)},get:function(e){if(!this.isAvailable())return!1;var t=void 0!==localStorage[e]?localStorage[e]:null;return f.log('LocalStorage - GET: "'+e+'" with value: "'+t+'"'),t},remove:function(e){return!!this.isAvailable()&&(void 0!==localStorage[e]&&delete localStorage[e],f.log('LocalStorage - Remove: "'+e+'"'),!0)}},f={debug:!1,target:"console",boxObject:null,balloonObject:null,balloonTimeout:null,setDebugLevel:function(){this.debug=document.location.href.match(/SYNERISETC_DEBUG=?(box|console)?/i),this.debug&&this.debug.length&&void 0!==this.debug[1]&&this.debug[1]&&(this.target=this.debug[1].toLowerCase())},_write:function(e,t){if(this.debug&&"undefined"!=typeof console){for(var n in t)if(t.hasOwnProperty(n)&&n instanceof Error){e="error";break}var r=l.get().getElapsedTimeString();"console"===this.target?(void 0===console[e]&&(e="info"),console[e]("SyneriseTC ["+r+"]",t)):"box"===this.target&&this.boxLogger(e,r,t)}else this._write=function(){}},balloon:function(){if(!this.debug)return!1;this.balloonObject||(this.balloonObject=document.createElement("div"),this.balloonObject.tabindex="0",this.balloonObject.style="position: fixed; bottom: 0px; right: 0px; z-index: 999999; background: #EEE; color: #000; border: 1px solid #F00; padding: 5px 5px; font-family: monospace; white-space: pre;");var e=document.createElement("li");e.style="border-bottom: 1px solid #ddd; padding: 2px 5px;";var t=[];for(var n in arguments)if(arguments.hasOwnProperty(n)&&!(arguments[n]instanceof HTMLElement)){var r="";isNaN(n)&&(r+=n+": "),r+=arguments[n],t.push(r)}e.innerHTML=t.join(" &#9483; ");var i=document.createElement("ul");i.appendChild(e),this.balloonObject.appendChild(i);var o=this,a=function(){o.balloonTimeout&&clearTimeout(o.balloonTimeout),o.balloonTimeout=setTimeout(function(){document.body.removeChild(o.balloonObject),o.balloonObject=null},15e3)};this.balloonObject.onmouseover=function(){clearTimeout(o.balloonTimeout)},this.balloonObject.onmouseout=a,document.body.appendChild(this.balloonObject),a(),this._write("log",arguments)},log:function(){this._write("log",arguments)},error:function(){this.balloon.apply(this,arguments),this._write("error",arguments)},warning:function(){this._write("warning",arguments)},boxLogger:function(e,t,n){this.boxObject||(this.boxObject=document.createElement("div"),this.boxObject.id="SYNERISE_TC_LOGGER_BOX",this.boxObject.style.position="fixed",this.boxObject.style.bottom="0px",this.boxObject.style.right="0px",this.boxObject.style.width="98%",this.boxObject.style.height="50%",this.boxObject.style.padding="5px 10px",this.boxObject.style.margin="0 auto",this.boxObject.style.overflowY="auto",this.boxObject.style.wordWrap="break-word",this.boxObject.style.background="lightsteelblue",this.boxObject.style.color="black",this.boxObject.style.fontSize="1.2em",this.boxObject.style.fontWeight="bold",this.boxObject.style.lineHeight="1.5em",document.body.appendChild(this.boxObject));var r="#000";for(var i in"error"===e.toLowerCase()&&(r="#F00"),this.boxObject.innerHTML+='<div style="font-size: 0.8em; font-weight: normal;">--- '+t+"</div>",n)n.hasOwnProperty(i)&&(this.boxObject.innerHTML+='<div style="color: '+r+';">'+n[i]+"</div>")}};function r(t,e,s){function n(){s.log("page handler - collect data"),t.collect();var e=t.storeData(t.trafficStorageKeyIndex,t.buildParamsForStat());t.storeTraffic({},function(){t.removeStoredData(t.trafficStorageKeyIndex,e)})}function c(e){try{setTimeout(function(){s.log("page handler - history handler - after time delay",e),n()},200)}catch(e){s.log("page handler - history handler error",e)}}return{attachHistoryHandler:function(){var t,n,r,i,o,a;s.log("page handler - attachHistoryHandler"),n=s,r=(t=e).pushState,t.pushState=function(e){return"function"==typeof t.onpushstate&&t.onpushstate({state:e}),n.log("page handler - history handler pushState triggered",e),c(e),r.apply(t,arguments)},o=s,a=(i=e).replaceState,i.replaceState=function(e){return"function"==typeof i.onreplacestate&&i.onreplacestate({state:e}),o.log("page handler - history handler replaceState triggered",e),c(e),a.apply(i,arguments)}},attachHashHandler:function(e){s.log("page handler - attachHashHandler"),e.addHashChangeCallback(function(e){s.log("page handler - hash handler change triggered",e),n()})}}}var l={objects:[],_timerObject:function(e){this.label=e,this.time=(new Date).getTime(),this.getLabel=function(){return this.label},this.getElapsedTime=function(){return(new Date).getTime()-this.time},this.getElapsedTimeString=function(){return this.getElapsedTime()+" ms"},this.log=function(){l.log(this)}},create:function(e){var t=new this._timerObject(e);return this.objects[e]=t},get:function(e){return void 0!==e&&e||(e="__main__"),void 0===this.objects[e]&&(this.objects[e]=new this._timerObject(e)),this.objects[e]},log:function(e){f.log('Timer "'+e.getLabel()+'" took '+e.getElapsedTimeString())}};function g(){var n=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})}var d={get:function(e,t,n){return this._request("GET",e,{},t,n)},post:function(e,t,n,r,i){return void 0===i&&(i="application/x-www-form-urlencoded"),f.log("XHR POST DATA: "+t),this._request("POST",e,t,n,r,i)},_request:function(e,t,n,r,i,o){l.get(t);var a=new XMLHttpRequest;if(a.open(e,t,!0),a.withCredentials=!0,a.timeout=5e3,d.ontimeout=function(e){f.error("XHR Timeout!!",e)},void 0!==i)for(var s in i)if(i.hasOwnProperty(s)){var c=i[s];a.setRequestHeader(s,c)}o&&a.setRequestHeader("Content-type",o),f.log('XHR Requesting "'+t+'" using method "'+e+'"'),a.onreadystatechange=function(){4===a.readyState&&(f.log('XHR Request Finished "'+t+'" in '+l.get(t).getElapsedTimeString()),r(a))},a.send(n)}},i=!1;if("undefined"!=typeof _riseA&&_riseA.length?i=_riseA:void 0!==window._riseA&&window._riseA.length?i=window._riseA:(f.setDebugLevel(),f.warning('WARNING: "_riseA" is undefined or empty')),i)try{SyneriseTC.init(i)}catch(e){f.setDebugLevel(),f.error("ERROR:",e)}}();